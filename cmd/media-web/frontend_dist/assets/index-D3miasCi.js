(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();var Ir,B,Hi,Vi,Ve,Hn,qi,Wi,Gi,_n,Qr,en,zt={},Ji=[],ws=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Er=Array.isArray;function ke(e,t){for(var r in t)e[r]=t[r];return e}function wn(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Ss(e,t,r){var n,o,i,a={};for(i in t)i=="key"?n=t[i]:i=="ref"?o=t[i]:a[i]=t[i];if(arguments.length>2&&(a.children=arguments.length>3?Ir.call(arguments,2):r),typeof e=="function"&&e.defaultProps!=null)for(i in e.defaultProps)a[i]===void 0&&(a[i]=e.defaultProps[i]);return lr(e,a,n,o,null)}function lr(e,t,r,n,o){var i={type:e,props:t,key:r,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++Hi,__i:-1,__u:0};return o==null&&B.vnode!=null&&B.vnode(i),i}function G(e){return e.children}function At(e,t){this.props=e,this.context=t}function ct(e,t){if(t==null)return e.__?ct(e.__,e.__i+1):null;for(var r;t<e.__k.length;t++)if((r=e.__k[t])!=null&&r.__e!=null)return r.__e;return typeof e.type=="function"?ct(e):null}function Yi(e){var t,r;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((r=e.__k[t])!=null&&r.__e!=null){e.__e=e.__c.base=r.__e;break}return Yi(e)}}function Vn(e){(!e.__d&&(e.__d=!0)&&Ve.push(e)&&!fr.__r++||Hn!=B.debounceRendering)&&((Hn=B.debounceRendering)||qi)(fr)}function fr(){for(var e,t,r,n,o,i,a,l=1;Ve.length;)Ve.length>l&&Ve.sort(Wi),e=Ve.shift(),l=Ve.length,e.__d&&(r=void 0,n=void 0,o=(n=(t=e).__v).__e,i=[],a=[],t.__P&&((r=ke({},n)).__v=n.__v+1,B.vnode&&B.vnode(r),Sn(t.__P,r,n,t.__n,t.__P.namespaceURI,32&n.__u?[o]:null,i,o??ct(n),!!(32&n.__u),a),r.__v=n.__v,r.__.__k[r.__i]=r,Qi(i,r,a),n.__e=n.__=null,r.__e!=o&&Yi(r)));fr.__r=0}function Zi(e,t,r,n,o,i,a,l,f,d,g){var p,y,m,w,b,C,T,I=n&&n.__k||Ji,R=t.length;for(f=bs(r,t,I,f,R),p=0;p<R;p++)(m=r.__k[p])!=null&&(y=m.__i==-1?zt:I[m.__i]||zt,m.__i=p,C=Sn(e,m,y,o,i,a,l,f,d,g),w=m.__e,m.ref&&y.ref!=m.ref&&(y.ref&&bn(y.ref,null,m),g.push(m.ref,m.__c||w,m)),b==null&&w!=null&&(b=w),(T=!!(4&m.__u))||y.__k===m.__k?f=Xi(m,f,e,T):typeof m.type=="function"&&C!==void 0?f=C:w&&(f=w.nextSibling),m.__u&=-7);return r.__e=b,f}function bs(e,t,r,n,o){var i,a,l,f,d,g=r.length,p=g,y=0;for(e.__k=new Array(o),i=0;i<o;i++)(a=t[i])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=e.__k[i]=lr(null,a,null,null,null):Er(a)?a=e.__k[i]=lr(G,{children:a},null,null,null):a.constructor===void 0&&a.__b>0?a=e.__k[i]=lr(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):e.__k[i]=a,f=i+y,a.__=e,a.__b=e.__b+1,l=null,(d=a.__i=xs(a,r,f,p))!=-1&&(p--,(l=r[d])&&(l.__u|=2)),l==null||l.__v==null?(d==-1&&(o>g?y--:o<g&&y++),typeof a.type!="function"&&(a.__u|=4)):d!=f&&(d==f-1?y--:d==f+1?y++:(d>f?y--:y++,a.__u|=4))):e.__k[i]=null;if(p)for(i=0;i<g;i++)(l=r[i])!=null&&(2&l.__u)==0&&(l.__e==n&&(n=ct(l)),to(l,l));return n}function Xi(e,t,r,n){var o,i;if(typeof e.type=="function"){for(o=e.__k,i=0;o&&i<o.length;i++)o[i]&&(o[i].__=e,t=Xi(o[i],t,r,n));return t}e.__e!=t&&(n&&(t&&e.type&&!t.parentNode&&(t=ct(e)),r.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function xs(e,t,r,n){var o,i,a,l=e.key,f=e.type,d=t[r],g=d!=null&&(2&d.__u)==0;if(d===null&&l==null||g&&l==d.key&&f==d.type)return r;if(n>(g?1:0)){for(o=r-1,i=r+1;o>=0||i<t.length;)if((d=t[a=o>=0?o--:i++])!=null&&(2&d.__u)==0&&l==d.key&&f==d.type)return a}return-1}function qn(e,t,r){t[0]=="-"?e.setProperty(t,r??""):e[t]=r==null?"":typeof r!="number"||ws.test(t)?r:r+"px"}function tr(e,t,r,n,o){var i,a;e:if(t=="style")if(typeof r=="string")e.style.cssText=r;else{if(typeof n=="string"&&(e.style.cssText=n=""),n)for(t in n)r&&t in r||qn(e.style,t,"");if(r)for(t in r)n&&r[t]==n[t]||qn(e.style,t,r[t])}else if(t[0]=="o"&&t[1]=="n")i=t!=(t=t.replace(Gi,"$1")),a=t.toLowerCase(),t=a in e||t=="onFocusOut"||t=="onFocusIn"?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=r,r?n?r.u=n.u:(r.u=_n,e.addEventListener(t,i?en:Qr,i)):e.removeEventListener(t,i?en:Qr,i);else{if(o=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&r==1?"":r))}}function Wn(e){return function(t){if(this.l){var r=this.l[t.type+e];if(t.t==null)t.t=_n++;else if(t.t<r.u)return;return r(B.event?B.event(t):t)}}}function Sn(e,t,r,n,o,i,a,l,f,d){var g,p,y,m,w,b,C,T,I,R,O,N,le,Pe,oe,Z,me,te=t.type;if(t.constructor!==void 0)return null;128&r.__u&&(f=!!(32&r.__u),i=[l=t.__e=r.__e]),(g=B.__b)&&g(t);e:if(typeof te=="function")try{if(T=t.props,I="prototype"in te&&te.prototype.render,R=(g=te.contextType)&&n[g.__c],O=g?R?R.props.value:g.__:n,r.__c?C=(p=t.__c=r.__c).__=p.__E:(I?t.__c=p=new te(T,O):(t.__c=p=new At(T,O),p.constructor=te,p.render=Ts),R&&R.sub(p),p.state||(p.state={}),p.__n=n,y=p.__d=!0,p.__h=[],p._sb=[]),I&&p.__s==null&&(p.__s=p.state),I&&te.getDerivedStateFromProps!=null&&(p.__s==p.state&&(p.__s=ke({},p.__s)),ke(p.__s,te.getDerivedStateFromProps(T,p.__s))),m=p.props,w=p.state,p.__v=t,y)I&&te.getDerivedStateFromProps==null&&p.componentWillMount!=null&&p.componentWillMount(),I&&p.componentDidMount!=null&&p.__h.push(p.componentDidMount);else{if(I&&te.getDerivedStateFromProps==null&&T!==m&&p.componentWillReceiveProps!=null&&p.componentWillReceiveProps(T,O),t.__v==r.__v||!p.__e&&p.shouldComponentUpdate!=null&&p.shouldComponentUpdate(T,p.__s,O)===!1){for(t.__v!=r.__v&&(p.props=T,p.state=p.__s,p.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.some(function(de){de&&(de.__=t)}),N=0;N<p._sb.length;N++)p.__h.push(p._sb[N]);p._sb=[],p.__h.length&&a.push(p);break e}p.componentWillUpdate!=null&&p.componentWillUpdate(T,p.__s,O),I&&p.componentDidUpdate!=null&&p.__h.push(function(){p.componentDidUpdate(m,w,b)})}if(p.context=O,p.props=T,p.__P=e,p.__e=!1,le=B.__r,Pe=0,I){for(p.state=p.__s,p.__d=!1,le&&le(t),g=p.render(p.props,p.state,p.context),oe=0;oe<p._sb.length;oe++)p.__h.push(p._sb[oe]);p._sb=[]}else do p.__d=!1,le&&le(t),g=p.render(p.props,p.state,p.context),p.state=p.__s;while(p.__d&&++Pe<25);p.state=p.__s,p.getChildContext!=null&&(n=ke(ke({},n),p.getChildContext())),I&&!y&&p.getSnapshotBeforeUpdate!=null&&(b=p.getSnapshotBeforeUpdate(m,w)),Z=g,g!=null&&g.type===G&&g.key==null&&(Z=eo(g.props.children)),l=Zi(e,Er(Z)?Z:[Z],t,r,n,o,i,a,l,f,d),p.base=t.__e,t.__u&=-161,p.__h.length&&a.push(p),C&&(p.__E=p.__=null)}catch(de){if(t.__v=null,f||i!=null)if(de.then){for(t.__u|=f?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;i[i.indexOf(l)]=null,t.__e=l}else{for(me=i.length;me--;)wn(i[me]);tn(t)}else t.__e=r.__e,t.__k=r.__k,de.then||tn(t);B.__e(de,t,r)}else i==null&&t.__v==r.__v?(t.__k=r.__k,t.__e=r.__e):l=t.__e=Cs(r.__e,t,r,n,o,i,a,f,d);return(g=B.diffed)&&g(t),128&t.__u?void 0:l}function tn(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(tn)}function Qi(e,t,r){for(var n=0;n<r.length;n++)bn(r[n],r[++n],r[++n]);B.__c&&B.__c(t,e),e.some(function(o){try{e=o.__h,o.__h=[],e.some(function(i){i.call(o)})}catch(i){B.__e(i,o.__v)}})}function eo(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:Er(e)?e.map(eo):ke({},e)}function Cs(e,t,r,n,o,i,a,l,f){var d,g,p,y,m,w,b,C=r.props||zt,T=t.props,I=t.type;if(I=="svg"?o="http://www.w3.org/2000/svg":I=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),i!=null){for(d=0;d<i.length;d++)if((m=i[d])&&"setAttribute"in m==!!I&&(I?m.localName==I:m.nodeType==3)){e=m,i[d]=null;break}}if(e==null){if(I==null)return document.createTextNode(T);e=document.createElementNS(o,I,T.is&&T),l&&(B.__m&&B.__m(t,i),l=!1),i=null}if(I==null)C===T||l&&e.data==T||(e.data=T);else{if(i=i&&Ir.call(e.childNodes),!l&&i!=null)for(C={},d=0;d<e.attributes.length;d++)C[(m=e.attributes[d]).name]=m.value;for(d in C)if(m=C[d],d!="children"){if(d=="dangerouslySetInnerHTML")p=m;else if(!(d in T)){if(d=="value"&&"defaultValue"in T||d=="checked"&&"defaultChecked"in T)continue;tr(e,d,null,m,o)}}for(d in T)m=T[d],d=="children"?y=m:d=="dangerouslySetInnerHTML"?g=m:d=="value"?w=m:d=="checked"?b=m:l&&typeof m!="function"||C[d]===m||tr(e,d,m,C[d],o);if(g)l||p&&(g.__html==p.__html||g.__html==e.innerHTML)||(e.innerHTML=g.__html),t.__k=[];else if(p&&(e.innerHTML=""),Zi(t.type=="template"?e.content:e,Er(y)?y:[y],t,r,n,I=="foreignObject"?"http://www.w3.org/1999/xhtml":o,i,a,i?i[0]:r.__k&&ct(r,0),l,f),i!=null)for(d=i.length;d--;)wn(i[d]);l||(d="value",I=="progress"&&w==null?e.removeAttribute("value"):w!=null&&(w!==e[d]||I=="progress"&&!w||I=="option"&&w!=C[d])&&tr(e,d,w,C[d],o),d="checked",b!=null&&b!=e[d]&&tr(e,d,b,C[d],o))}return e}function bn(e,t,r){try{if(typeof e=="function"){var n=typeof e.__u=="function";n&&e.__u(),n&&t==null||(e.__u=e(t))}else e.current=t}catch(o){B.__e(o,r)}}function to(e,t,r){var n,o;if(B.unmount&&B.unmount(e),(n=e.ref)&&(n.current&&n.current!=e.__e||bn(n,null,t)),(n=e.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(i){B.__e(i,t)}n.base=n.__P=null}if(n=e.__k)for(o=0;o<n.length;o++)n[o]&&to(n[o],t,r||typeof e.type!="function");r||wn(e.__e),e.__c=e.__=e.__e=void 0}function Ts(e,t,r){return this.constructor(e,r)}function Is(e,t,r){var n,o,i,a;t==document&&(t=document.documentElement),B.__&&B.__(e,t),o=(n=!1)?null:t.__k,i=[],a=[],Sn(t,e=t.__k=Ss(G,null,[e]),o||zt,zt,t.namespaceURI,o?null:t.firstChild?Ir.call(t.childNodes):null,i,o?o.__e:t.firstChild,n,a),Qi(i,e,a)}Ir=Ji.slice,B={__e:function(e,t,r,n){for(var o,i,a;t=t.__;)if((o=t.__c)&&!o.__)try{if((i=o.constructor)&&i.getDerivedStateFromError!=null&&(o.setState(i.getDerivedStateFromError(e)),a=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(e,n||{}),a=o.__d),a)return o.__E=o}catch(l){e=l}throw e}},Hi=0,Vi=function(e){return e!=null&&e.constructor===void 0},At.prototype.setState=function(e,t){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=ke({},this.state),typeof e=="function"&&(e=e(ke({},r),this.props)),e&&ke(r,e),e!=null&&this.__v&&(t&&this._sb.push(t),Vn(this))},At.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Vn(this))},At.prototype.render=G,Ve=[],qi=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Wi=function(e,t){return e.__v.__b-t.__v.__b},fr.__r=0,Gi=/(PointerCapture)$|Capture$/i,_n=0,Qr=Wn(!1),en=Wn(!0);var Es=0;function s(e,t,r,n,o,i){t||(t={});var a,l,f=t;if("ref"in f)for(l in f={},t)l=="ref"?a=t[l]:f[l]=t[l];var d={type:e,props:f,key:r,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Es,__i:-1,__u:0,__source:o,__self:i};if(typeof e=="function"&&(a=e.defaultProps))for(l in a)f[l]===void 0&&(f[l]=a[l]);return B.vnode&&B.vnode(d),d}var $t,W,Fr,Gn,hr=0,ro=[],Y=B,Jn=Y.__b,Yn=Y.__r,Zn=Y.diffed,Xn=Y.__c,Qn=Y.unmount,ei=Y.__;function xn(e,t){Y.__h&&Y.__h(W,e,hr||t),hr=0;var r=W.__H||(W.__H={__:[],__h:[]});return e>=r.__.length&&r.__.push({}),r.__[e]}function no(e){return hr=1,ks(oo,e)}function ks(e,t,r){var n=xn($t++,2);if(n.t=e,!n.__c&&(n.__=[oo(void 0,t),function(l){var f=n.__N?n.__N[0]:n.__[0],d=n.t(f,l);f!==d&&(n.__N=[d,n.__[1]],n.__c.setState({}))}],n.__c=W,!W.__f)){var o=function(l,f,d){if(!n.__c.__H)return!0;var g=n.__c.__H.__.filter(function(y){return!!y.__c});if(g.every(function(y){return!y.__N}))return!i||i.call(this,l,f,d);var p=n.__c.props!==l;return g.forEach(function(y){if(y.__N){var m=y.__[0];y.__=y.__N,y.__N=void 0,m!==y.__[0]&&(p=!0)}}),i&&i.call(this,l,f,d)||p};W.__f=!0;var i=W.shouldComponentUpdate,a=W.componentWillUpdate;W.componentWillUpdate=function(l,f,d){if(this.__e){var g=i;i=void 0,o(l,f,d),i=g}a&&a.call(this,l,f,d)},W.shouldComponentUpdate=o}return n.__N||n.__}function $e(e,t){var r=xn($t++,3);!Y.__s&&io(r.__H,t)&&(r.__=e,r.u=t,W.__H.__h.push(r))}function Us(e){return hr=5,Cn(function(){return{current:e}},[])}function Cn(e,t){var r=xn($t++,7);return io(r.__H,t)&&(r.__=e(),r.__H=t,r.__h=e),r.__}function As(){for(var e;e=ro.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(ur),e.__H.__h.forEach(rn),e.__H.__h=[]}catch(t){e.__H.__h=[],Y.__e(t,e.__v)}}Y.__b=function(e){W=null,Jn&&Jn(e)},Y.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),ei&&ei(e,t)},Y.__r=function(e){Yn&&Yn(e),$t=0;var t=(W=e.__c).__H;t&&(Fr===W?(t.__h=[],W.__h=[],t.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(t.__h.forEach(ur),t.__h.forEach(rn),t.__h=[],$t=0)),Fr=W},Y.diffed=function(e){Zn&&Zn(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(ro.push(t)!==1&&Gn===Y.requestAnimationFrame||((Gn=Y.requestAnimationFrame)||Ds)(As)),t.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),Fr=W=null},Y.__c=function(e,t){t.some(function(r){try{r.__h.forEach(ur),r.__h=r.__h.filter(function(n){return!n.__||rn(n)})}catch(n){t.some(function(o){o.__h&&(o.__h=[])}),t=[],Y.__e(n,r.__v)}}),Xn&&Xn(e,t)},Y.unmount=function(e){Qn&&Qn(e);var t,r=e.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{ur(n)}catch(o){t=o}}),r.__H=void 0,t&&Y.__e(t,r.__v))};var ti=typeof requestAnimationFrame=="function";function Ds(e){var t,r=function(){clearTimeout(n),ti&&cancelAnimationFrame(t),setTimeout(e)},n=setTimeout(r,35);ti&&(t=requestAnimationFrame(r))}function ur(e){var t=W,r=e.__c;typeof r=="function"&&(e.__c=void 0,r()),W=t}function rn(e){var t=W;e.__c=e.__(),W=t}function io(e,t){return!e||e.length!==t.length||t.some(function(r,n){return r!==e[n]})}function oo(e,t){return typeof t=="function"?t(e):t}var Rs=Symbol.for("preact-signals");function kr(){if(Me>1)Me--;else{for(var e,t=!1;Dt!==void 0;){var r=Dt;for(Dt=void 0,nn++;r!==void 0;){var n=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&lo(r))try{r.c()}catch(o){t||(e=o,t=!0)}r=n}}if(nn=0,Me--,t)throw e}}function Ps(e){if(Me>0)return e();Me++;try{return e()}finally{kr()}}var F=void 0;function so(e){var t=F;F=void 0;try{return e()}finally{F=t}}var Dt=void 0,Me=0,nn=0,pr=0;function ao(e){if(F!==void 0){var t=e.n;if(t===void 0||t.t!==F)return t={i:0,S:e,p:F.s,n:void 0,t:F,e:void 0,x:void 0,r:t},F.s!==void 0&&(F.s.n=t),F.s=t,e.n=t,32&F.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=F.s,t.n=void 0,F.s.n=t,F.s=t),t}}function ne(e,t){this.v=e,this.i=0,this.n=void 0,this.t=void 0,this.W=t==null?void 0:t.watched,this.Z=t==null?void 0:t.unwatched,this.name=t==null?void 0:t.name}ne.prototype.brand=Rs;ne.prototype.h=function(){return!0};ne.prototype.S=function(e){var t=this,r=this.t;r!==e&&e.e===void 0&&(e.x=r,this.t=e,r!==void 0?r.e=e:so(function(){var n;(n=t.W)==null||n.call(t)}))};ne.prototype.U=function(e){var t=this;if(this.t!==void 0){var r=e.e,n=e.x;r!==void 0&&(r.x=n,e.e=void 0),n!==void 0&&(n.e=r,e.x=void 0),e===this.t&&(this.t=n,n===void 0&&so(function(){var o;(o=t.Z)==null||o.call(t)}))}};ne.prototype.subscribe=function(e){var t=this;return Wt(function(){var r=t.value,n=F;F=void 0;try{e(r)}finally{F=n}},{name:"sub"})};ne.prototype.valueOf=function(){return this.value};ne.prototype.toString=function(){return this.value+""};ne.prototype.toJSON=function(){return this.value};ne.prototype.peek=function(){var e=F;F=void 0;try{return this.value}finally{F=e}};Object.defineProperty(ne.prototype,"value",{get:function(){var e=ao(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(nn>100)throw new Error("Cycle detected");this.v=e,this.i++,pr++,Me++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{kr()}}}});function E(e,t){return new ne(e,t)}function lo(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function uo(e){for(var t=e.s;t!==void 0;t=t.n){var r=t.S.n;if(r!==void 0&&(t.r=r),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function co(e){for(var t=e.s,r=void 0;t!==void 0;){var n=t.p;t.i===-1?(t.S.U(t),n!==void 0&&(n.n=t.n),t.n!==void 0&&(t.n.p=n)):r=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=n}e.s=r}function Xe(e,t){ne.call(this,void 0),this.x=e,this.s=void 0,this.g=pr-1,this.f=4,this.W=t==null?void 0:t.watched,this.Z=t==null?void 0:t.unwatched,this.name=t==null?void 0:t.name}Xe.prototype=new ne;Xe.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===pr))return!0;if(this.g=pr,this.f|=1,this.i>0&&!lo(this))return this.f&=-2,!0;var e=F;try{uo(this),F=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return F=e,co(this),this.f&=-2,!0};Xe.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}ne.prototype.S.call(this,e)};Xe.prototype.U=function(e){if(this.t!==void 0&&(ne.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};Xe.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}};Object.defineProperty(Xe.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var e=ao(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function X(e,t){return new Xe(e,t)}function fo(e){var t=e.u;if(e.u=void 0,typeof t=="function"){Me++;var r=F;F=void 0;try{t()}catch(n){throw e.f&=-2,e.f|=8,Tn(e),n}finally{F=r,kr()}}}function Tn(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,fo(e)}function Fs(e){if(F!==this)throw new Error("Out-of-order effect");co(this),F=e,this.f&=-2,8&this.f&&Tn(this),kr()}function vt(e,t){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=t==null?void 0:t.name}vt.prototype.c=function(){var e=this.S();try{if(8&this.f||this.x===void 0)return;var t=this.x();typeof t=="function"&&(this.u=t)}finally{e()}};vt.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,fo(this),uo(this),Me++;var e=F;return F=this,Fs.bind(this,e)};vt.prototype.N=function(){2&this.f||(this.f|=2,this.o=Dt,Dt=this)};vt.prototype.d=function(){this.f|=8,1&this.f||Tn(this)};vt.prototype.dispose=function(){this.d()};function Wt(e,t){var r=new vt(e,t);try{r.c()}catch(o){throw r.d(),o}var n=r.d.bind(r);return n[Symbol.dispose]=n,n}var ho,Br,Bs=typeof window<"u"&&!!window.__PREACT_SIGNALS_DEVTOOLS__,po=[];Wt(function(){ho=this.N})();function gt(e,t){B[e]=t.bind(null,B[e]||function(){})}function vr(e){Br&&Br(),Br=e&&e.S()}function vo(e){var t=this,r=e.data,n=Os(r);n.value=r;var o=Cn(function(){for(var l=t,f=t.__v;f=f.__;)if(f.__c){f.__c.__$f|=4;break}var d=X(function(){var m=n.value.value;return m===0?0:m===!0?"":m||""}),g=X(function(){return!Array.isArray(d.value)&&!Vi(d.value)}),p=Wt(function(){if(this.N=go,g.value){var m=d.value;l.__v&&l.__v.__e&&l.__v.__e.nodeType===3&&(l.__v.__e.data=m)}}),y=t.__$u.d;return t.__$u.d=function(){p(),y.call(this)},[g,d]},[]),i=o[0],a=o[1];return i.value?a.peek():a.value}vo.displayName="ReactiveTextNode";Object.defineProperties(ne.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:vo},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});gt("__b",function(e,t){if(typeof t.type=="string"){var r,n=t.props;for(var o in n)if(o!=="children"){var i=n[o];i instanceof ne&&(r||(t.__np=r={}),r[o]=i,n[o]=i.peek())}}e(t)});gt("__r",function(e,t){if(t.type!==G){vr();var r,n=t.__c;n&&(n.__$f&=-2,(r=n.__$u)===void 0&&(n.__$u=r=(function(o,i){var a;return Wt(function(){a=this},{name:i}),a.c=o,a})(function(){var o;Bs&&((o=r.y)==null||o.call(r)),n.__$f|=1,n.setState({})},typeof t.type=="function"?t.type.displayName||t.type.name:""))),vr(r)}e(t)});gt("__e",function(e,t,r,n){vr(),e(t,r,n)});gt("diffed",function(e,t){vr();var r;if(typeof t.type=="string"&&(r=t.__e)){var n=t.__np,o=t.props;if(n){var i=r.U;if(i)for(var a in i){var l=i[a];l!==void 0&&!(a in n)&&(l.d(),i[a]=void 0)}else i={},r.U=i;for(var f in n){var d=i[f],g=n[f];d===void 0?(d=Ms(r,f,g,o),i[f]=d):d.o(g,o)}}}e(t)});function Ms(e,t,r,n){var o=t in e&&e.ownerSVGElement===void 0,i=E(r);return{o:function(a,l){i.value=a,n=l},d:Wt(function(){this.N=go;var a=i.value.value;n[t]!==a&&(n[t]=a,o?e[t]=a:a!=null&&(a!==!1||t[4]==="-")?e.setAttribute(t,a):e.removeAttribute(t))})}}gt("unmount",function(e,t){if(typeof t.type=="string"){var r=t.__e;if(r){var n=r.U;if(n){r.U=void 0;for(var o in n){var i=n[o];i&&i.d()}}}}else{var a=t.__c;if(a){var l=a.__$u;l&&(a.__$u=void 0,l.d())}}e(t)});gt("__h",function(e,t,r,n){(n<3||n===9)&&(t.__$f|=2),e(t,r,n)});At.prototype.shouldComponentUpdate=function(e,t){if(this.__R)return!0;var r=this.__$u,n=r&&r.s!==void 0;for(var o in t)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){var i=2&this.__$f;if(!(n||i||4&this.__$f)||1&this.__$f)return!0}else if(!(n||4&this.__$f)||3&this.__$f)return!0;for(var a in e)if(a!=="__source"&&e[a]!==this.props[a])return!0;for(var l in this.props)if(!(l in e))return!0;return!1};function Os(e,t){return Cn(function(){return E(e,t)},[])}var Ns=function(e){queueMicrotask(function(){queueMicrotask(e)})};function zs(){Ps(function(){for(var e;e=po.shift();)ho.call(e)})}function go(){po.push(this)===1&&(B.requestAnimationFrame||Ns)(zs)}/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var $s=(function(){function e(r){var n=r||{},o=n.ValidationData,i=n.Username,a=n.Password,l=n.AuthParameters,f=n.ClientMetadata;this.validationData=o||{},this.authParameters=l||{},this.clientMetadata=f||{},this.username=i,this.password=a}var t=e.prototype;return t.getUsername=function(){return this.username},t.getPassword=function(){return this.password},t.getValidationData=function(){return this.validationData},t.getAuthParameters=function(){return this.authParameters},t.getClientMetadata=function(){return this.clientMetadata},e})(),ri=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function In(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}),r}var Mr={},wt={},ni;function Ls(){if(ni)return wt;ni=1,wt.byteLength=l,wt.toByteArray=d,wt.fromByteArray=y;for(var e=[],t=[],r=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,i=n.length;o<i;++o)e[o]=n[o],t[n.charCodeAt(o)]=o;t[45]=62,t[95]=63;function a(m){var w=m.length;if(w%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var b=m.indexOf("=");b===-1&&(b=w);var C=b===w?0:4-b%4;return[b,C]}function l(m){var w=a(m),b=w[0],C=w[1];return(b+C)*3/4-C}function f(m,w,b){return(w+b)*3/4-b}function d(m){var w,b=a(m),C=b[0],T=b[1],I=new r(f(m,C,T)),R=0,O=T>0?C-4:C,N;for(N=0;N<O;N+=4)w=t[m.charCodeAt(N)]<<18|t[m.charCodeAt(N+1)]<<12|t[m.charCodeAt(N+2)]<<6|t[m.charCodeAt(N+3)],I[R++]=w>>16&255,I[R++]=w>>8&255,I[R++]=w&255;return T===2&&(w=t[m.charCodeAt(N)]<<2|t[m.charCodeAt(N+1)]>>4,I[R++]=w&255),T===1&&(w=t[m.charCodeAt(N)]<<10|t[m.charCodeAt(N+1)]<<4|t[m.charCodeAt(N+2)]>>2,I[R++]=w>>8&255,I[R++]=w&255),I}function g(m){return e[m>>18&63]+e[m>>12&63]+e[m>>6&63]+e[m&63]}function p(m,w,b){for(var C,T=[],I=w;I<b;I+=3)C=(m[I]<<16&16711680)+(m[I+1]<<8&65280)+(m[I+2]&255),T.push(g(C));return T.join("")}function y(m){for(var w,b=m.length,C=b%3,T=[],I=16383,R=0,O=b-C;R<O;R+=I)T.push(p(m,R,R+I>O?O:R+I));return C===1?(w=m[b-1],T.push(e[w>>2]+e[w<<4&63]+"==")):C===2&&(w=(m[b-2]<<8)+m[b-1],T.push(e[w>>10]+e[w>>4&63]+e[w<<2&63]+"=")),T.join("")}return wt}var rr={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var ii;function js(){return ii||(ii=1,rr.read=function(e,t,r,n,o){var i,a,l=o*8-n-1,f=(1<<l)-1,d=f>>1,g=-7,p=r?o-1:0,y=r?-1:1,m=e[t+p];for(p+=y,i=m&(1<<-g)-1,m>>=-g,g+=l;g>0;i=i*256+e[t+p],p+=y,g-=8);for(a=i&(1<<-g)-1,i>>=-g,g+=n;g>0;a=a*256+e[t+p],p+=y,g-=8);if(i===0)i=1-d;else{if(i===f)return a?NaN:(m?-1:1)*(1/0);a=a+Math.pow(2,n),i=i-d}return(m?-1:1)*a*Math.pow(2,i-n)},rr.write=function(e,t,r,n,o,i){var a,l,f,d=i*8-o-1,g=(1<<d)-1,p=g>>1,y=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=n?0:i-1,w=n?1:-1,b=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,a=g):(a=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-a))<1&&(a--,f*=2),a+p>=1?t+=y/f:t+=y*Math.pow(2,1-p),t*f>=2&&(a++,f/=2),a+p>=g?(l=0,a=g):a+p>=1?(l=(t*f-1)*Math.pow(2,o),a=a+p):(l=t*Math.pow(2,p-1)*Math.pow(2,o),a=0));o>=8;e[r+m]=l&255,m+=w,l/=256,o-=8);for(a=a<<o|l,d+=o;d>0;e[r+m]=a&255,m+=w,a/=256,d-=8);e[r+m-w]|=b*128}),rr}var Or,oi;function Ks(){if(oi)return Or;oi=1;var e={}.toString;return Or=Array.isArray||function(t){return e.call(t)=="[object Array]"},Or}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var si;function Hs(){return si||(si=1,(function(e){var t=Ls(),r=js(),n=Ks();e.Buffer=l,e.SlowBuffer=T,e.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=ri.TYPED_ARRAY_SUPPORT!==void 0?ri.TYPED_ARRAY_SUPPORT:o(),e.kMaxLength=i();function o(){try{var h=new Uint8Array(1);return h.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},h.foo()===42&&typeof h.subarray=="function"&&h.subarray(1,1).byteLength===0}catch{return!1}}function i(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(h,u){if(i()<u)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(h=new Uint8Array(u),h.__proto__=l.prototype):(h===null&&(h=new l(u)),h.length=u),h}function l(h,u,c){if(!l.TYPED_ARRAY_SUPPORT&&!(this instanceof l))return new l(h,u,c);if(typeof h=="number"){if(typeof u=="string")throw new Error("If encoding is specified then the first argument must be a string");return p(this,h)}return f(this,h,u,c)}l.poolSize=8192,l._augment=function(h){return h.__proto__=l.prototype,h};function f(h,u,c,v){if(typeof u=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&u instanceof ArrayBuffer?w(h,u,c,v):typeof u=="string"?y(h,u,c):b(h,u)}l.from=function(h,u,c){return f(null,h,u,c)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0}));function d(h){if(typeof h!="number")throw new TypeError('"size" argument must be a number');if(h<0)throw new RangeError('"size" argument must not be negative')}function g(h,u,c,v){return d(u),u<=0?a(h,u):c!==void 0?typeof v=="string"?a(h,u).fill(c,v):a(h,u).fill(c):a(h,u)}l.alloc=function(h,u,c){return g(null,h,u,c)};function p(h,u){if(d(u),h=a(h,u<0?0:C(u)|0),!l.TYPED_ARRAY_SUPPORT)for(var c=0;c<u;++c)h[c]=0;return h}l.allocUnsafe=function(h){return p(null,h)},l.allocUnsafeSlow=function(h){return p(null,h)};function y(h,u,c){if((typeof c!="string"||c==="")&&(c="utf8"),!l.isEncoding(c))throw new TypeError('"encoding" must be a valid string encoding');var v=I(u,c)|0;h=a(h,v);var _=h.write(u,c);return _!==v&&(h=h.slice(0,_)),h}function m(h,u){var c=u.length<0?0:C(u.length)|0;h=a(h,c);for(var v=0;v<c;v+=1)h[v]=u[v]&255;return h}function w(h,u,c,v){if(u.byteLength,c<0||u.byteLength<c)throw new RangeError("'offset' is out of bounds");if(u.byteLength<c+(v||0))throw new RangeError("'length' is out of bounds");return c===void 0&&v===void 0?u=new Uint8Array(u):v===void 0?u=new Uint8Array(u,c):u=new Uint8Array(u,c,v),l.TYPED_ARRAY_SUPPORT?(h=u,h.__proto__=l.prototype):h=m(h,u),h}function b(h,u){if(l.isBuffer(u)){var c=C(u.length)|0;return h=a(h,c),h.length===0||u.copy(h,0,0,c),h}if(u){if(typeof ArrayBuffer<"u"&&u.buffer instanceof ArrayBuffer||"length"in u)return typeof u.length!="number"||_s(u.length)?a(h,0):m(h,u);if(u.type==="Buffer"&&n(u.data))return m(h,u.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function C(h){if(h>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return h|0}function T(h){return+h!=h&&(h=0),l.alloc(+h)}l.isBuffer=function(u){return!!(u!=null&&u._isBuffer)},l.compare=function(u,c){if(!l.isBuffer(u)||!l.isBuffer(c))throw new TypeError("Arguments must be Buffers");if(u===c)return 0;for(var v=u.length,_=c.length,S=0,x=Math.min(v,_);S<x;++S)if(u[S]!==c[S]){v=u[S],_=c[S];break}return v<_?-1:_<v?1:0},l.isEncoding=function(u){switch(String(u).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(u,c){if(!n(u))throw new TypeError('"list" argument must be an Array of Buffers');if(u.length===0)return l.alloc(0);var v;if(c===void 0)for(c=0,v=0;v<u.length;++v)c+=u[v].length;var _=l.allocUnsafe(c),S=0;for(v=0;v<u.length;++v){var x=u[v];if(!l.isBuffer(x))throw new TypeError('"list" argument must be an Array of Buffers');x.copy(_,S),S+=x.length}return _};function I(h,u){if(l.isBuffer(h))return h.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(h)||h instanceof ArrayBuffer))return h.byteLength;typeof h!="string"&&(h=""+h);var c=h.length;if(c===0)return 0;for(var v=!1;;)switch(u){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":case void 0:return Xt(h).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c*2;case"hex":return c>>>1;case"base64":return Ln(h).length;default:if(v)return Xt(h).length;u=(""+u).toLowerCase(),v=!0}}l.byteLength=I;function R(h,u,c){var v=!1;if((u===void 0||u<0)&&(u=0),u>this.length||((c===void 0||c>this.length)&&(c=this.length),c<=0)||(c>>>=0,u>>>=0,c<=u))return"";for(h||(h="utf8");;)switch(h){case"hex":return ds(this,u,c);case"utf8":case"utf-8":return _t(this,u,c);case"ascii":return us(this,u,c);case"latin1":case"binary":return cs(this,u,c);case"base64":return et(this,u,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return fs(this,u,c);default:if(v)throw new TypeError("Unknown encoding: "+h);h=(h+"").toLowerCase(),v=!0}}l.prototype._isBuffer=!0;function O(h,u,c){var v=h[u];h[u]=h[c],h[c]=v}l.prototype.swap16=function(){var u=this.length;if(u%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var c=0;c<u;c+=2)O(this,c,c+1);return this},l.prototype.swap32=function(){var u=this.length;if(u%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var c=0;c<u;c+=4)O(this,c,c+3),O(this,c+1,c+2);return this},l.prototype.swap64=function(){var u=this.length;if(u%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var c=0;c<u;c+=8)O(this,c,c+7),O(this,c+1,c+6),O(this,c+2,c+5),O(this,c+3,c+4);return this},l.prototype.toString=function(){var u=this.length|0;return u===0?"":arguments.length===0?_t(this,0,u):R.apply(this,arguments)},l.prototype.equals=function(u){if(!l.isBuffer(u))throw new TypeError("Argument must be a Buffer");return this===u?!0:l.compare(this,u)===0},l.prototype.inspect=function(){var u="",c=e.INSPECT_MAX_BYTES;return this.length>0&&(u=this.toString("hex",0,c).match(/.{2}/g).join(" "),this.length>c&&(u+=" ... ")),"<Buffer "+u+">"},l.prototype.compare=function(u,c,v,_,S){if(!l.isBuffer(u))throw new TypeError("Argument must be a Buffer");if(c===void 0&&(c=0),v===void 0&&(v=u?u.length:0),_===void 0&&(_=0),S===void 0&&(S=this.length),c<0||v>u.length||_<0||S>this.length)throw new RangeError("out of range index");if(_>=S&&c>=v)return 0;if(_>=S)return-1;if(c>=v)return 1;if(c>>>=0,v>>>=0,_>>>=0,S>>>=0,this===u)return 0;for(var x=S-_,U=v-c,z=Math.min(x,U),K=this.slice(_,S),ie=u.slice(c,v),V=0;V<z;++V)if(K[V]!==ie[V]){x=K[V],U=ie[V];break}return x<U?-1:U<x?1:0};function N(h,u,c,v,_){if(h.length===0)return-1;if(typeof c=="string"?(v=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,isNaN(c)&&(c=_?0:h.length-1),c<0&&(c=h.length+c),c>=h.length){if(_)return-1;c=h.length-1}else if(c<0)if(_)c=0;else return-1;if(typeof u=="string"&&(u=l.from(u,v)),l.isBuffer(u))return u.length===0?-1:le(h,u,c,v,_);if(typeof u=="number")return u=u&255,l.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?_?Uint8Array.prototype.indexOf.call(h,u,c):Uint8Array.prototype.lastIndexOf.call(h,u,c):le(h,[u],c,v,_);throw new TypeError("val must be string, number or Buffer")}function le(h,u,c,v,_){var S=1,x=h.length,U=u.length;if(v!==void 0&&(v=String(v).toLowerCase(),v==="ucs2"||v==="ucs-2"||v==="utf16le"||v==="utf-16le")){if(h.length<2||u.length<2)return-1;S=2,x/=2,U/=2,c/=2}function z(jn,Kn){return S===1?jn[Kn]:jn.readUInt16BE(Kn*S)}var K;if(_){var ie=-1;for(K=c;K<x;K++)if(z(h,K)===z(u,ie===-1?0:K-ie)){if(ie===-1&&(ie=K),K-ie+1===U)return ie*S}else ie!==-1&&(K-=K-ie),ie=-1}else for(c+U>x&&(c=x-U),K=c;K>=0;K--){for(var V=!0,er=0;er<U;er++)if(z(h,K+er)!==z(u,er)){V=!1;break}if(V)return K}return-1}l.prototype.includes=function(u,c,v){return this.indexOf(u,c,v)!==-1},l.prototype.indexOf=function(u,c,v){return N(this,u,c,v,!0)},l.prototype.lastIndexOf=function(u,c,v){return N(this,u,c,v,!1)};function Pe(h,u,c,v){c=Number(c)||0;var _=h.length-c;v?(v=Number(v),v>_&&(v=_)):v=_;var S=u.length;if(S%2!==0)throw new TypeError("Invalid hex string");v>S/2&&(v=S/2);for(var x=0;x<v;++x){var U=parseInt(u.substr(x*2,2),16);if(isNaN(U))return x;h[c+x]=U}return x}function oe(h,u,c,v){return Qt(Xt(u,h.length-c),h,c,v)}function Z(h,u,c,v){return Qt(ms(u),h,c,v)}function me(h,u,c,v){return Z(h,u,c,v)}function te(h,u,c,v){return Qt(Ln(u),h,c,v)}function de(h,u,c,v){return Qt(ys(u,h.length-c),h,c,v)}l.prototype.write=function(u,c,v,_){if(c===void 0)_="utf8",v=this.length,c=0;else if(v===void 0&&typeof c=="string")_=c,v=this.length,c=0;else if(isFinite(c))c=c|0,isFinite(v)?(v=v|0,_===void 0&&(_="utf8")):(_=v,v=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var S=this.length-c;if((v===void 0||v>S)&&(v=S),u.length>0&&(v<0||c<0)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");_||(_="utf8");for(var x=!1;;)switch(_){case"hex":return Pe(this,u,c,v);case"utf8":case"utf-8":return oe(this,u,c,v);case"ascii":return Z(this,u,c,v);case"latin1":case"binary":return me(this,u,c,v);case"base64":return te(this,u,c,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return de(this,u,c,v);default:if(x)throw new TypeError("Unknown encoding: "+_);_=(""+_).toLowerCase(),x=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function et(h,u,c){return u===0&&c===h.length?t.fromByteArray(h):t.fromByteArray(h.slice(u,c))}function _t(h,u,c){c=Math.min(h.length,c);for(var v=[],_=u;_<c;){var S=h[_],x=null,U=S>239?4:S>223?3:S>191?2:1;if(_+U<=c){var z,K,ie,V;switch(U){case 1:S<128&&(x=S);break;case 2:z=h[_+1],(z&192)===128&&(V=(S&31)<<6|z&63,V>127&&(x=V));break;case 3:z=h[_+1],K=h[_+2],(z&192)===128&&(K&192)===128&&(V=(S&15)<<12|(z&63)<<6|K&63,V>2047&&(V<55296||V>57343)&&(x=V));break;case 4:z=h[_+1],K=h[_+2],ie=h[_+3],(z&192)===128&&(K&192)===128&&(ie&192)===128&&(V=(S&15)<<18|(z&63)<<12|(K&63)<<6|ie&63,V>65535&&V<1114112&&(x=V))}}x===null?(x=65533,U=1):x>65535&&(x-=65536,v.push(x>>>10&1023|55296),x=56320|x&1023),v.push(x),_+=U}return Pr(v)}var je=4096;function Pr(h){var u=h.length;if(u<=je)return String.fromCharCode.apply(String,h);for(var c="",v=0;v<u;)c+=String.fromCharCode.apply(String,h.slice(v,v+=je));return c}function us(h,u,c){var v="";c=Math.min(h.length,c);for(var _=u;_<c;++_)v+=String.fromCharCode(h[_]&127);return v}function cs(h,u,c){var v="";c=Math.min(h.length,c);for(var _=u;_<c;++_)v+=String.fromCharCode(h[_]);return v}function ds(h,u,c){var v=h.length;(!u||u<0)&&(u=0),(!c||c<0||c>v)&&(c=v);for(var _="",S=u;S<c;++S)_+=gs(h[S]);return _}function fs(h,u,c){for(var v=h.slice(u,c),_="",S=0;S<v.length;S+=2)_+=String.fromCharCode(v[S]+v[S+1]*256);return _}l.prototype.slice=function(u,c){var v=this.length;u=~~u,c=c===void 0?v:~~c,u<0?(u+=v,u<0&&(u=0)):u>v&&(u=v),c<0?(c+=v,c<0&&(c=0)):c>v&&(c=v),c<u&&(c=u);var _;if(l.TYPED_ARRAY_SUPPORT)_=this.subarray(u,c),_.__proto__=l.prototype;else{var S=c-u;_=new l(S,void 0);for(var x=0;x<S;++x)_[x]=this[x+u]}return _};function Q(h,u,c){if(h%1!==0||h<0)throw new RangeError("offset is not uint");if(h+u>c)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUIntLE=function(u,c,v){u=u|0,c=c|0,v||Q(u,c,this.length);for(var _=this[u],S=1,x=0;++x<c&&(S*=256);)_+=this[u+x]*S;return _},l.prototype.readUIntBE=function(u,c,v){u=u|0,c=c|0,v||Q(u,c,this.length);for(var _=this[u+--c],S=1;c>0&&(S*=256);)_+=this[u+--c]*S;return _},l.prototype.readUInt8=function(u,c){return c||Q(u,1,this.length),this[u]},l.prototype.readUInt16LE=function(u,c){return c||Q(u,2,this.length),this[u]|this[u+1]<<8},l.prototype.readUInt16BE=function(u,c){return c||Q(u,2,this.length),this[u]<<8|this[u+1]},l.prototype.readUInt32LE=function(u,c){return c||Q(u,4,this.length),(this[u]|this[u+1]<<8|this[u+2]<<16)+this[u+3]*16777216},l.prototype.readUInt32BE=function(u,c){return c||Q(u,4,this.length),this[u]*16777216+(this[u+1]<<16|this[u+2]<<8|this[u+3])},l.prototype.readIntLE=function(u,c,v){u=u|0,c=c|0,v||Q(u,c,this.length);for(var _=this[u],S=1,x=0;++x<c&&(S*=256);)_+=this[u+x]*S;return S*=128,_>=S&&(_-=Math.pow(2,8*c)),_},l.prototype.readIntBE=function(u,c,v){u=u|0,c=c|0,v||Q(u,c,this.length);for(var _=c,S=1,x=this[u+--_];_>0&&(S*=256);)x+=this[u+--_]*S;return S*=128,x>=S&&(x-=Math.pow(2,8*c)),x},l.prototype.readInt8=function(u,c){return c||Q(u,1,this.length),this[u]&128?(255-this[u]+1)*-1:this[u]},l.prototype.readInt16LE=function(u,c){c||Q(u,2,this.length);var v=this[u]|this[u+1]<<8;return v&32768?v|4294901760:v},l.prototype.readInt16BE=function(u,c){c||Q(u,2,this.length);var v=this[u+1]|this[u]<<8;return v&32768?v|4294901760:v},l.prototype.readInt32LE=function(u,c){return c||Q(u,4,this.length),this[u]|this[u+1]<<8|this[u+2]<<16|this[u+3]<<24},l.prototype.readInt32BE=function(u,c){return c||Q(u,4,this.length),this[u]<<24|this[u+1]<<16|this[u+2]<<8|this[u+3]},l.prototype.readFloatLE=function(u,c){return c||Q(u,4,this.length),r.read(this,u,!0,23,4)},l.prototype.readFloatBE=function(u,c){return c||Q(u,4,this.length),r.read(this,u,!1,23,4)},l.prototype.readDoubleLE=function(u,c){return c||Q(u,8,this.length),r.read(this,u,!0,52,8)},l.prototype.readDoubleBE=function(u,c){return c||Q(u,8,this.length),r.read(this,u,!1,52,8)};function ae(h,u,c,v,_,S){if(!l.isBuffer(h))throw new TypeError('"buffer" argument must be a Buffer instance');if(u>_||u<S)throw new RangeError('"value" argument is out of bounds');if(c+v>h.length)throw new RangeError("Index out of range")}l.prototype.writeUIntLE=function(u,c,v,_){if(u=+u,c=c|0,v=v|0,!_){var S=Math.pow(2,8*v)-1;ae(this,u,c,v,S,0)}var x=1,U=0;for(this[c]=u&255;++U<v&&(x*=256);)this[c+U]=u/x&255;return c+v},l.prototype.writeUIntBE=function(u,c,v,_){if(u=+u,c=c|0,v=v|0,!_){var S=Math.pow(2,8*v)-1;ae(this,u,c,v,S,0)}var x=v-1,U=1;for(this[c+x]=u&255;--x>=0&&(U*=256);)this[c+x]=u/U&255;return c+v},l.prototype.writeUInt8=function(u,c,v){return u=+u,c=c|0,v||ae(this,u,c,1,255,0),l.TYPED_ARRAY_SUPPORT||(u=Math.floor(u)),this[c]=u&255,c+1};function Yt(h,u,c,v){u<0&&(u=65535+u+1);for(var _=0,S=Math.min(h.length-c,2);_<S;++_)h[c+_]=(u&255<<8*(v?_:1-_))>>>(v?_:1-_)*8}l.prototype.writeUInt16LE=function(u,c,v){return u=+u,c=c|0,v||ae(this,u,c,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[c]=u&255,this[c+1]=u>>>8):Yt(this,u,c,!0),c+2},l.prototype.writeUInt16BE=function(u,c,v){return u=+u,c=c|0,v||ae(this,u,c,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[c]=u>>>8,this[c+1]=u&255):Yt(this,u,c,!1),c+2};function Zt(h,u,c,v){u<0&&(u=4294967295+u+1);for(var _=0,S=Math.min(h.length-c,4);_<S;++_)h[c+_]=u>>>(v?_:3-_)*8&255}l.prototype.writeUInt32LE=function(u,c,v){return u=+u,c=c|0,v||ae(this,u,c,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[c+3]=u>>>24,this[c+2]=u>>>16,this[c+1]=u>>>8,this[c]=u&255):Zt(this,u,c,!0),c+4},l.prototype.writeUInt32BE=function(u,c,v){return u=+u,c=c|0,v||ae(this,u,c,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[c]=u>>>24,this[c+1]=u>>>16,this[c+2]=u>>>8,this[c+3]=u&255):Zt(this,u,c,!1),c+4},l.prototype.writeIntLE=function(u,c,v,_){if(u=+u,c=c|0,!_){var S=Math.pow(2,8*v-1);ae(this,u,c,v,S-1,-S)}var x=0,U=1,z=0;for(this[c]=u&255;++x<v&&(U*=256);)u<0&&z===0&&this[c+x-1]!==0&&(z=1),this[c+x]=(u/U>>0)-z&255;return c+v},l.prototype.writeIntBE=function(u,c,v,_){if(u=+u,c=c|0,!_){var S=Math.pow(2,8*v-1);ae(this,u,c,v,S-1,-S)}var x=v-1,U=1,z=0;for(this[c+x]=u&255;--x>=0&&(U*=256);)u<0&&z===0&&this[c+x+1]!==0&&(z=1),this[c+x]=(u/U>>0)-z&255;return c+v},l.prototype.writeInt8=function(u,c,v){return u=+u,c=c|0,v||ae(this,u,c,1,127,-128),l.TYPED_ARRAY_SUPPORT||(u=Math.floor(u)),u<0&&(u=255+u+1),this[c]=u&255,c+1},l.prototype.writeInt16LE=function(u,c,v){return u=+u,c=c|0,v||ae(this,u,c,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[c]=u&255,this[c+1]=u>>>8):Yt(this,u,c,!0),c+2},l.prototype.writeInt16BE=function(u,c,v){return u=+u,c=c|0,v||ae(this,u,c,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[c]=u>>>8,this[c+1]=u&255):Yt(this,u,c,!1),c+2},l.prototype.writeInt32LE=function(u,c,v){return u=+u,c=c|0,v||ae(this,u,c,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[c]=u&255,this[c+1]=u>>>8,this[c+2]=u>>>16,this[c+3]=u>>>24):Zt(this,u,c,!0),c+4},l.prototype.writeInt32BE=function(u,c,v){return u=+u,c=c|0,v||ae(this,u,c,4,2147483647,-2147483648),u<0&&(u=4294967295+u+1),l.TYPED_ARRAY_SUPPORT?(this[c]=u>>>24,this[c+1]=u>>>16,this[c+2]=u>>>8,this[c+3]=u&255):Zt(this,u,c,!1),c+4};function Nn(h,u,c,v,_,S){if(c+v>h.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function zn(h,u,c,v,_){return _||Nn(h,u,c,4),r.write(h,u,c,v,23,4),c+4}l.prototype.writeFloatLE=function(u,c,v){return zn(this,u,c,!0,v)},l.prototype.writeFloatBE=function(u,c,v){return zn(this,u,c,!1,v)};function $n(h,u,c,v,_){return _||Nn(h,u,c,8),r.write(h,u,c,v,52,8),c+8}l.prototype.writeDoubleLE=function(u,c,v){return $n(this,u,c,!0,v)},l.prototype.writeDoubleBE=function(u,c,v){return $n(this,u,c,!1,v)},l.prototype.copy=function(u,c,v,_){if(v||(v=0),!_&&_!==0&&(_=this.length),c>=u.length&&(c=u.length),c||(c=0),_>0&&_<v&&(_=v),_===v||u.length===0||this.length===0)return 0;if(c<0)throw new RangeError("targetStart out of bounds");if(v<0||v>=this.length)throw new RangeError("sourceStart out of bounds");if(_<0)throw new RangeError("sourceEnd out of bounds");_>this.length&&(_=this.length),u.length-c<_-v&&(_=u.length-c+v);var S=_-v,x;if(this===u&&v<c&&c<_)for(x=S-1;x>=0;--x)u[x+c]=this[x+v];else if(S<1e3||!l.TYPED_ARRAY_SUPPORT)for(x=0;x<S;++x)u[x+c]=this[x+v];else Uint8Array.prototype.set.call(u,this.subarray(v,v+S),c);return S},l.prototype.fill=function(u,c,v,_){if(typeof u=="string"){if(typeof c=="string"?(_=c,c=0,v=this.length):typeof v=="string"&&(_=v,v=this.length),u.length===1){var S=u.charCodeAt(0);S<256&&(u=S)}if(_!==void 0&&typeof _!="string")throw new TypeError("encoding must be a string");if(typeof _=="string"&&!l.isEncoding(_))throw new TypeError("Unknown encoding: "+_)}else typeof u=="number"&&(u=u&255);if(c<0||this.length<c||this.length<v)throw new RangeError("Out of range index");if(v<=c)return this;c=c>>>0,v=v===void 0?this.length:v>>>0,u||(u=0);var x;if(typeof u=="number")for(x=c;x<v;++x)this[x]=u;else{var U=l.isBuffer(u)?u:Xt(new l(u,_).toString()),z=U.length;for(x=0;x<v-c;++x)this[x+c]=U[x%z]}return this};var hs=/[^+\/0-9A-Za-z-_]/g;function ps(h){if(h=vs(h).replace(hs,""),h.length<2)return"";for(;h.length%4!==0;)h=h+"=";return h}function vs(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")}function gs(h){return h<16?"0"+h.toString(16):h.toString(16)}function Xt(h,u){u=u||1/0;for(var c,v=h.length,_=null,S=[],x=0;x<v;++x){if(c=h.charCodeAt(x),c>55295&&c<57344){if(!_){if(c>56319){(u-=3)>-1&&S.push(239,191,189);continue}else if(x+1===v){(u-=3)>-1&&S.push(239,191,189);continue}_=c;continue}if(c<56320){(u-=3)>-1&&S.push(239,191,189),_=c;continue}c=(_-55296<<10|c-56320)+65536}else _&&(u-=3)>-1&&S.push(239,191,189);if(_=null,c<128){if((u-=1)<0)break;S.push(c)}else if(c<2048){if((u-=2)<0)break;S.push(c>>6|192,c&63|128)}else if(c<65536){if((u-=3)<0)break;S.push(c>>12|224,c>>6&63|128,c&63|128)}else if(c<1114112){if((u-=4)<0)break;S.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw new Error("Invalid code point")}return S}function ms(h){for(var u=[],c=0;c<h.length;++c)u.push(h.charCodeAt(c)&255);return u}function ys(h,u){for(var c,v,_,S=[],x=0;x<h.length&&!((u-=2)<0);++x)c=h.charCodeAt(x),v=c>>8,_=c%256,S.push(_),S.push(v);return S}function Ln(h){return t.toByteArray(ps(h))}function Qt(h,u,c,v){for(var _=0;_<v&&!(_+c>=u.length||_>=h.length);++_)u[_+c]=h[_];return _}function _s(h){return h!==h}})(Mr)),Mr}var $=Hs(),fe;typeof window<"u"&&window.crypto&&(fe=window.crypto);!fe&&typeof window<"u"&&window.msCrypto&&(fe=window.msCrypto);!fe&&typeof global<"u"&&global.crypto&&(fe=global.crypto);if(!fe&&typeof require=="function")try{fe=require("crypto")}catch{}function Vs(){if(fe){if(typeof fe.getRandomValues=="function")try{return fe.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof fe.randomBytes=="function")try{return fe.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")}function qs(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((i&15).toString(16))}return n.join("")}var Ws=(function(){function e(r,n){r=this.words=r||[],n!=null?this.sigBytes=n:this.sigBytes=r.length*4}var t=e.prototype;return t.random=function(n){for(var o=[],i=0;i<n;i+=4)o.push(Vs());return new e(o,n)},t.toString=function(){return qs(this)},e})(),Nr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var on=function(e,t){return on=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o])},on(e,t)};function Gs(e,t){on(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var sn=function(){return sn=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},sn.apply(this,arguments)};function Js(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r}function Ys(e,t,r,n){var o=arguments.length,i=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,t,r,n);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i}function Zs(e,t){return function(r,n){t(r,n,e)}}function Xs(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function Qs(e,t,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function l(g){try{d(n.next(g))}catch(p){a(p)}}function f(g){try{d(n.throw(g))}catch(p){a(p)}}function d(g){g.done?i(g.value):o(g.value).then(l,f)}d((n=n.apply(e,t||[])).next())})}function ea(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(d){return function(g){return f([d,g])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=d[0]&2?o.return:d[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,d[1])).done)return i;switch(o=0,i&&(d=[d[0]&2,i.value]),d[0]){case 0:case 1:i=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,o=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){r.label=d[1];break}if(d[0]===6&&r.label<i[1]){r.label=i[1],i=d;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(d);break}i[2]&&r.ops.pop(),r.trys.pop();continue}d=t.call(e,r)}catch(g){d=[6,g],o=0}finally{n=i=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function ta(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}function ra(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=e[r])}function an(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function mo(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],a;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(l){a={error:l}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return i}function na(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(mo(arguments[t]));return e}function ia(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var i=arguments[t],a=0,l=i.length;a<l;a++,o++)n[o]=i[a];return n}function Lt(e){return this instanceof Lt?(this.v=e,this):new Lt(e)}function oa(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,i=[];return o={},a("next"),a("throw"),a("return"),o[Symbol.asyncIterator]=function(){return this},o;function a(y){n[y]&&(o[y]=function(m){return new Promise(function(w,b){i.push([y,m,w,b])>1||l(y,m)})})}function l(y,m){try{f(n[y](m))}catch(w){p(i[0][3],w)}}function f(y){y.value instanceof Lt?Promise.resolve(y.value.v).then(d,g):p(i[0][2],y)}function d(y){l("next",y)}function g(y){l("throw",y)}function p(y,m){y(m),i.shift(),i.length&&l(i[0][0],i[0][1])}}function sa(e){var t,r;return t={},n("next"),n("throw",function(o){throw o}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(o,i){t[o]=e[o]?function(a){return(r=!r)?{value:Lt(e[o](a)),done:o==="return"}:i?i(a):a}:i}}function aa(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof an=="function"?an(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(a){return new Promise(function(l,f){a=e[i](a),o(l,f,a.done,a.value)})}}function o(i,a,l,f){Promise.resolve(f).then(function(d){i({value:d,done:l})},a)}}function la(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function ua(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function ca(e){return e&&e.__esModule?e:{default:e}}function da(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function fa(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r}const ha=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return sn},__asyncDelegator:sa,__asyncGenerator:oa,__asyncValues:aa,__await:Lt,__awaiter:Qs,__classPrivateFieldGet:da,__classPrivateFieldSet:fa,__createBinding:ta,__decorate:Ys,__exportStar:ra,__extends:Gs,__generator:ea,__importDefault:ca,__importStar:ua,__makeTemplateObject:la,__metadata:Xs,__param:Zs,__read:mo,__rest:Js,__spread:na,__spreadArrays:ia,__values:an},Symbol.toStringTag,{value:"Module"})),yo=In(ha);var St={},ue={},ai;function _o(){return ai||(ai=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.MAX_HASHABLE_LENGTH=ue.INIT=ue.KEY=ue.DIGEST_LENGTH=ue.BLOCK_SIZE=void 0,ue.BLOCK_SIZE=64,ue.DIGEST_LENGTH=32,ue.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ue.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],ue.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1),ue}var bt={},li;function pa(){if(li)return bt;li=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.RawSha256=void 0;var e=_o(),t=(function(){function r(){this.state=Int32Array.from(e.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return r.prototype.update=function(n){if(this.finished)throw new Error("Attempted to update an already finished hash.");var o=0,i=n.byteLength;if(this.bytesHashed+=i,this.bytesHashed*8>e.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;i>0;)this.buffer[this.bufferLength++]=n[o++],i--,this.bufferLength===e.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},r.prototype.digest=function(){if(!this.finished){var n=this.bytesHashed*8,o=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),i=this.bufferLength;if(o.setUint8(this.bufferLength++,128),i%e.BLOCK_SIZE>=e.BLOCK_SIZE-8){for(var a=this.bufferLength;a<e.BLOCK_SIZE;a++)o.setUint8(a,0);this.hashBuffer(),this.bufferLength=0}for(var a=this.bufferLength;a<e.BLOCK_SIZE-8;a++)o.setUint8(a,0);o.setUint32(e.BLOCK_SIZE-8,Math.floor(n/4294967296),!0),o.setUint32(e.BLOCK_SIZE-4,n),this.hashBuffer(),this.finished=!0}for(var l=new Uint8Array(e.DIGEST_LENGTH),a=0;a<8;a++)l[a*4]=this.state[a]>>>24&255,l[a*4+1]=this.state[a]>>>16&255,l[a*4+2]=this.state[a]>>>8&255,l[a*4+3]=this.state[a]>>>0&255;return l},r.prototype.hashBuffer=function(){for(var n=this,o=n.buffer,i=n.state,a=i[0],l=i[1],f=i[2],d=i[3],g=i[4],p=i[5],y=i[6],m=i[7],w=0;w<e.BLOCK_SIZE;w++){if(w<16)this.temp[w]=(o[w*4]&255)<<24|(o[w*4+1]&255)<<16|(o[w*4+2]&255)<<8|o[w*4+3]&255;else{var b=this.temp[w-2],C=(b>>>17|b<<15)^(b>>>19|b<<13)^b>>>10;b=this.temp[w-15];var T=(b>>>7|b<<25)^(b>>>18|b<<14)^b>>>3;this.temp[w]=(C+this.temp[w-7]|0)+(T+this.temp[w-16]|0)}var I=(((g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&p^~g&y)|0)+(m+(e.KEY[w]+this.temp[w]|0)|0)|0,R=((a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10))+(a&l^a&f^l&f)|0;m=y,y=p,p=g,g=d+I|0,d=f,f=l,l=a,a=I+R|0}i[0]+=a,i[1]+=l,i[2]+=f,i[3]+=d,i[4]+=g,i[5]+=p,i[6]+=y,i[7]+=m},r})();return bt.RawSha256=t,bt}var zr={},xt={};const va=e=>{const t=[];for(let r=0,n=e.length;r<n;r++){const o=e.charCodeAt(r);if(o<128)t.push(o);else if(o<2048)t.push(o>>6|192,o&63|128);else if(r+1<e.length&&(o&64512)===55296&&(e.charCodeAt(r+1)&64512)===56320){const i=65536+((o&1023)<<10)+(e.charCodeAt(++r)&1023);t.push(i>>18|240,i>>12&63|128,i>>6&63|128,i&63|128)}else t.push(o>>12|224,o>>6&63|128,o&63|128)}return Uint8Array.from(t)},ga=e=>{let t="";for(let r=0,n=e.length;r<n;r++){const o=e[r];if(o<128)t+=String.fromCharCode(o);else if(192<=o&&o<224){const i=e[++r];t+=String.fromCharCode((o&31)<<6|i&63)}else if(240<=o&&o<365){const a="%"+[o,e[++r],e[++r],e[++r]].map(l=>l.toString(16)).join("%");t+=decodeURIComponent(a)}else t+=String.fromCharCode((o&15)<<12|(e[++r]&63)<<6|e[++r]&63)}return t};function ma(e){return new TextEncoder().encode(e)}function ya(e){return new TextDecoder("utf-8").decode(e)}const _a=e=>typeof TextEncoder=="function"?ma(e):va(e),wa=e=>typeof TextDecoder=="function"?ya(e):ga(e),Sa=Object.freeze(Object.defineProperty({__proto__:null,fromUtf8:_a,toUtf8:wa},Symbol.toStringTag,{value:"Module"})),ba=In(Sa);var ui;function xa(){if(ui)return xt;ui=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.convertToBuffer=void 0;var e=ba,t=typeof Buffer<"u"&&Buffer.from?function(n){return Buffer.from(n,"utf8")}:e.fromUtf8;function r(n){return n instanceof Uint8Array?n:typeof n=="string"?t(n):ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(n)}return xt.convertToBuffer=r,xt}var Ct={},ci;function Ca(){if(ci)return Ct;ci=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.isEmptyData=void 0;function e(t){return typeof t=="string"?t.length===0:t.byteLength===0}return Ct.isEmptyData=e,Ct}var Tt={},di;function Ta(){if(di)return Tt;di=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.numToUint8=void 0;function e(t){return new Uint8Array([(t&4278190080)>>24,(t&16711680)>>16,(t&65280)>>8,t&255])}return Tt.numToUint8=e,Tt}var It={},fi;function Ia(){if(fi)return It;fi=1,Object.defineProperty(It,"__esModule",{value:!0}),It.uint32ArrayFrom=void 0;function e(t){if(!Array.from){for(var r=new Uint32Array(t.length),n=0;n<t.length;)r[n]=t[n];return r}return Uint32Array.from(t)}return It.uint32ArrayFrom=e,It}var hi;function Ea(){return hi||(hi=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.uint32ArrayFrom=e.numToUint8=e.isEmptyData=e.convertToBuffer=void 0;var t=xa();Object.defineProperty(e,"convertToBuffer",{enumerable:!0,get:function(){return t.convertToBuffer}});var r=Ca();Object.defineProperty(e,"isEmptyData",{enumerable:!0,get:function(){return r.isEmptyData}});var n=Ta();Object.defineProperty(e,"numToUint8",{enumerable:!0,get:function(){return n.numToUint8}});var o=Ia();Object.defineProperty(e,"uint32ArrayFrom",{enumerable:!0,get:function(){return o.uint32ArrayFrom}})})(zr)),zr}var pi;function ka(){if(pi)return St;pi=1,Object.defineProperty(St,"__esModule",{value:!0}),St.Sha256=void 0;var e=yo,t=_o(),r=pa(),n=Ea(),o=(function(){function a(l){if(this.hash=new r.RawSha256,l){this.outer=new r.RawSha256;var f=i(l),d=new Uint8Array(t.BLOCK_SIZE);d.set(f);for(var g=0;g<t.BLOCK_SIZE;g++)f[g]^=54,d[g]^=92;this.hash.update(f),this.outer.update(d);for(var g=0;g<f.byteLength;g++)f[g]=0}}return a.prototype.update=function(l){if(!((0,n.isEmptyData)(l)||this.error))try{this.hash.update((0,n.convertToBuffer)(l))}catch(f){this.error=f}},a.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},a.prototype.digest=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(l){return[2,this.digestSync()]})})},a})();St.Sha256=o;function i(a){var l=(0,n.convertToBuffer)(a);if(l.byteLength>t.BLOCK_SIZE){var f=new r.RawSha256;f.update(l),l=f.digest()}var d=new Uint8Array(t.BLOCK_SIZE);return d.set(l),d}return St}var vi;function Ua(){return vi||(vi=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=yo;(0,t.__exportStar)(ka(),e)})(Nr)),Nr}var Rt=Ua();function k(e,t){e!=null&&this.fromString(e,t)}function se(){return new k(null)}var Oe,Aa=0xdeadbeefcafe,gi=(Aa&16777215)==15715070;function Da(e,t,r,n,o,i){for(;--i>=0;){var a=t*this[e++]+r[n]+o;o=Math.floor(a/67108864),r[n++]=a&67108863}return o}function Ra(e,t,r,n,o,i){for(var a=t&32767,l=t>>15;--i>=0;){var f=this[e]&32767,d=this[e++]>>15,g=l*f+d*a;f=a*f+((g&32767)<<15)+r[n]+(o&1073741823),o=(f>>>30)+(g>>>15)+l*d+(o>>>30),r[n++]=f&1073741823}return o}function Pa(e,t,r,n,o,i){for(var a=t&16383,l=t>>14;--i>=0;){var f=this[e]&16383,d=this[e++]>>14,g=l*f+d*a;f=a*f+((g&16383)<<14)+r[n]+o,o=(f>>28)+(g>>14)+l*d,r[n++]=f&268435455}return o}var mi=typeof navigator<"u";mi&&gi&&navigator.appName=="Microsoft Internet Explorer"?(k.prototype.am=Ra,Oe=30):mi&&gi&&navigator.appName!="Netscape"?(k.prototype.am=Da,Oe=26):(k.prototype.am=Pa,Oe=28);k.prototype.DB=Oe;k.prototype.DM=(1<<Oe)-1;k.prototype.DV=1<<Oe;var En=52;k.prototype.FV=Math.pow(2,En);k.prototype.F1=En-Oe;k.prototype.F2=2*Oe-En;var Fa="0123456789abcdefghijklmnopqrstuvwxyz",Ur=new Array,mt,he;mt=48;for(he=0;he<=9;++he)Ur[mt++]=he;mt=97;for(he=10;he<36;++he)Ur[mt++]=he;mt=65;for(he=10;he<36;++he)Ur[mt++]=he;function yi(e){return Fa.charAt(e)}function Ba(e,t){var r=Ur[e.charCodeAt(t)];return r??-1}function Ma(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function Oa(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function kn(e){var t=se();return t.fromInt(e),t}function Na(e,t){var r;if(t==16)r=4;else if(t==8)r=3;else if(t==2)r=1;else if(t==32)r=5;else if(t==4)r=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");this.t=0,this.s=0;for(var n=e.length,o=!1,i=0;--n>=0;){var a=Ba(e,n);if(a<0){e.charAt(n)=="-"&&(o=!0);continue}o=!1,i==0?this[this.t++]=a:i+r>this.DB?(this[this.t-1]|=(a&(1<<this.DB-i)-1)<<i,this[this.t++]=a>>this.DB-i):this[this.t-1]|=a<<i,i+=r,i>=this.DB&&(i-=this.DB)}this.clamp(),o&&k.ZERO.subTo(this,this)}function za(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t}function $a(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(e==16)t=4;else if(e==8)t=3;else if(e==2)t=1;else if(e==32)t=5;else if(e==4)t=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");var r=(1<<t)-1,n,o=!1,i="",a=this.t,l=this.DB-a*this.DB%t;if(a-- >0)for(l<this.DB&&(n=this[a]>>l)>0&&(o=!0,i=yi(n));a>=0;)l<t?(n=(this[a]&(1<<l)-1)<<t-l,n|=this[--a]>>(l+=this.DB-t)):(n=this[a]>>(l-=t)&r,l<=0&&(l+=this.DB,--a)),n>0&&(o=!0),o&&(i+=yi(n));return o?i:"0"}function La(){var e=se();return k.ZERO.subTo(this,e),e}function ja(){return this.s<0?this.negate():this}function Ka(e){var t=this.s-e.s;if(t!=0)return t;var r=this.t;if(t=r-e.t,t!=0)return this.s<0?-t:t;for(;--r>=0;)if((t=this[r]-e[r])!=0)return t;return 0}function Un(e){var t=1,r;return(r=e>>>16)!=0&&(e=r,t+=16),(r=e>>8)!=0&&(e=r,t+=8),(r=e>>4)!=0&&(e=r,t+=4),(r=e>>2)!=0&&(e=r,t+=2),(r=e>>1)!=0&&(e=r,t+=1),t}function Ha(){return this.t<=0?0:this.DB*(this.t-1)+Un(this[this.t-1]^this.s&this.DM)}function Va(e,t){var r;for(r=this.t-1;r>=0;--r)t[r+e]=this[r];for(r=e-1;r>=0;--r)t[r]=0;t.t=this.t+e,t.s=this.s}function qa(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s}function Wa(e,t){var r=e%this.DB,n=this.DB-r,o=(1<<n)-1,i=Math.floor(e/this.DB),a=this.s<<r&this.DM,l;for(l=this.t-1;l>=0;--l)t[l+i+1]=this[l]>>n|a,a=(this[l]&o)<<r;for(l=i-1;l>=0;--l)t[l]=0;t[i]=a,t.t=this.t+i+1,t.s=this.s,t.clamp()}function Ga(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t){t.t=0;return}var n=e%this.DB,o=this.DB-n,i=(1<<n)-1;t[0]=this[r]>>n;for(var a=r+1;a<this.t;++a)t[a-r-1]|=(this[a]&i)<<o,t[a-r]=this[a]>>n;n>0&&(t[this.t-r-1]|=(this.s&i)<<o),t.t=this.t-r,t.clamp()}function Ja(e,t){for(var r=0,n=0,o=Math.min(e.t,this.t);r<o;)n+=this[r]-e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e[r],t[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t[r++]=this.DV+n:n>0&&(t[r++]=n),t.t=r,t.clamp()}function Ya(e,t){var r=this.abs(),n=e.abs(),o=r.t;for(t.t=o+n.t;--o>=0;)t[o]=0;for(o=0;o<n.t;++o)t[o+r.t]=r.am(0,n[o],t,o,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&k.ZERO.subTo(t,t)}function Za(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()}function Xa(e,t,r){var n=e.abs();if(!(n.t<=0)){var o=this.abs();if(o.t<n.t){t!=null&&t.fromInt(0),r!=null&&this.copyTo(r);return}r==null&&(r=se());var i=se(),a=this.s,l=e.s,f=this.DB-Un(n[n.t-1]);f>0?(n.lShiftTo(f,i),o.lShiftTo(f,r)):(n.copyTo(i),o.copyTo(r));var d=i.t,g=i[d-1];if(g!=0){var p=g*(1<<this.F1)+(d>1?i[d-2]>>this.F2:0),y=this.FV/p,m=(1<<this.F1)/p,w=1<<this.F2,b=r.t,C=b-d,T=t??se();for(i.dlShiftTo(C,T),r.compareTo(T)>=0&&(r[r.t++]=1,r.subTo(T,r)),k.ONE.dlShiftTo(d,T),T.subTo(i,i);i.t<d;)i[i.t++]=0;for(;--C>=0;){var I=r[--b]==g?this.DM:Math.floor(r[b]*y+(r[b-1]+w)*m);if((r[b]+=i.am(0,I,r,C,0,d))<I)for(i.dlShiftTo(C,T),r.subTo(T,r);r[b]<--I;)r.subTo(T,r)}t!=null&&(r.drShiftTo(d,t),a!=l&&k.ZERO.subTo(t,t)),r.t=d,r.clamp(),f>0&&r.rShiftTo(f,r),a<0&&k.ZERO.subTo(r,r)}}}function Qa(e){var t=se();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(k.ZERO)>0&&e.subTo(t,t),t}function el(){if(this.t<1)return 0;var e=this[0];if((e&1)==0)return 0;var t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function tl(e){return this.compareTo(e)==0}function rl(e,t){for(var r=0,n=0,o=Math.min(e.t,this.t);r<o;)n+=this[r]+e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e[r],t[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t[r++]=n:n<-1&&(t[r++]=this.DV+n),t.t=r,t.clamp()}function nl(e){var t=se();return this.addTo(e,t),t}function il(e){var t=se();return this.subTo(e,t),t}function ol(e){var t=se();return this.multiplyTo(e,t),t}function sl(e){var t=se();return this.divRemTo(e,t,null),t}function yt(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function al(e){var t=se();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(k.ZERO)>0&&this.m.subTo(t,t),t}function ll(e){var t=se();return e.copyTo(t),this.reduce(t),t}function ul(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=e[t]&32767,n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(r=t+this.m.t,e[r]+=this.m.am(0,n,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function cl(e,t){e.squareTo(t),this.reduce(t)}function dl(e,t,r){e.multiplyTo(t,r),this.reduce(r)}yt.prototype.convert=al;yt.prototype.revert=ll;yt.prototype.reduce=ul;yt.prototype.mulTo=dl;yt.prototype.sqrTo=cl;function fl(e,t,r){var n=e.bitLength(),o,i=kn(1),a=new yt(t);if(n<=0)return i;n<18?o=1:n<48?o=3:n<144?o=4:n<768?o=5:o=6;var l=new Array,f=3,d=o-1,g=(1<<o)-1;if(l[1]=a.convert(this),o>1){var p=se();for(a.sqrTo(l[1],p);f<=g;)l[f]=se(),a.mulTo(p,l[f-2],l[f]),f+=2}var y=e.t-1,m,w=!0,b=se(),C;for(n=Un(e[y])-1;y>=0;){for(n>=d?m=e[y]>>n-d&g:(m=(e[y]&(1<<n+1)-1)<<d-n,y>0&&(m|=e[y-1]>>this.DB+n-d)),f=o;(m&1)==0;)m>>=1,--f;if((n-=f)<0&&(n+=this.DB,--y),w)l[m].copyTo(i),w=!1;else{for(;f>1;)a.sqrTo(i,b),a.sqrTo(b,i),f-=2;f>0?a.sqrTo(i,b):(C=i,i=b,b=C),a.mulTo(b,l[m],i)}for(;y>=0&&(e[y]&1<<n)==0;)a.sqrTo(i,b),C=i,i=b,b=C,--n<0&&(n=this.DB-1,--y)}var T=a.revert(i);return r(null,T),T}k.prototype.copyTo=Ma;k.prototype.fromInt=Oa;k.prototype.fromString=Na;k.prototype.clamp=za;k.prototype.dlShiftTo=Va;k.prototype.drShiftTo=qa;k.prototype.lShiftTo=Wa;k.prototype.rShiftTo=Ga;k.prototype.subTo=Ja;k.prototype.multiplyTo=Ya;k.prototype.squareTo=Za;k.prototype.divRemTo=Xa;k.prototype.invDigit=el;k.prototype.addTo=rl;k.prototype.toString=$a;k.prototype.negate=La;k.prototype.abs=ja;k.prototype.compareTo=Ka;k.prototype.bitLength=Ha;k.prototype.mod=Qa;k.prototype.equals=tl;k.prototype.add=nl;k.prototype.subtract=il;k.prototype.multiply=ol;k.prototype.divide=sl;k.prototype.modPow=fl;k.ZERO=kn(0);k.ONE=kn(1);/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */function $r(e){return $.Buffer.from(new Ws().random(e).toString(),"hex")}var hl=/^[89a-f]/i,pl="FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",vl="userAttributes.",tt=(function(){function e(r){this.N=new k(pl,16),this.g=new k("2",16),this.k=new k(this.hexHash(""+this.padHex(this.N)+this.padHex(this.g)),16),this.smallAValue=this.generateRandomSmallA(),this.getLargeAValue(function(){}),this.infoBits=$.Buffer.from("Caldera Derived Key","utf8"),this.poolName=r}var t=e.prototype;return t.getSmallAValue=function(){return this.smallAValue},t.getLargeAValue=function(n){var o=this;this.largeAValue?n(null,this.largeAValue):this.calculateA(this.smallAValue,function(i,a){i&&n(i,null),o.largeAValue=a,n(null,o.largeAValue)})},t.generateRandomSmallA=function(){var n=$r(128).toString("hex"),o=new k(n,16);return o},t.generateRandomString=function(){return $r(40).toString("base64")},t.getRandomPassword=function(){return this.randomPassword},t.getSaltDevices=function(){return this.SaltToHashDevices},t.getVerifierDevices=function(){return this.verifierDevices},t.generateHashDevice=function(n,o,i){var a=this;this.randomPassword=this.generateRandomString();var l=""+n+o+":"+this.randomPassword,f=this.hash(l),d=$r(16).toString("hex");this.SaltToHashDevices=this.padHex(new k(d,16)),this.g.modPow(new k(this.hexHash(this.SaltToHashDevices+f),16),this.N,function(g,p){g&&i(g,null),a.verifierDevices=a.padHex(p),i(null,null)})},t.calculateA=function(n,o){var i=this;this.g.modPow(n,this.N,function(a,l){a&&o(a,null),l.mod(i.N).equals(k.ZERO)&&o(new Error("Illegal paramater. A mod N cannot be 0."),null),o(null,l)})},t.calculateU=function(n,o){this.UHexHash=this.hexHash(this.padHex(n)+this.padHex(o));var i=new k(this.UHexHash,16);return i},t.hash=function(n){var o=new Rt.Sha256;o.update(n);var i=o.digestSync(),a=$.Buffer.from(i).toString("hex");return new Array(64-a.length).join("0")+a},t.hexHash=function(n){return this.hash($.Buffer.from(n,"hex"))},t.computehkdf=function(n,o){var i=$.Buffer.concat([this.infoBits,$.Buffer.from("","utf8")]),a=new Rt.Sha256(o);a.update(n);var l=a.digestSync(),f=new Rt.Sha256(l);f.update(i);var d=f.digestSync(),g=d,p=g.slice(0,16);return p},t.getPasswordAuthenticationKey=function(n,o,i,a,l){var f=this;if(i.mod(this.N).equals(k.ZERO))throw new Error("B cannot be zero.");if(this.UValue=this.calculateU(this.largeAValue,i),this.UValue.equals(k.ZERO))throw new Error("U cannot be zero.");var d=""+this.poolName+n+":"+o,g=this.hash(d),p=new k(this.hexHash(this.padHex(a)+g),16);this.calculateS(p,i,function(y,m){y&&l(y,null);var w=f.computehkdf($.Buffer.from(f.padHex(m),"hex"),$.Buffer.from(f.padHex(f.UValue),"hex"));l(null,w)})},t.calculateS=function(n,o,i){var a=this;this.g.modPow(n,this.N,function(l,f){l&&i(l,null);var d=o.subtract(a.k.multiply(f));d.modPow(a.smallAValue.add(a.UValue.multiply(n)),a.N,function(g,p){g&&i(g,null),i(null,p.mod(a.N))})})},t.getNewPasswordRequiredChallengeUserAttributePrefix=function(){return vl},t.padHex=function(n){if(!(n instanceof k))throw new Error("Not a BigInteger");var o=n.compareTo(k.ZERO)<0,i=n.abs().toString(16);if(i=i.length%2!==0?"0"+i:i,i=hl.test(i)?"00"+i:i,o){var a=i.split("").map(function(f){var d=~parseInt(f,16)&15;return"0123456789ABCDEF".charAt(d)}).join(""),l=new k(a,16).add(k.ONE);i=l.toString(16),i.toUpperCase().startsWith("FF8")&&(i=i.substring(2))}return i},e})();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var wo=(function(){function e(r){this.jwtToken=r||"",this.payload=this.decodePayload()}var t=e.prototype;return t.getJwtToken=function(){return this.jwtToken},t.getExpiration=function(){return this.payload.exp},t.getIssuedAt=function(){return this.payload.iat},t.decodePayload=function(){var n=this.jwtToken.split(".")[1];try{return JSON.parse($.Buffer.from(n,"base64").toString("utf8"))}catch{return{}}},e})();function gl(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ln(e,t)}function ln(e,t){return ln=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},ln(e,t)}var _i=(function(e){function t(r){var n=r===void 0?{}:r,o=n.AccessToken;return e.call(this,o||"")||this}return gl(t,e),t})(wo);function ml(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,un(e,t)}function un(e,t){return un=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},un(e,t)}var wi=(function(e){function t(r){var n=r===void 0?{}:r,o=n.IdToken;return e.call(this,o||"")||this}return ml(t,e),t})(wo);/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var Si=(function(){function e(r){var n=r===void 0?{}:r,o=n.RefreshToken;this.token=o||""}var t=e.prototype;return t.getToken=function(){return this.token},e})(),yl="5.0.4";/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var _l="aws-amplify/"+yl,So={userAgent:_l,isReactNative:typeof navigator<"u"&&navigator.product==="ReactNative"},wl=function(){return So.userAgent};/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var bi=(function(){function e(r){var n=r===void 0?{}:r,o=n.IdToken,i=n.RefreshToken,a=n.AccessToken,l=n.ClockDrift;if(a==null||o==null)throw new Error("Id token and Access Token must be present.");this.idToken=o,this.refreshToken=i,this.accessToken=a,this.clockDrift=l===void 0?this.calculateClockDrift():l}var t=e.prototype;return t.getIdToken=function(){return this.idToken},t.getRefreshToken=function(){return this.refreshToken},t.getAccessToken=function(){return this.accessToken},t.getClockDrift=function(){return this.clockDrift},t.calculateClockDrift=function(){var n=Math.floor(new Date/1e3),o=Math.min(this.accessToken.getIssuedAt(),this.idToken.getIssuedAt());return n-o},t.isValid=function(){var n=Math.floor(new Date/1e3),o=n-this.clockDrift;return o<this.accessToken.getExpiration()&&o<this.idToken.getExpiration()},e})();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var Sl=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],bl=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],xi=(function(){function e(){}var t=e.prototype;return t.getNowString=function(){var n=new Date,o=bl[n.getUTCDay()],i=Sl[n.getUTCMonth()],a=n.getUTCDate(),l=n.getUTCHours();l<10&&(l="0"+l);var f=n.getUTCMinutes();f<10&&(f="0"+f);var d=n.getUTCSeconds();d<10&&(d="0"+d);var g=n.getUTCFullYear(),p=o+" "+i+" "+a+" "+l+":"+f+":"+d+" UTC "+g;return p},e})();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var xl=(function(){function e(r){var n=r===void 0?{}:r,o=n.Name,i=n.Value;this.Name=o||"",this.Value=i||""}var t=e.prototype;return t.getValue=function(){return this.Value},t.setValue=function(n){return this.Value=n,this},t.getName=function(){return this.Name},t.setName=function(n){return this.Name=n,this},t.toString=function(){return JSON.stringify(this)},t.toJSON=function(){return{Name:this.Name,Value:this.Value}},e})();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var Ke={},Cl=(function(){function e(){}return e.setItem=function(r,n){return Ke[r]=n,Ke[r]},e.getItem=function(r){return Object.prototype.hasOwnProperty.call(Ke,r)?Ke[r]:void 0},e.removeItem=function(r){return delete Ke[r]},e.clear=function(){return Ke={},Ke},e})(),bo=(function(){function e(){try{this.storageWindow=window.localStorage,this.storageWindow.setItem("aws.cognito.test-ls",1),this.storageWindow.removeItem("aws.cognito.test-ls")}catch{this.storageWindow=Cl}}var t=e.prototype;return t.getStorage=function(){return this.storageWindow},e})();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var Tl=typeof navigator<"u",Ci=Tl?So.isReactNative?"react-native":navigator.userAgent:"nodejs",cn=(function(){function e(r){if(r==null||r.Username==null||r.Pool==null)throw new Error("Username and Pool information are required.");this.username=r.Username||"",this.pool=r.Pool,this.Session=null,this.client=r.Pool.client,this.signInUserSession=null,this.authenticationFlowType="USER_SRP_AUTH",this.storage=r.Storage||new bo().getStorage(),this.keyPrefix="CognitoIdentityServiceProvider."+this.pool.getClientId(),this.userDataKey=this.keyPrefix+"."+this.username+".userData"}var t=e.prototype;return t.setSignInUserSession=function(n){this.clearCachedUserData(),this.signInUserSession=n,this.cacheTokens()},t.getSignInUserSession=function(){return this.signInUserSession},t.getUsername=function(){return this.username},t.getAuthenticationFlowType=function(){return this.authenticationFlowType},t.setAuthenticationFlowType=function(n){this.authenticationFlowType=n},t.initiateAuth=function(n,o){var i=this,a=n.getAuthParameters();a.USERNAME=this.username;var l=Object.keys(n.getValidationData()).length!==0?n.getValidationData():n.getClientMetadata(),f={AuthFlow:"CUSTOM_AUTH",ClientId:this.pool.getClientId(),AuthParameters:a,ClientMetadata:l};this.getUserContextData()&&(f.UserContextData=this.getUserContextData()),this.client.request("InitiateAuth",f,function(d,g){if(d)return o.onFailure(d);var p=g.ChallengeName,y=g.ChallengeParameters;return p==="CUSTOM_CHALLENGE"?(i.Session=g.Session,o.customChallenge(y)):(i.signInUserSession=i.getCognitoUserSession(g.AuthenticationResult),i.cacheTokens(),o.onSuccess(i.signInUserSession))})},t.authenticateUser=function(n,o){return this.authenticationFlowType==="USER_PASSWORD_AUTH"?this.authenticateUserPlainUsernamePassword(n,o):this.authenticationFlowType==="USER_SRP_AUTH"||this.authenticationFlowType==="CUSTOM_AUTH"?this.authenticateUserDefaultAuth(n,o):o.onFailure(new Error("Authentication flow type is invalid."))},t.authenticateUserDefaultAuth=function(n,o){var i=this,a=new tt(this.pool.getUserPoolName()),l=new xi,f,d,g={};this.deviceKey!=null&&(g.DEVICE_KEY=this.deviceKey),g.USERNAME=this.username,a.getLargeAValue(function(p,y){p&&o.onFailure(p),g.SRP_A=y.toString(16),i.authenticationFlowType==="CUSTOM_AUTH"&&(g.CHALLENGE_NAME="SRP_A");var m=Object.keys(n.getValidationData()).length!==0?n.getValidationData():n.getClientMetadata(),w={AuthFlow:i.authenticationFlowType,ClientId:i.pool.getClientId(),AuthParameters:g,ClientMetadata:m};i.getUserContextData(i.username)&&(w.UserContextData=i.getUserContextData(i.username)),i.client.request("InitiateAuth",w,function(b,C){if(b)return o.onFailure(b);var T=C.ChallengeParameters;i.username=T.USER_ID_FOR_SRP,i.userDataKey=i.keyPrefix+"."+i.username+".userData",f=new k(T.SRP_B,16),d=new k(T.SALT,16),i.getCachedDeviceKeyAndPassword(),a.getPasswordAuthenticationKey(i.username,n.getPassword(),f,d,function(I,R){I&&o.onFailure(I);var O=l.getNowString(),N=$.Buffer.concat([$.Buffer.from(i.pool.getUserPoolName(),"utf8"),$.Buffer.from(i.username,"utf8"),$.Buffer.from(T.SECRET_BLOCK,"base64"),$.Buffer.from(O,"utf8")]),le=new Rt.Sha256(R);le.update(N);var Pe=le.digestSync(),oe=$.Buffer.from(Pe).toString("base64"),Z={};Z.USERNAME=i.username,Z.PASSWORD_CLAIM_SECRET_BLOCK=T.SECRET_BLOCK,Z.TIMESTAMP=O,Z.PASSWORD_CLAIM_SIGNATURE=oe,i.deviceKey!=null&&(Z.DEVICE_KEY=i.deviceKey);var me=function(et,_t){return i.client.request("RespondToAuthChallenge",et,function(je,Pr){return je&&je.code==="ResourceNotFoundException"&&je.message.toLowerCase().indexOf("device")!==-1?(Z.DEVICE_KEY=null,i.deviceKey=null,i.randomPassword=null,i.deviceGroupKey=null,i.clearCachedDeviceKeyAndPassword(),me(et,_t)):_t(je,Pr)})},te={ChallengeName:"PASSWORD_VERIFIER",ClientId:i.pool.getClientId(),ChallengeResponses:Z,Session:C.Session,ClientMetadata:m};i.getUserContextData()&&(te.UserContextData=i.getUserContextData()),me(te,function(de,et){return de?o.onFailure(de):i.authenticateUserInternal(et,a,o)})})})})},t.authenticateUserPlainUsernamePassword=function(n,o){var i=this,a={};if(a.USERNAME=this.username,a.PASSWORD=n.getPassword(),!a.PASSWORD){o.onFailure(new Error("PASSWORD parameter is required"));return}var l=new tt(this.pool.getUserPoolName());this.getCachedDeviceKeyAndPassword(),this.deviceKey!=null&&(a.DEVICE_KEY=this.deviceKey);var f=Object.keys(n.getValidationData()).length!==0?n.getValidationData():n.getClientMetadata(),d={AuthFlow:"USER_PASSWORD_AUTH",ClientId:this.pool.getClientId(),AuthParameters:a,ClientMetadata:f};this.getUserContextData(this.username)&&(d.UserContextData=this.getUserContextData(this.username)),this.client.request("InitiateAuth",d,function(g,p){return g?o.onFailure(g):i.authenticateUserInternal(p,l,o)})},t.authenticateUserInternal=function(n,o,i){var a=this,l=n.ChallengeName,f=n.ChallengeParameters;if(l==="SMS_MFA")return this.Session=n.Session,i.mfaRequired(l,f);if(l==="SELECT_MFA_TYPE")return this.Session=n.Session,i.selectMFAType(l,f);if(l==="MFA_SETUP")return this.Session=n.Session,i.mfaSetup(l,f);if(l==="SOFTWARE_TOKEN_MFA")return this.Session=n.Session,i.totpRequired(l,f);if(l==="CUSTOM_CHALLENGE")return this.Session=n.Session,i.customChallenge(f);if(l==="NEW_PASSWORD_REQUIRED"){this.Session=n.Session;var d=null,g=null,p=[],y=o.getNewPasswordRequiredChallengeUserAttributePrefix();if(f&&(d=JSON.parse(n.ChallengeParameters.userAttributes),g=JSON.parse(n.ChallengeParameters.requiredAttributes)),g)for(var m=0;m<g.length;m++)p[m]=g[m].substr(y.length);return i.newPasswordRequired(d,p)}if(l==="DEVICE_SRP_AUTH"){this.Session=n.Session,this.getDeviceResponse(i);return}this.signInUserSession=this.getCognitoUserSession(n.AuthenticationResult),this.challengeName=l,this.cacheTokens();var w=n.AuthenticationResult.NewDeviceMetadata;if(w==null)return i.onSuccess(this.signInUserSession);o.generateHashDevice(n.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,n.AuthenticationResult.NewDeviceMetadata.DeviceKey,function(b){if(b)return i.onFailure(b);var C={Salt:$.Buffer.from(o.getSaltDevices(),"hex").toString("base64"),PasswordVerifier:$.Buffer.from(o.getVerifierDevices(),"hex").toString("base64")};a.verifierDevices=C.PasswordVerifier,a.deviceGroupKey=w.DeviceGroupKey,a.randomPassword=o.getRandomPassword(),a.client.request("ConfirmDevice",{DeviceKey:w.DeviceKey,AccessToken:a.signInUserSession.getAccessToken().getJwtToken(),DeviceSecretVerifierConfig:C,DeviceName:Ci},function(T,I){return T?i.onFailure(T):(a.deviceKey=n.AuthenticationResult.NewDeviceMetadata.DeviceKey,a.cacheDeviceKeyAndPassword(),I.UserConfirmationNecessary===!0?i.onSuccess(a.signInUserSession,I.UserConfirmationNecessary):i.onSuccess(a.signInUserSession))})})},t.completeNewPasswordChallenge=function(n,o,i,a){var l=this;if(!n)return i.onFailure(new Error("New password is required."));var f=new tt(this.pool.getUserPoolName()),d=f.getNewPasswordRequiredChallengeUserAttributePrefix(),g={};o&&Object.keys(o).forEach(function(y){g[d+y]=o[y]}),g.NEW_PASSWORD=n,g.USERNAME=this.username;var p={ChallengeName:"NEW_PASSWORD_REQUIRED",ClientId:this.pool.getClientId(),ChallengeResponses:g,Session:this.Session,ClientMetadata:a};this.getUserContextData()&&(p.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",p,function(y,m){return y?i.onFailure(y):l.authenticateUserInternal(m,f,i)})},t.getDeviceResponse=function(n,o){var i=this,a=new tt(this.deviceGroupKey),l=new xi,f={};f.USERNAME=this.username,f.DEVICE_KEY=this.deviceKey,a.getLargeAValue(function(d,g){d&&n.onFailure(d),f.SRP_A=g.toString(16);var p={ChallengeName:"DEVICE_SRP_AUTH",ClientId:i.pool.getClientId(),ChallengeResponses:f,ClientMetadata:o,Session:i.Session};i.getUserContextData()&&(p.UserContextData=i.getUserContextData()),i.client.request("RespondToAuthChallenge",p,function(y,m){if(y)return n.onFailure(y);var w=m.ChallengeParameters,b=new k(w.SRP_B,16),C=new k(w.SALT,16);a.getPasswordAuthenticationKey(i.deviceKey,i.randomPassword,b,C,function(T,I){if(T)return n.onFailure(T);var R=l.getNowString(),O=$.Buffer.concat([$.Buffer.from(i.deviceGroupKey,"utf8"),$.Buffer.from(i.deviceKey,"utf8"),$.Buffer.from(w.SECRET_BLOCK,"base64"),$.Buffer.from(R,"utf8")]),N=new Rt.Sha256(I);N.update(O);var le=N.digestSync(),Pe=$.Buffer.from(le).toString("base64"),oe={};oe.USERNAME=i.username,oe.PASSWORD_CLAIM_SECRET_BLOCK=w.SECRET_BLOCK,oe.TIMESTAMP=R,oe.PASSWORD_CLAIM_SIGNATURE=Pe,oe.DEVICE_KEY=i.deviceKey;var Z={ChallengeName:"DEVICE_PASSWORD_VERIFIER",ClientId:i.pool.getClientId(),ChallengeResponses:oe,Session:m.Session};i.getUserContextData()&&(Z.UserContextData=i.getUserContextData()),i.client.request("RespondToAuthChallenge",Z,function(me,te){return me?n.onFailure(me):(i.signInUserSession=i.getCognitoUserSession(te.AuthenticationResult),i.cacheTokens(),n.onSuccess(i.signInUserSession))})})})})},t.confirmRegistration=function(n,o,i,a){var l={ClientId:this.pool.getClientId(),ConfirmationCode:n,Username:this.username,ForceAliasCreation:o,ClientMetadata:a};this.getUserContextData()&&(l.UserContextData=this.getUserContextData()),this.client.request("ConfirmSignUp",l,function(f){return f?i(f,null):i(null,"SUCCESS")})},t.sendCustomChallengeAnswer=function(n,o,i){var a=this,l={};l.USERNAME=this.username,l.ANSWER=n;var f=new tt(this.pool.getUserPoolName());this.getCachedDeviceKeyAndPassword(),this.deviceKey!=null&&(l.DEVICE_KEY=this.deviceKey);var d={ChallengeName:"CUSTOM_CHALLENGE",ChallengeResponses:l,ClientId:this.pool.getClientId(),Session:this.Session,ClientMetadata:i};this.getUserContextData()&&(d.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",d,function(g,p){return g?o.onFailure(g):a.authenticateUserInternal(p,f,o)})},t.sendMFACode=function(n,o,i,a){var l=this,f={};f.USERNAME=this.username,f.SMS_MFA_CODE=n;var d=i||"SMS_MFA";d==="SOFTWARE_TOKEN_MFA"&&(f.SOFTWARE_TOKEN_MFA_CODE=n),this.deviceKey!=null&&(f.DEVICE_KEY=this.deviceKey);var g={ChallengeName:d,ChallengeResponses:f,ClientId:this.pool.getClientId(),Session:this.Session,ClientMetadata:a};this.getUserContextData()&&(g.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",g,function(p,y){if(p)return o.onFailure(p);var m=y.ChallengeName;if(m==="DEVICE_SRP_AUTH"){l.getDeviceResponse(o);return}if(l.signInUserSession=l.getCognitoUserSession(y.AuthenticationResult),l.cacheTokens(),y.AuthenticationResult.NewDeviceMetadata==null)return o.onSuccess(l.signInUserSession);var w=new tt(l.pool.getUserPoolName());w.generateHashDevice(y.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,y.AuthenticationResult.NewDeviceMetadata.DeviceKey,function(b){if(b)return o.onFailure(b);var C={Salt:$.Buffer.from(w.getSaltDevices(),"hex").toString("base64"),PasswordVerifier:$.Buffer.from(w.getVerifierDevices(),"hex").toString("base64")};l.verifierDevices=C.PasswordVerifier,l.deviceGroupKey=y.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,l.randomPassword=w.getRandomPassword(),l.client.request("ConfirmDevice",{DeviceKey:y.AuthenticationResult.NewDeviceMetadata.DeviceKey,AccessToken:l.signInUserSession.getAccessToken().getJwtToken(),DeviceSecretVerifierConfig:C,DeviceName:Ci},function(T,I){return T?o.onFailure(T):(l.deviceKey=y.AuthenticationResult.NewDeviceMetadata.DeviceKey,l.cacheDeviceKeyAndPassword(),I.UserConfirmationNecessary===!0?o.onSuccess(l.signInUserSession,I.UserConfirmationNecessary):o.onSuccess(l.signInUserSession))})})})},t.changePassword=function(n,o,i,a){if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return i(new Error("User is not authenticated"),null);this.client.request("ChangePassword",{PreviousPassword:n,ProposedPassword:o,AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),ClientMetadata:a},function(l){return l?i(l,null):i(null,"SUCCESS")})},t.enableMFA=function(n){if(this.signInUserSession==null||!this.signInUserSession.isValid())return n(new Error("User is not authenticated"),null);var o=[],i={DeliveryMedium:"SMS",AttributeName:"phone_number"};o.push(i),this.client.request("SetUserSettings",{MFAOptions:o,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(a){return a?n(a,null):n(null,"SUCCESS")})},t.setUserMfaPreference=function(n,o,i){if(this.signInUserSession==null||!this.signInUserSession.isValid())return i(new Error("User is not authenticated"),null);this.client.request("SetUserMFAPreference",{SMSMfaSettings:n,SoftwareTokenMfaSettings:o,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(a){return a?i(a,null):i(null,"SUCCESS")})},t.disableMFA=function(n){if(this.signInUserSession==null||!this.signInUserSession.isValid())return n(new Error("User is not authenticated"),null);var o=[];this.client.request("SetUserSettings",{MFAOptions:o,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(i){return i?n(i,null):n(null,"SUCCESS")})},t.deleteUser=function(n,o){var i=this;if(this.signInUserSession==null||!this.signInUserSession.isValid())return n(new Error("User is not authenticated"),null);this.client.request("DeleteUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),ClientMetadata:o},function(a){return a?n(a,null):(i.clearCachedUser(),n(null,"SUCCESS"))})},t.updateAttributes=function(n,o,i){var a=this;if(this.signInUserSession==null||!this.signInUserSession.isValid())return o(new Error("User is not authenticated"),null);this.client.request("UpdateUserAttributes",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),UserAttributes:n,ClientMetadata:i},function(l,f){return l?o(l,null):a.getUserData(function(){return o(null,"SUCCESS",f)},{bypassCache:!0})})},t.getUserAttributes=function(n){if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return n(new Error("User is not authenticated"),null);this.client.request("GetUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(o,i){if(o)return n(o,null);for(var a=[],l=0;l<i.UserAttributes.length;l++){var f={Name:i.UserAttributes[l].Name,Value:i.UserAttributes[l].Value},d=new xl(f);a.push(d)}return n(null,a)})},t.getMFAOptions=function(n){if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return n(new Error("User is not authenticated"),null);this.client.request("GetUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(o,i){return o?n(o,null):n(null,i.MFAOptions)})},t.createGetUserRequest=function(){return this.client.promisifyRequest("GetUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()})},t.refreshSessionIfPossible=function(n){var o=this;return n===void 0&&(n={}),new Promise(function(i){var a=o.signInUserSession.getRefreshToken();a&&a.getToken()?o.refreshSession(a,i,n.clientMetadata):i()})},t.getUserData=function(n,o){var i=this;if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return this.clearCachedUserData(),n(new Error("User is not authenticated"),null);var a=this.getUserDataFromCache();if(!a){this.fetchUserData().then(function(l){n(null,l)}).catch(n);return}if(this.isFetchUserDataAndTokenRequired(o)){this.fetchUserData().then(function(l){return i.refreshSessionIfPossible(o).then(function(){return l})}).then(function(l){return n(null,l)}).catch(n);return}try{n(null,JSON.parse(a));return}catch(l){this.clearCachedUserData(),n(l,null);return}},t.getUserDataFromCache=function(){var n=this.storage.getItem(this.userDataKey);return n},t.isFetchUserDataAndTokenRequired=function(n){var o=n||{},i=o.bypassCache,a=i===void 0?!1:i;return a},t.fetchUserData=function(){var n=this;return this.createGetUserRequest().then(function(o){return n.cacheUserData(o),o})},t.deleteAttributes=function(n,o){var i=this;if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return o(new Error("User is not authenticated"),null);this.client.request("DeleteUserAttributes",{UserAttributeNames:n,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(a){return a?o(a,null):i.getUserData(function(){return o(null,"SUCCESS")},{bypassCache:!0})})},t.resendConfirmationCode=function(n,o){var i={ClientId:this.pool.getClientId(),Username:this.username,ClientMetadata:o};this.client.request("ResendConfirmationCode",i,function(a,l){return a?n(a,null):n(null,l)})},t.getSession=function(n,o){if(o===void 0&&(o={}),this.username==null)return n(new Error("Username is null. Cannot retrieve a new session"),null);if(this.signInUserSession!=null&&this.signInUserSession.isValid())return n(null,this.signInUserSession);var i="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,a=i+".idToken",l=i+".accessToken",f=i+".refreshToken",d=i+".clockDrift";if(this.storage.getItem(a)){var g=new wi({IdToken:this.storage.getItem(a)}),p=new _i({AccessToken:this.storage.getItem(l)}),y=new Si({RefreshToken:this.storage.getItem(f)}),m=parseInt(this.storage.getItem(d),0)||0,w={IdToken:g,AccessToken:p,RefreshToken:y,ClockDrift:m},b=new bi(w);if(b.isValid())return this.signInUserSession=b,n(null,this.signInUserSession);if(!y.getToken())return n(new Error("Cannot retrieve a new session. Please authenticate."),null);this.refreshSession(y,n,o.clientMetadata)}else n(new Error("Local storage is missing an ID Token, Please authenticate"),null)},t.refreshSession=function(n,o,i){var a=this,l=this.pool.wrapRefreshSessionCallback?this.pool.wrapRefreshSessionCallback(o):o,f={};f.REFRESH_TOKEN=n.getToken();var d="CognitoIdentityServiceProvider."+this.pool.getClientId(),g=d+".LastAuthUser";if(this.storage.getItem(g)){this.username=this.storage.getItem(g);var p=d+"."+this.username+".deviceKey";this.deviceKey=this.storage.getItem(p),f.DEVICE_KEY=this.deviceKey}var y={ClientId:this.pool.getClientId(),AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:f,ClientMetadata:i};this.getUserContextData()&&(y.UserContextData=this.getUserContextData()),this.client.requestWithRetry("InitiateAuth",y,function(m,w){if(m)return m.code==="NotAuthorizedException"&&a.clearCachedUser(),l(m,null);if(w){var b=w.AuthenticationResult;return Object.prototype.hasOwnProperty.call(b,"RefreshToken")||(b.RefreshToken=n.getToken()),a.signInUserSession=a.getCognitoUserSession(b),a.cacheTokens(),l(null,a.signInUserSession)}})},t.cacheTokens=function(){var n="CognitoIdentityServiceProvider."+this.pool.getClientId(),o=n+"."+this.username+".idToken",i=n+"."+this.username+".accessToken",a=n+"."+this.username+".refreshToken",l=n+"."+this.username+".clockDrift",f=n+".LastAuthUser";this.storage.setItem(o,this.signInUserSession.getIdToken().getJwtToken()),this.storage.setItem(i,this.signInUserSession.getAccessToken().getJwtToken()),this.storage.setItem(a,this.signInUserSession.getRefreshToken().getToken()),this.storage.setItem(l,""+this.signInUserSession.getClockDrift()),this.storage.setItem(f,this.username)},t.cacheUserData=function(n){this.storage.setItem(this.userDataKey,JSON.stringify(n))},t.clearCachedUserData=function(){this.storage.removeItem(this.userDataKey)},t.clearCachedUser=function(){this.clearCachedTokens(),this.clearCachedUserData()},t.cacheDeviceKeyAndPassword=function(){var n="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,o=n+".deviceKey",i=n+".randomPasswordKey",a=n+".deviceGroupKey";this.storage.setItem(o,this.deviceKey),this.storage.setItem(i,this.randomPassword),this.storage.setItem(a,this.deviceGroupKey)},t.getCachedDeviceKeyAndPassword=function(){var n="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,o=n+".deviceKey",i=n+".randomPasswordKey",a=n+".deviceGroupKey";this.storage.getItem(o)&&(this.deviceKey=this.storage.getItem(o),this.randomPassword=this.storage.getItem(i),this.deviceGroupKey=this.storage.getItem(a))},t.clearCachedDeviceKeyAndPassword=function(){var n="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,o=n+".deviceKey",i=n+".randomPasswordKey",a=n+".deviceGroupKey";this.storage.removeItem(o),this.storage.removeItem(i),this.storage.removeItem(a)},t.clearCachedTokens=function(){var n="CognitoIdentityServiceProvider."+this.pool.getClientId(),o=n+"."+this.username+".idToken",i=n+"."+this.username+".accessToken",a=n+"."+this.username+".refreshToken",l=n+".LastAuthUser",f=n+"."+this.username+".clockDrift";this.storage.removeItem(o),this.storage.removeItem(i),this.storage.removeItem(a),this.storage.removeItem(l),this.storage.removeItem(f)},t.getCognitoUserSession=function(n){var o=new wi(n),i=new _i(n),a=new Si(n),l={IdToken:o,AccessToken:i,RefreshToken:a};return new bi(l)},t.forgotPassword=function(n,o){var i={ClientId:this.pool.getClientId(),Username:this.username,ClientMetadata:o};this.getUserContextData()&&(i.UserContextData=this.getUserContextData()),this.client.request("ForgotPassword",i,function(a,l){return a?n.onFailure(a):typeof n.inputVerificationCode=="function"?n.inputVerificationCode(l):n.onSuccess(l)})},t.confirmPassword=function(n,o,i,a){var l={ClientId:this.pool.getClientId(),Username:this.username,ConfirmationCode:n,Password:o,ClientMetadata:a};this.getUserContextData()&&(l.UserContextData=this.getUserContextData()),this.client.request("ConfirmForgotPassword",l,function(f){return f?i.onFailure(f):i.onSuccess("SUCCESS")})},t.getAttributeVerificationCode=function(n,o,i){if(this.signInUserSession==null||!this.signInUserSession.isValid())return o.onFailure(new Error("User is not authenticated"));this.client.request("GetUserAttributeVerificationCode",{AttributeName:n,AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),ClientMetadata:i},function(a,l){return a?o.onFailure(a):typeof o.inputVerificationCode=="function"?o.inputVerificationCode(l):o.onSuccess("SUCCESS")})},t.verifyAttribute=function(n,o,i){if(this.signInUserSession==null||!this.signInUserSession.isValid())return i.onFailure(new Error("User is not authenticated"));this.client.request("VerifyUserAttribute",{AttributeName:n,Code:o,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(a){return a?i.onFailure(a):i.onSuccess("SUCCESS")})},t.getDevice=function(n){if(this.signInUserSession==null||!this.signInUserSession.isValid())return n.onFailure(new Error("User is not authenticated"));this.client.request("GetDevice",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey},function(o,i){return o?n.onFailure(o):n.onSuccess(i)})},t.forgetSpecificDevice=function(n,o){if(this.signInUserSession==null||!this.signInUserSession.isValid())return o.onFailure(new Error("User is not authenticated"));this.client.request("ForgetDevice",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:n},function(i){return i?o.onFailure(i):o.onSuccess("SUCCESS")})},t.forgetDevice=function(n){var o=this;this.forgetSpecificDevice(this.deviceKey,{onFailure:n.onFailure,onSuccess:function(a){return o.deviceKey=null,o.deviceGroupKey=null,o.randomPassword=null,o.clearCachedDeviceKeyAndPassword(),n.onSuccess(a)}})},t.setDeviceStatusRemembered=function(n){if(this.signInUserSession==null||!this.signInUserSession.isValid())return n.onFailure(new Error("User is not authenticated"));this.client.request("UpdateDeviceStatus",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey,DeviceRememberedStatus:"remembered"},function(o){return o?n.onFailure(o):n.onSuccess("SUCCESS")})},t.setDeviceStatusNotRemembered=function(n){if(this.signInUserSession==null||!this.signInUserSession.isValid())return n.onFailure(new Error("User is not authenticated"));this.client.request("UpdateDeviceStatus",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey,DeviceRememberedStatus:"not_remembered"},function(o){return o?n.onFailure(o):n.onSuccess("SUCCESS")})},t.listDevices=function(n,o,i){if(this.signInUserSession==null||!this.signInUserSession.isValid())return i.onFailure(new Error("User is not authenticated"));var a={AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),Limit:n};o&&(a.PaginationToken=o),this.client.request("ListDevices",a,function(l,f){return l?i.onFailure(l):i.onSuccess(f)})},t.globalSignOut=function(n){var o=this;if(this.signInUserSession==null||!this.signInUserSession.isValid())return n.onFailure(new Error("User is not authenticated"));this.client.request("GlobalSignOut",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(i){return i?n.onFailure(i):(o.clearCachedUser(),n.onSuccess("SUCCESS"))})},t.signOut=function(n){var o=this;if(!n||typeof n!="function"){this.cleanClientData();return}this.getSession(function(i,a){if(i)return n(i);o.revokeTokens(function(l){o.cleanClientData(),n(l)})})},t.revokeTokens=function(n){if(n===void 0&&(n=function(){}),typeof n!="function")throw new Error("Invalid revokeTokenCallback. It should be a function.");if(!this.signInUserSession){var o=new Error("User is not authenticated");return n(o)}if(!this.signInUserSession.getAccessToken()){var i=new Error("No Access token available");return n(i)}var a=this.signInUserSession.getRefreshToken().getToken(),l=this.signInUserSession.getAccessToken();if(this.isSessionRevocable(l)&&a)return this.revokeToken({token:a,callback:n});n()},t.isSessionRevocable=function(n){if(n&&typeof n.decodePayload=="function")try{var o=n.decodePayload(),i=o.origin_jti;return!!i}catch{}return!1},t.cleanClientData=function(){this.signInUserSession=null,this.clearCachedUser()},t.revokeToken=function(n){var o=n.token,i=n.callback;this.client.requestWithRetry("RevokeToken",{Token:o,ClientId:this.pool.getClientId()},function(a){if(a)return i(a);i()})},t.sendMFASelectionAnswer=function(n,o){var i=this,a={};a.USERNAME=this.username,a.ANSWER=n;var l={ChallengeName:"SELECT_MFA_TYPE",ChallengeResponses:a,ClientId:this.pool.getClientId(),Session:this.Session};this.getUserContextData()&&(l.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",l,function(f,d){if(f)return o.onFailure(f);if(i.Session=d.Session,n==="SMS_MFA")return o.mfaRequired(d.ChallengeName,d.ChallengeParameters);if(n==="SOFTWARE_TOKEN_MFA")return o.totpRequired(d.ChallengeName,d.ChallengeParameters)})},t.getUserContextData=function(){var n=this.pool;return n.getUserContextData(this.username)},t.associateSoftwareToken=function(n){var o=this;this.signInUserSession!=null&&this.signInUserSession.isValid()?this.client.request("AssociateSoftwareToken",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(i,a){return i?n.onFailure(i):n.associateSecretCode(a.SecretCode)}):this.client.request("AssociateSoftwareToken",{Session:this.Session},function(i,a){return i?n.onFailure(i):(o.Session=a.Session,n.associateSecretCode(a.SecretCode))})},t.verifySoftwareToken=function(n,o,i){var a=this;this.signInUserSession!=null&&this.signInUserSession.isValid()?this.client.request("VerifySoftwareToken",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),UserCode:n,FriendlyDeviceName:o},function(l,f){return l?i.onFailure(l):i.onSuccess(f)}):this.client.request("VerifySoftwareToken",{Session:this.Session,UserCode:n,FriendlyDeviceName:o},function(l,f){if(l)return i.onFailure(l);a.Session=f.Session;var d={};d.USERNAME=a.username;var g={ChallengeName:"MFA_SETUP",ClientId:a.pool.getClientId(),ChallengeResponses:d,Session:a.Session};a.getUserContextData()&&(g.UserContextData=a.getUserContextData()),a.client.request("RespondToAuthChallenge",g,function(p,y){return p?i.onFailure(p):(a.signInUserSession=a.getCognitoUserSession(y.AuthenticationResult),a.cacheTokens(),i.onSuccess(a.signInUserSession))})})},e})();function Il(e,t){return t=t||{},new Promise(function(r,n){var o=new XMLHttpRequest,i=[],a=[],l={},f=function(){return{ok:(o.status/100|0)==2,statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:f,headers:{keys:function(){return i},entries:function(){return a},get:function(g){return l[g.toLowerCase()]},has:function(g){return g.toLowerCase()in l}}}};for(var d in o.open(t.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(g,p,y){i.push(p=p.toLowerCase()),a.push([p,y]),l[p]=l[p]?l[p]+","+y:y}),r(f())},o.onerror=n,o.withCredentials=t.credentials=="include",t.headers)o.setRequestHeader(d,t.headers[d]);o.send(t.body||null)})}const El=Object.freeze(Object.defineProperty({__proto__:null,default:Il},Symbol.toStringTag,{value:"Module"})),Ti=In(El);var Lr,Ii;function kl(){return Ii||(Ii=1,Lr=self.fetch||(self.fetch=Ti.default||Ti)),Lr}kl();function rt(){}rt.prototype.userAgent=wl();var Ul=function(t){var r=rt.category?" "+rt.category:"",n=rt.framework?" framework/"+rt.framework:"",o=""+rt.prototype.userAgent+r+n;return o};function Al(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,jt(e,t)}function dn(e){var t=typeof Map=="function"?new Map:void 0;return dn=function(n){if(n===null||!Rl(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(n))return t.get(n);t.set(n,o)}function o(){return Dl(n,arguments,fn(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),jt(o,n)},dn(e)}function Dl(e,t,r){if(xo())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var o=new(e.bind.apply(e,n));return r&&jt(o,r.prototype),o}function xo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xo=function(){return!!e})()}function Rl(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function jt(e,t){return jt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},jt(e,t)}function fn(e){return fn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fn(e)}var Pl=(function(e){function t(r,n,o,i){var a;return a=e.call(this,r)||this,a.code=n,a.name=o,a.statusCode=i,a}return Al(t,e),t})(dn(Error)),Fl=(function(){function e(r,n,o){this.endpoint=n||"https://cognito-idp."+r+".amazonaws.com/";var i=o||{},a=i.credentials;this.fetchOptions=a?{credentials:a}:{}}var t=e.prototype;return t.promisifyRequest=function(n,o){var i=this;return new Promise(function(a,l){i.request(n,o,function(f,d){f?l(new Pl(f.message,f.code,f.name,f.statusCode)):a(d)})})},t.requestWithRetry=function(n,o,i){var a=this,l=5*1e3;Ol(function(f){return new Promise(function(d,g){a.request(n,f,function(p,y){p?g(p):d(y)})})},[o],l).then(function(f){return i(null,f)}).catch(function(f){return i(f)})},t.request=function(n,o,i){var a={"Content-Type":"application/x-amz-json-1.1","X-Amz-Target":"AWSCognitoIdentityProviderService."+n,"X-Amz-User-Agent":Ul(),"Cache-Control":"no-store"},l=Object.assign({},this.fetchOptions,{headers:a,method:"POST",mode:"cors",body:JSON.stringify(o)}),f;fetch(this.endpoint,l).then(function(d){return f=d,d},function(d){throw d instanceof TypeError?new Error("Network error"):d}).then(function(d){return d.json().catch(function(){return{}})}).then(function(d){if(f.ok)return i(null,d);var g=(d.__type||d.code).split("#").pop(),p=new Error(d.message||d.Message||null);return p.name=g,p.code=g,i(p)}).catch(function(d){if(f&&f.headers&&f.headers.get("x-amzn-errortype"))try{var g=f.headers.get("x-amzn-errortype").split(":")[0],p=new Error(f.status?f.status.toString():null);return p.code=g,p.name=g,p.statusCode=f.status,i(p)}catch{return i(d)}else d instanceof Error&&d.message==="Network error"&&(d.code="NetworkError");return i(d)})},e})(),nr={debug:function(){}},Bl=function(t){var r="nonRetryable";return t&&t[r]};function Co(e,t,r,n){if(n===void 0&&(n=1),typeof e!="function")throw Error("functionToRetry must be a function");return nr.debug(e.name+" attempt #"+n+" with args: "+JSON.stringify(t)),e.apply(void 0,t).catch(function(o){if(nr.debug("error on "+e.name,o),Bl(o))throw nr.debug(e.name+" non retryable error",o),o;var i=r(n,t,o);if(nr.debug(e.name+" retrying in "+i+" ms"),i!==!1)return new Promise(function(a){return setTimeout(a,i)}).then(function(){return Co(e,t,r,n+1)});throw o})}function Ml(e){var t=100,r=100;return function(n){var o=Math.pow(2,n)*t+r*Math.random();return o>e?!1:o}}function Ol(e,t,r){return Co(e,t,Ml(r))}/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var Nl=55,zl=(function(){function e(r,n){var o=r||{},i=o.UserPoolId,a=o.ClientId,l=o.endpoint,f=o.fetchOptions,d=o.AdvancedSecurityDataCollectionFlag;if(!i||!a)throw new Error("Both UserPoolId and ClientId are required.");if(i.length>Nl||!/^[\w-]+_[0-9a-zA-Z]+$/.test(i))throw new Error("Invalid UserPoolId format.");var g=i.split("_")[0];this.userPoolId=i,this.clientId=a,this.client=new Fl(g,l,f),this.advancedSecurityDataCollectionFlag=d!==!1,this.storage=r.Storage||new bo().getStorage(),n&&(this.wrapRefreshSessionCallback=n)}var t=e.prototype;return t.getUserPoolId=function(){return this.userPoolId},t.getUserPoolName=function(){return this.getUserPoolId().split("_")[1]},t.getClientId=function(){return this.clientId},t.signUp=function(n,o,i,a,l,f){var d=this,g={ClientId:this.clientId,Username:n,Password:o,UserAttributes:i,ValidationData:a,ClientMetadata:f};this.getUserContextData(n)&&(g.UserContextData=this.getUserContextData(n)),this.client.request("SignUp",g,function(p,y){if(p)return l(p,null);var m={Username:n,Pool:d,Storage:d.storage},w={user:new cn(m),userConfirmed:y.UserConfirmed,userSub:y.UserSub,codeDeliveryDetails:y.CodeDeliveryDetails};return l(null,w)})},t.getCurrentUser=function(){var n="CognitoIdentityServiceProvider."+this.clientId+".LastAuthUser",o=this.storage.getItem(n);if(o){var i={Username:o,Pool:this,Storage:this.storage};return new cn(i)}return null},t.getUserContextData=function(n){if(!(typeof AmazonCognitoAdvancedSecurityData>"u")){var o=AmazonCognitoAdvancedSecurityData;if(this.advancedSecurityDataCollectionFlag){var i=o.getData(n,this.userPoolId,this.clientId);if(i){var a={EncodedData:i};return a}}return{}}},e})(),jr={exports:{}};/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */var Ei;function $l(){return Ei||(Ei=1,(function(e,t){(function(r){var n;if(e.exports=r(),n=!0,!n){var o=window.Cookies,i=window.Cookies=r();i.noConflict=function(){return window.Cookies=o,i}}})(function(){function r(){for(var i=0,a={};i<arguments.length;i++){var l=arguments[i];for(var f in l)a[f]=l[f]}return a}function n(i){return i.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function o(i){function a(){}function l(d,g,p){if(!(typeof document>"u")){p=r({path:"/"},a.defaults,p),typeof p.expires=="number"&&(p.expires=new Date(new Date*1+p.expires*864e5)),p.expires=p.expires?p.expires.toUTCString():"";try{var y=JSON.stringify(g);/^[\{\[]/.test(y)&&(g=y)}catch{}g=i.write?i.write(g,d):encodeURIComponent(String(g)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),d=encodeURIComponent(String(d)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var m="";for(var w in p)p[w]&&(m+="; "+w,p[w]!==!0&&(m+="="+p[w].split(";")[0]));return document.cookie=d+"="+g+m}}function f(d,g){if(!(typeof document>"u")){for(var p={},y=document.cookie?document.cookie.split("; "):[],m=0;m<y.length;m++){var w=y[m].split("="),b=w.slice(1).join("=");!g&&b.charAt(0)==='"'&&(b=b.slice(1,-1));try{var C=n(w[0]);if(b=(i.read||i)(b,C)||n(b),g)try{b=JSON.parse(b)}catch{}if(p[C]=b,d===C)break}catch{}}return d?p[d]:p}}return a.set=l,a.get=function(d){return f(d,!1)},a.getJSON=function(d){return f(d,!0)},a.remove=function(d,g){l(d,"",r(g,{expires:-1}))},a.defaults={},a.withConverter=o,a}return o(function(){})})})(jr)),jr.exports}$l();const Ll="us-east-1_2XDZpGyEN,us-east-1_wZQb5HVNv".split(",").map(e=>e.trim()).filter(Boolean),jl="7ttl5fme1llm52l25v2ocd5mla,47l07iv46cpc2r7kmcecc80ags".split(",").map(e=>e.trim()).filter(Boolean),dt=Ll.map((e,t)=>({userPoolId:e,clientId:jl[t]||""})).filter(e=>e.userPoolId&&e.clientId);let An=0;const Kr=new Map;function Dn(e){const t=e??An;if(!Kr.has(t)){const r=dt[t];Kr.set(t,new zl({UserPoolId:r.userPoolId,ClientId:r.clientId}))}return Kr.get(t)}function Kl(e){const t=e.message||"";return t.includes("does not exist")||t.includes("User pool client")||t.includes("ResourceNotFoundException")}const Ue=E(!1),qe=E(null),hn=E(!0);function Kt(){return dt.length>0}function To(){if(!Kt())return Promise.resolve(null);function e(t){return t>=dt.length?Promise.resolve(null):new Promise(r=>{const o=Dn(t).getCurrentUser();if(!o){r(e(t+1));return}o.getSession((i,a)=>{if(i||!a||!a.isValid()){r(e(t+1));return}An=t,r(a.getIdToken().getJwtToken())})})}return e(0)}async function Hl(){if(!Kt()){Ue.value=!0,hn.value=!1;return}try{const e=await To();Ue.value=e!==null}catch{Ue.value=!1}finally{hn.value=!1}}function Vl(e,t){qe.value=null;function r(n){if(n>=dt.length){const o=new Error("Authentication failed: none of the configured Cognito pools are reachable.");return Ue.value=!1,qe.value=o.message,Promise.reject(o)}return new Promise((o,i)=>{const a=Dn(n),l=new cn({Username:e,Pool:a}),f=new $s({Username:e,Password:t});l.authenticateUser(f,{onSuccess:()=>{An=n,Ue.value=!0,qe.value=null,o()},onFailure:d=>{if(Kl(d)&&n+1<dt.length){r(n+1).then(o,i);return}Ue.value=!1,qe.value=d.message||"Authentication failed",i(d)},newPasswordRequired:()=>{Ue.value=!1,qe.value="Password change required. Please use the AWS CLI to set a permanent password.",i(new Error("NEW_PASSWORD_REQUIRED"))}})})}return r(0)}function ql(){if(Kt()){for(let e=0;e<dt.length;e++){const r=Dn(e).getCurrentUser();r&&r.signOut()}Ue.value=!1}}const ce=!0,ir="dev",Io="";async function j(e,t){const r={"Content-Type":"application/json","X-Client-Version":ir,...(t==null?void 0:t.headers)||{}},n=await To();n&&(r.Authorization=`Bearer ${n}`);const o=await fetch(`${Io}${e}`,{...t,headers:r});if(!o.ok){const a=await o.text(),l=o.headers.get("x-app-version")||"unknown";throw new Error(`${o.status}: ${a} (backend: ${l}, client: ${ir})`)}const i=o.headers.get("content-type")||"";if(!i.includes("application/json")){const a=await o.text(),l=o.headers.get("x-app-version")||"unknown";throw a.trimStart().startsWith("<!DOCTYPE")||a.trimStart().startsWith("<html")?new Error(`API request to ${e} was intercepted by the CDN  the endpoint may not exist or returned an auth error. Backend: ${l}, Client: ${ir}`):new Error(`Expected JSON from ${e} but received ${i||"unknown content-type"} (backend: ${l}, client: ${ir})`)}return o.json()}function Eo(e,t,r){const n=new URLSearchParams({sessionId:e,filename:t,contentType:r});return j(`/api/upload-url?${n}`)}async function ko(e,t,r){return new Promise((n,o)=>{const i=new XMLHttpRequest;i.open("PUT",e,!0),i.setRequestHeader("Content-Type",t.type),r&&i.upload.addEventListener("progress",a=>{a.lengthComputable&&r(a.loaded,a.total)}),i.onload=()=>{i.status>=200&&i.status<300?n():o(new Error(`Upload failed: ${i.status} ${i.statusText}`))},i.onerror=()=>o(new Error("Upload failed: network error")),i.send(t)})}const Uo=10*1024*1024,Wl=10*1024*1024,Gl=6;function Jl(e){return j("/api/upload-multipart/init",{method:"POST",body:JSON.stringify(e)})}function Yl(e){return j("/api/upload-multipart/complete",{method:"POST",body:JSON.stringify(e)})}function Zl(e){return j("/api/upload-multipart/abort",{method:"POST",body:JSON.stringify(e)})}function Xl(e,t,r){return new Promise((n,o)=>{const i=new XMLHttpRequest;i.open("PUT",e,!0),r&&i.upload.addEventListener("progress",a=>{a.lengthComputable&&r(a.loaded)}),i.onload=()=>{if(i.status>=200&&i.status<300){const a=i.getResponseHeader("ETag");if(!a){o(new Error("Upload succeeded but ETag header missing (check S3 CORS exposedHeaders)"));return}n(a)}else o(new Error(`Chunk upload failed: ${i.status} ${i.statusText}`))},i.onerror=()=>o(new Error("Chunk upload failed: network error")),i.send(t)})}async function Ao(e,t,r){const n=Wl,o=t.size,i=await Jl({sessionId:e,filename:t.name,contentType:t.type,fileSize:o,chunkSize:n}),{uploadId:a,key:l,partUrls:f}=i,d=[],g=new Array(f.length).fill(0);function p(){if(r){const y=g.reduce((m,w)=>m+w,0);r(y,o)}}try{let y=0;async function m(){for(;y<f.length;){const b=y++,C=f[b];if(!C)continue;const T=b*n,I=Math.min(T+n,o),R=t.slice(T,I),O=await Xl(C.url,R,N=>{g[b]=N,p()});g[b]=I-T,p(),d.push({partNumber:C.partNumber,etag:O})}}const w=Array.from({length:Math.min(Gl,f.length)},()=>m());return await Promise.all(w),d.sort((b,C)=>b.partNumber-C.partNumber),await Yl({sessionId:e,key:l,uploadId:a,parts:d}),l}catch(y){try{await Zl({sessionId:e,key:l,uploadId:a})}catch(m){console.error("Failed to abort multipart upload:",m)}throw y}}function Do(e){return j("/api/triage/start",{method:"POST",body:JSON.stringify(e)})}function Ql(e){return j("/api/triage/init",{method:"POST",body:JSON.stringify(e)})}function Ro(e){return j("/api/triage/update-files",{method:"POST",body:JSON.stringify(e)})}function Po(e,t){const r=t?`?sessionId=${encodeURIComponent(t)}`:"";return j(`/api/triage/${e}/results${r}`)}function eu(e,t){return j(`/api/triage/${e}/confirm`,{method:"POST",body:JSON.stringify(t)})}function _e(e){return`${Io}/api/media/thumbnail?key=${encodeURIComponent(e)}`}async function Fo(e,t){{if(t==="Video")try{return(await j(`/api/media/compressed?key=${encodeURIComponent(e)}`)).url}catch(n){console.warn("Failed to get compressed video, falling back to original",n)}return(await j(`/api/media/full?key=${encodeURIComponent(e)}`)).url}}async function ki(e){const t=await Fo(e);window.open(t,"_blank")}function He(e){var r;const t=((r=e.split(".").pop())==null?void 0:r.toLowerCase())??"";return["mp4","mov","avi","mkv","webm","m4v","3gp"].includes(t)}function tu(e){return j("/api/selection/start",{method:"POST",body:JSON.stringify(e)})}function ru(e,t){return j(`/api/selection/${e}/results?sessionId=${encodeURIComponent(t)}`)}function nu(e){return j("/api/enhance/start",{method:"POST",body:JSON.stringify(e)})}function Bo(e,t){return j(`/api/enhance/${e}/results?sessionId=${encodeURIComponent(t)}`)}function iu(e,t){return j(`/api/enhance/${e}/feedback`,{method:"POST",body:JSON.stringify(t)})}function ou(e){return j("/api/download/start",{method:"POST",body:JSON.stringify(e)})}function su(e,t){return j(`/api/download/${e}/results?sessionId=${encodeURIComponent(t)}`)}function au(e){return j("/api/description/generate",{method:"POST",body:JSON.stringify(e)})}function lu(e,t){return j(`/api/description/${e}/results?sessionId=${encodeURIComponent(t)}`)}function uu(e,t){return j(`/api/description/${e}/feedback`,{method:"POST",body:JSON.stringify(t)})}function cu(){return j("/api/health")}function du(e){return j("/api/publish/start",{method:"POST",body:JSON.stringify(e)})}function fu(e,t){return j(`/api/publish/${e}/status?sessionId=${encodeURIComponent(t)}`)}function hu(e){return j("/api/session/invalidate",{method:"POST",body:JSON.stringify(e)})}function Qe({left:e,right:t}){return s("div",{style:{position:"sticky",bottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",background:"var(--color-surface)",borderRadius:"var(--radius-lg)",border:"1px solid var(--color-border)"},children:[e,t]})}function lt(e){if(e===0)return"0 B";const t=1024,r=["B","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(t));return`${(e/Math.pow(t,n)).toFixed(1)} ${r[n]}`}function pu(e){return e<1024?`${e.toFixed(0)} B/s`:e<1024*1024?`${(e/1024).toFixed(1)} KB/s`:`${(e/(1024*1024)).toFixed(1)} MB/s`}function vu({bundle:e}){const t=e.status==="complete",r=e.status==="error",n=e.status==="processing"||e.status==="pending";return s("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem 1rem",background:"var(--color-bg)",borderRadius:"var(--radius)",border:r?"1px solid var(--color-danger)":"1px solid var(--color-border)"},children:[s("div",{style:{flex:1},children:[s("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[s("span",{style:{fontSize:"0.75rem",padding:"0.125rem 0.375rem",borderRadius:"3px",background:e.type==="images"?"rgba(108, 200, 108, 0.15)":"rgba(108, 140, 255, 0.15)",color:e.type==="images"?"var(--color-success)":"var(--color-primary)",fontWeight:600,textTransform:"uppercase"},children:e.type==="images"?"Photos":"Videos"}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,fontFamily:"var(--font-mono)"},children:e.name})]}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:[e.fileCount," file",e.fileCount!==1?"s":"","  ",lt(e.totalSize),t&&e.zipSize>0&&s(G,{children:[" (ZIP: ",lt(e.zipSize),")"]})]}),r&&e.error&&s("div",{style:{fontSize:"0.75rem",color:"var(--color-danger)",marginTop:"0.25rem"},children:e.error})]}),s("div",{style:{marginLeft:"1rem"},children:[n&&s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",fontStyle:"italic"},children:"Creating ZIP..."}),t&&e.downloadUrl&&s("a",{href:e.downloadUrl,download:e.name,style:{display:"inline-flex",alignItems:"center",gap:"0.375rem",padding:"0.375rem 0.75rem",fontSize:"0.875rem",fontWeight:500,background:"var(--color-primary)",color:"#fff",borderRadius:"var(--radius)",textDecoration:"none",cursor:"pointer",transition:"opacity 0.15s"},children:"Download"}),r&&s("span",{style:{fontSize:"0.75rem",color:"var(--color-danger)",fontWeight:500},children:"Failed"})]})]})}function gu({group:e,state:t,isExpanded:r,groupableMedia:n,onToggleExpand:o,onDownload:i}){const a=t.status==="idle",l=t.status==="processing",f=t.status==="complete",d=t.status==="error",g=e.keys.slice(0,6).map(C=>n.find(T=>T.key===C)).filter(C=>C!==void 0),p=e.keys.map(C=>n.find(T=>T.key===C)).filter(C=>C!==void 0),y=p.filter(C=>C.type==="Photo").length,m=p.filter(C=>C.type==="Video").length,w=t.bundles.filter(C=>C.status==="complete").length,b=t.bundles.length;return s("div",{class:"card",style:{marginBottom:"0.75rem",border:f?"1px solid var(--color-success)":d?"1px solid var(--color-danger)":"1px solid var(--color-border)"},children:[s("div",{onClick:o,style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",gap:"1rem"},children:[s("div",{style:{flex:1},children:[s("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.375rem"},children:[s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",transition:"transform 0.15s",transform:r?"rotate(90deg)":"rotate(0deg)"},children:""}),s("h3",{style:{margin:0,fontSize:"1rem",color:e.label?"var(--color-text)":"var(--color-text-secondary)"},children:e.label||"Untitled group"}),f&&s("span",{style:{fontSize:"0.75rem",padding:"0.125rem 0.375rem",borderRadius:"3px",background:"rgba(108, 200, 108, 0.15)",color:"var(--color-success)",fontWeight:600},children:"Ready"}),l&&s("span",{style:{fontSize:"0.75rem",padding:"0.125rem 0.375rem",borderRadius:"3px",background:"rgba(108, 140, 255, 0.15)",color:"var(--color-primary)",fontWeight:600},children:["Creating ZIPs... ",w,"/",b]})]}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginLeft:"1.5rem"},children:[e.keys.length," item",e.keys.length!==1?"s":"",y>0&&s(G,{children:["  ",y," photo",y!==1?"s":""]}),m>0&&s(G,{children:["  ",m," video",m!==1?"s":""]})]})]}),s("div",{style:{display:"flex",gap:"2px",flexShrink:0},children:[g.map(C=>s("div",{style:{width:"2rem",height:"2rem",borderRadius:"3px",overflow:"hidden",background:"var(--color-surface-hover)"},children:s("img",{src:_e(C.thumbnailKey),alt:"",style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:T=>{T.target.style.display="none"}})},C.key)),e.keys.length>6&&s("div",{style:{width:"2rem",height:"2rem",borderRadius:"3px",background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:["+",e.keys.length-6]})]}),s("div",{style:{flexShrink:0},children:[a&&s("button",{class:"primary",onClick:C=>{C.stopPropagation(),i()},style:{fontSize:"0.875rem"},children:"Prepare Download"}),d&&s("button",{class:"outline",onClick:C=>{C.stopPropagation(),i()},style:{fontSize:"0.875rem"},children:"Retry"})]})]}),r&&(f||l||d)&&s("div",{style:{marginTop:"1rem"},children:[t.bundles.length===0&&l&&s("div",{style:{textAlign:"center",padding:"1.5rem",color:"var(--color-text-secondary)",fontSize:"0.875rem"},children:"Calculating bundles..."}),t.bundles.length>0&&s("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.bundles.map((C,T)=>s(vu,{bundle:C},`${e.id}-${T}`))}),f&&s("div",{style:{marginTop:"0.75rem",padding:"0.5rem 0.75rem",background:"rgba(108, 200, 108, 0.06)",borderRadius:"var(--radius)",fontSize:"0.75rem",color:"var(--color-success)"},children:"All bundles ready. Download links expire in 1 hour."}),d&&t.error&&s("div",{style:{marginTop:"0.75rem",padding:"0.5rem 0.75rem",background:"rgba(255, 107, 107, 0.06)",borderRadius:"var(--radius)",fontSize:"0.75rem",color:"var(--color-danger)"},children:t.error})]})]})}function Ui({item:e,isInGroup:t,showAssignHint:r,isDragging:n,onDragStart:o,onDragEnd:i,onClick:a}){return s("div",{draggable:!0,onDragStart:o,onDragEnd:i,onClick:a,title:t?`${e.filename}  click to remove from group`:r?`${e.filename}  click to add to selected group`:e.filename,style:{position:"relative",borderRadius:"var(--radius)",overflow:"hidden",cursor:"grab",opacity:n?.4:1,transition:"opacity 0.15s, transform 0.15s",border:"2px solid transparent",background:"var(--color-bg)"},children:[s("div",{style:{width:"100%",aspectRatio:"1",background:"var(--color-surface-hover)"},children:s("img",{src:_e(e.thumbnailKey),alt:e.filename,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"},onError:l=>{l.target.style.display="none"}})}),e.type==="Video"&&s("span",{style:{position:"absolute",top:"0.25rem",left:"0.25rem",fontSize:"0.75rem",padding:"0.0625rem 0.25rem",borderRadius:"3px",background:"rgba(108, 140, 255, 0.85)",color:"#fff",fontWeight:600},children:"Video"}),t&&s("div",{style:{position:"absolute",top:"0.25rem",right:"0.25rem",width:"1rem",height:"1rem",borderRadius:"50%",background:"rgba(255, 107, 107, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",color:"#fff",fontWeight:700,lineHeight:1},children:""}),s("div",{style:{padding:"0.25rem 0.375rem",fontSize:"0.75rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"var(--color-text-secondary)"},children:e.filename})]})}const M=E([]),Ie=E([]),ye=E(null),we=E(null),q=E(null);let pn=0;function mu(){return pn++,`group-${pn}-${Date.now()}`}function Mo(){M.value=[],Ie.value=[],ye.value=null,we.value=null,q.value=null,pn=0}const ut=20;function Oo(e){const t=mu(),r=e?[e]:[];return M.value=[...M.value,{id:t,label:"",keys:r}],ye.value=t,t}function yu(e){M.value=M.value.filter(t=>t.id!==e),ye.value===e&&(ye.value=M.value.length>0?M.value[0].id:null)}function _u(e,t){M.value=M.value.map(r=>r.id===e?{...r,label:t}:r)}function No(e,t){const r=M.value.find(n=>n.id===e);r&&(r.keys.length>=ut||r.keys.includes(t)||(Rn(t),M.value=M.value.map(n=>n.id===e?{...n,keys:[...n.keys,t]}:n)))}function wu(e,t){M.value=M.value.map(r=>r.id===e?{...r,keys:r.keys.filter(n=>n!==t)}:r)}function Rn(e){M.value=M.value.map(t=>t.keys.includes(e)?{...t,keys:t.keys.filter(r=>r!==e)}:t)}function Su({group:e,isSelected:t,onSelect:r,onDelete:n,onDragOver:o,onDragEnter:i,onDragLeave:a,onDrop:l}){const f=q.value===e.id,d=e.keys.length>=ut,g=e.keys.slice(0,4).map(p=>Ie.value.find(y=>y.key===p)).filter(p=>p!==void 0);return s("div",{onClick:r,onDragOver:o,onDragEnter:i,onDragLeave:a,onDrop:l,style:{minWidth:"8.5rem",maxWidth:"10rem",padding:"0.5rem",background:t?"rgba(108, 140, 255, 0.12)":"var(--color-bg)",border:f?"2px dashed var(--color-primary)":t?"2px solid var(--color-primary)":"2px solid var(--color-border)",borderRadius:"var(--radius)",cursor:"pointer",transition:"border-color 0.15s, background 0.15s",flexShrink:0,position:"relative"},children:[s("button",{onClick:p=>{p.stopPropagation(),n()},style:{position:"absolute",top:"0.25rem",right:"0.25rem",width:"1.125rem",height:"1.125rem",borderRadius:"50%",background:"var(--color-surface-hover)",border:"none",color:"var(--color-text-secondary)",fontSize:"0.75rem",display:"flex",alignItems:"center",justifyContent:"center",padding:0,cursor:"pointer",lineHeight:1},title:"Delete group",children:""}),s("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2px",width:"3rem",height:"3rem",margin:"0 auto 0.375rem",borderRadius:"4px",overflow:"hidden",background:"var(--color-surface-hover)"},children:[0,1,2,3].map(p=>{const y=g[p];return s("div",{style:{background:"var(--color-surface-hover)",overflow:"hidden"},children:y&&s("img",{src:_e(y.thumbnailKey),alt:"",style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:m=>{m.target.style.display="none"}})},p)})}),s("div",{style:{fontSize:"0.75rem",fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"center",marginBottom:"0.125rem",color:e.label?"var(--color-text)":"var(--color-text-secondary)"},title:e.label||"Untitled group",children:e.label||"Untitled"}),s("div",{style:{fontSize:"0.75rem",textAlign:"center",color:d?"var(--color-danger)":"var(--color-text-secondary)"},children:[e.keys.length,"/",ut]})]})}function bu({onCreateGroup:e,onDragOver:t,onDragEnter:r,onDragLeave:n,onDrop:o}){const i=q.value==="__new__";return s("div",{onClick:e,onDragOver:t,onDragEnter:r,onDragLeave:n,onDrop:o,style:{minWidth:"8.5rem",maxWidth:"10rem",padding:"0.5rem",background:i?"rgba(108, 140, 255, 0.08)":"var(--color-bg)",border:i?"2px dashed var(--color-primary)":"2px dashed var(--color-border)",borderRadius:"var(--radius)",cursor:"pointer",transition:"border-color 0.15s, background 0.15s",flexShrink:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"6.5rem"},children:[s("div",{style:{fontSize:"1.5rem",color:i?"var(--color-primary)":"var(--color-text-secondary)",lineHeight:1,marginBottom:"0.375rem"},children:"+"}),s("div",{style:{fontSize:"0.75rem",color:i?"var(--color-primary)":"var(--color-text-secondary)",fontWeight:500},children:"New Group"})]})}const zo=X(()=>{const e=new Set;for(const t of M.value)for(const r of t.keys)e.add(r);return e}),xu=X(()=>Ie.value.filter(e=>!zo.value.has(e.key))),Pn=X(()=>M.value.find(e=>e.id===ye.value)??null),Cu=X(()=>{const e=Pn.value;return e?e.keys.map(t=>Ie.value.find(r=>r.key===t)).filter(t=>t!==void 0):[]});function Ai(e,t){we.value={key:e,sourceGroupId:t}}function Di(){we.value=null,q.value=null}function Hr(e){e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move")}function Tu(e,t){e.preventDefault();const r=we.value;r&&(No(t,r.key),we.value=null,q.value=null)}function Iu(e){e.preventDefault();const t=we.value;t&&(Rn(t.key),Oo(t.key),we.value=null,q.value=null)}function Eu(e){e.preventDefault();const t=we.value;t&&(Rn(t.key),we.value=null,q.value=null)}function Ri(e,t){if(t){const r=Pn.value;r&&wu(r.id,e)}else ye.value&&No(ye.value,e)}function ku(){const e=M.value.filter(t=>t.keys.length>0);e.length!==0&&(M.value=e,Se("publish"))}function Uu(){Le()}function Au(){const e=M.value,t=xu.value,r=Pn.value,n=Cu.value,o=!!ye.value,i=Ie.value.length,a=zo.value.size,l=i-a,f=e.filter(d=>d.keys.length>0);return s("div",{children:[s("div",{class:"card",style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"0.5rem"},children:[s("div",{children:s("span",{style:{fontSize:"0.875rem"},children:[s("strong",{children:i})," media items",a>0&&s(G,{children:["  ",s("span",{style:{color:"var(--color-success)"},children:[a," grouped"]})]}),l>0&&s(G,{children:["  ",s("span",{style:{color:"var(--color-text-secondary)"},children:[l," remaining"]})]})]})}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:o?"Click thumbnails to add/remove from selected group, or drag to any group.":"Select or create a group below, then click thumbnails to add them."})]}),s("div",{class:"card",style:{marginBottom:"1rem"},onDragOver:Hr,onDragEnter:()=>{q.value="__ungrouped__"},onDragLeave:d=>{const g=d.relatedTarget;g&&d.currentTarget.contains(g)||q.value==="__ungrouped__"&&(q.value=null)},onDrop:Eu,children:[s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},children:[s("h2",{style:{marginBottom:0},children:["Ungrouped Media",s("span",{style:{fontSize:"0.875rem",fontWeight:400,color:"var(--color-text-secondary)",marginLeft:"0.5rem"},children:["(",t.length,")"]})]}),t.length>0&&o&&s("span",{style:{fontSize:"0.75rem",color:"var(--color-primary)",fontStyle:"italic"},children:["Click to add to ",(r==null?void 0:r.label)||"Untitled",""]})]}),t.length===0?s("div",{style:{textAlign:"center",padding:"2rem",color:"var(--color-text-secondary)",fontSize:"0.875rem",borderRadius:"var(--radius)",background:q.value==="__ungrouped__"?"rgba(108, 140, 255, 0.06)":"transparent",border:q.value==="__ungrouped__"?"2px dashed var(--color-primary)":"2px dashed transparent",transition:"background 0.15s, border-color 0.15s"},children:"All media has been grouped! Drag items here to ungroup them."}):s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(var(--grid-card-sm), 1fr))",gap:"0.5rem",borderRadius:"var(--radius)",padding:q.value==="__ungrouped__"?"0.5rem":"0",background:q.value==="__ungrouped__"?"rgba(108, 140, 255, 0.06)":"transparent",border:q.value==="__ungrouped__"?"2px dashed var(--color-primary)":"2px dashed transparent",transition:"background 0.15s, border-color 0.15s, padding 0.15s"},children:t.map(d=>{var g;return s(Ui,{item:d,isInGroup:!1,showAssignHint:o,isDragging:((g=we.value)==null?void 0:g.key)===d.key,onDragStart:()=>Ai(d.key,null),onDragEnd:Di,onClick:()=>Ri(d.key,!1)},d.key)})})]}),s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("h2",{style:{marginBottom:"0.75rem"},children:["Post Groups",s("span",{style:{fontSize:"0.875rem",fontWeight:400,color:"var(--color-text-secondary)",marginLeft:"0.5rem"},children:["(",e.length,")"]})]}),s("div",{style:{display:"flex",gap:"0.75rem",overflowX:"auto",paddingBottom:"0.5rem"},children:[e.map(d=>s(Su,{group:d,isSelected:d.id===ye.value,onSelect:()=>{ye.value=ye.value===d.id?null:d.id},onDelete:()=>yu(d.id),onDragOver:Hr,onDragEnter:()=>{d.keys.length<ut&&(q.value=d.id)},onDragLeave:()=>{q.value===d.id&&(q.value=null)},onDrop:g=>Tu(g,d.id)},d.id)),s(bu,{onCreateGroup:()=>Oo(),onDragOver:Hr,onDragEnter:()=>{q.value="__new__"},onDragLeave:()=>{q.value==="__new__"&&(q.value=null)},onDrop:Iu})]})]}),r&&s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.75rem",gap:"1rem"},children:[s("div",{style:{flex:1},children:[s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.25rem"},children:"Group label  describe this post (used for AI caption generation)"}),s("textarea",{value:r.label,onInput:d=>_u(r.id,d.target.value),placeholder:"e.g., First morning in Shibuya  the energy of the crossing, coffee at Blue Bottle, found a great vintage shop on Cat Street...",style:{width:"100%",minHeight:"3rem",resize:"vertical",fontSize:"0.875rem",background:"var(--color-bg)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",padding:"0.5rem 0.75rem",color:"var(--color-text)",lineHeight:1.5}})]}),s("div",{style:{fontSize:"0.875rem",color:r.keys.length>=ut?"var(--color-danger)":"var(--color-text-secondary)",fontWeight:600,whiteSpace:"nowrap",paddingTop:"1.25rem"},children:[r.keys.length,"/",ut]})]}),n.length===0?s("div",{style:{textAlign:"center",padding:"2rem",color:"var(--color-text-secondary)",fontSize:"0.875rem",borderRadius:"var(--radius)",border:"2px dashed var(--color-border)"},children:"No items in this group yet. Click thumbnails above or drag media here."}):s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(var(--grid-card-sm), 1fr))",gap:"0.5rem"},children:n.map(d=>{var g;return s(Ui,{item:d,isInGroup:!0,isDragging:((g=we.value)==null?void 0:g.key)===d.key,onDragStart:()=>Ai(d.key,r.id),onDragEnd:Di,onClick:()=>Ri(d.key,!0)},d.key)})}),n.length>0&&s("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"var(--color-text-secondary)",fontStyle:"italic"},children:"Click a thumbnail to remove it from this group."})]}),s(Qe,{left:s("span",{style:{fontSize:"0.875rem"},children:f.length===0?s("span",{style:{color:"var(--color-text-secondary)"},children:"Create a group and add media to proceed"}):s(G,{children:[s("strong",{style:{color:"var(--color-success)"},children:[f.length," post",f.length!==1?"s":""]}),s("span",{style:{color:"var(--color-text-secondary)"},children:[" ","ready (",a," items)"]}),l>0&&s("span",{style:{color:"var(--color-text-secondary)",fontSize:"0.75rem",marginLeft:"0.5rem"},children:["(",l," ungrouped  will not be published)"]})]})}),right:s("div",{style:{display:"flex",gap:"0.75rem"},children:[s("button",{class:"outline",onClick:Uu,children:"Back to Enhancement"}),s("button",{class:"primary",onClick:ku,disabled:f.length===0,children:["Continue (",f.length," post",f.length!==1?"s":"",")"]})]})})]})}const Ht=E({}),cr=E(null);function $o(){Ht.value={},cr.value=null}function Du(e){return Ht.value[e]??{jobId:null,status:"idle",bundles:[],error:null}}function or(e,t){Ht.value={...Ht.value,[e]:t}}async function Ru(e){const t=D.value;if(t){or(e.id,{jobId:null,status:"processing",bundles:[],error:null});try{const{id:r}=await ou({sessionId:t,keys:e.keys,groupLabel:e.label||"media"});or(e.id,{jobId:r,status:"processing",bundles:[],error:null});const n=2e3,o=150;for(let i=0;i<o;i++){await new Promise(l=>setTimeout(l,n));const a=await su(r,t);if(or(e.id,{jobId:r,status:a.status==="complete"||a.status==="error"?a.status:"processing",bundles:a.bundles??[],error:a.error??null}),a.status==="complete"||a.status==="error")break}}catch(r){or(e.id,{jobId:null,status:"error",bundles:[],error:r instanceof Error?r.message:"Download failed"})}}}const Vr=X(()=>M.value.length),Et=X(()=>Object.values(Ht.value).filter(e=>e.status==="complete").length);function Pu(){const e=M.value;return s("div",{children:[s("div",{class:"card",style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"0.5rem"},children:[s("div",{children:s("span",{style:{fontSize:"0.875rem"},children:[s("strong",{children:Vr.value})," post group",Vr.value!==1?"s":"",Et.value>0&&s(G,{children:["  ",s("span",{style:{color:"var(--color-success)"},children:[Et.value," ready for download"]})]})]})}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Photos are bundled into one ZIP. Videos are split into bundles under 375 MB each for fast downloads."})]}),e.map(t=>s(gu,{group:t,state:Du(t.id),isExpanded:cr.value===t.id,groupableMedia:Ie.value,onToggleExpand:()=>{cr.value=cr.value===t.id?null:t.id},onDownload:()=>Ru(t)},t.id)),s(Qe,{left:s("span",{style:{fontSize:"0.875rem"},children:Et.value===0?s("span",{style:{color:"var(--color-text-secondary)"},children:'Click "Prepare Download" on a group to create ZIP bundles'}):s(G,{children:[s("strong",{style:{color:"var(--color-success)"},children:[Et.value," of ",Vr.value]}),s("span",{style:{color:"var(--color-text-secondary)"},children:[" ","group",Et.value!==1?"s":""," ready"]})]})}),right:s("div",{style:{display:"flex",gap:"0.5rem"},children:[s("button",{class:"outline",onClick:()=>Le(),children:"Back to Grouping"}),s("button",{class:"primary",onClick:()=>Se("description"),style:{fontSize:"0.875rem"},children:"Generate Captions"})]})})]})}E([]);E(!1);E(null);function Ar(e){let t=!1;return{promise:new Promise((n,o)=>{const{fn:i,intervalMs:a,timeoutMs:l,isDone:f,onPoll:d,onPollError:g}=e,p=Date.now(),y=async()=>{if(t){o(new Error("Polling aborted"));return}if(l&&Date.now()-p>l){o(new Error("Polling timed out"));return}try{const m=await i();if(d==null||d(m),f(m)){n(m);return}}catch(m){if(!((g==null?void 0:g(m))??!1)){o(m instanceof Error?m:new Error(String(m)));return}}t||setTimeout(y,a)};e.immediate?y():setTimeout(y,a)}),abort:()=>{t=!0}}}function Lo(){const[e,t]=no(0);return $e(()=>{const r=Date.now(),n=setInterval(()=>{t(Math.floor((Date.now()-r)/1e3))},1e3);return()=>clearInterval(n)},[]),e}function jo(e){const t=Math.floor(e/60),r=e%60;return`${t}:${r.toString().padStart(2,"0")}`}function Fu(e){switch(e){case"done":case"complete":case"completed":return"status-badge status-badge--done";case"error":case"failed":return"status-badge status-badge--error";case"processing":case"enhancing":case"analyzing":return"status-badge status-badge--processing";default:return"status-badge status-badge--pending"}}function Dr(e){const t=Lo(),[r,n]=no(!1),o=jo(t),i=e.completedCount!=null&&e.totalCount!=null&&e.totalCount>0,a=i?e.completedCount/e.totalCount*100:0;return s("div",{class:"card",style:{padding:"2.5rem"},children:[s("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),s("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[s("div",{style:{width:"1.5rem",height:"1.5rem",border:"2.5px solid var(--color-border)",borderTop:"2.5px solid var(--color-primary)",borderRadius:"50%",animation:"spin 1s linear infinite",flexShrink:0}}),s("div",{style:{fontSize:"1.5rem",color:"var(--color-text)",fontWeight:600},children:e.title})]}),s("p",{style:{color:"var(--color-text-secondary)",maxWidth:"32rem",margin:"0 auto 1rem",textAlign:"center"},children:e.description}),s("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"1rem",marginBottom:"1rem"},children:[s("span",{style:{fontSize:"1.125rem",fontFamily:"var(--font-mono)",color:"var(--color-text)"},children:o}),e.status&&s("span",{class:`status-badge status-badge--${e.status==="pending"?"pending":"processing"}`,children:e.status})]}),i&&s("div",{style:{margin:"0 auto 1rem",maxWidth:"24rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.875rem",color:"var(--color-text-secondary)",marginBottom:"0.375rem"},children:[s("span",{children:[e.completedCount," of ",e.totalCount]}),s("span",{children:[Math.round(a),"%"]})]}),s("div",{style:{width:"100%",height:"0.5rem",background:"var(--color-surface-hover)",borderRadius:"4px",overflow:"hidden"},children:s("div",{style:{width:`${a}%`,height:"100%",background:"var(--color-primary)",borderRadius:"4px",transition:"width 0.3s"}})})]}),e.items&&e.items.length>0&&s("div",{style:{maxWidth:"32rem",margin:"0 auto 1rem"},children:s("div",{class:"file-list",style:{maxHeight:"320px"},children:e.items.map(l=>s("div",{class:"file-row",children:[s("span",{style:{fontSize:"1rem",flexShrink:0,width:"1.25rem",textAlign:"center",opacity:.6},children:""}),s("span",{style:{flex:1,fontSize:"0.875rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:l.name,children:l.name}),s("span",{class:Fu(l.status),children:l.status})]},l.name))})}),e.children,s("div",{style:{marginTop:"1rem",textAlign:"center"},children:[s("button",{class:"outline",onClick:()=>n(!r),style:{fontSize:"0.75rem",padding:"0.25rem 0.75rem"},children:r?"Hide details":"Show details"}),r&&s("div",{style:{marginTop:"0.75rem",padding:"0.75rem 1rem",background:"var(--color-bg)",borderRadius:"var(--radius)",fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--color-text-secondary)",textAlign:"left",maxWidth:"24rem",margin:"0.75rem auto 0"},children:[e.jobId&&s("div",{children:["Job ID: ",e.jobId]}),e.sessionId&&s("div",{children:["Session: ",e.sessionId]}),e.pollIntervalMs&&s("div",{children:["Poll interval: ",e.pollIntervalMs,"ms"]}),e.fileCount!=null&&s("div",{children:["Files: ",e.fileCount]}),e.status&&s("div",{children:["Status: ",e.status]}),s("div",{children:["Elapsed: ",o]})]})]}),e.onCancel&&s("div",{style:{textAlign:"center"},children:s("button",{class:"outline",onClick:e.onCancel,style:{marginTop:"1rem"},children:"Cancel"})})]})}function Bu(){const e=Lo();return s("span",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:jo(e)})}function gr(e){switch(e){case"initial":return"Queued";case"phase1":return"Global Enhancement";case"phase2":return"Analyzing";case"phase3":return"Surgical Edits";case"feedback":return"Feedback Applied";case"complete":return"Done";case"error":return"Error";default:return e}}function Fn(e){switch(e){case"complete":case"feedback":return"var(--color-success)";case"error":return"var(--color-danger)";case"initial":return"var(--color-text-secondary)";default:return"var(--color-primary)"}}function Mu({item:e,isSelected:t,onClick:r}){const n=!!e.enhancedThumbKey,o=_e(n?e.enhancedThumbKey:e.originalThumbKey||e.key);return s("div",{onClick:r,style:{background:t?"rgba(108, 140, 255, 0.08)":"var(--color-bg)",borderRadius:"var(--radius)",overflow:"hidden",border:t?"2px solid var(--color-primary)":"2px solid transparent",cursor:"pointer",transition:"border-color 0.15s"},children:[s("div",{style:{width:"100%",aspectRatio:"1",background:"var(--color-surface-hover)",position:"relative"},children:[s("img",{src:o,alt:e.filename,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover"},onError:i=>{i.target.style.display="none"}}),s("span",{style:{position:"absolute",top:"0.375rem",right:"0.375rem",fontSize:"0.75rem",padding:"0.125rem 0.375rem",borderRadius:"4px",background:Fn(e.phase),color:"#fff",fontWeight:600},children:gr(e.phase)}),e.analysis&&s("span",{style:{position:"absolute",top:"0.375rem",left:"0.375rem",fontSize:"0.75rem",fontWeight:700,padding:"0.125rem 0.375rem",borderRadius:"4px",background:e.analysis.professionalScore>=8.5?"rgba(81, 207, 102, 0.9)":"rgba(255, 193, 7, 0.9)",color:"#fff"},children:e.analysis.professionalScore.toFixed(1)}),e.imagenEdits>0&&s("span",{style:{position:"absolute",bottom:"0.375rem",left:"0.375rem",fontSize:"0.75rem",padding:"0.125rem 0.375rem",borderRadius:"4px",background:"rgba(108, 140, 255, 0.85)",color:"#fff",fontWeight:600},children:["+",e.imagenEdits," surgical"]})]}),s("div",{style:{padding:"0.5rem"},children:[s("div",{title:e.filename,style:{fontSize:"0.75rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.filename}),e.error&&s("div",{style:{fontSize:"0.75rem",color:"var(--color-danger)",marginTop:"0.25rem"},children:e.error})]})]})}const Pt=E(!1),mr=E(""),Ko=E("Photo"),yr=E(""),Ft=E(null),We=E(!1);function Vt(e,t,r){mr.value=e,Ko.value=t,yr.value=r,Ft.value=null,We.value=!0,Pt.value=!0,Fo(e,t).then(n=>{Ft.value=n}).catch(()=>{Ft.value=null}).finally(()=>{We.value=!1})}function qr(){Pt.value=!1,mr.value="",yr.value="",Ft.value=null,We.value=!1}function Ou(){const e=Us(null);if($e(()=>{function n(o){o.key==="Escape"&&Pt.value&&qr()}return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]),$e(()=>(Pt.value?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""})),!Pt.value)return null;const t=Ft.value,r=Ko.value==="Video";return s("div",{ref:e,onClick:n=>{n.target===e.current&&qr()},style:{position:"fixed",inset:0,zIndex:9999,background:"rgba(0, 0, 0, 0.85)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[s("div",{style:{position:"absolute",top:0,left:0,right:0,display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1.5rem",background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(8px)",zIndex:1},children:[s("div",{style:{fontSize:"0.875rem",fontFamily:"var(--font-mono)",color:"#e4e6f0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:"1rem"},children:yr.value}),s("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[s("button",{class:"outline",onClick:n=>{n.stopPropagation(),ki(mr.value)},style:{fontSize:"0.875rem",padding:"0.5rem 1rem",color:"#e4e6f0",borderColor:"rgba(255, 255, 255, 0.2)"},children:"Open in New Tab"}),s("button",{class:"outline",onClick:n=>{n.stopPropagation(),qr()},style:{fontSize:"0.875rem",padding:"0.5rem 0.875rem",color:"#e4e6f0",borderColor:"rgba(255, 255, 255, 0.2)",fontWeight:700,lineHeight:1},children:""})]})]}),s("div",{style:{maxWidth:"90vw",maxHeight:"80vh",display:"flex",alignItems:"center",justifyContent:"center"},children:[We.value&&s("div",{style:{color:"#e4e6f0",fontSize:"1rem"},children:"Loading..."}),!We.value&&!t&&s("div",{style:{color:"var(--color-danger)",fontSize:"0.875rem",textAlign:"center"},children:[s("div",{style:{marginBottom:"0.5rem"},children:"Failed to load media."}),s("button",{class:"outline",onClick:n=>{n.stopPropagation(),ki(mr.value)},style:{fontSize:"0.75rem",color:"#e4e6f0",borderColor:"rgba(255, 255, 255, 0.2)"},children:"Try opening in new tab"})]}),!We.value&&t&&!r&&s("img",{src:t,alt:yr.value,style:{maxWidth:"90vw",maxHeight:"80vh",objectFit:"contain",borderRadius:"var(--radius)"}}),!We.value&&t&&r&&s("video",{src:t,controls:!0,autoPlay:!0,playsInline:!0,style:{width:"80vw",maxHeight:"80vh",borderRadius:"var(--radius)",background:"#000"},children:"Your browser does not support the video tag."})]}),s("div",{style:{position:"absolute",bottom:"1rem",fontSize:"0.75rem",color:"rgba(255, 255, 255, 0.4)"},children:"Press Esc or click outside to close"})]})}function Nu({item:e,feedbackText:t,onFeedbackInput:r,feedbackLoading:n,onSubmitFeedback:o}){const i=_e(e.originalThumbKey||e.key),a=e.enhancedThumbKey?_e(e.enhancedThumbKey):null;return s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("h3",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s("span",{children:e.filename}),s("span",{style:{fontSize:"0.75rem",color:Fn(e.phase),fontWeight:600},children:gr(e.phase)})]}),s("div",{style:{display:"grid",gridTemplateColumns:a?"1fr 1fr":"1fr",gap:"1rem",marginBottom:"1rem"},children:[s("div",{children:[s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.375rem",textAlign:"center"},children:"Original"}),s("div",{style:{background:"var(--color-surface-hover)",borderRadius:"var(--radius)",overflow:"hidden",aspectRatio:"4/3"},children:s("img",{src:i,alt:`Original: ${e.filename}`,onClick:()=>Vt(e.originalKey,"Photo",e.filename),style:{width:"100%",height:"100%",objectFit:"contain",cursor:"zoom-in"},onError:l=>{l.target.style.display="none"}})})]}),a&&s("div",{children:[s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.375rem",textAlign:"center"},children:["Enhanced",e.analysis&&s("span",{style:{marginLeft:"0.375rem",color:e.analysis.professionalScore>=8.5?"var(--color-success)":"var(--color-warning, #ffc107)"},children:["(Score: ",e.analysis.professionalScore.toFixed(1),")"]})]}),s("div",{style:{background:"var(--color-surface-hover)",borderRadius:"var(--radius)",overflow:"hidden",aspectRatio:"4/3"},children:s("img",{src:a,alt:`Enhanced: ${e.filename}`,onClick:()=>Vt(e.enhancedKey,"Photo",`${e.filename} (enhanced)`),style:{width:"100%",height:"100%",objectFit:"contain",cursor:"zoom-in"},onError:l=>{l.target.style.display="none"}})})]})]}),e.phase1Text&&s("div",{style:{marginBottom:"0.75rem"},children:[s("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"var(--color-text-secondary)",marginBottom:"0.25rem"},children:"Changes Applied:"}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",lineHeight:1.5,background:"var(--color-bg)",padding:"0.5rem 0.75rem",borderRadius:"var(--radius)"},children:e.phase1Text})]}),e.analysis&&!e.analysis.noFurtherEditsNeeded&&s("div",{style:{marginBottom:"0.75rem"},children:[s("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"var(--color-text-secondary)",marginBottom:"0.25rem"},children:"Analysis:"}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",lineHeight:1.5,background:"var(--color-bg)",padding:"0.5rem 0.75rem",borderRadius:"var(--radius)"},children:[s("div",{children:e.analysis.overallAssessment}),e.analysis.remainingImprovements.length>0&&s("ul",{style:{margin:"0.375rem 0 0 0",paddingLeft:"1.25rem"},children:e.analysis.remainingImprovements.map((l,f)=>s("li",{style:{marginBottom:"0.25rem"},children:[s("span",{style:{fontWeight:600,color:l.impact==="high"?"var(--color-danger)":"var(--color-text-secondary)"},children:["[",l.impact,"]"]})," ",l.description,l.imagenSuitable&&s("span",{style:{fontSize:"0.75rem",color:"var(--color-primary)",marginLeft:"0.375rem"},children:"(surgical edit)"})]},f))})]})]}),e.feedbackHistory&&e.feedbackHistory.length>0&&s("div",{style:{marginBottom:"0.75rem"},children:[s("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"var(--color-text-secondary)",marginBottom:"0.25rem"},children:"Feedback History:"}),e.feedbackHistory.map((l,f)=>s("div",{style:{fontSize:"0.75rem",background:"var(--color-bg)",padding:"0.375rem 0.75rem",borderRadius:"var(--radius)",marginBottom:"0.375rem",borderLeft:`3px solid ${l.success?"var(--color-success)":"var(--color-danger)"}`},children:[s("div",{style:{fontWeight:600},children:["You: ",l.userFeedback]}),s("div",{style:{color:"var(--color-text-secondary)"},children:["AI (",l.method,"): ",l.modelResponse]})]},f))]}),(e.phase==="complete"||e.phase==="feedback")&&s("div",{style:{display:"flex",gap:"0.5rem",alignItems:"flex-start"},children:[s("textarea",{value:t,onInput:l=>{r(l.target.value)},placeholder:'Give feedback, e.g., "make the sky more blue", "remove the trash can on the right"...',style:{flex:1,minHeight:"2.5rem",resize:"vertical",fontSize:"0.875rem"},disabled:n}),s("button",{class:"primary",onClick:o,disabled:!t.trim()||n,style:{whiteSpace:"nowrap"},children:n?"Processing...":"Apply Feedback"})]})]})}const ft=E(null),re=E(null),pe=E(null),Ee=E(null),Ne=E(""),Bt=E(!1),Rr=E([]);function Ho(){ft.value=null,re.value=null,pe.value=null,Ee.value=null,Ne.value="",Bt.value=!1,Rr.value=[]}function zu(){const e=D.value;if(!e){pe.value="No upload session found. Please upload media first.";return}const t=Rr.value;if(t.length===0){pe.value="No photos selected for enhancement.";return}ls("grouping"),pe.value=null,nu({sessionId:e,keys:t}).then(r=>{ft.value=r.id,$u(r.id,e)}).catch(r=>{pe.value=r instanceof Error?r.message:"Failed to start enhancement"})}function $u(e,t){Ar({fn:()=>Bo(e,t),intervalMs:3e3,isDone:r=>r.status==="complete"||r.status==="error",onPoll:r=>{re.value=r},onPollError:r=>(pe.value=r instanceof Error?r.message:"Failed to poll results",!1)}).promise.then(r=>{r.status==="complete"&&Jt("review-enhanced")})}async function Lu(){if(!Ee.value||!Ne.value.trim())return;const e=D.value,t=ft.value;if(!(!e||!t)){Bt.value=!0;try{await iu(t,{sessionId:e,key:Ee.value,feedback:Ne.value.trim()}),Ne.value="",setTimeout(async()=>{try{const r=await Bo(t,e);re.value=r}catch{}Bt.value=!1},5e3)}catch(r){pe.value=r instanceof Error?r.message:"Feedback submission failed",Bt.value=!1}}}function ju(){var t;const e=((t=re.value)==null?void 0:t.items)??[];Ie.value=e.filter(r=>r.phase==="complete"||r.phase==="feedback").map(r=>({key:r.enhancedKey||r.key,filename:r.filename,thumbnailKey:r.enhancedThumbKey||r.originalThumbKey||r.key,type:"Photo"})),Se("group-posts")}function Wr(){re.value=null,ft.value=null,Ee.value=null,Ne.value="",pe.value=null,Le()}function Ku(){var o,i,a,l,f,d;if($e(()=>{P.value==="enhancing"&&!ft.value&&zu()},[]),P.value==="enhancing"&&(!re.value||re.value.status==="pending"||re.value.status==="processing")){const g=((o=re.value)==null?void 0:o.completedCount)??0,p=((i=re.value)==null?void 0:i.totalCount)??Rr.value.length;return s(Dr,{title:"Enhancing Photos",description:"Each photo goes through a multi-step AI enhancement pipeline: global enhancement, professional quality analysis, and surgical edits.",status:((a=re.value)==null?void 0:a.status)??"pending",jobId:ft.value??void 0,sessionId:D.value??void 0,pollIntervalMs:3e3,completedCount:g,totalCount:p,onCancel:Wr,children:[((l=re.value)==null?void 0:l.items)&&re.value.items.length>0&&s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(var(--grid-card-sm), 1fr))",gap:"0.5rem",maxWidth:"40rem",margin:"1rem auto 0",textAlign:"left"},children:re.value.items.map(y=>s("div",{style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",borderRadius:"var(--radius)",background:"var(--color-bg)",color:Fn(y.phase),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:`${y.filename}: ${gr(y.phase)}`,children:[y.filename,": ",gr(y.phase)]},y.key))}),pe.value&&s("div",{style:{color:"var(--color-danger)",marginTop:"1rem",fontSize:"0.875rem"},children:pe.value})]})}if(((f=re.value)==null?void 0:f.status)==="error")return s("div",{class:"card",children:[s("p",{style:{color:"var(--color-danger)"},children:["Enhancement failed: ",re.value.error]}),s("button",{class:"outline",onClick:Wr,style:{marginTop:"1rem"},children:"Back to Selection"})]});const e=((d=re.value)==null?void 0:d.items)||[],t=e.filter(g=>g.phase==="complete"||g.phase==="feedback"),r=e.filter(g=>g.phase==="error"),n=e.find(g=>g.key===Ee.value);return!n&&e.length>0&&!Ee.value&&(Ee.value=e[0].key),s("div",{children:[pe.value&&s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:pe.value}),s("div",{class:"card",style:{marginBottom:"1.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s("div",{children:s("span",{style:{fontSize:"0.875rem"},children:[s("strong",{style:{color:"var(--color-success)"},children:[t.length," enhanced"]}),r.length>0&&s(G,{children:[" / ",s("span",{style:{color:"var(--color-danger)"},children:[r.length," failed"]})]})," / ",s("span",{style:{color:"var(--color-text-secondary)"},children:[e.length," total"]})]})}),s("div",{children:s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Click a photo to view comparison. Give feedback to request changes."})})]}),s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("h2",{style:{marginBottom:"1rem"},children:"Enhanced Photos"}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(var(--grid-card-md), 1fr))",gap:"0.75rem"},children:e.map(g=>s(Mu,{item:g,isSelected:g.key===Ee.value,onClick:()=>{Ee.value=g.key,Ne.value=""}},g.key))})]}),n&&s(Nu,{item:n,feedbackText:Ne.value,onFeedbackInput:g=>{Ne.value=g},feedbackLoading:Bt.value,onSubmitFeedback:Lu}),s(Qe,{left:s("span",{style:{fontSize:"0.875rem"},children:[t.length," photo(s) ready for grouping"]}),right:s("div",{style:{display:"flex",gap:"0.75rem"},children:[s("button",{class:"outline",onClick:Wr,children:"Back to Selection"}),s("button",{class:"primary",onClick:ju,disabled:t.length===0,children:["Proceed to Grouping (",t.length,")"]})]})})]})}const Hu=[{id:"triage",title:"Media Triage",description:"Identify and delete unsaveable media",details:["AI detects blurry, dark, and accidental photos/videos","Review flagged items with thumbnail previews","Multi-select deletion with confirmation"],startStep:"triage-upload",accentColor:"var(--color-danger)",accentBg:"rgba(255, 107, 107, 0.1)"},{id:"selection",title:"Media Selection",description:"Full AI pipeline for Instagram posts",details:["AI selects the best photos and videos","Enhance, group into posts, generate captions","Download bundles or publish to Instagram"],startStep:"upload",accentColor:"var(--color-primary)",accentBg:"rgba(108, 140, 255, 0.1)"}];function Pi(e){Ze.value=e.id,Se(e.startStep)}function Vu(){return s("div",{children:[s("p",{style:{color:"var(--color-text-secondary)",fontSize:"1rem",marginBottom:"2rem",lineHeight:"1.6"},children:"Choose a tool to get started. Upload your media files, and AI will handle the rest."}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(var(--grid-card-lg), 1fr))",gap:"1.5rem"},children:Hu.map(e=>s("div",{onClick:()=>Pi(e),role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),Pi(e))},style:{background:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-lg)",padding:"2rem",cursor:"pointer",transition:"all 0.2s ease",position:"relative",overflow:"hidden"},onMouseEnter:t=>{const r=t.currentTarget;r.style.borderColor=e.accentColor,r.style.transform="translateY(-2px)",r.style.boxShadow=`0 4px 12px ${e.accentBg}`},onMouseLeave:t=>{const r=t.currentTarget;r.style.borderColor="var(--color-border)",r.style.transform="none",r.style.boxShadow="none"},children:[s("div",{style:{position:"absolute",top:0,left:0,right:0,height:"3px",background:e.accentColor,opacity:.6}}),s("h2",{style:{fontSize:"1.25rem",fontWeight:600,marginBottom:"0.5rem",color:e.accentColor},children:e.title}),s("p",{style:{color:"var(--color-text-secondary)",fontSize:"1rem",marginBottom:"1.25rem"},children:e.description}),s("ul",{style:{listStyle:"none",padding:0,margin:0},children:e.details.map((t,r)=>s("li",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)",padding:"0.25rem 0",paddingLeft:"1rem",position:"relative"},children:[s("span",{style:{position:"absolute",left:0,color:e.accentColor,opacity:.7},children:"-"}),t]},r))}),s("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"flex-end"},children:s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:e.accentColor,display:"flex",alignItems:"center",gap:"0.25rem"},children:["Get started",s("span",{"aria-hidden":"true",children:""})]})})]},e.id))})]})}const vn=E(""),gn=E(""),Mt=E(!1);async function qu(e){if(e.preventDefault(),!Mt.value){Mt.value=!0;try{await Vl(vn.value,gn.value)}catch{}finally{Mt.value=!1}}}function Wu(){return s("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:s("div",{class:"card",style:{maxWidth:"400px",width:"100%"},children:[s("h2",{style:{marginBottom:"1.5rem",textAlign:"center"},children:"Sign In"}),s("form",{onSubmit:qu,children:[s("div",{style:{marginBottom:"1rem"},children:[s("label",{htmlFor:"email",style:{display:"block",fontSize:"0.875rem",marginBottom:"0.25rem",color:"var(--color-text-secondary)"},children:"Email"}),s("input",{id:"email",type:"email",value:vn.value,onInput:e=>{vn.value=e.target.value},required:!0,autoComplete:"email",style:{width:"100%",padding:"0.5rem 0.75rem",borderRadius:"var(--radius)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)",fontSize:"1rem",minHeight:"2.75rem",boxSizing:"border-box"}})]}),s("div",{style:{marginBottom:"1.5rem"},children:[s("label",{htmlFor:"password",style:{display:"block",fontSize:"0.875rem",marginBottom:"0.25rem",color:"var(--color-text-secondary)"},children:"Password"}),s("input",{id:"password",type:"password",value:gn.value,onInput:e=>{gn.value=e.target.value},required:!0,autoComplete:"current-password",style:{width:"100%",padding:"0.5rem 0.75rem",borderRadius:"var(--radius)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)",fontSize:"1rem",minHeight:"2.75rem",boxSizing:"border-box"}})]}),qe.value&&s("div",{style:{color:"var(--color-danger)",fontSize:"0.875rem",marginBottom:"1rem",textAlign:"center"},children:qe.value}),s("button",{type:"submit",class:"primary",disabled:Mt.value,style:{width:"100%"},children:Mt.value?"Signing in...":"Sign In"})]})]})})}function Gu(e){return new Promise((t,r)=>{const n=[];function o(){e.readEntries(i=>{i.length===0?t(n):(n.push(...i),o())},r)}o()})}function Ju(e){return new Promise((t,r)=>e.file(t,r))}async function Vo(e){if(e.isFile)try{return[await Ju(e)]}catch{return[]}if(e.isDirectory){const t=e.createReader(),r=await Gu(t);return(await Promise.all(r.map(Vo))).flat()}return[]}async function qo(e){const r=Array.from(e.items).map(o=>{var i;return(i=o.webkitGetAsEntry)==null?void 0:i.call(o)}).filter(o=>o!=null);return r.length===0?Array.from(e.files):(await Promise.all(r.map(Vo))).flat()}function Wo(e){return`status-badge status-badge--${e}`}function Go(e,t){switch(e){case"uploading":return`Uploading ${t}%`;case"done":return"Uploaded";case"error":return"Failed";default:return"Waiting"}}const _r=160;async function Yu(e){return new Promise((t,r)=>{const n=URL.createObjectURL(e),o=new Image;o.onload=()=>{const i=Math.min(_r/o.width,_r/o.height,1),a=Math.round(o.width*i),l=Math.round(o.height*i),f=document.createElement("canvas");f.width=a,f.height=l;const d=f.getContext("2d");if(!d){URL.revokeObjectURL(n),r(new Error("Canvas not supported"));return}d.drawImage(o,0,0,a,l),URL.revokeObjectURL(n),t(f.toDataURL("image/jpeg",.7))},o.onerror=()=>{URL.revokeObjectURL(n),r(new Error("Failed to load image"))},o.src=n})}async function Zu(e){return new Promise((t,r)=>{const n=URL.createObjectURL(e),o=document.createElement("video");o.preload="metadata",o.muted=!0,o.playsInline=!0,o.onloadeddata=()=>{o.currentTime=Math.min(1,o.duration/2)},o.onseeked=()=>{const i=Math.min(_r/o.videoWidth,_r/o.videoHeight,1),a=Math.round(o.videoWidth*i),l=Math.round(o.videoHeight*i),f=document.createElement("canvas");f.width=a,f.height=l;const d=f.getContext("2d");if(!d){URL.revokeObjectURL(n),r(new Error("Canvas not supported"));return}d.drawImage(o,0,0,a,l),URL.revokeObjectURL(n),t(f.toDataURL("image/jpeg",.7))},o.onerror=()=>{URL.revokeObjectURL(n),r(new Error("Failed to load video"))},o.src=n})}async function Xu(e){try{if(e.type.startsWith("video/"))return await Zu(e);if(e.type.startsWith("image/"))return await Yu(e)}catch{}}const Qu=new Set([".jpg",".jpeg",".png",".gif",".webp",".heic",".heif",".mp4",".mov",".avi",".webm",".mkv"]),ec=[{description:"Media files",accept:{"image/*":[".jpg",".jpeg",".png",".gif",".webp",".heic",".heif"],"video/*":[".mp4",".mov",".avi",".webm",".mkv"]}}],L=E([]),be=E(null);function tc(){return crypto.randomUUID()}function Jo(e){const t=e.name.lastIndexOf(".");if(t===-1)return!1;const r=e.name.slice(t).toLowerCase();return Qu.has(r)}function rc(e){return e.type.startsWith("video/")?"video":"image"}async function Yo(e){const t=[];for await(const r of e.values())if(r.kind==="file"){const n=await r.getFile();Jo(n)&&t.push(n)}else if(r.kind==="directory"){const n=await Yo(r);t.push(...n)}return t}async function Fi(){try{const e=await window.showOpenFilePicker({multiple:!0,types:ec}),t=[];for(const r of e)t.push(await r.getFile());t.length>0&&Bn(t)}catch(e){if(e instanceof DOMException&&e.name==="AbortError")return;be.value=e instanceof Error?e.message:"Failed to open file picker"}}async function Bi(){try{const e=await window.showDirectoryPicker(),t=await Yo(e);if(t.length===0){be.value="No media files found in the selected folder.";return}be.value=null,Bn(t)}catch(e){if(e instanceof DOMException&&e.name==="AbortError")return;be.value=e instanceof Error?e.message:"Failed to open folder picker"}}function Bn(e){D.value||(D.value=tc());const t=D.value,r=new Set(L.value.map(i=>i.name)),n=[],o=new Map;for(const i of e)r.has(i.name)||(r.add(i.name),n.push({name:i.name,size:i.size,key:`${t}/${i.name}`,status:"pending",progress:0,mediaType:rc(i)}),o.set(i.name,i));if(n.length!==0){L.value=[...L.value,...n];for(const i of n){const a=o.get(i.name);Xu(a).then(l=>{l&&nt(i.name,{thumbnailDataUrl:l})}),nc(t,i.name,a)}}}async function nc(e,t,r){nt(t,{status:"uploading",progress:0});try{let n;if(r.size>Uo)n=await Ao(e,r,(o,i)=>{nt(t,{progress:Math.round(o/i*100)})});else{const o=await Eo(e,t,r.type);n=o.key,await ko(o.uploadUrl,r,(i,a)=>{nt(t,{progress:Math.round(i/a*100)})})}nt(t,{status:"done",progress:100,key:n})}catch(n){nt(t,{status:"error",error:n instanceof Error?n.message:"Upload failed"})}}function nt(e,t){L.value=L.value.map(r=>r.name===e?{...r,...t}:r)}function ic(e){L.value=L.value.filter(t=>t.name!==e)}function oc(){L.value=[],D.value=null}async function sc(e){if(e.preventDefault(),e.stopPropagation(),!e.dataTransfer)return;const r=(await qo(e.dataTransfer)).filter(Jo);r.length>0&&Bn(r)}function ac(e){e.preventDefault(),e.stopPropagation()}function lc(){const e=L.value.filter(t=>t.status==="done").map(t=>t.key);if(e.length!==0){if(!pt.value.trim()){be.value="Please enter a trip or event description before continuing.";return}be.value=null,Re.value=e,Se("selecting")}}function uc(){const e=L.value.length>0&&L.value.every(i=>i.status==="done"||i.status==="error"),t=L.value.filter(i=>i.status==="done").length,r=L.value.some(i=>i.status==="uploading"),n=L.value.length,o=n>0?Math.round(L.value.reduce((i,a)=>i+a.progress,0)/n):0;return s("div",{class:"card",children:[s("p",{style:{color:"var(--color-text-secondary)",fontSize:"0.875rem",marginBottom:"1.5rem"},children:"Upload media files for AI selection. Choose individual files, select a folder, or drag and drop."}),L.value.length===0&&s("div",{style:{display:"flex",gap:"0.75rem",marginBottom:"1rem"},children:[s("button",{class:"primary",onClick:Fi,children:"Choose Files"}),s("button",{class:"outline",onClick:Bi,children:"Choose Folder"})]}),s("div",{onDrop:sc,onDragOver:ac,style:{border:"2px dashed var(--color-border)",borderRadius:"var(--radius)",padding:L.value.length>0?"0.75rem":"1.5rem",textAlign:"center",marginBottom:"1.5rem",transition:"border-color 0.2s, padding 0.2s"},children:[s("div",{style:{fontSize:L.value.length>0?"0.875rem":"1rem",marginBottom:L.value.length>0?"0":"0.375rem",color:"var(--color-text-secondary)"},children:L.value.length>0?"Drop more files here":"or drop files here"}),L.value.length===0&&s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"JPEG, PNG, GIF, WebP, HEIC, MP4, MOV, AVI, WebM, MKV"})]}),L.value.length>0&&s("div",{class:"file-list",children:L.value.map(i=>s("div",{class:"file-row",children:[s("div",{style:{width:"40px",height:"40px",borderRadius:"4px",overflow:"hidden",flexShrink:0,background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center"},children:i.thumbnailDataUrl?s("img",{src:i.thumbnailDataUrl,alt:i.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",textTransform:"uppercase"},children:i.mediaType==="video"?"VID":"IMG"})}),s("span",{style:{flex:1,fontSize:"0.875rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:i.name,children:i.name}),s("span",{style:{fontSize:"0.75rem",padding:"0.125rem 0.375rem",borderRadius:"999px",background:i.mediaType==="video"?"rgba(108, 140, 255, 0.15)":"rgba(81, 207, 102, 0.15)",color:i.mediaType==="video"?"var(--color-primary)":"var(--color-success)",flexShrink:0,textTransform:"uppercase",fontWeight:600},children:i.mediaType==="video"?"Video":"Photo"}),s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",flexShrink:0},children:lt(i.size)}),s("span",{class:Wo(i.status),style:i.status==="uploading"?{background:`linear-gradient(to right, rgba(108, 140, 255, 0.3) ${i.progress}%, rgba(108, 140, 255, 0.1) ${i.progress}%)`}:void 0,title:i.status==="error"?i.error||"Upload failed":void 0,children:Go(i.status,i.progress)}),s("button",{class:"btn-remove",onClick:()=>ic(i.name),disabled:i.status==="uploading",title:"Remove file",children:""}),i.status==="uploading"&&s("div",{class:"file-progress-bar",style:{width:`${i.progress}%`}})]},i.name))}),r&&s("div",{style:{marginBottom:"1rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.375rem"},children:[s("span",{children:["Uploading ",t," of ",n," files..."]}),s("span",{children:[o,"%"]})]}),s("div",{style:{height:"4px",background:"var(--color-border)",borderRadius:"2px",overflow:"hidden"},children:s("div",{style:{height:"100%",width:`${o}%`,background:"var(--color-primary)",transition:"width 0.3s ease",borderRadius:"2px"}})})]}),be.value&&s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:be.value}),L.value.length===0&&s("p",{style:{color:"var(--color-text-secondary)",padding:"1.5rem 1rem",textAlign:"center",fontSize:"0.875rem"},children:"No files selected yet. Use the buttons above or drag and drop media files."}),s("div",{style:{marginBottom:"1.5rem"},children:[s("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:500,marginBottom:"0.5rem"},children:"Trip / Event Context"}),s("input",{type:"text",placeholder:'e.g., "3-day trip to Tokyo, Oct 2025"',value:pt.value,onInput:i=>{var a;pt.value=i.target.value,(a=be.value)!=null&&a.includes("trip or event")&&(be.value=null)},style:{width:"100%",padding:"0.625rem 0.75rem",fontSize:"0.875rem",background:"var(--color-bg)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",outline:"none"}}),s("p",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginTop:"0.375rem"},children:"Describe the trip or event to help the AI understand context for media selection."})]}),L.value.length>0&&s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"0.75rem"},children:[s("div",{style:{display:"flex",gap:"0.5rem"},children:[s("button",{class:"btn-add-more",onClick:Fi,children:"+ Choose Files"}),s("button",{class:"btn-add-more",onClick:Bi,children:"+ Choose Folder"})]}),s("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[s("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:[t,"/",n," uploaded"]}),s("button",{class:"outline",onClick:oc,disabled:r,children:"Clear all"}),s("button",{class:"primary",onClick:lc,disabled:!e||t===0,children:"Continue to Selection"})]})]})]})}const Ot=E(!1),wr=E(null);async function cc(){Ot.value=!0,wr.value=null;try{const e=ce?{sessionId:D.value}:{paths:Re.value},t=await Do(e);ge.value=t.id,Jt("processing")}catch(e){wr.value=e instanceof Error?e.message:"Failed to start triage"}finally{Ot.value=!1}}function dc(){Jt("browse")}function fc(e){const t=e.split("/");return t[t.length-1]||e}function hc(){const e=Re.value;return s("div",{class:"card",children:[s("h2",{children:"Files to triage"}),s("p",{style:{color:"var(--color-text-secondary)",fontSize:"0.875rem",marginBottom:"1rem"},children:["The following ",e.length," file(s) will be sent for AI triage analysis. Media files will be evaluated and categorized as keep or discard."]}),s("div",{style:{background:"var(--color-bg)",borderRadius:"var(--radius)",padding:"0.75rem",maxHeight:"400px",overflowY:"auto",marginBottom:"1.5rem"},children:e.map(t=>s("div",{style:{padding:"0.375rem 0",fontSize:"0.875rem",fontFamily:"var(--font-mono)",borderBottom:"1px solid var(--color-border)"},children:fc(t)},t))}),wr.value&&s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:wr.value}),s("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[s("button",{class:"outline",onClick:dc,disabled:Ot.value,children:"Back"}),s("button",{class:"primary",onClick:cc,disabled:Ot.value,children:Ot.value?"Starting...":"Start Triage"})]})]})}function pc({item:e,isOverride:t,onToggle:r}){return s("div",{style:{background:t?"rgba(108, 140, 255, 0.08)":"var(--color-bg)",borderRadius:"var(--radius)",overflow:"hidden",border:t?"2px solid var(--color-primary)":"2px solid transparent"},children:[s("div",{style:{width:"100%",aspectRatio:"1",background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[s("img",{src:e.thumbnailUrl,alt:e.filename,loading:"lazy",onClick:()=>Vt(e.key,e.type,e.filename),style:{width:"100%",height:"100%",objectFit:"cover",cursor:"zoom-in"},onError:n=>{n.target.style.display="none"}}),s("span",{style:{position:"absolute",top:"0.375rem",left:"0.375rem",background:"var(--color-primary)",color:"#fff",fontSize:"0.75rem",fontWeight:700,width:"1.5rem",height:"1.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.rank}),s("span",{style:{position:"absolute",top:"0.375rem",right:"0.375rem",fontSize:"0.75rem",padding:"0.125rem 0.375rem",borderRadius:"4px",background:e.type==="Video"?"rgba(108, 140, 255, 0.85)":"rgba(81, 207, 102, 0.85)",color:"#fff",fontWeight:600,textTransform:"uppercase"},children:e.type})]}),s("div",{style:{padding:"0.5rem"},children:[s("div",{title:e.filename,style:{fontSize:"0.75rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginBottom:"0.25rem"},children:e.filename}),e.scene&&s("div",{style:{fontSize:"0.75rem",color:"var(--color-primary)",marginBottom:"0.25rem"},children:e.scene}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",lineHeight:1.4},children:e.justification}),e.comparisonNote&&s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:e.comparisonNote}),s("button",{class:"outline",onClick:r,style:{marginTop:"0.5rem",padding:"0.125rem 0.5rem",fontSize:"0.75rem",width:"100%"},children:t?"Undo Add":"Remove"})]})]})}const qt=E(null),ee=E(null),xe=E(null),Ce=E(new Set),Te=E(new Set),it=E(!1),ot=E(!1);function Zo(){qt.value=null,ee.value=null,xe.value=null,Ce.value=new Set,Te.value=new Set,it.value=!1,ot.value=!1}function vc(){const e=D.value;if(!e){xe.value="No upload session found. Please upload media first.";return}ls("enhancement"),xe.value=null,tu({sessionId:e,tripContext:pt.value}).then(t=>{qt.value=t.id,gc(t.id,e)}).catch(t=>{xe.value=t instanceof Error?t.message:"Failed to start selection"})}function gc(e,t){Ar({fn:()=>ru(e,t),intervalMs:3e3,isDone:r=>r.status==="complete"||r.status==="error",onPoll:r=>{ee.value=r},onPollError:r=>(xe.value=r instanceof Error?r.message:"Failed to poll results",!1)}).promise.then(r=>{r.status==="complete"&&Jt("review-selection")})}function Mi(e,t){if(t){const r=new Set(Te.value);r.has(e.key)?r.delete(e.key):r.add(e.key),Te.value=r;const n=new Set(Ce.value);n.delete(e.key),Ce.value=n}else{const r=new Set(Ce.value);r.has(e.key)?r.delete(e.key):r.add(e.key),Ce.value=r;const n=new Set(Te.value);n.delete(e.key),Te.value=n}}function Xo(){var n;if(!((n=ee.value)!=null&&n.selected))return[];const e=Te.value,t=Ce.value,r=(ee.value.selected||[]).filter(o=>!e.has(o.key));if(ee.value.excluded)for(const o of ee.value.excluded)t.has(o.key)&&r.push({rank:r.length+1,media:o.media,filename:o.filename,key:o.key,type:"Photo",scene:"",justification:"Added by user override",thumbnailUrl:o.thumbnailUrl});return r}function mc(){var n;if(!((n=ee.value)!=null&&n.excluded))return[];const e=Ce.value,t=Te.value,r=(ee.value.excluded||[]).filter(o=>!e.has(o.key));if(ee.value.selected)for(const o of ee.value.selected)t.has(o.key)&&r.push({media:o.media,filename:o.filename,key:o.key,reason:"Removed by user override",category:"redundant-scene",thumbnailUrl:o.thumbnailUrl});return r}function yc(){const e=Xo();Rr.value=e.map(t=>t.key),Se("enhancing")}function Gr(){ee.value=null,qt.value=null,Ce.value=new Set,Te.value=new Set,it.value=!1,ot.value=!1,xe.value=null,Le()}function _c({item:e,onToggle:t}){const r=Te.value.has(e.key);return s("div",{style:{background:r?"rgba(255, 107, 107, 0.08)":"var(--color-bg)",borderRadius:"var(--radius)",overflow:"hidden",border:r?"2px solid var(--color-danger)":"2px solid transparent"},children:[s("div",{style:{width:"100%",aspectRatio:"1",background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[s("img",{src:e.thumbnailUrl,alt:e.filename,loading:"lazy",onClick:()=>Vt(e.key,He(e.filename)?"Video":"Photo",e.filename),style:{width:"100%",height:"100%",objectFit:"cover",cursor:"zoom-in",opacity:.7},onError:n=>{n.target.style.display="none"}}),s("span",{style:{position:"absolute",top:"0.375rem",right:"0.375rem",fontSize:"0.75rem",padding:"0.125rem 0.375rem",borderRadius:"4px",background:"rgba(255, 107, 107, 0.85)",color:"#fff",fontWeight:600},children:e.category.replace("-"," ")})]}),s("div",{style:{padding:"0.5rem"},children:[s("div",{title:e.filename,style:{fontSize:"0.75rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginBottom:"0.25rem"},children:e.filename}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",lineHeight:1.4},children:e.reason}),e.duplicateOf&&s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",fontStyle:"italic",marginTop:"0.125rem"},children:["Duplicate of: ",e.duplicateOf]}),s("button",{class:"outline",onClick:t,style:{marginTop:"0.5rem",padding:"0.125rem 0.5rem",fontSize:"0.75rem",width:"100%"},children:r?"Undo Remove":"Add to Selection"})]})]})}function wc({group:e}){return s("div",{style:{background:"var(--color-bg)",borderRadius:"var(--radius)",padding:"0.75rem",marginBottom:"0.75rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[s("strong",{style:{fontSize:"0.875rem"},children:e.name}),s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:[e.items.filter(t=>t.selected).length," /"," ",e.items.length," selected"]})]}),(e.gps||e.timeRange)&&s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.5rem"},children:[e.gps&&s("span",{children:e.gps}),e.gps&&e.timeRange&&s("span",{children:"  "}),e.timeRange&&s("span",{children:e.timeRange})]}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(var(--grid-thumb-sm), 1fr))",gap:"0.375rem"},children:e.items.map(t=>s("div",{style:{position:"relative",aspectRatio:"1",borderRadius:"4px",overflow:"hidden",border:t.selected?"2px solid var(--color-success)":"2px solid var(--color-border)",opacity:t.selected?1:.5},title:`${t.filename}: ${t.description}`,children:s("img",{src:t.thumbnailUrl,alt:t.filename,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover"},onError:r=>{r.target.style.display="none"}})},t.key))})]})}function Sc(){var o,i,a;if($e(()=>{P.value==="selecting"&&!qt.value&&vc()},[]),P.value==="selecting"||ee.value&&(ee.value.status==="pending"||ee.value.status==="processing"))return s(Dr,{title:"AI Selection in Progress",description:"Scene detection, deduplication, and content evaluation. This may take 1-3 minutes depending on the number of files.",status:((o=ee.value)==null?void 0:o.status)??"pending",jobId:qt.value??void 0,sessionId:D.value??void 0,pollIntervalMs:3e3,onCancel:Gr,children:xe.value&&s("div",{style:{color:"var(--color-danger)",marginTop:"1rem",fontSize:"0.875rem"},children:xe.value})});if(((i=ee.value)==null?void 0:i.status)==="error")return s("div",{class:"card",children:[s("p",{style:{color:"var(--color-danger)"},children:["Selection failed: ",ee.value.error]}),s("button",{class:"outline",onClick:Gr,style:{marginTop:"1rem"},children:"Back to Upload"})]});const e=Xo(),t=mc(),r=((a=ee.value)==null?void 0:a.sceneGroups)||[],n=Ce.value.size>0||Te.value.size>0;return s("div",{children:[xe.value&&s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:xe.value}),s("div",{class:"card",style:{marginBottom:"1.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s("div",{children:[s("span",{style:{fontSize:"0.875rem"},children:[s("strong",{style:{color:"var(--color-success)"},children:[e.length," selected"]})," / ",s("span",{style:{color:"var(--color-text-secondary)"},children:[t.length," excluded"]})," / ",s("span",{style:{color:"var(--color-text-secondary)"},children:[r.length," scenes"]})]}),n&&s("span",{style:{fontSize:"0.75rem",color:"var(--color-primary)",marginLeft:"0.75rem"},children:"(modified)"})]}),s("div",{children:s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Click thumbnails to view full-size. Use buttons to override AI selections."})})]}),s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("h2",{style:{color:"var(--color-success)",marginBottom:"1rem"},children:["Selected (",e.length,")"]}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(var(--grid-card-md), 1fr))",gap:"0.75rem"},children:e.map(l=>s(pc,{item:l,isOverride:Ce.value.has(l.key),onToggle:()=>Mi(l,!0)},l.key))}),e.length===0&&s("p",{style:{color:"var(--color-text-secondary)",textAlign:"center",padding:"1.5rem"},children:"No items selected. Add items from the excluded section below."})]}),s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("div",{onClick:()=>{it.value=!it.value},style:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[s("h2",{style:{color:"var(--color-text-secondary)",marginBottom:0},children:["Excluded (",t.length,")"]}),s("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:it.value?"Collapse":"Expand"})]}),it.value&&s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(var(--grid-card-md), 1fr))",gap:"0.75rem",marginTop:"1rem"},children:t.map(l=>s(_c,{item:l,onToggle:()=>Mi(l,!1)},l.key))})]}),r.length>0&&s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("div",{onClick:()=>{ot.value=!ot.value},style:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[s("h2",{style:{color:"var(--color-text-secondary)",marginBottom:0},children:["Scene Groups (",r.length,")"]}),s("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:ot.value?"Collapse":"Expand"})]}),ot.value&&s("div",{style:{marginTop:"1rem"},children:r.map(l=>s(wc,{group:l},l.name))})]}),s(Qe,{left:s("span",{style:{fontSize:"0.875rem"},children:[e.length," item(s) selected for enhancement",n&&s("span",{style:{color:"var(--color-primary)",marginLeft:"0.5rem"},children:"(includes overrides)"})]}),right:s("div",{style:{display:"flex",gap:"0.75rem"},children:[s("button",{class:"outline",onClick:Gr,children:"Back to Upload"}),s("button",{class:"primary",onClick:yc,disabled:e.length===0,children:["Confirm Selection (",e.length,")"]})]})})]})}const mn=[{id:1,label:"Upload",steps:["upload"]},{id:2,label:"Select",steps:["selecting","review-selection"]},{id:3,label:"Enhance",steps:["enhancing","review-enhanced"]},{id:4,label:"Group",steps:["group-posts"]},{id:5,label:"Download",steps:["publish"]},{id:6,label:"Caption",steps:["description"]}];function Qo(e){return mn.findIndex(t=>t.steps.includes(e))}const es=X(()=>Qo(P.value)),bc=X(()=>{const e=[...De.value.map(t=>Qo(t)),es.value].filter(t=>t>=0);return Math.max(...e,0)}),xc={display:"flex",alignItems:"center",gap:"0",marginBottom:"1.5rem",padding:"0.75rem 1rem",background:"var(--color-surface)",borderRadius:"var(--radius-lg)",border:"1px solid var(--color-border)",overflowX:"auto",flexWrap:"wrap",justifyContent:"center"};function Cc(e){const t={display:"flex",alignItems:"center",gap:"0.375rem",padding:"0.5rem 1rem",borderRadius:"999px",fontSize:"0.875rem",fontWeight:"600",letterSpacing:"0.02em",whiteSpace:"nowrap",transition:"all 0.2s ease",border:"2px solid transparent"};switch(e){case"completed":return{...t,background:"rgba(81, 207, 102, 0.12)",color:"#51cf66",border:"2px solid rgba(81, 207, 102, 0.25)",cursor:"pointer"};case"current":return{...t,background:"rgba(108, 140, 255, 0.15)",color:"#6c8cff",border:"2px solid rgba(108, 140, 255, 0.4)",cursor:"default"};case"future":return{...t,background:"transparent",color:"var(--color-text-secondary)",opacity:"0.5",cursor:"default"}}}function Tc(e){const t={display:"flex",alignItems:"center",justifyContent:"center",width:"1.75rem",height:"1.75rem",borderRadius:"50%",fontSize:"0.75rem",fontWeight:"700",lineHeight:"1",flexShrink:"0"};switch(e){case"completed":return{...t,background:"#51cf66",color:"#0f1117"};case"current":return{...t,background:"#6c8cff",color:"#ffffff"};case"future":return{...t,background:"var(--color-border)",color:"var(--color-text-secondary)"}}}function Ic(e){return{display:"flex",alignItems:"center",padding:"0 0.25rem",color:e?"rgba(81, 207, 102, 0.5)":"var(--color-border)",fontSize:"1.125rem",flexShrink:"0",userSelect:"none"}}function Ec(){const e=es.value,t=bc.value;return s("nav",{style:xc,"aria-label":"Workflow steps",children:mn.map((r,n)=>{const o=n<e?"completed":n===e?"current":n<=t?"completed":"future",i=o==="completed";function a(){if(!i)return;const l=r.steps[0];Se(l)}return s(G,{children:[s("div",{style:Cc(o),onClick:a,role:i?"button":void 0,tabIndex:i?0:void 0,"aria-current":o==="current"?"step":void 0,onKeyDown:i?l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),a())}:void 0,title:i?`Go back to ${r.label}`:o==="current"?`Currently on ${r.label}`:r.label,children:[s("span",{style:Tc(o),children:o==="completed"&&n<e?"":r.id}),s("span",{children:r.label})]},r.id),n<mn.length-1&&s("span",{style:Ic(n<e),"aria-hidden":"true",children:""})]})})})}const Je=E({}),Be=E(null);function ts(){Je.value={}}async function kc(){if(Be.value===null)try{const e=await cu();Be.value=e.instagramConfigured}catch{Be.value=!1}}function Uc(e,t,r){const n=st(e);Je.value={...Je.value,[e]:{...n,caption:t,hashtags:r}}}function st(e){return Je.value[e]??{jobId:null,status:"idle",phase:"",progress:{completed:0,total:0},instagramPostId:null,error:null,caption:"",hashtags:[]}}function sr(e,t){Je.value={...Je.value,[e]:t}}const Jr=X(()=>M.value.length),kt=X(()=>Object.values(Je.value).filter(e=>e.status==="published").length);function Ac(e){switch(e){case"creating_containers":return"Uploading media to Instagram...";case"processing_videos":return"Processing videos on Instagram...";case"creating_carousel":return"Creating carousel post...";case"publishing":return"Publishing...";case"published":return"Published!";default:return"Preparing..."}}async function Oi(e){const t=D.value;if(!t)return;const r=st(e.id);sr(e.id,{...r,jobId:null,status:"publishing",phase:"pending",progress:{completed:0,total:e.keys.length},instagramPostId:null,error:null});try{const{id:n}=await du({sessionId:t,groupId:e.id,keys:e.keys,caption:r.caption,hashtags:r.hashtags});sr(e.id,{...st(e.id),jobId:n});const o=3e3,i=200;for(let a=0;a<i;a++){await new Promise(d=>setTimeout(d,o));const l=await fu(n,t),f=st(e.id);if(sr(e.id,{...f,jobId:n,status:l.status==="published"?"published":l.status==="error"?"error":"publishing",phase:l.phase,progress:l.progress,instagramPostId:l.instagramPostId??null,error:l.error??null}),l.status==="published"||l.status==="error")break}}catch(n){sr(e.id,{...st(e.id),status:"error",error:n instanceof Error?n.message:"Publish failed"})}}function Dc({group:e}){const t=st(e.id),r=t.status==="idle",n=t.status==="publishing",o=t.status==="published",i=t.status==="error",a=e.keys.slice(0,8).map(p=>Ie.value.find(y=>y.key===p)).filter(p=>p!==void 0),l=e.keys.map(p=>Ie.value.find(y=>y.key===p)).filter(p=>p!==void 0),f=l.filter(p=>p.type==="Photo").length,d=l.filter(p=>p.type==="Video").length,g=t.caption.length>0;return s("div",{class:"card",style:{marginBottom:"0.75rem",border:o?"1px solid var(--color-success)":i?"1px solid var(--color-danger)":"1px solid var(--color-border)"},children:[s("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"1rem",marginBottom:"0.75rem"},children:[s("div",{style:{flex:1},children:[s("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[s("h3",{style:{margin:0,fontSize:"1rem",color:e.label?"var(--color-text)":"var(--color-text-secondary)"},children:e.label||"Untitled group"}),o&&s("span",{style:{fontSize:"0.75rem",padding:"0.125rem 0.375rem",borderRadius:"3px",background:"rgba(108, 200, 108, 0.15)",color:"var(--color-success)",fontWeight:600},children:"Published"})]}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:[e.keys.length," item",e.keys.length!==1?"s":"",f>0&&s(G,{children:["  ",f," photo",f!==1?"s":""]}),d>0&&s(G,{children:["  ",d," video",d!==1?"s":""]})]})]}),s("div",{style:{display:"flex",gap:"2px",flexShrink:0},children:[a.map(p=>s("div",{style:{width:"2.5rem",height:"2.5rem",borderRadius:"3px",overflow:"hidden",background:"var(--color-surface-hover)",position:"relative"},children:[s("img",{src:_e(p.thumbnailKey),alt:"",style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:y=>{y.target.style.display="none"}}),p.type==="Video"&&s("span",{style:{position:"absolute",bottom:"1px",right:"1px",fontSize:"0.75rem",background:"rgba(0,0,0,0.6)",color:"#fff",padding:"1px 2px",borderRadius:"2px"},children:"VID"})]},p.key)),e.keys.length>8&&s("div",{style:{width:"2.5rem",height:"2.5rem",borderRadius:"3px",background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:["+",e.keys.length-8]})]})]}),g&&s("div",{style:{padding:"0.5rem 0.75rem",background:"var(--color-bg)",borderRadius:"var(--radius)",border:"1px solid var(--color-border)",fontSize:"0.875rem",lineHeight:"1.5",whiteSpace:"pre-wrap",marginBottom:"0.75rem",maxHeight:"4.5rem",overflow:"hidden",position:"relative"},children:[t.caption.slice(0,200),t.caption.length>200&&s("span",{style:{color:"var(--color-text-secondary)"},children:"..."})]}),!g&&r&&s("div",{style:{padding:"0.5rem 0.75rem",background:"rgba(255, 200, 50, 0.06)",borderRadius:"var(--radius)",border:"1px solid rgba(255, 200, 50, 0.2)",fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.75rem"},children:"No caption set. Generate captions in the Description step first, or publish without a caption."}),t.hashtags.length>0&&s("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem",marginBottom:"0.75rem"},children:[t.hashtags.slice(0,10).map((p,y)=>s("span",{style:{fontSize:"0.75rem",padding:"0.125rem 0.375rem",background:"rgba(108, 140, 255, 0.1)",color:"var(--color-primary)",borderRadius:"3px"},children:["#",p]},`${p}-${y}`)),t.hashtags.length>10&&s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",padding:"0.125rem 0.25rem"},children:["+",t.hashtags.length-10," more"]})]}),n&&s("div",{style:{padding:"0.75rem",background:"rgba(108, 140, 255, 0.06)",borderRadius:"var(--radius)",marginBottom:"0.5rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[s("span",{style:{fontSize:"0.875rem",fontWeight:500},children:Ac(t.phase)}),s("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[s(Bu,{}),s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:[t.progress.completed,"/",t.progress.total]})]})]}),s("div",{style:{height:"4px",background:"var(--color-border)",borderRadius:"2px",overflow:"hidden"},children:s("div",{style:{height:"100%",width:t.progress.total>0?`${t.progress.completed/t.progress.total*100}%`:"0%",background:"var(--color-primary)",borderRadius:"2px",transition:"width 0.3s ease"}})}),s("div",{style:{marginTop:"0.5rem",width:"1.25rem",height:"1.25rem",border:"2px solid var(--color-border)",borderTop:"2px solid var(--color-primary)",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0.5rem auto 0"}}),s("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}),o&&s("div",{style:{padding:"0.75rem",background:"rgba(108, 200, 108, 0.06)",borderRadius:"var(--radius)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s("span",{style:{fontSize:"0.875rem",color:"var(--color-success)",fontWeight:500},children:"Successfully published to Instagram"}),t.instagramPostId&&s("a",{href:`https://www.instagram.com/p/${t.instagramPostId}/`,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"0.875rem",color:"var(--color-primary)",textDecoration:"none",fontWeight:500},children:"View on Instagram"})]}),i&&s("div",{style:{padding:"0.75rem",background:"rgba(255, 107, 107, 0.06)",borderRadius:"var(--radius)",marginBottom:"0.5rem"},children:[s("div",{style:{fontSize:"0.875rem",color:"var(--color-danger)",marginBottom:"0.5rem"},children:t.error}),s("button",{class:"outline",onClick:()=>Oi(e),style:{fontSize:"0.75rem"},children:"Retry"})]}),r&&s("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"0.75rem"},children:[Be.value===!1&&s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Instagram not connected"}),s("button",{class:"primary",onClick:()=>Oi(e),disabled:!Be.value,style:{fontSize:"0.875rem",opacity:Be.value?1:.4,cursor:Be.value?"pointer":"not-allowed"},children:"Publish to Instagram"})]})]})}function Rc(){const e=M.value;return $e(()=>{kc()},[]),s("div",{children:[Be.value===!1&&s("div",{class:"card",style:{marginBottom:"1rem",padding:"0.75rem 1rem",background:"rgba(255, 200, 50, 0.08)",border:"1px solid rgba(255, 200, 50, 0.25)",display:"flex",alignItems:"center",gap:"0.75rem"},children:[s("span",{style:{fontSize:"1.125rem"},children:""}),s("div",{children:[s("div",{style:{fontSize:"0.875rem",fontWeight:500,marginBottom:"0.125rem"},children:"Instagram not connected"}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Publishing is disabled. Provide a long-lived access token and user ID via SSM Parameter Store to enable Instagram publishing."})]})]}),s("div",{class:"card",style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"0.5rem"},children:[s("div",{children:s("span",{style:{fontSize:"0.875rem"},children:[s("strong",{children:Jr.value})," post group",Jr.value!==1?"s":"",kt.value>0&&s(G,{children:["  ",s("span",{style:{color:"var(--color-success)"},children:[kt.value," published"]})]})]})}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Each group is published as an Instagram carousel (or single post for 1 item)."})]}),e.map(t=>s(Dc,{group:t},t.id)),s(Qe,{left:s("div",{style:{display:"flex",gap:"0.5rem"},children:[s("button",{class:"outline",onClick:()=>Le(),children:"Back"}),s("button",{class:"outline",onClick:()=>Se("description"),style:{fontSize:"0.875rem"},children:"Generate Captions"})]}),right:s("span",{style:{fontSize:"0.875rem"},children:kt.value===0?s("span",{style:{color:"var(--color-text-secondary)"},children:"Ready to publish your posts"}):s(G,{children:[s("strong",{style:{color:"var(--color-success)"},children:[kt.value," of ",Jr.value]}),s("span",{style:{color:"var(--color-text-secondary)"},children:[" ","group",kt.value!==1?"s":""," published"]})]})})})]})}const Ae=E(0),H=E({jobId:null,status:"idle",caption:"",hashtags:[],locationTag:"",feedbackRound:0,error:null}),ze=E(""),at=E(!1),Sr=E("idle");function rs(){Ae.value=0,H.value={jobId:null,status:"idle",caption:"",hashtags:[],locationTag:"",feedbackRound:0,error:null},ze.value="",at.value=!1,Sr.value="idle"}const Mn=X(()=>{const e=M.value,t=Ae.value;return t<e.length?e[t]:null}),ns=X(()=>Ae.value<M.value.length-1),Pc=X(()=>M.value.length);async function Ni(){const e=Mn.value,t=D.value;if(!(!e||!t)){H.value={jobId:null,status:"generating",caption:"",hashtags:[],locationTag:"",feedbackRound:0,error:null};try{const{id:r}=await au({sessionId:t,keys:e.keys,groupLabel:e.label,tripContext:pt.value});H.value={...H.value,jobId:r},await is(r,t)}catch(r){H.value={...H.value,status:"error",error:r instanceof Error?r.message:"Generation failed"}}}}async function is(e,t){try{const r=await Ar({fn:()=>lu(e,t),intervalMs:2e3,timeoutMs:6e4,isDone:n=>n.status==="complete"||n.status==="error",onPollError:()=>!0}).promise;r.status==="complete"?H.value={jobId:e,status:"complete",caption:r.caption??"",hashtags:r.hashtags??[],locationTag:r.locationTag??"",feedbackRound:r.feedbackRound,error:null}:H.value={jobId:e,status:"error",caption:"",hashtags:[],locationTag:"",feedbackRound:0,error:r.error??"Generation failed"}}catch(r){const n=r instanceof Error&&r.message==="Polling timed out"?"Generation timed out":r instanceof Error?r.message:"Generation failed";H.value={...H.value,status:"error",error:n}}}async function Fc(){const e=H.value,t=D.value;if(!e.jobId||!t||!ze.value.trim())return;const r=ze.value.trim();ze.value="",H.value={...H.value,status:"generating"};try{await uu(e.jobId,{sessionId:t,feedback:r}),await is(e.jobId,t)}catch(n){H.value={...H.value,status:"error",error:n instanceof Error?n.message:"Feedback failed"}}}function Bc(){const e=H.value,t=e.hashtags.map(n=>`#${n}`).join(" "),r=`${e.caption}

${t}`;navigator.clipboard.writeText(r).then(()=>{Sr.value="copied",setTimeout(()=>{Sr.value="idle"},2e3)})}function Mc(){const e=Mn.value,t=H.value;e&&t.status==="complete"&&Uc(e.id,t.caption,t.hashtags),ns.value?(Ae.value=Ae.value+1,H.value={jobId:null,status:"idle",caption:"",hashtags:[],locationTag:"",feedbackRound:0,error:null},ze.value="",at.value=!1):Se("instagram-publish")}function Oc({group:e}){const t=e.keys.slice(0,8).map(r=>Ie.value.find(n=>n.key===r)).filter(r=>r!==void 0);return s("div",{style:{display:"flex",gap:"4px",overflowX:"auto",padding:"0.5rem 0"},children:[t.map(r=>s("div",{style:{width:"3.5rem",height:"3.5rem",borderRadius:"var(--radius)",overflow:"hidden",flexShrink:0,background:"var(--color-surface-hover)",position:"relative"},children:[s("img",{src:_e(r.thumbnailKey),alt:r.filename,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:n=>{n.target.style.display="none"}}),r.type==="Video"&&s("span",{style:{position:"absolute",bottom:"2px",right:"2px",fontSize:"0.75rem",background:"rgba(0,0,0,0.6)",color:"#fff",padding:"1px 3px",borderRadius:"2px"},children:"VID"})]},r.key)),e.keys.length>8&&s("div",{style:{width:"3.5rem",height:"3.5rem",borderRadius:"var(--radius)",background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",color:"var(--color-text-secondary)",flexShrink:0},children:["+",e.keys.length-8]})]})}function Nc({hashtags:e,onRemove:t}){return s("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.375rem"},children:e.map((r,n)=>s("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",fontSize:"0.75rem",background:"rgba(108, 140, 255, 0.1)",color:"var(--color-primary)",borderRadius:"var(--radius)",cursor:"pointer",transition:"background 0.15s"},onClick:()=>t(n),title:"Click to remove",children:["#",r,s("span",{style:{fontSize:"0.75rem",opacity:.6,marginLeft:"0.125rem"},children:"x"})]},`${r}-${n}`))})}function zc(){const e=Mn.value,t=H.value,r=M.value;return $e(()=>{e&&t.status==="idle"&&Ni()},[Ae.value]),e?s("div",{children:[r.length>1&&s("div",{class:"card",style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s("span",{style:{fontSize:"0.875rem"},children:["Post"," ",s("strong",{children:[Ae.value+1," of ",Pc.value]})]}),s("div",{style:{display:"flex",gap:"4px"},children:r.map((n,o)=>s("div",{style:{width:"1.5rem",height:"4px",borderRadius:"2px",background:o<Ae.value?"var(--color-success)":o===Ae.value?"var(--color-primary)":"var(--color-border)"}},o))})]}),s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("h3",{style:{margin:"0 0 0.5rem",fontSize:"1rem",color:e.label?"var(--color-text)":"var(--color-text-secondary)"},children:e.label||"Untitled group"}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.5rem"},children:[e.keys.length," item",e.keys.length!==1?"s":""," in this post"]}),s(Oc,{group:e})]}),t.status==="generating"&&s("div",{style:{marginBottom:"1rem"},children:s(Dr,{title:"Generating Caption",description:"Analyzing your media and crafting an engaging Instagram caption",sessionId:D.value??void 0,jobId:t.jobId??void 0,pollIntervalMs:2e3})}),t.status==="error"&&s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:t.error}),s("button",{class:"primary",onClick:()=>Ni(),children:"Try Again"})]}),t.status==="complete"&&s(G,{children:[s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},children:[s("h3",{style:{margin:0,fontSize:"1rem"},children:"Caption"}),s("div",{style:{display:"flex",gap:"0.5rem"},children:[t.feedbackRound>0&&s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",padding:"0.125rem 0.375rem",background:"var(--color-surface-hover)",borderRadius:"3px"},children:["v",t.feedbackRound+1]}),s("button",{class:"outline",style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem"},onClick:()=>{at.value=!at.value},children:at.value?"Done":"Edit"})]})]}),at.value?s("textarea",{value:t.caption,onInput:n=>{H.value={...H.value,caption:n.target.value}},style:{width:"100%",minHeight:"8rem",padding:"0.75rem",fontSize:"0.875rem",lineHeight:"1.5",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",background:"var(--color-bg)",color:"var(--color-text)",resize:"vertical",fontFamily:"inherit"}}):s("div",{style:{padding:"0.75rem",background:"var(--color-bg)",borderRadius:"var(--radius)",border:"1px solid var(--color-border)",fontSize:"0.875rem",lineHeight:"1.6",whiteSpace:"pre-wrap"},children:t.caption})]}),t.locationTag&&s("div",{class:"card",style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:"Location:"}),s("span",{style:{fontSize:"0.875rem",fontWeight:500,color:"var(--color-primary)"},children:t.locationTag})]}),s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("h3",{style:{margin:"0 0 0.75rem",fontSize:"1rem"},children:["Hashtags",s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",fontWeight:400,marginLeft:"0.5rem"},children:["(",t.hashtags.length,")"]})]}),s(Nc,{hashtags:t.hashtags,onRemove:n=>{H.value={...H.value,hashtags:t.hashtags.filter((o,i)=>i!==n)}}}),s("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Click a hashtag to remove it"})]}),s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("h3",{style:{margin:"0 0 0.5rem",fontSize:"1rem"},children:"Want changes?"}),s("div",{style:{display:"flex",gap:"0.5rem",alignItems:"flex-end"},children:[s("textarea",{value:ze.value,onInput:n=>{ze.value=n.target.value},placeholder:'e.g., "make it shorter", "more casual", "add more food hashtags"',style:{flex:1,minHeight:"3rem",maxHeight:"6rem",padding:"0.5rem 0.75rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",background:"var(--color-bg)",color:"var(--color-text)",resize:"vertical",fontFamily:"inherit"}}),s("button",{class:"primary",disabled:!ze.value.trim(),onClick:()=>Fc(),style:{fontSize:"0.875rem",flexShrink:0},children:"Regenerate"})]})]})]}),s(Qe,{left:s("button",{class:"outline",onClick:()=>Le(),children:"Back"}),right:s("div",{style:{display:"flex",gap:"0.5rem"},children:t.status==="complete"&&s(G,{children:[s("button",{class:"outline",onClick:()=>Bc(),style:{fontSize:"0.875rem"},children:Sr.value==="copied"?"Copied!":"Copy to Clipboard"}),s("button",{class:"primary",onClick:()=>Mc(),style:{fontSize:"0.875rem"},children:ns.value?"Accept & Next Group":"Done"})]})})})]}):s("div",{class:"card",style:{textAlign:"center",padding:"2rem"},children:[s("p",{style:{color:"var(--color-text-secondary)"},children:"No post groups to generate descriptions for."}),s("button",{class:"outline",onClick:()=>Le(),children:"Back"})]})}function Ge(e){return e.key??e.path}function $c(e){return e.thumbnailUrl?e.thumbnailUrl:e.key?_e(e.key):_e(e.path)}function zi({item:e,selectable:t,isSelected:r,onToggle:n}){return s("div",{onClick:t?n:void 0,style:{background:r?"rgba(255, 107, 107, 0.1)":"var(--color-bg)",border:r?"2px solid var(--color-danger)":"2px solid transparent",borderRadius:"var(--radius)",overflow:"hidden",cursor:t?"pointer":"default"},children:[s("div",{onClick:o=>{o.stopPropagation(),Vt(Ge(e),He(e.filename)?"Video":"Photo",e.filename)},style:{width:"100%",aspectRatio:"1",background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"zoom-in"},children:[He(e.filename)?null:s("img",{src:$c(e),alt:e.filename,title:e.filename,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover"},onError:o=>{const i=o.target;i.style.display="none";const a=i.nextElementSibling;a&&(a.style.display="flex")}}),s("div",{style:{display:He(e.filename)?"flex":"none",position:"absolute",inset:0,flexDirection:"column",alignItems:"center",justifyContent:"center",color:"var(--color-text-secondary)",gap:"0.5rem"},children:[s("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:He(e.filename)?s("path",{d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}):s("path",{d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),s("span",{style:{fontSize:"0.75rem"},children:He(e.filename)?e.filename:"No preview"})]}),He(e.filename)&&s("div",{style:{position:"absolute",bottom:"0.5rem",right:"0.5rem",background:"rgba(0,0,0,0.65)",borderRadius:"4px",padding:"0.25rem 0.4rem",display:"flex",alignItems:"center",gap:"0.25rem",color:"#fff",fontSize:"0.75rem",pointerEvents:"none"},children:[s("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:s("polygon",{points:"6,4 20,12 6,20"})}),"Video"]}),t&&s("input",{type:"checkbox",checked:r,onClick:o=>o.stopPropagation(),onChange:n,style:{position:"absolute",top:"0.5rem",left:"0.5rem",width:"1.25rem",height:"1.25rem"}})]}),s("div",{style:{padding:"0.5rem"},children:[s("div",{title:e.filename,style:{fontSize:"0.75rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.filename}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginTop:"0.25rem"},children:e.reason})]})]})}const J=E(null),ve=E(new Set),br=E(!1),Fe=E(null),Ye=E(null);function Lc(e){const t=D.value??void 0,{promise:r,abort:n}=Ar({fn:()=>Po(e,t),intervalMs:2e3,timeoutMs:900*1e3,immediate:!0,isDone:o=>o.status==="complete"||o.status==="error",onPoll:o=>{J.value=o},onPollError:o=>(Ye.value=o instanceof Error?o.message:"Failed to poll results",!1)});return r.then(o=>{Jt("results"),o.discard&&o.discard.length>0&&(ve.value=new Set(o.discard.map(i=>Ge(i))))}).catch(o=>{o instanceof Error&&o.message==="Polling timed out"&&(Ye.value="Processing is taking too long. Please try again or check your connection.",J.value={id:e,status:"error",error:"Processing timed out after 15 minutes",keep:[],discard:[]})}),n}function jc(e){const t=new Set(ve.value);t.has(e)?t.delete(e):t.add(e),ve.value=t}function Kc(){if(!J.value)return;const e=J.value.discard??[];ve.value=new Set(e.map(t=>Ge(t)))}function Hc(){ve.value=new Set}async function Vc(){if(ge.value){br.value=!0;try{const e=Array.from(ve.value),t=ce?{deleteKeys:e,sessionId:D.value}:{deletePaths:e},r=await eu(ge.value,t);Fe.value=r}catch(e){Ye.value=e instanceof Error?e.message:"Failed to confirm deletion"}finally{br.value=!1}}}function Yr(){J.value=null,ve.value=new Set,Fe.value=null,Ye.value=null,ge.value=null,Re.value=[],D.value=null,yn()}function qc(){J.value=null,ve.value=new Set,Fe.value=null,Ye.value=null,ge.value=null,Re.value=[],D.value=null,Le()}function Wc(){var r,n,o,i,a;if($e(()=>{if(ge.value&&!J.value)return Lc(ge.value)},[]),Fe.value)return s("div",{class:"card",style:{textAlign:"center"},children:[s("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:Fe.value.errors.length===0?"Done":"Completed with errors"}),s("p",{children:["Deleted ",Fe.value.deleted," file(s)",!ce,"."]}),Fe.value.errors.length>0&&s("div",{style:{color:"var(--color-danger)",marginTop:"1rem",fontSize:"0.875rem"},children:Fe.value.errors.map(l=>s("div",{children:l},l))}),s("button",{class:"primary",onClick:Yr,style:{marginTop:"1.5rem"},children:"Start Over"})]});if(!J.value||J.value.status==="pending"||J.value.status==="processing"){const l=(r=J.value)==null?void 0:r.phase;let f="Analyzing Media with AI",d="Evaluating each media file for quality, duplicates, and content issues",g=((n=J.value)==null?void 0:n.status)??"pending";l==="uploading"?(f="Uploading Media to Gemini",d="Preparing and uploading each media file to the Gemini API for analysis",g="uploading"):l==="gemini_processing"?(f="Processing Videos",d="Gemini is processing uploaded video files  this may take a moment",g="processing videos"):l==="analyzing"&&(f="Analyzing Media with AI",d="Sending query to Gemini and waiting for the AI to evaluate your media",g="analyzing");const p=l==="uploading"&&((o=J.value)==null?void 0:o.totalFiles)!=null&&J.value.totalFiles>0;return s(Dr,{title:f,description:d,status:g,jobId:ge.value??void 0,sessionId:D.value??void 0,pollIntervalMs:2e3,fileCount:Re.value.length,completedCount:p?((i=J.value)==null?void 0:i.uploadedFiles)??0:void 0,totalCount:p?(a=J.value)==null?void 0:a.totalFiles:void 0,onCancel:Yr})}if(J.value.status==="error")return s("div",{class:"card",children:[s("p",{style:{color:"var(--color-danger)"},children:["Triage failed: ",J.value.error]}),s("button",{class:"outline",onClick:Yr,style:{marginTop:"1rem"},children:"Start Over"})]});const e=J.value.keep??[],t=J.value.discard??[];return s("div",{children:[Ye.value&&s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:Ye.value}),s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[s("h2",{style:{color:"var(--color-danger)"},children:["Discard (",t.length,")"]}),s("div",{style:{display:"flex",gap:"0.5rem"},children:[s("button",{class:"outline",onClick:Kc,children:"Select all"}),s("button",{class:"outline",onClick:Hc,children:"Deselect all"})]})]}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(var(--grid-card-md), 1fr))",gap:"0.75rem"},children:t.map(l=>s(zi,{item:l,selectable:!0,isSelected:ve.value.has(Ge(l)),onToggle:()=>jc(Ge(l))},Ge(l)))})]}),s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("h2",{style:{color:"var(--color-success)",marginBottom:"1rem"},children:["Keep (",e.length,")"]}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(var(--grid-card-md), 1fr))",gap:"0.75rem"},children:e.map(l=>s(zi,{item:l,selectable:!1,isSelected:!1},Ge(l)))})]}),s(Qe,{left:s("span",{style:{fontSize:"0.875rem"},children:[ve.value.size," of ",t.length," marked for deletion"]}),right:s("div",{style:{display:"flex",gap:"0.75rem"},children:[s("button",{class:"outline",onClick:qc,children:"Back"}),s("button",{class:"danger",onClick:Vc,disabled:ve.value.size===0||br.value,children:br.value?"Deleting...":`Delete ${ve.value.size} file(s)`})]})})]})}const os={landing:"/","triage-upload":"/triage/upload",processing:"/triage/processing",results:"/triage/results",upload:"/select/upload",selecting:"/select/ai","review-selection":"/select/review",enhancing:"/select/enhance","review-enhanced":"/select/enhanced","group-posts":"/select/groups",publish:"/select/download",description:"/select/description","instagram-publish":"/select/publish"},ss={};for(const[e,t]of Object.entries(os))ss[t]=e;const Gc=new Set(["triage-upload","processing","results","selecting","review-selection","enhancing","review-enhanced","group-posts","publish","description","instagram-publish"]);function Jc(e){return e==="landing"?null:e==="triage-upload"||e==="processing"||e==="results"||e==="browse"||e==="confirm-files"?"triage":"selection"}function Gt(e,t){const r=os[e];if(r===void 0)return;let n=r;t&&Gc.has(e)&&(n+=`?session=${encodeURIComponent(t)}`),window.location.pathname+window.location.search!==n&&history.pushState({step:e},"",n)}function $i(){const e=window.location.pathname,t=new URLSearchParams(window.location.search),r=ss[e];return r?{step:r,workflow:Jc(r),sessionId:t.get("session")}:null}function Yc(){const e=$i();e&&e.step!=="landing"&&(P.value=e.step,Ze.value=e.workflow,e.sessionId&&(D.value=e.sessionId)),window.addEventListener("popstate",()=>{const t=$i();t&&(P.value=t.step,Ze.value=t.workflow,t.sessionId&&(D.value=t.sessionId),De.value=[])})}const Zc="image/jpeg,image/png,image/gif,image/webp,image/heic,image/heif,video/mp4,video/quicktime,video/x-msvideo,video/webm,video/x-matroska",A=E([]),ht=E(null),xr=E(!1),Cr=E(!1),Tr=E(0);let Nt=null,Zr=0,Xr=0;function Li(){return A.value.reduce((e,t)=>e+t.loaded,0)}function Xc(){Nt||(Zr=Li(),Xr=performance.now(),Nt=setInterval(()=>{const e=performance.now(),t=Li(),r=(e-Xr)/1e3;r>0&&(Tr.value=(t-Zr)/r),Zr=t,Xr=e,A.value.some(n=>n.status==="uploading")||On()},1e3))}function On(){Nt&&(clearInterval(Nt),Nt=null),Tr.value=0}function Qc(){return crypto.randomUUID()}function ed(e){const t=e.target;!t.files||t.files.length===0||(as(Array.from(t.files)),t.value="")}async function td(e){if(e.preventDefault(),e.stopPropagation(),!e.dataTransfer)return;const t=await qo(e.dataTransfer);t.length>0&&as(t)}function rd(e){e.preventDefault(),e.stopPropagation()}function as(e){D.value||(D.value=Qc(),Gt(P.value,D.value));const t=D.value,r=new Set(A.value.map(i=>i.name)),n=[],o=new Map;for(const i of e)r.has(i.name)||(r.add(i.name),n.push({name:i.name,size:i.size,key:`${t}/${i.name}`,status:"pending",progress:0,loaded:0}),o.set(i.name,i));if(n.length!==0){if(A.value=[...A.value,...n],!xr.value)xr.value=!0,od(t,A.value.length);else{const i=ge.value;i&&Ro({sessionId:t,jobId:i,expectedFileCount:A.value.length}).catch(a=>console.error("Failed to update file count:",a))}for(const i of n)nd(t,i.name,o.get(i.name))}}async function nd(e,t,r){Ut(t,{status:"uploading",progress:0,loaded:0}),Xc();try{let n;if(r.size>Uo)n=await Ao(e,r,(o,i)=>{Ut(t,{progress:Math.round(o/i*100),loaded:o})});else{const o=await Eo(e,t,r.type);n=o.key,await ko(o.uploadUrl,r,(i,a)=>{Ut(t,{progress:Math.round(i/a*100),loaded:i})})}Ut(t,{status:"done",progress:100,loaded:r.size,key:n})}catch(n){Ut(t,{status:"error",error:n instanceof Error?n.message:"Upload failed"})}}function Ut(e,t){A.value=A.value.map(r=>r.name===e?{...r,...t}:r)}function id(e){A.value=A.value.filter(t=>t.name!==e)}async function od(e,t){try{const r=await Ql({sessionId:e,expectedFileCount:t});ge.value=r.id,Cr.value=!0,sd(r.id,e)}catch(r){ht.value=r instanceof Error?r.message:"Failed to initialize triage"}}async function sd(e,t){for(;Cr.value;){try{const r=await Po(e,t),n=A.value.length>0&&A.value.every(o=>o.status==="done"||o.status==="error");if(r.status!=="pending"&&n){const o=A.value.filter(a=>a.status==="done");A.value.filter(a=>a.status==="error").length>0&&o.length>0&&await Ro({sessionId:t,jobId:e,expectedFileCount:o.length}).catch(a=>console.error("Failed to update expected file count:",a)),Cr.value=!1,Re.value=o.map(a=>a.key),Se("processing");return}}catch{}await new Promise(r=>setTimeout(r,2e3))}}function ad(){A.value=[],D.value=null,On()}function ld(){A.value=[],ht.value=null,xr.value=!1,Cr.value=!1,On()}async function ud(){const e=A.value.filter(r=>r.status==="done").map(r=>r.key);if(e.length===0)return;const t=D.value;if(t){ht.value=null,Re.value=e;try{const r=await Do({sessionId:t});ge.value=r.id,Se("processing")}catch(r){ht.value=r instanceof Error?r.message:"Failed to start triage"}}}function cd(){const e=A.value.length>0&&A.value.every(i=>i.status==="done"||i.status==="error"),t=A.value.filter(i=>i.status==="done").length,r=A.value.some(i=>i.status==="uploading"),n=A.value.length,o=n>0?Math.round(A.value.reduce((i,a)=>i+a.progress,0)/n):0;return s("div",{class:"card",children:[s("p",{style:{color:"var(--color-text-secondary)",fontSize:"0.875rem",marginBottom:"1.5rem"},children:"Upload media files for AI triage analysis. Drag and drop or use the button below."}),s("div",{onDrop:td,onDragOver:rd,style:{border:"2px dashed var(--color-border)",borderRadius:"var(--radius)",padding:A.value.length>0?"1rem":"2rem",textAlign:"center",marginBottom:"1.5rem",cursor:"pointer",transition:"border-color 0.2s, padding 0.2s"},onClick:()=>{var i;return(i=document.getElementById("file-input"))==null?void 0:i.click()},children:[s("input",{id:"file-input",type:"file",multiple:!0,accept:Zc,onChange:ed,style:{display:"none"}}),s("div",{style:{fontSize:A.value.length>0?"0.875rem":"1.25rem",marginBottom:A.value.length>0?"0":"0.5rem",color:"var(--color-text-secondary)"},children:A.value.length>0?"Drop more files here":"Drop files here"}),A.value.length===0&&s("div",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:"or click to browse  JPEG, PNG, GIF, WebP, HEIC, MP4, MOV"})]}),A.value.length>0&&s("div",{class:"file-list",children:A.value.map(i=>s("div",{class:"file-row",children:[s("span",{style:{fontSize:"1.125rem",flexShrink:0,width:"1.5rem",textAlign:"center",opacity:.6},children:""}),s("span",{style:{flex:1,fontSize:"0.875rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:i.name,children:i.name}),s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",flexShrink:0,fontVariantNumeric:"tabular-nums"},children:i.status==="uploading"?`${lt(i.loaded)} / ${lt(i.size)}`:lt(i.size)}),s("span",{class:Wo(i.status),style:i.status==="uploading"?{background:`linear-gradient(to right, rgba(108, 140, 255, 0.3) ${i.progress}%, rgba(108, 140, 255, 0.1) ${i.progress}%)`}:void 0,title:i.status==="error"?i.error||"Upload failed":void 0,children:Go(i.status,i.progress)}),s("button",{class:"btn-remove",onClick:()=>id(i.name),disabled:i.status==="uploading",title:"Remove file",children:""}),i.status==="uploading"&&s("div",{class:"file-progress-bar",style:{width:`${i.progress}%`}})]},i.name))}),r&&s("div",{style:{marginBottom:"1rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.375rem"},children:[s("span",{children:["Uploading ",t," of ",n," files..."]}),s("span",{style:{fontVariantNumeric:"tabular-nums"},children:[Tr.value>0&&s("span",{style:{marginRight:"0.5rem"},children:pu(Tr.value)}),o,"%"]})]}),s("div",{style:{height:"4px",background:"var(--color-border)",borderRadius:"2px",overflow:"hidden"},children:s("div",{style:{height:"100%",width:`${o}%`,background:"var(--color-primary)",transition:"width 0.3s ease",borderRadius:"2px"}})})]}),ht.value&&s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:ht.value}),A.value.length===0&&s("p",{style:{color:"var(--color-text-secondary)",padding:"2rem 1rem",textAlign:"center",fontSize:"0.875rem"},children:"No files selected yet. Drag and drop media files or click the drop zone above."}),A.value.length>0&&s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"0.75rem"},children:[s("button",{class:"btn-add-more",onClick:()=>{var i;return(i=document.getElementById("file-input"))==null?void 0:i.click()},children:"+ Add more Files"}),s("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[s("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:[t,"/",n," uploaded"]}),s("button",{class:"outline",onClick:ad,disabled:r,children:"Clear all"}),xr.value?s("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:"Triage will start automatically"}):s("button",{class:"primary",onClick:ud,disabled:!e||t===0,children:"Continue to Triage"})]})]})]})}const Ze=E(null),P=E("landing"),Re=E([]),ge=E(null),D=E(null),pt=E(""),De=E([]),dr=[{steps:["upload"],invalidationKey:"upload"},{steps:["selecting","review-selection"],invalidationKey:"selection"},{steps:["enhancing","review-enhanced"],invalidationKey:"enhancement"},{steps:["group-posts"],invalidationKey:"grouping"},{steps:["publish"],invalidationKey:"download"},{steps:["description"],invalidationKey:"description"},{steps:["instagram-publish"],invalidationKey:"publish"}];function dd(e){return dr.findIndex(t=>t.steps.includes(e))}function Jt(e){P.value=e,Gt(e,D.value)}function Se(e){De.value=[...De.value,P.value],P.value=e,Gt(e,D.value)}function Le(){const e=De.value;if(e.length===0)return;const t=e[e.length-1];De.value=e.slice(0,-1),P.value=t,Gt(t,D.value)}async function ls(e){const t=D.value;if(!t)return;hu({sessionId:t,fromStep:e}).catch(o=>{console.warn("Backend invalidation failed (non-blocking):",o)});const r={selection:Zo,enhancement:Ho,grouping:Mo,download:$o,description:rs,publish:ts},n=dr.findIndex(o=>o.invalidationKey===e);if(n>=0){for(const i of dr.slice(n)){const a=r[i.invalidationKey];a&&a()}const o=new Set(dr.slice(n).flatMap(i=>i.steps));De.value=De.value.filter(i=>!o.has(i))}}const ji=X(()=>Ze.value==="triage"?"Media Triage":(Ze.value==="selection","Media Tools")),fd=X(()=>{switch(P.value){case"landing":return"Choose a Tool";case"browse":return"Select Media";case"confirm-files":return"Confirm Selection";case"triage-upload":return"Upload Media";case"processing":return"Processing...";case"results":return"Triage Results";case"upload":return"Upload Media";case"selecting":return"AI Selection";case"review-selection":return"Review Selection";case"enhancing":return"Enhancement";case"review-enhanced":return"Review Enhanced";case"group-posts":return"Group into Posts";case"publish":return"Publish or Download";case"description":return"Post Description";case"instagram-publish":return"Publish to Instagram"}});function yn(){Ze.value=null,P.value="landing",De.value=[],Re.value=[],ge.value=null,D.value=null,pt.value="",Zo(),Ho(),Mo(),$o(),rs(),ts(),ld(),Gt("landing")}const Ki=X(()=>Ze.value==="selection"&&dd(P.value)>=0),ar=X(()=>P.value==="landing");function hd(){return hn.value?s("div",{style:{textAlign:"center",padding:"4rem 0"},children:s("p",{style:{color:"var(--color-text-secondary)"},children:"Loading..."})}):Kt()&&!Ue.value?s("div",{children:[s("header",{style:{marginBottom:"2rem"},children:s("h1",{children:ji.value})}),s(Wu,{})]}):s("div",{children:[s("header",{style:{marginBottom:Ki.value?"1rem":"2rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s("div",{children:[s("h1",{onClick:ar.value?void 0:yn,style:{cursor:ar.value?"default":"pointer"},title:ar.value?void 0:"Back to Home",children:ji.value}),s("p",{style:{color:"var(--color-text-secondary)"},children:fd.value})]}),s("div",{style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[!ar.value&&s("button",{class:"outline text-sm",onClick:yn,children:"Home"}),Kt()&&s("button",{class:"outline text-sm",onClick:()=>ql(),children:"Sign Out"})]})]}),P.value==="landing"&&ce&&s(Vu,{}),Ki.value&&s(Ec,{}),P.value==="browse"&&!ce,P.value==="confirm-files"&&s(hc,{}),P.value==="triage-upload"&&ce&&s(cd,{}),(P.value==="processing"||P.value==="results")&&s(Wc,{}),P.value==="upload"&&ce&&s(uc,{}),(P.value==="selecting"||P.value==="review-selection")&&ce&&s(Sc,{}),(P.value==="enhancing"||P.value==="review-enhanced")&&ce&&s(Ku,{}),P.value==="group-posts"&&ce&&s(Au,{}),P.value==="publish"&&ce&&s(Pu,{}),P.value==="description"&&ce&&s(zc,{}),P.value==="instagram-publish"&&ce&&s(Rc,{}),s(Ou,{})]})}Hl().then(()=>{Yc(),Is(s(hd,{}),document.getElementById("app"))});
