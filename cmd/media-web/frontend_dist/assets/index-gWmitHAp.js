(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();var hr,P,xi,Ci,Le,En,Ti,Ii,Ai,nn,Mr,Or,Ut={},Ei=[],Vo=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,pr=Array.isArray;function Ie(e,t){for(var r in t)e[r]=t[r];return e}function on(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function qo(e,t,r){var n,o,i,a={};for(i in t)i=="key"?n=t[i]:i=="ref"?o=t[i]:a[i]=t[i];if(arguments.length>2&&(a.children=arguments.length>3?hr.call(arguments,2):r),typeof e=="function"&&e.defaultProps!=null)for(i in e.defaultProps)a[i]===void 0&&(a[i]=e.defaultProps[i]);return Qt(e,a,n,o,null)}function Qt(e,t,r,n,o){var i={type:e,props:t,key:r,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++xi,__i:-1,__u:0};return o==null&&P.vnode!=null&&P.vnode(i),i}function $(e){return e.children}function xt(e,t){this.props=e,this.context=t}function it(e,t){if(t==null)return e.__?it(e.__,e.__i+1):null;for(var r;t<e.__k.length;t++)if((r=e.__k[t])!=null&&r.__e!=null)return r.__e;return typeof e.type=="function"?it(e):null}function ki(e){var t,r;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((r=e.__k[t])!=null&&r.__e!=null){e.__e=e.__c.base=r.__e;break}return ki(e)}}function kn(e){(!e.__d&&(e.__d=!0)&&Le.push(e)&&!rr.__r++||En!=P.debounceRendering)&&((En=P.debounceRendering)||Ti)(rr)}function rr(){for(var e,t,r,n,o,i,a,l=1;Le.length;)Le.length>l&&Le.sort(Ii),e=Le.shift(),l=Le.length,e.__d&&(r=void 0,n=void 0,o=(n=(t=e).__v).__e,i=[],a=[],t.__P&&((r=Ie({},n)).__v=n.__v+1,P.vnode&&P.vnode(r),sn(t.__P,r,n,t.__n,t.__P.namespaceURI,32&n.__u?[o]:null,i,o??it(n),!!(32&n.__u),a),r.__v=n.__v,r.__.__k[r.__i]=r,Ri(i,r,a),n.__e=n.__=null,r.__e!=o&&ki(r)));rr.__r=0}function Ui(e,t,r,n,o,i,a,l,f,d,m){var v,_,g,w,b,T,C,I=n&&n.__k||Ei,D=t.length;for(f=Wo(r,t,I,f,D),v=0;v<D;v++)(g=r.__k[v])!=null&&(_=g.__i==-1?Ut:I[g.__i]||Ut,g.__i=v,T=sn(e,g,_,o,i,a,l,f,d,m),w=g.__e,g.ref&&_.ref!=g.ref&&(_.ref&&an(_.ref,null,g),m.push(g.ref,g.__c||w,g)),b==null&&w!=null&&(b=w),(C=!!(4&g.__u))||_.__k===g.__k?f=Di(g,f,e,C):typeof g.type=="function"&&T!==void 0?f=T:w&&(f=w.nextSibling),g.__u&=-7);return r.__e=b,f}function Wo(e,t,r,n,o){var i,a,l,f,d,m=r.length,v=m,_=0;for(e.__k=new Array(o),i=0;i<o;i++)(a=t[i])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=e.__k[i]=Qt(null,a,null,null,null):pr(a)?a=e.__k[i]=Qt($,{children:a},null,null,null):a.constructor===void 0&&a.__b>0?a=e.__k[i]=Qt(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):e.__k[i]=a,f=i+_,a.__=e,a.__b=e.__b+1,l=null,(d=a.__i=Go(a,r,f,v))!=-1&&(v--,(l=r[d])&&(l.__u|=2)),l==null||l.__v==null?(d==-1&&(o>m?_--:o<m&&_++),typeof a.type!="function"&&(a.__u|=4)):d!=f&&(d==f-1?_--:d==f+1?_++:(d>f?_--:_++,a.__u|=4))):e.__k[i]=null;if(v)for(i=0;i<m;i++)(l=r[i])!=null&&(2&l.__u)==0&&(l.__e==n&&(n=it(l)),Fi(l,l));return n}function Di(e,t,r,n){var o,i;if(typeof e.type=="function"){for(o=e.__k,i=0;o&&i<o.length;i++)o[i]&&(o[i].__=e,t=Di(o[i],t,r,n));return t}e.__e!=t&&(n&&(t&&e.type&&!t.parentNode&&(t=it(e)),r.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Go(e,t,r,n){var o,i,a,l=e.key,f=e.type,d=t[r],m=d!=null&&(2&d.__u)==0;if(d===null&&l==null||m&&l==d.key&&f==d.type)return r;if(n>(m?1:0)){for(o=r-1,i=r+1;o>=0||i<t.length;)if((d=t[a=o>=0?o--:i++])!=null&&(2&d.__u)==0&&l==d.key&&f==d.type)return a}return-1}function Un(e,t,r){t[0]=="-"?e.setProperty(t,r??""):e[t]=r==null?"":typeof r!="number"||Vo.test(t)?r:r+"px"}function Wt(e,t,r,n,o){var i,a;e:if(t=="style")if(typeof r=="string")e.style.cssText=r;else{if(typeof n=="string"&&(e.style.cssText=n=""),n)for(t in n)r&&t in r||Un(e.style,t,"");if(r)for(t in r)n&&r[t]==n[t]||Un(e.style,t,r[t])}else if(t[0]=="o"&&t[1]=="n")i=t!=(t=t.replace(Ai,"$1")),a=t.toLowerCase(),t=a in e||t=="onFocusOut"||t=="onFocusIn"?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=r,r?n?r.u=n.u:(r.u=nn,e.addEventListener(t,i?Or:Mr,i)):e.removeEventListener(t,i?Or:Mr,i);else{if(o=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&r==1?"":r))}}function Dn(e){return function(t){if(this.l){var r=this.l[t.type+e];if(t.t==null)t.t=nn++;else if(t.t<r.u)return;return r(P.event?P.event(t):t)}}}function sn(e,t,r,n,o,i,a,l,f,d){var m,v,_,g,w,b,T,C,I,D,B,M,ae,De,ne,W,pe,X=t.type;if(t.constructor!==void 0)return null;128&r.__u&&(f=!!(32&r.__u),i=[l=t.__e=r.__e]),(m=P.__b)&&m(t);e:if(typeof X=="function")try{if(C=t.props,I="prototype"in X&&X.prototype.render,D=(m=X.contextType)&&n[m.__c],B=m?D?D.props.value:m.__:n,r.__c?T=(v=t.__c=r.__c).__=v.__E:(I?t.__c=v=new X(C,B):(t.__c=v=new xt(C,B),v.constructor=X,v.render=Yo),D&&D.sub(v),v.state||(v.state={}),v.__n=n,_=v.__d=!0,v.__h=[],v._sb=[]),I&&v.__s==null&&(v.__s=v.state),I&&X.getDerivedStateFromProps!=null&&(v.__s==v.state&&(v.__s=Ie({},v.__s)),Ie(v.__s,X.getDerivedStateFromProps(C,v.__s))),g=v.props,w=v.state,v.__v=t,_)I&&X.getDerivedStateFromProps==null&&v.componentWillMount!=null&&v.componentWillMount(),I&&v.componentDidMount!=null&&v.__h.push(v.componentDidMount);else{if(I&&X.getDerivedStateFromProps==null&&C!==g&&v.componentWillReceiveProps!=null&&v.componentWillReceiveProps(C,B),t.__v==r.__v||!v.__e&&v.shouldComponentUpdate!=null&&v.shouldComponentUpdate(C,v.__s,B)===!1){for(t.__v!=r.__v&&(v.props=C,v.state=v.__s,v.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.some(function(ue){ue&&(ue.__=t)}),M=0;M<v._sb.length;M++)v.__h.push(v._sb[M]);v._sb=[],v.__h.length&&a.push(v);break e}v.componentWillUpdate!=null&&v.componentWillUpdate(C,v.__s,B),I&&v.componentDidUpdate!=null&&v.__h.push(function(){v.componentDidUpdate(g,w,b)})}if(v.context=B,v.props=C,v.__P=e,v.__e=!1,ae=P.__r,De=0,I){for(v.state=v.__s,v.__d=!1,ae&&ae(t),m=v.render(v.props,v.state,v.context),ne=0;ne<v._sb.length;ne++)v.__h.push(v._sb[ne]);v._sb=[]}else do v.__d=!1,ae&&ae(t),m=v.render(v.props,v.state,v.context),v.state=v.__s;while(v.__d&&++De<25);v.state=v.__s,v.getChildContext!=null&&(n=Ie(Ie({},n),v.getChildContext())),I&&!_&&v.getSnapshotBeforeUpdate!=null&&(b=v.getSnapshotBeforeUpdate(g,w)),W=m,m!=null&&m.type===$&&m.key==null&&(W=Pi(m.props.children)),l=Ui(e,pr(W)?W:[W],t,r,n,o,i,a,l,f,d),v.base=t.__e,t.__u&=-161,v.__h.length&&a.push(v),T&&(v.__E=v.__=null)}catch(ue){if(t.__v=null,f||i!=null)if(ue.then){for(t.__u|=f?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;i[i.indexOf(l)]=null,t.__e=l}else{for(pe=i.length;pe--;)on(i[pe]);Nr(t)}else t.__e=r.__e,t.__k=r.__k,ue.then||Nr(t);P.__e(ue,t,r)}else i==null&&t.__v==r.__v?(t.__k=r.__k,t.__e=r.__e):l=t.__e=Jo(r.__e,t,r,n,o,i,a,f,d);return(m=P.diffed)&&m(t),128&t.__u?void 0:l}function Nr(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Nr)}function Ri(e,t,r){for(var n=0;n<r.length;n++)an(r[n],r[++n],r[++n]);P.__c&&P.__c(t,e),e.some(function(o){try{e=o.__h,o.__h=[],e.some(function(i){i.call(o)})}catch(i){P.__e(i,o.__v)}})}function Pi(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:pr(e)?e.map(Pi):Ie({},e)}function Jo(e,t,r,n,o,i,a,l,f){var d,m,v,_,g,w,b,T=r.props||Ut,C=t.props,I=t.type;if(I=="svg"?o="http://www.w3.org/2000/svg":I=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),i!=null){for(d=0;d<i.length;d++)if((g=i[d])&&"setAttribute"in g==!!I&&(I?g.localName==I:g.nodeType==3)){e=g,i[d]=null;break}}if(e==null){if(I==null)return document.createTextNode(C);e=document.createElementNS(o,I,C.is&&C),l&&(P.__m&&P.__m(t,i),l=!1),i=null}if(I==null)T===C||l&&e.data==C||(e.data=C);else{if(i=i&&hr.call(e.childNodes),!l&&i!=null)for(T={},d=0;d<e.attributes.length;d++)T[(g=e.attributes[d]).name]=g.value;for(d in T)if(g=T[d],d!="children"){if(d=="dangerouslySetInnerHTML")v=g;else if(!(d in C)){if(d=="value"&&"defaultValue"in C||d=="checked"&&"defaultChecked"in C)continue;Wt(e,d,null,g,o)}}for(d in C)g=C[d],d=="children"?_=g:d=="dangerouslySetInnerHTML"?m=g:d=="value"?w=g:d=="checked"?b=g:l&&typeof g!="function"||T[d]===g||Wt(e,d,g,T[d],o);if(m)l||v&&(m.__html==v.__html||m.__html==e.innerHTML)||(e.innerHTML=m.__html),t.__k=[];else if(v&&(e.innerHTML=""),Ui(t.type=="template"?e.content:e,pr(_)?_:[_],t,r,n,I=="foreignObject"?"http://www.w3.org/1999/xhtml":o,i,a,i?i[0]:r.__k&&it(r,0),l,f),i!=null)for(d=i.length;d--;)on(i[d]);l||(d="value",I=="progress"&&w==null?e.removeAttribute("value"):w!=null&&(w!==e[d]||I=="progress"&&!w||I=="option"&&w!=T[d])&&Wt(e,d,w,T[d],o),d="checked",b!=null&&b!=e[d]&&Wt(e,d,b,T[d],o))}return e}function an(e,t,r){try{if(typeof e=="function"){var n=typeof e.__u=="function";n&&e.__u(),n&&t==null||(e.__u=e(t))}else e.current=t}catch(o){P.__e(o,r)}}function Fi(e,t,r){var n,o;if(P.unmount&&P.unmount(e),(n=e.ref)&&(n.current&&n.current!=e.__e||an(n,null,t)),(n=e.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(i){P.__e(i,t)}n.base=n.__P=null}if(n=e.__k)for(o=0;o<n.length;o++)n[o]&&Fi(n[o],t,r||typeof e.type!="function");r||on(e.__e),e.__c=e.__=e.__e=void 0}function Yo(e,t,r){return this.constructor(e,r)}function Zo(e,t,r){var n,o,i,a;t==document&&(t=document.documentElement),P.__&&P.__(e,t),o=(n=!1)?null:t.__k,i=[],a=[],sn(t,e=t.__k=qo($,null,[e]),o||Ut,Ut,t.namespaceURI,o?null:t.firstChild?hr.call(t.childNodes):null,i,o?o.__e:t.firstChild,n,a),Ri(i,e,a)}hr=Ei.slice,P={__e:function(e,t,r,n){for(var o,i,a;t=t.__;)if((o=t.__c)&&!o.__)try{if((i=o.constructor)&&i.getDerivedStateFromError!=null&&(o.setState(i.getDerivedStateFromError(e)),a=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(e,n||{}),a=o.__d),a)return o.__E=o}catch(l){e=l}throw e}},xi=0,Ci=function(e){return e!=null&&e.constructor===void 0},xt.prototype.setState=function(e,t){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Ie({},this.state),typeof e=="function"&&(e=e(Ie({},r),this.props)),e&&Ie(r,e),e!=null&&this.__v&&(t&&this._sb.push(t),kn(this))},xt.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),kn(this))},xt.prototype.render=$,Le=[],Ti=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ii=function(e,t){return e.__v.__b-t.__v.__b},rr.__r=0,Ai=/(PointerCapture)$|Capture$/i,nn=0,Mr=Dn(!1),Or=Dn(!0);var Xo=0;function s(e,t,r,n,o,i){t||(t={});var a,l,f=t;if("ref"in f)for(l in f={},t)l=="ref"?a=t[l]:f[l]=t[l];var d={type:e,props:f,key:r,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Xo,__i:-1,__u:0,__source:o,__self:i};if(typeof e=="function"&&(a=e.defaultProps))for(l in a)f[l]===void 0&&(f[l]=a[l]);return P.vnode&&P.vnode(d),d}var nr,se,wr,Rn,zr=0,Bi=[],q=P,Pn=q.__b,Fn=q.__r,Bn=q.diffed,Mn=q.__c,On=q.unmount,Nn=q.__;function Mi(e,t){q.__h&&q.__h(se,e,zr||t),zr=0;var r=se.__H||(se.__H={__:[],__h:[]});return e>=r.__.length&&r.__.push({}),r.__[e]}function qe(e,t){var r=Mi(nr++,3);!q.__s&&Oi(r.__H,t)&&(r.__=e,r.u=t,se.__H.__h.push(r))}function Qo(e){return zr=5,ln(function(){return{current:e}},[])}function ln(e,t){var r=Mi(nr++,7);return Oi(r.__H,t)&&(r.__=e(),r.__H=t,r.__h=e),r.__}function es(){for(var e;e=Bi.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(er),e.__H.__h.forEach(Lr),e.__H.__h=[]}catch(t){e.__H.__h=[],q.__e(t,e.__v)}}q.__b=function(e){se=null,Pn&&Pn(e)},q.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Nn&&Nn(e,t)},q.__r=function(e){Fn&&Fn(e),nr=0;var t=(se=e.__c).__H;t&&(wr===se?(t.__h=[],se.__h=[],t.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(t.__h.forEach(er),t.__h.forEach(Lr),t.__h=[],nr=0)),wr=se},q.diffed=function(e){Bn&&Bn(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Bi.push(t)!==1&&Rn===q.requestAnimationFrame||((Rn=q.requestAnimationFrame)||ts)(es)),t.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),wr=se=null},q.__c=function(e,t){t.some(function(r){try{r.__h.forEach(er),r.__h=r.__h.filter(function(n){return!n.__||Lr(n)})}catch(n){t.some(function(o){o.__h&&(o.__h=[])}),t=[],q.__e(n,r.__v)}}),Mn&&Mn(e,t)},q.unmount=function(e){On&&On(e);var t,r=e.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{er(n)}catch(o){t=o}}),r.__H=void 0,t&&q.__e(t,r.__v))};var zn=typeof requestAnimationFrame=="function";function ts(e){var t,r=function(){clearTimeout(n),zn&&cancelAnimationFrame(t),setTimeout(e)},n=setTimeout(r,35);zn&&(t=requestAnimationFrame(r))}function er(e){var t=se,r=e.__c;typeof r=="function"&&(e.__c=void 0,r()),se=t}function Lr(e){var t=se;e.__c=e.__(),se=t}function Oi(e,t){return!e||e.length!==t.length||t.some(function(r,n){return r!==e[n]})}var rs=Symbol.for("preact-signals");function vr(){if(Pe>1)Pe--;else{for(var e,t=!1;Ct!==void 0;){var r=Ct;for(Ct=void 0,$r++;r!==void 0;){var n=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&Li(r))try{r.c()}catch(o){t||(e=o,t=!0)}r=n}}if($r=0,Pe--,t)throw e}}function ns(e){if(Pe>0)return e();Pe++;try{return e()}finally{vr()}}var R=void 0;function Ni(e){var t=R;R=void 0;try{return e()}finally{R=t}}var Ct=void 0,Pe=0,$r=0,ir=0;function zi(e){if(R!==void 0){var t=e.n;if(t===void 0||t.t!==R)return t={i:0,S:e,p:R.s,n:void 0,t:R,e:void 0,x:void 0,r:t},R.s!==void 0&&(R.s.n=t),R.s=t,e.n=t,32&R.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=R.s,t.n=void 0,R.s.n=t,R.s=t),t}}function ee(e,t){this.v=e,this.i=0,this.n=void 0,this.t=void 0,this.W=t==null?void 0:t.watched,this.Z=t==null?void 0:t.unwatched,this.name=t==null?void 0:t.name}ee.prototype.brand=rs;ee.prototype.h=function(){return!0};ee.prototype.S=function(e){var t=this,r=this.t;r!==e&&e.e===void 0&&(e.x=r,this.t=e,r!==void 0?r.e=e:Ni(function(){var n;(n=t.W)==null||n.call(t)}))};ee.prototype.U=function(e){var t=this;if(this.t!==void 0){var r=e.e,n=e.x;r!==void 0&&(r.x=n,e.e=void 0),n!==void 0&&(n.e=r,e.x=void 0),e===this.t&&(this.t=n,n===void 0&&Ni(function(){var o;(o=t.Z)==null||o.call(t)}))}};ee.prototype.subscribe=function(e){var t=this;return Lt(function(){var r=t.value,n=R;R=void 0;try{e(r)}finally{R=n}},{name:"sub"})};ee.prototype.valueOf=function(){return this.value};ee.prototype.toString=function(){return this.value+""};ee.prototype.toJSON=function(){return this.value};ee.prototype.peek=function(){var e=R;R=void 0;try{return this.value}finally{R=e}};Object.defineProperty(ee.prototype,"value",{get:function(){var e=zi(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if($r>100)throw new Error("Cycle detected");this.v=e,this.i++,ir++,Pe++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{vr()}}}});function E(e,t){return new ee(e,t)}function Li(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function $i(e){for(var t=e.s;t!==void 0;t=t.n){var r=t.S.n;if(r!==void 0&&(t.r=r),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function Ki(e){for(var t=e.s,r=void 0;t!==void 0;){var n=t.p;t.i===-1?(t.S.U(t),n!==void 0&&(n.n=t.n),t.n!==void 0&&(t.n.p=n)):r=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=n}e.s=r}function Je(e,t){ee.call(this,void 0),this.x=e,this.s=void 0,this.g=ir-1,this.f=4,this.W=t==null?void 0:t.watched,this.Z=t==null?void 0:t.unwatched,this.name=t==null?void 0:t.name}Je.prototype=new ee;Je.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===ir))return!0;if(this.g=ir,this.f|=1,this.i>0&&!Li(this))return this.f&=-2,!0;var e=R;try{$i(this),R=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return R=e,Ki(this),this.f&=-2,!0};Je.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}ee.prototype.S.call(this,e)};Je.prototype.U=function(e){if(this.t!==void 0&&(ee.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};Je.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}};Object.defineProperty(Je.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var e=zi(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function Y(e,t){return new Je(e,t)}function ji(e){var t=e.u;if(e.u=void 0,typeof t=="function"){Pe++;var r=R;R=void 0;try{t()}catch(n){throw e.f&=-2,e.f|=8,cn(e),n}finally{R=r,vr()}}}function cn(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,ji(e)}function is(e){if(R!==this)throw new Error("Out-of-order effect");Ki(this),R=e,this.f&=-2,8&this.f&&cn(this),vr()}function at(e,t){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=t==null?void 0:t.name}at.prototype.c=function(){var e=this.S();try{if(8&this.f||this.x===void 0)return;var t=this.x();typeof t=="function"&&(this.u=t)}finally{e()}};at.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,ji(this),$i(this),Pe++;var e=R;return R=this,is.bind(this,e)};at.prototype.N=function(){2&this.f||(this.f|=2,this.o=Ct,Ct=this)};at.prototype.d=function(){this.f|=8,1&this.f||cn(this)};at.prototype.dispose=function(){this.d()};function Lt(e,t){var r=new at(e,t);try{r.c()}catch(o){throw r.d(),o}var n=r.d.bind(r);return n[Symbol.dispose]=n,n}var Hi,Sr,os=typeof window<"u"&&!!window.__PREACT_SIGNALS_DEVTOOLS__,Vi=[];Lt(function(){Hi=this.N})();function lt(e,t){P[e]=t.bind(null,P[e]||function(){})}function or(e){Sr&&Sr(),Sr=e&&e.S()}function qi(e){var t=this,r=e.data,n=as(r);n.value=r;var o=ln(function(){for(var l=t,f=t.__v;f=f.__;)if(f.__c){f.__c.__$f|=4;break}var d=Y(function(){var g=n.value.value;return g===0?0:g===!0?"":g||""}),m=Y(function(){return!Array.isArray(d.value)&&!Ci(d.value)}),v=Lt(function(){if(this.N=Wi,m.value){var g=d.value;l.__v&&l.__v.__e&&l.__v.__e.nodeType===3&&(l.__v.__e.data=g)}}),_=t.__$u.d;return t.__$u.d=function(){v(),_.call(this)},[m,d]},[]),i=o[0],a=o[1];return i.value?a.peek():a.value}qi.displayName="ReactiveTextNode";Object.defineProperties(ee.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:qi},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});lt("__b",function(e,t){if(typeof t.type=="string"){var r,n=t.props;for(var o in n)if(o!=="children"){var i=n[o];i instanceof ee&&(r||(t.__np=r={}),r[o]=i,n[o]=i.peek())}}e(t)});lt("__r",function(e,t){if(t.type!==$){or();var r,n=t.__c;n&&(n.__$f&=-2,(r=n.__$u)===void 0&&(n.__$u=r=(function(o,i){var a;return Lt(function(){a=this},{name:i}),a.c=o,a})(function(){var o;os&&((o=r.y)==null||o.call(r)),n.__$f|=1,n.setState({})},typeof t.type=="function"?t.type.displayName||t.type.name:""))),or(r)}e(t)});lt("__e",function(e,t,r,n){or(),e(t,r,n)});lt("diffed",function(e,t){or();var r;if(typeof t.type=="string"&&(r=t.__e)){var n=t.__np,o=t.props;if(n){var i=r.U;if(i)for(var a in i){var l=i[a];l!==void 0&&!(a in n)&&(l.d(),i[a]=void 0)}else i={},r.U=i;for(var f in n){var d=i[f],m=n[f];d===void 0?(d=ss(r,f,m,o),i[f]=d):d.o(m,o)}}}e(t)});function ss(e,t,r,n){var o=t in e&&e.ownerSVGElement===void 0,i=E(r);return{o:function(a,l){i.value=a,n=l},d:Lt(function(){this.N=Wi;var a=i.value.value;n[t]!==a&&(n[t]=a,o?e[t]=a:a!=null&&(a!==!1||t[4]==="-")?e.setAttribute(t,a):e.removeAttribute(t))})}}lt("unmount",function(e,t){if(typeof t.type=="string"){var r=t.__e;if(r){var n=r.U;if(n){r.U=void 0;for(var o in n){var i=n[o];i&&i.d()}}}}else{var a=t.__c;if(a){var l=a.__$u;l&&(a.__$u=void 0,l.d())}}e(t)});lt("__h",function(e,t,r,n){(n<3||n===9)&&(t.__$f|=2),e(t,r,n)});xt.prototype.shouldComponentUpdate=function(e,t){if(this.__R)return!0;var r=this.__$u,n=r&&r.s!==void 0;for(var o in t)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){var i=2&this.__$f;if(!(n||i||4&this.__$f)||1&this.__$f)return!0}else if(!(n||4&this.__$f)||3&this.__$f)return!0;for(var a in e)if(a!=="__source"&&e[a]!==this.props[a])return!0;for(var l in this.props)if(!(l in e))return!0;return!1};function as(e,t){return ln(function(){return E(e,t)},[])}var ls=function(e){queueMicrotask(function(){queueMicrotask(e)})};function cs(){ns(function(){for(var e;e=Vi.shift();)Hi.call(e)})}function Wi(){Vi.push(this)===1&&(P.requestAnimationFrame||ls)(cs)}/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var us=(function(){function e(r){var n=r||{},o=n.ValidationData,i=n.Username,a=n.Password,l=n.AuthParameters,f=n.ClientMetadata;this.validationData=o||{},this.authParameters=l||{},this.clientMetadata=f||{},this.username=i,this.password=a}var t=e.prototype;return t.getUsername=function(){return this.username},t.getPassword=function(){return this.password},t.getValidationData=function(){return this.validationData},t.getAuthParameters=function(){return this.authParameters},t.getClientMetadata=function(){return this.clientMetadata},e})(),Ln=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function un(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}),r}var br={},ht={},$n;function ds(){if($n)return ht;$n=1,ht.byteLength=l,ht.toByteArray=d,ht.fromByteArray=_;for(var e=[],t=[],r=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,i=n.length;o<i;++o)e[o]=n[o],t[n.charCodeAt(o)]=o;t[45]=62,t[95]=63;function a(g){var w=g.length;if(w%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var b=g.indexOf("=");b===-1&&(b=w);var T=b===w?0:4-b%4;return[b,T]}function l(g){var w=a(g),b=w[0],T=w[1];return(b+T)*3/4-T}function f(g,w,b){return(w+b)*3/4-b}function d(g){var w,b=a(g),T=b[0],C=b[1],I=new r(f(g,T,C)),D=0,B=C>0?T-4:T,M;for(M=0;M<B;M+=4)w=t[g.charCodeAt(M)]<<18|t[g.charCodeAt(M+1)]<<12|t[g.charCodeAt(M+2)]<<6|t[g.charCodeAt(M+3)],I[D++]=w>>16&255,I[D++]=w>>8&255,I[D++]=w&255;return C===2&&(w=t[g.charCodeAt(M)]<<2|t[g.charCodeAt(M+1)]>>4,I[D++]=w&255),C===1&&(w=t[g.charCodeAt(M)]<<10|t[g.charCodeAt(M+1)]<<4|t[g.charCodeAt(M+2)]>>2,I[D++]=w>>8&255,I[D++]=w&255),I}function m(g){return e[g>>18&63]+e[g>>12&63]+e[g>>6&63]+e[g&63]}function v(g,w,b){for(var T,C=[],I=w;I<b;I+=3)T=(g[I]<<16&16711680)+(g[I+1]<<8&65280)+(g[I+2]&255),C.push(m(T));return C.join("")}function _(g){for(var w,b=g.length,T=b%3,C=[],I=16383,D=0,B=b-T;D<B;D+=I)C.push(v(g,D,D+I>B?B:D+I));return T===1?(w=g[b-1],C.push(e[w>>2]+e[w<<4&63]+"==")):T===2&&(w=(g[b-2]<<8)+g[b-1],C.push(e[w>>10]+e[w>>4&63]+e[w<<2&63]+"=")),C.join("")}return ht}var Gt={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var Kn;function fs(){return Kn||(Kn=1,Gt.read=function(e,t,r,n,o){var i,a,l=o*8-n-1,f=(1<<l)-1,d=f>>1,m=-7,v=r?o-1:0,_=r?-1:1,g=e[t+v];for(v+=_,i=g&(1<<-m)-1,g>>=-m,m+=l;m>0;i=i*256+e[t+v],v+=_,m-=8);for(a=i&(1<<-m)-1,i>>=-m,m+=n;m>0;a=a*256+e[t+v],v+=_,m-=8);if(i===0)i=1-d;else{if(i===f)return a?NaN:(g?-1:1)*(1/0);a=a+Math.pow(2,n),i=i-d}return(g?-1:1)*a*Math.pow(2,i-n)},Gt.write=function(e,t,r,n,o,i){var a,l,f,d=i*8-o-1,m=(1<<d)-1,v=m>>1,_=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=n?0:i-1,w=n?1:-1,b=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,a=m):(a=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-a))<1&&(a--,f*=2),a+v>=1?t+=_/f:t+=_*Math.pow(2,1-v),t*f>=2&&(a++,f/=2),a+v>=m?(l=0,a=m):a+v>=1?(l=(t*f-1)*Math.pow(2,o),a=a+v):(l=t*Math.pow(2,v-1)*Math.pow(2,o),a=0));o>=8;e[r+g]=l&255,g+=w,l/=256,o-=8);for(a=a<<o|l,d+=o;d>0;e[r+g]=a&255,g+=w,a/=256,d-=8);e[r+g-w]|=b*128}),Gt}var xr,jn;function hs(){if(jn)return xr;jn=1;var e={}.toString;return xr=Array.isArray||function(t){return e.call(t)=="[object Array]"},xr}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var Hn;function ps(){return Hn||(Hn=1,(function(e){var t=ds(),r=fs(),n=hs();e.Buffer=l,e.SlowBuffer=C,e.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=Ln.TYPED_ARRAY_SUPPORT!==void 0?Ln.TYPED_ARRAY_SUPPORT:o(),e.kMaxLength=i();function o(){try{var h=new Uint8Array(1);return h.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},h.foo()===42&&typeof h.subarray=="function"&&h.subarray(1,1).byteLength===0}catch{return!1}}function i(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(h,c){if(i()<c)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(h=new Uint8Array(c),h.__proto__=l.prototype):(h===null&&(h=new l(c)),h.length=c),h}function l(h,c,u){if(!l.TYPED_ARRAY_SUPPORT&&!(this instanceof l))return new l(h,c,u);if(typeof h=="number"){if(typeof c=="string")throw new Error("If encoding is specified then the first argument must be a string");return v(this,h)}return f(this,h,c,u)}l.poolSize=8192,l._augment=function(h){return h.__proto__=l.prototype,h};function f(h,c,u,p){if(typeof c=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&c instanceof ArrayBuffer?w(h,c,u,p):typeof c=="string"?_(h,c,u):b(h,c)}l.from=function(h,c,u){return f(null,h,c,u)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0}));function d(h){if(typeof h!="number")throw new TypeError('"size" argument must be a number');if(h<0)throw new RangeError('"size" argument must not be negative')}function m(h,c,u,p){return d(c),c<=0?a(h,c):u!==void 0?typeof p=="string"?a(h,c).fill(u,p):a(h,c).fill(u):a(h,c)}l.alloc=function(h,c,u){return m(null,h,c,u)};function v(h,c){if(d(c),h=a(h,c<0?0:T(c)|0),!l.TYPED_ARRAY_SUPPORT)for(var u=0;u<c;++u)h[u]=0;return h}l.allocUnsafe=function(h){return v(null,h)},l.allocUnsafeSlow=function(h){return v(null,h)};function _(h,c,u){if((typeof u!="string"||u==="")&&(u="utf8"),!l.isEncoding(u))throw new TypeError('"encoding" must be a valid string encoding');var p=I(c,u)|0;h=a(h,p);var y=h.write(c,u);return y!==p&&(h=h.slice(0,y)),h}function g(h,c){var u=c.length<0?0:T(c.length)|0;h=a(h,u);for(var p=0;p<u;p+=1)h[p]=c[p]&255;return h}function w(h,c,u,p){if(c.byteLength,u<0||c.byteLength<u)throw new RangeError("'offset' is out of bounds");if(c.byteLength<u+(p||0))throw new RangeError("'length' is out of bounds");return u===void 0&&p===void 0?c=new Uint8Array(c):p===void 0?c=new Uint8Array(c,u):c=new Uint8Array(c,u,p),l.TYPED_ARRAY_SUPPORT?(h=c,h.__proto__=l.prototype):h=g(h,c),h}function b(h,c){if(l.isBuffer(c)){var u=T(c.length)|0;return h=a(h,u),h.length===0||c.copy(h,0,0,u),h}if(c){if(typeof ArrayBuffer<"u"&&c.buffer instanceof ArrayBuffer||"length"in c)return typeof c.length!="number"||Ho(c.length)?a(h,0):g(h,c);if(c.type==="Buffer"&&n(c.data))return g(h,c.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function T(h){if(h>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return h|0}function C(h){return+h!=h&&(h=0),l.alloc(+h)}l.isBuffer=function(c){return!!(c!=null&&c._isBuffer)},l.compare=function(c,u){if(!l.isBuffer(c)||!l.isBuffer(u))throw new TypeError("Arguments must be Buffers");if(c===u)return 0;for(var p=c.length,y=u.length,S=0,x=Math.min(p,y);S<x;++S)if(c[S]!==u[S]){p=c[S],y=u[S];break}return p<y?-1:y<p?1:0},l.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(c,u){if(!n(c))throw new TypeError('"list" argument must be an Array of Buffers');if(c.length===0)return l.alloc(0);var p;if(u===void 0)for(u=0,p=0;p<c.length;++p)u+=c[p].length;var y=l.allocUnsafe(u),S=0;for(p=0;p<c.length;++p){var x=c[p];if(!l.isBuffer(x))throw new TypeError('"list" argument must be an Array of Buffers');x.copy(y,S),S+=x.length}return y};function I(h,c){if(l.isBuffer(h))return h.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(h)||h instanceof ArrayBuffer))return h.byteLength;typeof h!="string"&&(h=""+h);var u=h.length;if(u===0)return 0;for(var p=!1;;)switch(c){case"ascii":case"latin1":case"binary":return u;case"utf8":case"utf-8":case void 0:return Ht(h).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u*2;case"hex":return u>>>1;case"base64":return Tn(h).length;default:if(p)return Ht(h).length;c=(""+c).toLowerCase(),p=!0}}l.byteLength=I;function D(h,c,u){var p=!1;if((c===void 0||c<0)&&(c=0),c>this.length||((u===void 0||u>this.length)&&(u=this.length),u<=0)||(u>>>=0,c>>>=0,u<=c))return"";for(h||(h="utf8");;)switch(h){case"hex":return Mo(this,c,u);case"utf8":case"utf-8":return ft(this,c,u);case"ascii":return Fo(this,c,u);case"latin1":case"binary":return Bo(this,c,u);case"base64":return Ye(this,c,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Oo(this,c,u);default:if(p)throw new TypeError("Unknown encoding: "+h);h=(h+"").toLowerCase(),p=!0}}l.prototype._isBuffer=!0;function B(h,c,u){var p=h[c];h[c]=h[u],h[u]=p}l.prototype.swap16=function(){var c=this.length;if(c%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var u=0;u<c;u+=2)B(this,u,u+1);return this},l.prototype.swap32=function(){var c=this.length;if(c%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var u=0;u<c;u+=4)B(this,u,u+3),B(this,u+1,u+2);return this},l.prototype.swap64=function(){var c=this.length;if(c%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var u=0;u<c;u+=8)B(this,u,u+7),B(this,u+1,u+6),B(this,u+2,u+5),B(this,u+3,u+4);return this},l.prototype.toString=function(){var c=this.length|0;return c===0?"":arguments.length===0?ft(this,0,c):D.apply(this,arguments)},l.prototype.equals=function(c){if(!l.isBuffer(c))throw new TypeError("Argument must be a Buffer");return this===c?!0:l.compare(this,c)===0},l.prototype.inspect=function(){var c="",u=e.INSPECT_MAX_BYTES;return this.length>0&&(c=this.toString("hex",0,u).match(/.{2}/g).join(" "),this.length>u&&(c+=" ... ")),"<Buffer "+c+">"},l.prototype.compare=function(c,u,p,y,S){if(!l.isBuffer(c))throw new TypeError("Argument must be a Buffer");if(u===void 0&&(u=0),p===void 0&&(p=c?c.length:0),y===void 0&&(y=0),S===void 0&&(S=this.length),u<0||p>c.length||y<0||S>this.length)throw new RangeError("out of range index");if(y>=S&&u>=p)return 0;if(y>=S)return-1;if(u>=p)return 1;if(u>>>=0,p>>>=0,y>>>=0,S>>>=0,this===c)return 0;for(var x=S-y,k=p-u,O=Math.min(x,k),z=this.slice(y,S),te=c.slice(u,p),K=0;K<O;++K)if(z[K]!==te[K]){x=z[K],k=te[K];break}return x<k?-1:k<x?1:0};function M(h,c,u,p,y){if(h.length===0)return-1;if(typeof u=="string"?(p=u,u=0):u>2147483647?u=2147483647:u<-2147483648&&(u=-2147483648),u=+u,isNaN(u)&&(u=y?0:h.length-1),u<0&&(u=h.length+u),u>=h.length){if(y)return-1;u=h.length-1}else if(u<0)if(y)u=0;else return-1;if(typeof c=="string"&&(c=l.from(c,p)),l.isBuffer(c))return c.length===0?-1:ae(h,c,u,p,y);if(typeof c=="number")return c=c&255,l.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?y?Uint8Array.prototype.indexOf.call(h,c,u):Uint8Array.prototype.lastIndexOf.call(h,c,u):ae(h,[c],u,p,y);throw new TypeError("val must be string, number or Buffer")}function ae(h,c,u,p,y){var S=1,x=h.length,k=c.length;if(p!==void 0&&(p=String(p).toLowerCase(),p==="ucs2"||p==="ucs-2"||p==="utf16le"||p==="utf-16le")){if(h.length<2||c.length<2)return-1;S=2,x/=2,k/=2,u/=2}function O(In,An){return S===1?In[An]:In.readUInt16BE(An*S)}var z;if(y){var te=-1;for(z=u;z<x;z++)if(O(h,z)===O(c,te===-1?0:z-te)){if(te===-1&&(te=z),z-te+1===k)return te*S}else te!==-1&&(z-=z-te),te=-1}else for(u+k>x&&(u=x-k),z=u;z>=0;z--){for(var K=!0,qt=0;qt<k;qt++)if(O(h,z+qt)!==O(c,qt)){K=!1;break}if(K)return z}return-1}l.prototype.includes=function(c,u,p){return this.indexOf(c,u,p)!==-1},l.prototype.indexOf=function(c,u,p){return M(this,c,u,p,!0)},l.prototype.lastIndexOf=function(c,u,p){return M(this,c,u,p,!1)};function De(h,c,u,p){u=Number(u)||0;var y=h.length-u;p?(p=Number(p),p>y&&(p=y)):p=y;var S=c.length;if(S%2!==0)throw new TypeError("Invalid hex string");p>S/2&&(p=S/2);for(var x=0;x<p;++x){var k=parseInt(c.substr(x*2,2),16);if(isNaN(k))return x;h[u+x]=k}return x}function ne(h,c,u,p){return Vt(Ht(c,h.length-u),h,u,p)}function W(h,c,u,p){return Vt(Ko(c),h,u,p)}function pe(h,c,u,p){return W(h,c,u,p)}function X(h,c,u,p){return Vt(Tn(c),h,u,p)}function ue(h,c,u,p){return Vt(jo(c,h.length-u),h,u,p)}l.prototype.write=function(c,u,p,y){if(u===void 0)y="utf8",p=this.length,u=0;else if(p===void 0&&typeof u=="string")y=u,p=this.length,u=0;else if(isFinite(u))u=u|0,isFinite(p)?(p=p|0,y===void 0&&(y="utf8")):(y=p,p=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var S=this.length-u;if((p===void 0||p>S)&&(p=S),c.length>0&&(p<0||u<0)||u>this.length)throw new RangeError("Attempt to write outside buffer bounds");y||(y="utf8");for(var x=!1;;)switch(y){case"hex":return De(this,c,u,p);case"utf8":case"utf-8":return ne(this,c,u,p);case"ascii":return W(this,c,u,p);case"latin1":case"binary":return pe(this,c,u,p);case"base64":return X(this,c,u,p);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ue(this,c,u,p);default:if(x)throw new TypeError("Unknown encoding: "+y);y=(""+y).toLowerCase(),x=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Ye(h,c,u){return c===0&&u===h.length?t.fromByteArray(h):t.fromByteArray(h.slice(c,u))}function ft(h,c,u){u=Math.min(h.length,u);for(var p=[],y=c;y<u;){var S=h[y],x=null,k=S>239?4:S>223?3:S>191?2:1;if(y+k<=u){var O,z,te,K;switch(k){case 1:S<128&&(x=S);break;case 2:O=h[y+1],(O&192)===128&&(K=(S&31)<<6|O&63,K>127&&(x=K));break;case 3:O=h[y+1],z=h[y+2],(O&192)===128&&(z&192)===128&&(K=(S&15)<<12|(O&63)<<6|z&63,K>2047&&(K<55296||K>57343)&&(x=K));break;case 4:O=h[y+1],z=h[y+2],te=h[y+3],(O&192)===128&&(z&192)===128&&(te&192)===128&&(K=(S&15)<<18|(O&63)<<12|(z&63)<<6|te&63,K>65535&&K<1114112&&(x=K))}}x===null?(x=65533,k=1):x>65535&&(x-=65536,p.push(x>>>10&1023|55296),x=56320|x&1023),p.push(x),y+=k}return _r(p)}var Ne=4096;function _r(h){var c=h.length;if(c<=Ne)return String.fromCharCode.apply(String,h);for(var u="",p=0;p<c;)u+=String.fromCharCode.apply(String,h.slice(p,p+=Ne));return u}function Fo(h,c,u){var p="";u=Math.min(h.length,u);for(var y=c;y<u;++y)p+=String.fromCharCode(h[y]&127);return p}function Bo(h,c,u){var p="";u=Math.min(h.length,u);for(var y=c;y<u;++y)p+=String.fromCharCode(h[y]);return p}function Mo(h,c,u){var p=h.length;(!c||c<0)&&(c=0),(!u||u<0||u>p)&&(u=p);for(var y="",S=c;S<u;++S)y+=$o(h[S]);return y}function Oo(h,c,u){for(var p=h.slice(c,u),y="",S=0;S<p.length;S+=2)y+=String.fromCharCode(p[S]+p[S+1]*256);return y}l.prototype.slice=function(c,u){var p=this.length;c=~~c,u=u===void 0?p:~~u,c<0?(c+=p,c<0&&(c=0)):c>p&&(c=p),u<0?(u+=p,u<0&&(u=0)):u>p&&(u=p),u<c&&(u=c);var y;if(l.TYPED_ARRAY_SUPPORT)y=this.subarray(c,u),y.__proto__=l.prototype;else{var S=u-c;y=new l(S,void 0);for(var x=0;x<S;++x)y[x]=this[x+c]}return y};function Z(h,c,u){if(h%1!==0||h<0)throw new RangeError("offset is not uint");if(h+c>u)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUIntLE=function(c,u,p){c=c|0,u=u|0,p||Z(c,u,this.length);for(var y=this[c],S=1,x=0;++x<u&&(S*=256);)y+=this[c+x]*S;return y},l.prototype.readUIntBE=function(c,u,p){c=c|0,u=u|0,p||Z(c,u,this.length);for(var y=this[c+--u],S=1;u>0&&(S*=256);)y+=this[c+--u]*S;return y},l.prototype.readUInt8=function(c,u){return u||Z(c,1,this.length),this[c]},l.prototype.readUInt16LE=function(c,u){return u||Z(c,2,this.length),this[c]|this[c+1]<<8},l.prototype.readUInt16BE=function(c,u){return u||Z(c,2,this.length),this[c]<<8|this[c+1]},l.prototype.readUInt32LE=function(c,u){return u||Z(c,4,this.length),(this[c]|this[c+1]<<8|this[c+2]<<16)+this[c+3]*16777216},l.prototype.readUInt32BE=function(c,u){return u||Z(c,4,this.length),this[c]*16777216+(this[c+1]<<16|this[c+2]<<8|this[c+3])},l.prototype.readIntLE=function(c,u,p){c=c|0,u=u|0,p||Z(c,u,this.length);for(var y=this[c],S=1,x=0;++x<u&&(S*=256);)y+=this[c+x]*S;return S*=128,y>=S&&(y-=Math.pow(2,8*u)),y},l.prototype.readIntBE=function(c,u,p){c=c|0,u=u|0,p||Z(c,u,this.length);for(var y=u,S=1,x=this[c+--y];y>0&&(S*=256);)x+=this[c+--y]*S;return S*=128,x>=S&&(x-=Math.pow(2,8*u)),x},l.prototype.readInt8=function(c,u){return u||Z(c,1,this.length),this[c]&128?(255-this[c]+1)*-1:this[c]},l.prototype.readInt16LE=function(c,u){u||Z(c,2,this.length);var p=this[c]|this[c+1]<<8;return p&32768?p|4294901760:p},l.prototype.readInt16BE=function(c,u){u||Z(c,2,this.length);var p=this[c+1]|this[c]<<8;return p&32768?p|4294901760:p},l.prototype.readInt32LE=function(c,u){return u||Z(c,4,this.length),this[c]|this[c+1]<<8|this[c+2]<<16|this[c+3]<<24},l.prototype.readInt32BE=function(c,u){return u||Z(c,4,this.length),this[c]<<24|this[c+1]<<16|this[c+2]<<8|this[c+3]},l.prototype.readFloatLE=function(c,u){return u||Z(c,4,this.length),r.read(this,c,!0,23,4)},l.prototype.readFloatBE=function(c,u){return u||Z(c,4,this.length),r.read(this,c,!1,23,4)},l.prototype.readDoubleLE=function(c,u){return u||Z(c,8,this.length),r.read(this,c,!0,52,8)},l.prototype.readDoubleBE=function(c,u){return u||Z(c,8,this.length),r.read(this,c,!1,52,8)};function oe(h,c,u,p,y,S){if(!l.isBuffer(h))throw new TypeError('"buffer" argument must be a Buffer instance');if(c>y||c<S)throw new RangeError('"value" argument is out of bounds');if(u+p>h.length)throw new RangeError("Index out of range")}l.prototype.writeUIntLE=function(c,u,p,y){if(c=+c,u=u|0,p=p|0,!y){var S=Math.pow(2,8*p)-1;oe(this,c,u,p,S,0)}var x=1,k=0;for(this[u]=c&255;++k<p&&(x*=256);)this[u+k]=c/x&255;return u+p},l.prototype.writeUIntBE=function(c,u,p,y){if(c=+c,u=u|0,p=p|0,!y){var S=Math.pow(2,8*p)-1;oe(this,c,u,p,S,0)}var x=p-1,k=1;for(this[u+x]=c&255;--x>=0&&(k*=256);)this[u+x]=c/k&255;return u+p},l.prototype.writeUInt8=function(c,u,p){return c=+c,u=u|0,p||oe(this,c,u,1,255,0),l.TYPED_ARRAY_SUPPORT||(c=Math.floor(c)),this[u]=c&255,u+1};function Kt(h,c,u,p){c<0&&(c=65535+c+1);for(var y=0,S=Math.min(h.length-u,2);y<S;++y)h[u+y]=(c&255<<8*(p?y:1-y))>>>(p?y:1-y)*8}l.prototype.writeUInt16LE=function(c,u,p){return c=+c,u=u|0,p||oe(this,c,u,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[u]=c&255,this[u+1]=c>>>8):Kt(this,c,u,!0),u+2},l.prototype.writeUInt16BE=function(c,u,p){return c=+c,u=u|0,p||oe(this,c,u,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[u]=c>>>8,this[u+1]=c&255):Kt(this,c,u,!1),u+2};function jt(h,c,u,p){c<0&&(c=4294967295+c+1);for(var y=0,S=Math.min(h.length-u,4);y<S;++y)h[u+y]=c>>>(p?y:3-y)*8&255}l.prototype.writeUInt32LE=function(c,u,p){return c=+c,u=u|0,p||oe(this,c,u,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[u+3]=c>>>24,this[u+2]=c>>>16,this[u+1]=c>>>8,this[u]=c&255):jt(this,c,u,!0),u+4},l.prototype.writeUInt32BE=function(c,u,p){return c=+c,u=u|0,p||oe(this,c,u,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[u]=c>>>24,this[u+1]=c>>>16,this[u+2]=c>>>8,this[u+3]=c&255):jt(this,c,u,!1),u+4},l.prototype.writeIntLE=function(c,u,p,y){if(c=+c,u=u|0,!y){var S=Math.pow(2,8*p-1);oe(this,c,u,p,S-1,-S)}var x=0,k=1,O=0;for(this[u]=c&255;++x<p&&(k*=256);)c<0&&O===0&&this[u+x-1]!==0&&(O=1),this[u+x]=(c/k>>0)-O&255;return u+p},l.prototype.writeIntBE=function(c,u,p,y){if(c=+c,u=u|0,!y){var S=Math.pow(2,8*p-1);oe(this,c,u,p,S-1,-S)}var x=p-1,k=1,O=0;for(this[u+x]=c&255;--x>=0&&(k*=256);)c<0&&O===0&&this[u+x+1]!==0&&(O=1),this[u+x]=(c/k>>0)-O&255;return u+p},l.prototype.writeInt8=function(c,u,p){return c=+c,u=u|0,p||oe(this,c,u,1,127,-128),l.TYPED_ARRAY_SUPPORT||(c=Math.floor(c)),c<0&&(c=255+c+1),this[u]=c&255,u+1},l.prototype.writeInt16LE=function(c,u,p){return c=+c,u=u|0,p||oe(this,c,u,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[u]=c&255,this[u+1]=c>>>8):Kt(this,c,u,!0),u+2},l.prototype.writeInt16BE=function(c,u,p){return c=+c,u=u|0,p||oe(this,c,u,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[u]=c>>>8,this[u+1]=c&255):Kt(this,c,u,!1),u+2},l.prototype.writeInt32LE=function(c,u,p){return c=+c,u=u|0,p||oe(this,c,u,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[u]=c&255,this[u+1]=c>>>8,this[u+2]=c>>>16,this[u+3]=c>>>24):jt(this,c,u,!0),u+4},l.prototype.writeInt32BE=function(c,u,p){return c=+c,u=u|0,p||oe(this,c,u,4,2147483647,-2147483648),c<0&&(c=4294967295+c+1),l.TYPED_ARRAY_SUPPORT?(this[u]=c>>>24,this[u+1]=c>>>16,this[u+2]=c>>>8,this[u+3]=c&255):jt(this,c,u,!1),u+4};function bn(h,c,u,p,y,S){if(u+p>h.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("Index out of range")}function xn(h,c,u,p,y){return y||bn(h,c,u,4),r.write(h,c,u,p,23,4),u+4}l.prototype.writeFloatLE=function(c,u,p){return xn(this,c,u,!0,p)},l.prototype.writeFloatBE=function(c,u,p){return xn(this,c,u,!1,p)};function Cn(h,c,u,p,y){return y||bn(h,c,u,8),r.write(h,c,u,p,52,8),u+8}l.prototype.writeDoubleLE=function(c,u,p){return Cn(this,c,u,!0,p)},l.prototype.writeDoubleBE=function(c,u,p){return Cn(this,c,u,!1,p)},l.prototype.copy=function(c,u,p,y){if(p||(p=0),!y&&y!==0&&(y=this.length),u>=c.length&&(u=c.length),u||(u=0),y>0&&y<p&&(y=p),y===p||c.length===0||this.length===0)return 0;if(u<0)throw new RangeError("targetStart out of bounds");if(p<0||p>=this.length)throw new RangeError("sourceStart out of bounds");if(y<0)throw new RangeError("sourceEnd out of bounds");y>this.length&&(y=this.length),c.length-u<y-p&&(y=c.length-u+p);var S=y-p,x;if(this===c&&p<u&&u<y)for(x=S-1;x>=0;--x)c[x+u]=this[x+p];else if(S<1e3||!l.TYPED_ARRAY_SUPPORT)for(x=0;x<S;++x)c[x+u]=this[x+p];else Uint8Array.prototype.set.call(c,this.subarray(p,p+S),u);return S},l.prototype.fill=function(c,u,p,y){if(typeof c=="string"){if(typeof u=="string"?(y=u,u=0,p=this.length):typeof p=="string"&&(y=p,p=this.length),c.length===1){var S=c.charCodeAt(0);S<256&&(c=S)}if(y!==void 0&&typeof y!="string")throw new TypeError("encoding must be a string");if(typeof y=="string"&&!l.isEncoding(y))throw new TypeError("Unknown encoding: "+y)}else typeof c=="number"&&(c=c&255);if(u<0||this.length<u||this.length<p)throw new RangeError("Out of range index");if(p<=u)return this;u=u>>>0,p=p===void 0?this.length:p>>>0,c||(c=0);var x;if(typeof c=="number")for(x=u;x<p;++x)this[x]=c;else{var k=l.isBuffer(c)?c:Ht(new l(c,y).toString()),O=k.length;for(x=0;x<p-u;++x)this[x+u]=k[x%O]}return this};var No=/[^+\/0-9A-Za-z-_]/g;function zo(h){if(h=Lo(h).replace(No,""),h.length<2)return"";for(;h.length%4!==0;)h=h+"=";return h}function Lo(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")}function $o(h){return h<16?"0"+h.toString(16):h.toString(16)}function Ht(h,c){c=c||1/0;for(var u,p=h.length,y=null,S=[],x=0;x<p;++x){if(u=h.charCodeAt(x),u>55295&&u<57344){if(!y){if(u>56319){(c-=3)>-1&&S.push(239,191,189);continue}else if(x+1===p){(c-=3)>-1&&S.push(239,191,189);continue}y=u;continue}if(u<56320){(c-=3)>-1&&S.push(239,191,189),y=u;continue}u=(y-55296<<10|u-56320)+65536}else y&&(c-=3)>-1&&S.push(239,191,189);if(y=null,u<128){if((c-=1)<0)break;S.push(u)}else if(u<2048){if((c-=2)<0)break;S.push(u>>6|192,u&63|128)}else if(u<65536){if((c-=3)<0)break;S.push(u>>12|224,u>>6&63|128,u&63|128)}else if(u<1114112){if((c-=4)<0)break;S.push(u>>18|240,u>>12&63|128,u>>6&63|128,u&63|128)}else throw new Error("Invalid code point")}return S}function Ko(h){for(var c=[],u=0;u<h.length;++u)c.push(h.charCodeAt(u)&255);return c}function jo(h,c){for(var u,p,y,S=[],x=0;x<h.length&&!((c-=2)<0);++x)u=h.charCodeAt(x),p=u>>8,y=u%256,S.push(y),S.push(p);return S}function Tn(h){return t.toByteArray(zo(h))}function Vt(h,c,u,p){for(var y=0;y<p&&!(y+u>=c.length||y>=h.length);++y)c[y+u]=h[y];return y}function Ho(h){return h!==h}})(br)),br}var N=ps(),de;typeof window<"u"&&window.crypto&&(de=window.crypto);!de&&typeof window<"u"&&window.msCrypto&&(de=window.msCrypto);!de&&typeof global<"u"&&global.crypto&&(de=global.crypto);if(!de&&typeof require=="function")try{de=require("crypto")}catch{}function vs(){if(de){if(typeof de.getRandomValues=="function")try{return de.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof de.randomBytes=="function")try{return de.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")}function ms(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((i&15).toString(16))}return n.join("")}var gs=(function(){function e(r,n){r=this.words=r||[],n!=null?this.sigBytes=n:this.sigBytes=r.length*4}var t=e.prototype;return t.random=function(n){for(var o=[],i=0;i<n;i+=4)o.push(vs());return new e(o,n)},t.toString=function(){return ms(this)},e})(),Cr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Kr=function(e,t){return Kr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o])},Kr(e,t)};function ys(e,t){Kr(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var jr=function(){return jr=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},jr.apply(this,arguments)};function _s(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r}function ws(e,t,r,n){var o=arguments.length,i=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,t,r,n);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i}function Ss(e,t){return function(r,n){t(r,n,e)}}function bs(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function xs(e,t,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function l(m){try{d(n.next(m))}catch(v){a(v)}}function f(m){try{d(n.throw(m))}catch(v){a(v)}}function d(m){m.done?i(m.value):o(m.value).then(l,f)}d((n=n.apply(e,t||[])).next())})}function Cs(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(d){return function(m){return f([d,m])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=d[0]&2?o.return:d[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,d[1])).done)return i;switch(o=0,i&&(d=[d[0]&2,i.value]),d[0]){case 0:case 1:i=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,o=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){r.label=d[1];break}if(d[0]===6&&r.label<i[1]){r.label=i[1],i=d;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(d);break}i[2]&&r.ops.pop(),r.trys.pop();continue}d=t.call(e,r)}catch(m){d=[6,m],o=0}finally{n=i=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function Ts(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}function Is(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=e[r])}function Hr(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Gi(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],a;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(l){a={error:l}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return i}function As(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Gi(arguments[t]));return e}function Es(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var i=arguments[t],a=0,l=i.length;a<l;a++,o++)n[o]=i[a];return n}function Dt(e){return this instanceof Dt?(this.v=e,this):new Dt(e)}function ks(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,i=[];return o={},a("next"),a("throw"),a("return"),o[Symbol.asyncIterator]=function(){return this},o;function a(_){n[_]&&(o[_]=function(g){return new Promise(function(w,b){i.push([_,g,w,b])>1||l(_,g)})})}function l(_,g){try{f(n[_](g))}catch(w){v(i[0][3],w)}}function f(_){_.value instanceof Dt?Promise.resolve(_.value.v).then(d,m):v(i[0][2],_)}function d(_){l("next",_)}function m(_){l("throw",_)}function v(_,g){_(g),i.shift(),i.length&&l(i[0][0],i[0][1])}}function Us(e){var t,r;return t={},n("next"),n("throw",function(o){throw o}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(o,i){t[o]=e[o]?function(a){return(r=!r)?{value:Dt(e[o](a)),done:o==="return"}:i?i(a):a}:i}}function Ds(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof Hr=="function"?Hr(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(a){return new Promise(function(l,f){a=e[i](a),o(l,f,a.done,a.value)})}}function o(i,a,l,f){Promise.resolve(f).then(function(d){i({value:d,done:l})},a)}}function Rs(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function Ps(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function Fs(e){return e&&e.__esModule?e:{default:e}}function Bs(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function Ms(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r}const Os=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return jr},__asyncDelegator:Us,__asyncGenerator:ks,__asyncValues:Ds,__await:Dt,__awaiter:xs,__classPrivateFieldGet:Bs,__classPrivateFieldSet:Ms,__createBinding:Ts,__decorate:ws,__exportStar:Is,__extends:ys,__generator:Cs,__importDefault:Fs,__importStar:Ps,__makeTemplateObject:Rs,__metadata:bs,__param:Ss,__read:Gi,__rest:_s,__spread:As,__spreadArrays:Es,__values:Hr},Symbol.toStringTag,{value:"Module"})),Ji=un(Os);var pt={},le={},Vn;function Yi(){return Vn||(Vn=1,Object.defineProperty(le,"__esModule",{value:!0}),le.MAX_HASHABLE_LENGTH=le.INIT=le.KEY=le.DIGEST_LENGTH=le.BLOCK_SIZE=void 0,le.BLOCK_SIZE=64,le.DIGEST_LENGTH=32,le.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),le.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],le.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1),le}var vt={},qn;function Ns(){if(qn)return vt;qn=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.RawSha256=void 0;var e=Yi(),t=(function(){function r(){this.state=Int32Array.from(e.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return r.prototype.update=function(n){if(this.finished)throw new Error("Attempted to update an already finished hash.");var o=0,i=n.byteLength;if(this.bytesHashed+=i,this.bytesHashed*8>e.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;i>0;)this.buffer[this.bufferLength++]=n[o++],i--,this.bufferLength===e.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},r.prototype.digest=function(){if(!this.finished){var n=this.bytesHashed*8,o=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),i=this.bufferLength;if(o.setUint8(this.bufferLength++,128),i%e.BLOCK_SIZE>=e.BLOCK_SIZE-8){for(var a=this.bufferLength;a<e.BLOCK_SIZE;a++)o.setUint8(a,0);this.hashBuffer(),this.bufferLength=0}for(var a=this.bufferLength;a<e.BLOCK_SIZE-8;a++)o.setUint8(a,0);o.setUint32(e.BLOCK_SIZE-8,Math.floor(n/4294967296),!0),o.setUint32(e.BLOCK_SIZE-4,n),this.hashBuffer(),this.finished=!0}for(var l=new Uint8Array(e.DIGEST_LENGTH),a=0;a<8;a++)l[a*4]=this.state[a]>>>24&255,l[a*4+1]=this.state[a]>>>16&255,l[a*4+2]=this.state[a]>>>8&255,l[a*4+3]=this.state[a]>>>0&255;return l},r.prototype.hashBuffer=function(){for(var n=this,o=n.buffer,i=n.state,a=i[0],l=i[1],f=i[2],d=i[3],m=i[4],v=i[5],_=i[6],g=i[7],w=0;w<e.BLOCK_SIZE;w++){if(w<16)this.temp[w]=(o[w*4]&255)<<24|(o[w*4+1]&255)<<16|(o[w*4+2]&255)<<8|o[w*4+3]&255;else{var b=this.temp[w-2],T=(b>>>17|b<<15)^(b>>>19|b<<13)^b>>>10;b=this.temp[w-15];var C=(b>>>7|b<<25)^(b>>>18|b<<14)^b>>>3;this.temp[w]=(T+this.temp[w-7]|0)+(C+this.temp[w-16]|0)}var I=(((m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(m&v^~m&_)|0)+(g+(e.KEY[w]+this.temp[w]|0)|0)|0,D=((a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10))+(a&l^a&f^l&f)|0;g=_,_=v,v=m,m=d+I|0,d=f,f=l,l=a,a=I+D|0}i[0]+=a,i[1]+=l,i[2]+=f,i[3]+=d,i[4]+=m,i[5]+=v,i[6]+=_,i[7]+=g},r})();return vt.RawSha256=t,vt}var Tr={},mt={};const zs=e=>{const t=[];for(let r=0,n=e.length;r<n;r++){const o=e.charCodeAt(r);if(o<128)t.push(o);else if(o<2048)t.push(o>>6|192,o&63|128);else if(r+1<e.length&&(o&64512)===55296&&(e.charCodeAt(r+1)&64512)===56320){const i=65536+((o&1023)<<10)+(e.charCodeAt(++r)&1023);t.push(i>>18|240,i>>12&63|128,i>>6&63|128,i&63|128)}else t.push(o>>12|224,o>>6&63|128,o&63|128)}return Uint8Array.from(t)},Ls=e=>{let t="";for(let r=0,n=e.length;r<n;r++){const o=e[r];if(o<128)t+=String.fromCharCode(o);else if(192<=o&&o<224){const i=e[++r];t+=String.fromCharCode((o&31)<<6|i&63)}else if(240<=o&&o<365){const a="%"+[o,e[++r],e[++r],e[++r]].map(l=>l.toString(16)).join("%");t+=decodeURIComponent(a)}else t+=String.fromCharCode((o&15)<<12|(e[++r]&63)<<6|e[++r]&63)}return t};function $s(e){return new TextEncoder().encode(e)}function Ks(e){return new TextDecoder("utf-8").decode(e)}const js=e=>typeof TextEncoder=="function"?$s(e):zs(e),Hs=e=>typeof TextDecoder=="function"?Ks(e):Ls(e),Vs=Object.freeze(Object.defineProperty({__proto__:null,fromUtf8:js,toUtf8:Hs},Symbol.toStringTag,{value:"Module"})),qs=un(Vs);var Wn;function Ws(){if(Wn)return mt;Wn=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.convertToBuffer=void 0;var e=qs,t=typeof Buffer<"u"&&Buffer.from?function(n){return Buffer.from(n,"utf8")}:e.fromUtf8;function r(n){return n instanceof Uint8Array?n:typeof n=="string"?t(n):ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(n)}return mt.convertToBuffer=r,mt}var gt={},Gn;function Gs(){if(Gn)return gt;Gn=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.isEmptyData=void 0;function e(t){return typeof t=="string"?t.length===0:t.byteLength===0}return gt.isEmptyData=e,gt}var yt={},Jn;function Js(){if(Jn)return yt;Jn=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.numToUint8=void 0;function e(t){return new Uint8Array([(t&4278190080)>>24,(t&16711680)>>16,(t&65280)>>8,t&255])}return yt.numToUint8=e,yt}var _t={},Yn;function Ys(){if(Yn)return _t;Yn=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.uint32ArrayFrom=void 0;function e(t){if(!Array.from){for(var r=new Uint32Array(t.length),n=0;n<t.length;)r[n]=t[n];return r}return Uint32Array.from(t)}return _t.uint32ArrayFrom=e,_t}var Zn;function Zs(){return Zn||(Zn=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.uint32ArrayFrom=e.numToUint8=e.isEmptyData=e.convertToBuffer=void 0;var t=Ws();Object.defineProperty(e,"convertToBuffer",{enumerable:!0,get:function(){return t.convertToBuffer}});var r=Gs();Object.defineProperty(e,"isEmptyData",{enumerable:!0,get:function(){return r.isEmptyData}});var n=Js();Object.defineProperty(e,"numToUint8",{enumerable:!0,get:function(){return n.numToUint8}});var o=Ys();Object.defineProperty(e,"uint32ArrayFrom",{enumerable:!0,get:function(){return o.uint32ArrayFrom}})})(Tr)),Tr}var Xn;function Xs(){if(Xn)return pt;Xn=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.Sha256=void 0;var e=Ji,t=Yi(),r=Ns(),n=Zs(),o=(function(){function a(l){if(this.hash=new r.RawSha256,l){this.outer=new r.RawSha256;var f=i(l),d=new Uint8Array(t.BLOCK_SIZE);d.set(f);for(var m=0;m<t.BLOCK_SIZE;m++)f[m]^=54,d[m]^=92;this.hash.update(f),this.outer.update(d);for(var m=0;m<f.byteLength;m++)f[m]=0}}return a.prototype.update=function(l){if(!((0,n.isEmptyData)(l)||this.error))try{this.hash.update((0,n.convertToBuffer)(l))}catch(f){this.error=f}},a.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},a.prototype.digest=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(l){return[2,this.digestSync()]})})},a})();pt.Sha256=o;function i(a){var l=(0,n.convertToBuffer)(a);if(l.byteLength>t.BLOCK_SIZE){var f=new r.RawSha256;f.update(l),l=f.digest()}var d=new Uint8Array(t.BLOCK_SIZE);return d.set(l),d}return pt}var Qn;function Qs(){return Qn||(Qn=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ji;(0,t.__exportStar)(Xs(),e)})(Cr)),Cr}var Tt=Qs();function A(e,t){e!=null&&this.fromString(e,t)}function ie(){return new A(null)}var Fe,ea=0xdeadbeefcafe,ei=(ea&16777215)==15715070;function ta(e,t,r,n,o,i){for(;--i>=0;){var a=t*this[e++]+r[n]+o;o=Math.floor(a/67108864),r[n++]=a&67108863}return o}function ra(e,t,r,n,o,i){for(var a=t&32767,l=t>>15;--i>=0;){var f=this[e]&32767,d=this[e++]>>15,m=l*f+d*a;f=a*f+((m&32767)<<15)+r[n]+(o&1073741823),o=(f>>>30)+(m>>>15)+l*d+(o>>>30),r[n++]=f&1073741823}return o}function na(e,t,r,n,o,i){for(var a=t&16383,l=t>>14;--i>=0;){var f=this[e]&16383,d=this[e++]>>14,m=l*f+d*a;f=a*f+((m&16383)<<14)+r[n]+o,o=(f>>28)+(m>>14)+l*d,r[n++]=f&268435455}return o}var ti=typeof navigator<"u";ti&&ei&&navigator.appName=="Microsoft Internet Explorer"?(A.prototype.am=ra,Fe=30):ti&&ei&&navigator.appName!="Netscape"?(A.prototype.am=ta,Fe=26):(A.prototype.am=na,Fe=28);A.prototype.DB=Fe;A.prototype.DM=(1<<Fe)-1;A.prototype.DV=1<<Fe;var dn=52;A.prototype.FV=Math.pow(2,dn);A.prototype.F1=dn-Fe;A.prototype.F2=2*Fe-dn;var ia="0123456789abcdefghijklmnopqrstuvwxyz",mr=new Array,ct,fe;ct=48;for(fe=0;fe<=9;++fe)mr[ct++]=fe;ct=97;for(fe=10;fe<36;++fe)mr[ct++]=fe;ct=65;for(fe=10;fe<36;++fe)mr[ct++]=fe;function ri(e){return ia.charAt(e)}function oa(e,t){var r=mr[e.charCodeAt(t)];return r??-1}function sa(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function aa(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function fn(e){var t=ie();return t.fromInt(e),t}function la(e,t){var r;if(t==16)r=4;else if(t==8)r=3;else if(t==2)r=1;else if(t==32)r=5;else if(t==4)r=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");this.t=0,this.s=0;for(var n=e.length,o=!1,i=0;--n>=0;){var a=oa(e,n);if(a<0){e.charAt(n)=="-"&&(o=!0);continue}o=!1,i==0?this[this.t++]=a:i+r>this.DB?(this[this.t-1]|=(a&(1<<this.DB-i)-1)<<i,this[this.t++]=a>>this.DB-i):this[this.t-1]|=a<<i,i+=r,i>=this.DB&&(i-=this.DB)}this.clamp(),o&&A.ZERO.subTo(this,this)}function ca(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t}function ua(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(e==16)t=4;else if(e==8)t=3;else if(e==2)t=1;else if(e==32)t=5;else if(e==4)t=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");var r=(1<<t)-1,n,o=!1,i="",a=this.t,l=this.DB-a*this.DB%t;if(a-- >0)for(l<this.DB&&(n=this[a]>>l)>0&&(o=!0,i=ri(n));a>=0;)l<t?(n=(this[a]&(1<<l)-1)<<t-l,n|=this[--a]>>(l+=this.DB-t)):(n=this[a]>>(l-=t)&r,l<=0&&(l+=this.DB,--a)),n>0&&(o=!0),o&&(i+=ri(n));return o?i:"0"}function da(){var e=ie();return A.ZERO.subTo(this,e),e}function fa(){return this.s<0?this.negate():this}function ha(e){var t=this.s-e.s;if(t!=0)return t;var r=this.t;if(t=r-e.t,t!=0)return this.s<0?-t:t;for(;--r>=0;)if((t=this[r]-e[r])!=0)return t;return 0}function hn(e){var t=1,r;return(r=e>>>16)!=0&&(e=r,t+=16),(r=e>>8)!=0&&(e=r,t+=8),(r=e>>4)!=0&&(e=r,t+=4),(r=e>>2)!=0&&(e=r,t+=2),(r=e>>1)!=0&&(e=r,t+=1),t}function pa(){return this.t<=0?0:this.DB*(this.t-1)+hn(this[this.t-1]^this.s&this.DM)}function va(e,t){var r;for(r=this.t-1;r>=0;--r)t[r+e]=this[r];for(r=e-1;r>=0;--r)t[r]=0;t.t=this.t+e,t.s=this.s}function ma(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s}function ga(e,t){var r=e%this.DB,n=this.DB-r,o=(1<<n)-1,i=Math.floor(e/this.DB),a=this.s<<r&this.DM,l;for(l=this.t-1;l>=0;--l)t[l+i+1]=this[l]>>n|a,a=(this[l]&o)<<r;for(l=i-1;l>=0;--l)t[l]=0;t[i]=a,t.t=this.t+i+1,t.s=this.s,t.clamp()}function ya(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t){t.t=0;return}var n=e%this.DB,o=this.DB-n,i=(1<<n)-1;t[0]=this[r]>>n;for(var a=r+1;a<this.t;++a)t[a-r-1]|=(this[a]&i)<<o,t[a-r]=this[a]>>n;n>0&&(t[this.t-r-1]|=(this.s&i)<<o),t.t=this.t-r,t.clamp()}function _a(e,t){for(var r=0,n=0,o=Math.min(e.t,this.t);r<o;)n+=this[r]-e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e[r],t[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t[r++]=this.DV+n:n>0&&(t[r++]=n),t.t=r,t.clamp()}function wa(e,t){var r=this.abs(),n=e.abs(),o=r.t;for(t.t=o+n.t;--o>=0;)t[o]=0;for(o=0;o<n.t;++o)t[o+r.t]=r.am(0,n[o],t,o,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&A.ZERO.subTo(t,t)}function Sa(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()}function ba(e,t,r){var n=e.abs();if(!(n.t<=0)){var o=this.abs();if(o.t<n.t){t!=null&&t.fromInt(0),r!=null&&this.copyTo(r);return}r==null&&(r=ie());var i=ie(),a=this.s,l=e.s,f=this.DB-hn(n[n.t-1]);f>0?(n.lShiftTo(f,i),o.lShiftTo(f,r)):(n.copyTo(i),o.copyTo(r));var d=i.t,m=i[d-1];if(m!=0){var v=m*(1<<this.F1)+(d>1?i[d-2]>>this.F2:0),_=this.FV/v,g=(1<<this.F1)/v,w=1<<this.F2,b=r.t,T=b-d,C=t??ie();for(i.dlShiftTo(T,C),r.compareTo(C)>=0&&(r[r.t++]=1,r.subTo(C,r)),A.ONE.dlShiftTo(d,C),C.subTo(i,i);i.t<d;)i[i.t++]=0;for(;--T>=0;){var I=r[--b]==m?this.DM:Math.floor(r[b]*_+(r[b-1]+w)*g);if((r[b]+=i.am(0,I,r,T,0,d))<I)for(i.dlShiftTo(T,C),r.subTo(C,r);r[b]<--I;)r.subTo(C,r)}t!=null&&(r.drShiftTo(d,t),a!=l&&A.ZERO.subTo(t,t)),r.t=d,r.clamp(),f>0&&r.rShiftTo(f,r),a<0&&A.ZERO.subTo(r,r)}}}function xa(e){var t=ie();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(A.ZERO)>0&&e.subTo(t,t),t}function Ca(){if(this.t<1)return 0;var e=this[0];if((e&1)==0)return 0;var t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function Ta(e){return this.compareTo(e)==0}function Ia(e,t){for(var r=0,n=0,o=Math.min(e.t,this.t);r<o;)n+=this[r]+e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e[r],t[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t[r++]=n:n<-1&&(t[r++]=this.DV+n),t.t=r,t.clamp()}function Aa(e){var t=ie();return this.addTo(e,t),t}function Ea(e){var t=ie();return this.subTo(e,t),t}function ka(e){var t=ie();return this.multiplyTo(e,t),t}function Ua(e){var t=ie();return this.divRemTo(e,t,null),t}function ut(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function Da(e){var t=ie();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(A.ZERO)>0&&this.m.subTo(t,t),t}function Ra(e){var t=ie();return e.copyTo(t),this.reduce(t),t}function Pa(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=e[t]&32767,n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(r=t+this.m.t,e[r]+=this.m.am(0,n,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function Fa(e,t){e.squareTo(t),this.reduce(t)}function Ba(e,t,r){e.multiplyTo(t,r),this.reduce(r)}ut.prototype.convert=Da;ut.prototype.revert=Ra;ut.prototype.reduce=Pa;ut.prototype.mulTo=Ba;ut.prototype.sqrTo=Fa;function Ma(e,t,r){var n=e.bitLength(),o,i=fn(1),a=new ut(t);if(n<=0)return i;n<18?o=1:n<48?o=3:n<144?o=4:n<768?o=5:o=6;var l=new Array,f=3,d=o-1,m=(1<<o)-1;if(l[1]=a.convert(this),o>1){var v=ie();for(a.sqrTo(l[1],v);f<=m;)l[f]=ie(),a.mulTo(v,l[f-2],l[f]),f+=2}var _=e.t-1,g,w=!0,b=ie(),T;for(n=hn(e[_])-1;_>=0;){for(n>=d?g=e[_]>>n-d&m:(g=(e[_]&(1<<n+1)-1)<<d-n,_>0&&(g|=e[_-1]>>this.DB+n-d)),f=o;(g&1)==0;)g>>=1,--f;if((n-=f)<0&&(n+=this.DB,--_),w)l[g].copyTo(i),w=!1;else{for(;f>1;)a.sqrTo(i,b),a.sqrTo(b,i),f-=2;f>0?a.sqrTo(i,b):(T=i,i=b,b=T),a.mulTo(b,l[g],i)}for(;_>=0&&(e[_]&1<<n)==0;)a.sqrTo(i,b),T=i,i=b,b=T,--n<0&&(n=this.DB-1,--_)}var C=a.revert(i);return r(null,C),C}A.prototype.copyTo=sa;A.prototype.fromInt=aa;A.prototype.fromString=la;A.prototype.clamp=ca;A.prototype.dlShiftTo=va;A.prototype.drShiftTo=ma;A.prototype.lShiftTo=ga;A.prototype.rShiftTo=ya;A.prototype.subTo=_a;A.prototype.multiplyTo=wa;A.prototype.squareTo=Sa;A.prototype.divRemTo=ba;A.prototype.invDigit=Ca;A.prototype.addTo=Ia;A.prototype.toString=ua;A.prototype.negate=da;A.prototype.abs=fa;A.prototype.compareTo=ha;A.prototype.bitLength=pa;A.prototype.mod=xa;A.prototype.equals=Ta;A.prototype.add=Aa;A.prototype.subtract=Ea;A.prototype.multiply=ka;A.prototype.divide=Ua;A.prototype.modPow=Ma;A.ZERO=fn(0);A.ONE=fn(1);/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */function Ir(e){return N.Buffer.from(new gs().random(e).toString(),"hex")}var Oa=/^[89a-f]/i,Na="FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",za="userAttributes.",Ze=(function(){function e(r){this.N=new A(Na,16),this.g=new A("2",16),this.k=new A(this.hexHash(""+this.padHex(this.N)+this.padHex(this.g)),16),this.smallAValue=this.generateRandomSmallA(),this.getLargeAValue(function(){}),this.infoBits=N.Buffer.from("Caldera Derived Key","utf8"),this.poolName=r}var t=e.prototype;return t.getSmallAValue=function(){return this.smallAValue},t.getLargeAValue=function(n){var o=this;this.largeAValue?n(null,this.largeAValue):this.calculateA(this.smallAValue,function(i,a){i&&n(i,null),o.largeAValue=a,n(null,o.largeAValue)})},t.generateRandomSmallA=function(){var n=Ir(128).toString("hex"),o=new A(n,16);return o},t.generateRandomString=function(){return Ir(40).toString("base64")},t.getRandomPassword=function(){return this.randomPassword},t.getSaltDevices=function(){return this.SaltToHashDevices},t.getVerifierDevices=function(){return this.verifierDevices},t.generateHashDevice=function(n,o,i){var a=this;this.randomPassword=this.generateRandomString();var l=""+n+o+":"+this.randomPassword,f=this.hash(l),d=Ir(16).toString("hex");this.SaltToHashDevices=this.padHex(new A(d,16)),this.g.modPow(new A(this.hexHash(this.SaltToHashDevices+f),16),this.N,function(m,v){m&&i(m,null),a.verifierDevices=a.padHex(v),i(null,null)})},t.calculateA=function(n,o){var i=this;this.g.modPow(n,this.N,function(a,l){a&&o(a,null),l.mod(i.N).equals(A.ZERO)&&o(new Error("Illegal paramater. A mod N cannot be 0."),null),o(null,l)})},t.calculateU=function(n,o){this.UHexHash=this.hexHash(this.padHex(n)+this.padHex(o));var i=new A(this.UHexHash,16);return i},t.hash=function(n){var o=new Tt.Sha256;o.update(n);var i=o.digestSync(),a=N.Buffer.from(i).toString("hex");return new Array(64-a.length).join("0")+a},t.hexHash=function(n){return this.hash(N.Buffer.from(n,"hex"))},t.computehkdf=function(n,o){var i=N.Buffer.concat([this.infoBits,N.Buffer.from("","utf8")]),a=new Tt.Sha256(o);a.update(n);var l=a.digestSync(),f=new Tt.Sha256(l);f.update(i);var d=f.digestSync(),m=d,v=m.slice(0,16);return v},t.getPasswordAuthenticationKey=function(n,o,i,a,l){var f=this;if(i.mod(this.N).equals(A.ZERO))throw new Error("B cannot be zero.");if(this.UValue=this.calculateU(this.largeAValue,i),this.UValue.equals(A.ZERO))throw new Error("U cannot be zero.");var d=""+this.poolName+n+":"+o,m=this.hash(d),v=new A(this.hexHash(this.padHex(a)+m),16);this.calculateS(v,i,function(_,g){_&&l(_,null);var w=f.computehkdf(N.Buffer.from(f.padHex(g),"hex"),N.Buffer.from(f.padHex(f.UValue),"hex"));l(null,w)})},t.calculateS=function(n,o,i){var a=this;this.g.modPow(n,this.N,function(l,f){l&&i(l,null);var d=o.subtract(a.k.multiply(f));d.modPow(a.smallAValue.add(a.UValue.multiply(n)),a.N,function(m,v){m&&i(m,null),i(null,v.mod(a.N))})})},t.getNewPasswordRequiredChallengeUserAttributePrefix=function(){return za},t.padHex=function(n){if(!(n instanceof A))throw new Error("Not a BigInteger");var o=n.compareTo(A.ZERO)<0,i=n.abs().toString(16);if(i=i.length%2!==0?"0"+i:i,i=Oa.test(i)?"00"+i:i,o){var a=i.split("").map(function(f){var d=~parseInt(f,16)&15;return"0123456789ABCDEF".charAt(d)}).join(""),l=new A(a,16).add(A.ONE);i=l.toString(16),i.toUpperCase().startsWith("FF8")&&(i=i.substring(2))}return i},e})();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var Zi=(function(){function e(r){this.jwtToken=r||"",this.payload=this.decodePayload()}var t=e.prototype;return t.getJwtToken=function(){return this.jwtToken},t.getExpiration=function(){return this.payload.exp},t.getIssuedAt=function(){return this.payload.iat},t.decodePayload=function(){var n=this.jwtToken.split(".")[1];try{return JSON.parse(N.Buffer.from(n,"base64").toString("utf8"))}catch{return{}}},e})();function La(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Vr(e,t)}function Vr(e,t){return Vr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},Vr(e,t)}var ni=(function(e){function t(r){var n=r===void 0?{}:r,o=n.AccessToken;return e.call(this,o||"")||this}return La(t,e),t})(Zi);function $a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,qr(e,t)}function qr(e,t){return qr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},qr(e,t)}var ii=(function(e){function t(r){var n=r===void 0?{}:r,o=n.IdToken;return e.call(this,o||"")||this}return $a(t,e),t})(Zi);/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var oi=(function(){function e(r){var n=r===void 0?{}:r,o=n.RefreshToken;this.token=o||""}var t=e.prototype;return t.getToken=function(){return this.token},e})(),Ka="5.0.4";/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var ja="aws-amplify/"+Ka,Xi={userAgent:ja,isReactNative:typeof navigator<"u"&&navigator.product==="ReactNative"},Ha=function(){return Xi.userAgent};/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var si=(function(){function e(r){var n=r===void 0?{}:r,o=n.IdToken,i=n.RefreshToken,a=n.AccessToken,l=n.ClockDrift;if(a==null||o==null)throw new Error("Id token and Access Token must be present.");this.idToken=o,this.refreshToken=i,this.accessToken=a,this.clockDrift=l===void 0?this.calculateClockDrift():l}var t=e.prototype;return t.getIdToken=function(){return this.idToken},t.getRefreshToken=function(){return this.refreshToken},t.getAccessToken=function(){return this.accessToken},t.getClockDrift=function(){return this.clockDrift},t.calculateClockDrift=function(){var n=Math.floor(new Date/1e3),o=Math.min(this.accessToken.getIssuedAt(),this.idToken.getIssuedAt());return n-o},t.isValid=function(){var n=Math.floor(new Date/1e3),o=n-this.clockDrift;return o<this.accessToken.getExpiration()&&o<this.idToken.getExpiration()},e})();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var Va=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],qa=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ai=(function(){function e(){}var t=e.prototype;return t.getNowString=function(){var n=new Date,o=qa[n.getUTCDay()],i=Va[n.getUTCMonth()],a=n.getUTCDate(),l=n.getUTCHours();l<10&&(l="0"+l);var f=n.getUTCMinutes();f<10&&(f="0"+f);var d=n.getUTCSeconds();d<10&&(d="0"+d);var m=n.getUTCFullYear(),v=o+" "+i+" "+a+" "+l+":"+f+":"+d+" UTC "+m;return v},e})();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var Wa=(function(){function e(r){var n=r===void 0?{}:r,o=n.Name,i=n.Value;this.Name=o||"",this.Value=i||""}var t=e.prototype;return t.getValue=function(){return this.Value},t.setValue=function(n){return this.Value=n,this},t.getName=function(){return this.Name},t.setName=function(n){return this.Name=n,this},t.toString=function(){return JSON.stringify(this)},t.toJSON=function(){return{Name:this.Name,Value:this.Value}},e})();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var ze={},Ga=(function(){function e(){}return e.setItem=function(r,n){return ze[r]=n,ze[r]},e.getItem=function(r){return Object.prototype.hasOwnProperty.call(ze,r)?ze[r]:void 0},e.removeItem=function(r){return delete ze[r]},e.clear=function(){return ze={},ze},e})(),Qi=(function(){function e(){try{this.storageWindow=window.localStorage,this.storageWindow.setItem("aws.cognito.test-ls",1),this.storageWindow.removeItem("aws.cognito.test-ls")}catch{this.storageWindow=Ga}}var t=e.prototype;return t.getStorage=function(){return this.storageWindow},e})();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var Ja=typeof navigator<"u",li=Ja?Xi.isReactNative?"react-native":navigator.userAgent:"nodejs",Wr=(function(){function e(r){if(r==null||r.Username==null||r.Pool==null)throw new Error("Username and Pool information are required.");this.username=r.Username||"",this.pool=r.Pool,this.Session=null,this.client=r.Pool.client,this.signInUserSession=null,this.authenticationFlowType="USER_SRP_AUTH",this.storage=r.Storage||new Qi().getStorage(),this.keyPrefix="CognitoIdentityServiceProvider."+this.pool.getClientId(),this.userDataKey=this.keyPrefix+"."+this.username+".userData"}var t=e.prototype;return t.setSignInUserSession=function(n){this.clearCachedUserData(),this.signInUserSession=n,this.cacheTokens()},t.getSignInUserSession=function(){return this.signInUserSession},t.getUsername=function(){return this.username},t.getAuthenticationFlowType=function(){return this.authenticationFlowType},t.setAuthenticationFlowType=function(n){this.authenticationFlowType=n},t.initiateAuth=function(n,o){var i=this,a=n.getAuthParameters();a.USERNAME=this.username;var l=Object.keys(n.getValidationData()).length!==0?n.getValidationData():n.getClientMetadata(),f={AuthFlow:"CUSTOM_AUTH",ClientId:this.pool.getClientId(),AuthParameters:a,ClientMetadata:l};this.getUserContextData()&&(f.UserContextData=this.getUserContextData()),this.client.request("InitiateAuth",f,function(d,m){if(d)return o.onFailure(d);var v=m.ChallengeName,_=m.ChallengeParameters;return v==="CUSTOM_CHALLENGE"?(i.Session=m.Session,o.customChallenge(_)):(i.signInUserSession=i.getCognitoUserSession(m.AuthenticationResult),i.cacheTokens(),o.onSuccess(i.signInUserSession))})},t.authenticateUser=function(n,o){return this.authenticationFlowType==="USER_PASSWORD_AUTH"?this.authenticateUserPlainUsernamePassword(n,o):this.authenticationFlowType==="USER_SRP_AUTH"||this.authenticationFlowType==="CUSTOM_AUTH"?this.authenticateUserDefaultAuth(n,o):o.onFailure(new Error("Authentication flow type is invalid."))},t.authenticateUserDefaultAuth=function(n,o){var i=this,a=new Ze(this.pool.getUserPoolName()),l=new ai,f,d,m={};this.deviceKey!=null&&(m.DEVICE_KEY=this.deviceKey),m.USERNAME=this.username,a.getLargeAValue(function(v,_){v&&o.onFailure(v),m.SRP_A=_.toString(16),i.authenticationFlowType==="CUSTOM_AUTH"&&(m.CHALLENGE_NAME="SRP_A");var g=Object.keys(n.getValidationData()).length!==0?n.getValidationData():n.getClientMetadata(),w={AuthFlow:i.authenticationFlowType,ClientId:i.pool.getClientId(),AuthParameters:m,ClientMetadata:g};i.getUserContextData(i.username)&&(w.UserContextData=i.getUserContextData(i.username)),i.client.request("InitiateAuth",w,function(b,T){if(b)return o.onFailure(b);var C=T.ChallengeParameters;i.username=C.USER_ID_FOR_SRP,i.userDataKey=i.keyPrefix+"."+i.username+".userData",f=new A(C.SRP_B,16),d=new A(C.SALT,16),i.getCachedDeviceKeyAndPassword(),a.getPasswordAuthenticationKey(i.username,n.getPassword(),f,d,function(I,D){I&&o.onFailure(I);var B=l.getNowString(),M=N.Buffer.concat([N.Buffer.from(i.pool.getUserPoolName(),"utf8"),N.Buffer.from(i.username,"utf8"),N.Buffer.from(C.SECRET_BLOCK,"base64"),N.Buffer.from(B,"utf8")]),ae=new Tt.Sha256(D);ae.update(M);var De=ae.digestSync(),ne=N.Buffer.from(De).toString("base64"),W={};W.USERNAME=i.username,W.PASSWORD_CLAIM_SECRET_BLOCK=C.SECRET_BLOCK,W.TIMESTAMP=B,W.PASSWORD_CLAIM_SIGNATURE=ne,i.deviceKey!=null&&(W.DEVICE_KEY=i.deviceKey);var pe=function(Ye,ft){return i.client.request("RespondToAuthChallenge",Ye,function(Ne,_r){return Ne&&Ne.code==="ResourceNotFoundException"&&Ne.message.toLowerCase().indexOf("device")!==-1?(W.DEVICE_KEY=null,i.deviceKey=null,i.randomPassword=null,i.deviceGroupKey=null,i.clearCachedDeviceKeyAndPassword(),pe(Ye,ft)):ft(Ne,_r)})},X={ChallengeName:"PASSWORD_VERIFIER",ClientId:i.pool.getClientId(),ChallengeResponses:W,Session:T.Session,ClientMetadata:g};i.getUserContextData()&&(X.UserContextData=i.getUserContextData()),pe(X,function(ue,Ye){return ue?o.onFailure(ue):i.authenticateUserInternal(Ye,a,o)})})})})},t.authenticateUserPlainUsernamePassword=function(n,o){var i=this,a={};if(a.USERNAME=this.username,a.PASSWORD=n.getPassword(),!a.PASSWORD){o.onFailure(new Error("PASSWORD parameter is required"));return}var l=new Ze(this.pool.getUserPoolName());this.getCachedDeviceKeyAndPassword(),this.deviceKey!=null&&(a.DEVICE_KEY=this.deviceKey);var f=Object.keys(n.getValidationData()).length!==0?n.getValidationData():n.getClientMetadata(),d={AuthFlow:"USER_PASSWORD_AUTH",ClientId:this.pool.getClientId(),AuthParameters:a,ClientMetadata:f};this.getUserContextData(this.username)&&(d.UserContextData=this.getUserContextData(this.username)),this.client.request("InitiateAuth",d,function(m,v){return m?o.onFailure(m):i.authenticateUserInternal(v,l,o)})},t.authenticateUserInternal=function(n,o,i){var a=this,l=n.ChallengeName,f=n.ChallengeParameters;if(l==="SMS_MFA")return this.Session=n.Session,i.mfaRequired(l,f);if(l==="SELECT_MFA_TYPE")return this.Session=n.Session,i.selectMFAType(l,f);if(l==="MFA_SETUP")return this.Session=n.Session,i.mfaSetup(l,f);if(l==="SOFTWARE_TOKEN_MFA")return this.Session=n.Session,i.totpRequired(l,f);if(l==="CUSTOM_CHALLENGE")return this.Session=n.Session,i.customChallenge(f);if(l==="NEW_PASSWORD_REQUIRED"){this.Session=n.Session;var d=null,m=null,v=[],_=o.getNewPasswordRequiredChallengeUserAttributePrefix();if(f&&(d=JSON.parse(n.ChallengeParameters.userAttributes),m=JSON.parse(n.ChallengeParameters.requiredAttributes)),m)for(var g=0;g<m.length;g++)v[g]=m[g].substr(_.length);return i.newPasswordRequired(d,v)}if(l==="DEVICE_SRP_AUTH"){this.Session=n.Session,this.getDeviceResponse(i);return}this.signInUserSession=this.getCognitoUserSession(n.AuthenticationResult),this.challengeName=l,this.cacheTokens();var w=n.AuthenticationResult.NewDeviceMetadata;if(w==null)return i.onSuccess(this.signInUserSession);o.generateHashDevice(n.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,n.AuthenticationResult.NewDeviceMetadata.DeviceKey,function(b){if(b)return i.onFailure(b);var T={Salt:N.Buffer.from(o.getSaltDevices(),"hex").toString("base64"),PasswordVerifier:N.Buffer.from(o.getVerifierDevices(),"hex").toString("base64")};a.verifierDevices=T.PasswordVerifier,a.deviceGroupKey=w.DeviceGroupKey,a.randomPassword=o.getRandomPassword(),a.client.request("ConfirmDevice",{DeviceKey:w.DeviceKey,AccessToken:a.signInUserSession.getAccessToken().getJwtToken(),DeviceSecretVerifierConfig:T,DeviceName:li},function(C,I){return C?i.onFailure(C):(a.deviceKey=n.AuthenticationResult.NewDeviceMetadata.DeviceKey,a.cacheDeviceKeyAndPassword(),I.UserConfirmationNecessary===!0?i.onSuccess(a.signInUserSession,I.UserConfirmationNecessary):i.onSuccess(a.signInUserSession))})})},t.completeNewPasswordChallenge=function(n,o,i,a){var l=this;if(!n)return i.onFailure(new Error("New password is required."));var f=new Ze(this.pool.getUserPoolName()),d=f.getNewPasswordRequiredChallengeUserAttributePrefix(),m={};o&&Object.keys(o).forEach(function(_){m[d+_]=o[_]}),m.NEW_PASSWORD=n,m.USERNAME=this.username;var v={ChallengeName:"NEW_PASSWORD_REQUIRED",ClientId:this.pool.getClientId(),ChallengeResponses:m,Session:this.Session,ClientMetadata:a};this.getUserContextData()&&(v.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",v,function(_,g){return _?i.onFailure(_):l.authenticateUserInternal(g,f,i)})},t.getDeviceResponse=function(n,o){var i=this,a=new Ze(this.deviceGroupKey),l=new ai,f={};f.USERNAME=this.username,f.DEVICE_KEY=this.deviceKey,a.getLargeAValue(function(d,m){d&&n.onFailure(d),f.SRP_A=m.toString(16);var v={ChallengeName:"DEVICE_SRP_AUTH",ClientId:i.pool.getClientId(),ChallengeResponses:f,ClientMetadata:o,Session:i.Session};i.getUserContextData()&&(v.UserContextData=i.getUserContextData()),i.client.request("RespondToAuthChallenge",v,function(_,g){if(_)return n.onFailure(_);var w=g.ChallengeParameters,b=new A(w.SRP_B,16),T=new A(w.SALT,16);a.getPasswordAuthenticationKey(i.deviceKey,i.randomPassword,b,T,function(C,I){if(C)return n.onFailure(C);var D=l.getNowString(),B=N.Buffer.concat([N.Buffer.from(i.deviceGroupKey,"utf8"),N.Buffer.from(i.deviceKey,"utf8"),N.Buffer.from(w.SECRET_BLOCK,"base64"),N.Buffer.from(D,"utf8")]),M=new Tt.Sha256(I);M.update(B);var ae=M.digestSync(),De=N.Buffer.from(ae).toString("base64"),ne={};ne.USERNAME=i.username,ne.PASSWORD_CLAIM_SECRET_BLOCK=w.SECRET_BLOCK,ne.TIMESTAMP=D,ne.PASSWORD_CLAIM_SIGNATURE=De,ne.DEVICE_KEY=i.deviceKey;var W={ChallengeName:"DEVICE_PASSWORD_VERIFIER",ClientId:i.pool.getClientId(),ChallengeResponses:ne,Session:g.Session};i.getUserContextData()&&(W.UserContextData=i.getUserContextData()),i.client.request("RespondToAuthChallenge",W,function(pe,X){return pe?n.onFailure(pe):(i.signInUserSession=i.getCognitoUserSession(X.AuthenticationResult),i.cacheTokens(),n.onSuccess(i.signInUserSession))})})})})},t.confirmRegistration=function(n,o,i,a){var l={ClientId:this.pool.getClientId(),ConfirmationCode:n,Username:this.username,ForceAliasCreation:o,ClientMetadata:a};this.getUserContextData()&&(l.UserContextData=this.getUserContextData()),this.client.request("ConfirmSignUp",l,function(f){return f?i(f,null):i(null,"SUCCESS")})},t.sendCustomChallengeAnswer=function(n,o,i){var a=this,l={};l.USERNAME=this.username,l.ANSWER=n;var f=new Ze(this.pool.getUserPoolName());this.getCachedDeviceKeyAndPassword(),this.deviceKey!=null&&(l.DEVICE_KEY=this.deviceKey);var d={ChallengeName:"CUSTOM_CHALLENGE",ChallengeResponses:l,ClientId:this.pool.getClientId(),Session:this.Session,ClientMetadata:i};this.getUserContextData()&&(d.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",d,function(m,v){return m?o.onFailure(m):a.authenticateUserInternal(v,f,o)})},t.sendMFACode=function(n,o,i,a){var l=this,f={};f.USERNAME=this.username,f.SMS_MFA_CODE=n;var d=i||"SMS_MFA";d==="SOFTWARE_TOKEN_MFA"&&(f.SOFTWARE_TOKEN_MFA_CODE=n),this.deviceKey!=null&&(f.DEVICE_KEY=this.deviceKey);var m={ChallengeName:d,ChallengeResponses:f,ClientId:this.pool.getClientId(),Session:this.Session,ClientMetadata:a};this.getUserContextData()&&(m.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",m,function(v,_){if(v)return o.onFailure(v);var g=_.ChallengeName;if(g==="DEVICE_SRP_AUTH"){l.getDeviceResponse(o);return}if(l.signInUserSession=l.getCognitoUserSession(_.AuthenticationResult),l.cacheTokens(),_.AuthenticationResult.NewDeviceMetadata==null)return o.onSuccess(l.signInUserSession);var w=new Ze(l.pool.getUserPoolName());w.generateHashDevice(_.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,_.AuthenticationResult.NewDeviceMetadata.DeviceKey,function(b){if(b)return o.onFailure(b);var T={Salt:N.Buffer.from(w.getSaltDevices(),"hex").toString("base64"),PasswordVerifier:N.Buffer.from(w.getVerifierDevices(),"hex").toString("base64")};l.verifierDevices=T.PasswordVerifier,l.deviceGroupKey=_.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,l.randomPassword=w.getRandomPassword(),l.client.request("ConfirmDevice",{DeviceKey:_.AuthenticationResult.NewDeviceMetadata.DeviceKey,AccessToken:l.signInUserSession.getAccessToken().getJwtToken(),DeviceSecretVerifierConfig:T,DeviceName:li},function(C,I){return C?o.onFailure(C):(l.deviceKey=_.AuthenticationResult.NewDeviceMetadata.DeviceKey,l.cacheDeviceKeyAndPassword(),I.UserConfirmationNecessary===!0?o.onSuccess(l.signInUserSession,I.UserConfirmationNecessary):o.onSuccess(l.signInUserSession))})})})},t.changePassword=function(n,o,i,a){if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return i(new Error("User is not authenticated"),null);this.client.request("ChangePassword",{PreviousPassword:n,ProposedPassword:o,AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),ClientMetadata:a},function(l){return l?i(l,null):i(null,"SUCCESS")})},t.enableMFA=function(n){if(this.signInUserSession==null||!this.signInUserSession.isValid())return n(new Error("User is not authenticated"),null);var o=[],i={DeliveryMedium:"SMS",AttributeName:"phone_number"};o.push(i),this.client.request("SetUserSettings",{MFAOptions:o,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(a){return a?n(a,null):n(null,"SUCCESS")})},t.setUserMfaPreference=function(n,o,i){if(this.signInUserSession==null||!this.signInUserSession.isValid())return i(new Error("User is not authenticated"),null);this.client.request("SetUserMFAPreference",{SMSMfaSettings:n,SoftwareTokenMfaSettings:o,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(a){return a?i(a,null):i(null,"SUCCESS")})},t.disableMFA=function(n){if(this.signInUserSession==null||!this.signInUserSession.isValid())return n(new Error("User is not authenticated"),null);var o=[];this.client.request("SetUserSettings",{MFAOptions:o,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(i){return i?n(i,null):n(null,"SUCCESS")})},t.deleteUser=function(n,o){var i=this;if(this.signInUserSession==null||!this.signInUserSession.isValid())return n(new Error("User is not authenticated"),null);this.client.request("DeleteUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),ClientMetadata:o},function(a){return a?n(a,null):(i.clearCachedUser(),n(null,"SUCCESS"))})},t.updateAttributes=function(n,o,i){var a=this;if(this.signInUserSession==null||!this.signInUserSession.isValid())return o(new Error("User is not authenticated"),null);this.client.request("UpdateUserAttributes",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),UserAttributes:n,ClientMetadata:i},function(l,f){return l?o(l,null):a.getUserData(function(){return o(null,"SUCCESS",f)},{bypassCache:!0})})},t.getUserAttributes=function(n){if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return n(new Error("User is not authenticated"),null);this.client.request("GetUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(o,i){if(o)return n(o,null);for(var a=[],l=0;l<i.UserAttributes.length;l++){var f={Name:i.UserAttributes[l].Name,Value:i.UserAttributes[l].Value},d=new Wa(f);a.push(d)}return n(null,a)})},t.getMFAOptions=function(n){if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return n(new Error("User is not authenticated"),null);this.client.request("GetUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(o,i){return o?n(o,null):n(null,i.MFAOptions)})},t.createGetUserRequest=function(){return this.client.promisifyRequest("GetUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()})},t.refreshSessionIfPossible=function(n){var o=this;return n===void 0&&(n={}),new Promise(function(i){var a=o.signInUserSession.getRefreshToken();a&&a.getToken()?o.refreshSession(a,i,n.clientMetadata):i()})},t.getUserData=function(n,o){var i=this;if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return this.clearCachedUserData(),n(new Error("User is not authenticated"),null);var a=this.getUserDataFromCache();if(!a){this.fetchUserData().then(function(l){n(null,l)}).catch(n);return}if(this.isFetchUserDataAndTokenRequired(o)){this.fetchUserData().then(function(l){return i.refreshSessionIfPossible(o).then(function(){return l})}).then(function(l){return n(null,l)}).catch(n);return}try{n(null,JSON.parse(a));return}catch(l){this.clearCachedUserData(),n(l,null);return}},t.getUserDataFromCache=function(){var n=this.storage.getItem(this.userDataKey);return n},t.isFetchUserDataAndTokenRequired=function(n){var o=n||{},i=o.bypassCache,a=i===void 0?!1:i;return a},t.fetchUserData=function(){var n=this;return this.createGetUserRequest().then(function(o){return n.cacheUserData(o),o})},t.deleteAttributes=function(n,o){var i=this;if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return o(new Error("User is not authenticated"),null);this.client.request("DeleteUserAttributes",{UserAttributeNames:n,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(a){return a?o(a,null):i.getUserData(function(){return o(null,"SUCCESS")},{bypassCache:!0})})},t.resendConfirmationCode=function(n,o){var i={ClientId:this.pool.getClientId(),Username:this.username,ClientMetadata:o};this.client.request("ResendConfirmationCode",i,function(a,l){return a?n(a,null):n(null,l)})},t.getSession=function(n,o){if(o===void 0&&(o={}),this.username==null)return n(new Error("Username is null. Cannot retrieve a new session"),null);if(this.signInUserSession!=null&&this.signInUserSession.isValid())return n(null,this.signInUserSession);var i="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,a=i+".idToken",l=i+".accessToken",f=i+".refreshToken",d=i+".clockDrift";if(this.storage.getItem(a)){var m=new ii({IdToken:this.storage.getItem(a)}),v=new ni({AccessToken:this.storage.getItem(l)}),_=new oi({RefreshToken:this.storage.getItem(f)}),g=parseInt(this.storage.getItem(d),0)||0,w={IdToken:m,AccessToken:v,RefreshToken:_,ClockDrift:g},b=new si(w);if(b.isValid())return this.signInUserSession=b,n(null,this.signInUserSession);if(!_.getToken())return n(new Error("Cannot retrieve a new session. Please authenticate."),null);this.refreshSession(_,n,o.clientMetadata)}else n(new Error("Local storage is missing an ID Token, Please authenticate"),null)},t.refreshSession=function(n,o,i){var a=this,l=this.pool.wrapRefreshSessionCallback?this.pool.wrapRefreshSessionCallback(o):o,f={};f.REFRESH_TOKEN=n.getToken();var d="CognitoIdentityServiceProvider."+this.pool.getClientId(),m=d+".LastAuthUser";if(this.storage.getItem(m)){this.username=this.storage.getItem(m);var v=d+"."+this.username+".deviceKey";this.deviceKey=this.storage.getItem(v),f.DEVICE_KEY=this.deviceKey}var _={ClientId:this.pool.getClientId(),AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:f,ClientMetadata:i};this.getUserContextData()&&(_.UserContextData=this.getUserContextData()),this.client.requestWithRetry("InitiateAuth",_,function(g,w){if(g)return g.code==="NotAuthorizedException"&&a.clearCachedUser(),l(g,null);if(w){var b=w.AuthenticationResult;return Object.prototype.hasOwnProperty.call(b,"RefreshToken")||(b.RefreshToken=n.getToken()),a.signInUserSession=a.getCognitoUserSession(b),a.cacheTokens(),l(null,a.signInUserSession)}})},t.cacheTokens=function(){var n="CognitoIdentityServiceProvider."+this.pool.getClientId(),o=n+"."+this.username+".idToken",i=n+"."+this.username+".accessToken",a=n+"."+this.username+".refreshToken",l=n+"."+this.username+".clockDrift",f=n+".LastAuthUser";this.storage.setItem(o,this.signInUserSession.getIdToken().getJwtToken()),this.storage.setItem(i,this.signInUserSession.getAccessToken().getJwtToken()),this.storage.setItem(a,this.signInUserSession.getRefreshToken().getToken()),this.storage.setItem(l,""+this.signInUserSession.getClockDrift()),this.storage.setItem(f,this.username)},t.cacheUserData=function(n){this.storage.setItem(this.userDataKey,JSON.stringify(n))},t.clearCachedUserData=function(){this.storage.removeItem(this.userDataKey)},t.clearCachedUser=function(){this.clearCachedTokens(),this.clearCachedUserData()},t.cacheDeviceKeyAndPassword=function(){var n="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,o=n+".deviceKey",i=n+".randomPasswordKey",a=n+".deviceGroupKey";this.storage.setItem(o,this.deviceKey),this.storage.setItem(i,this.randomPassword),this.storage.setItem(a,this.deviceGroupKey)},t.getCachedDeviceKeyAndPassword=function(){var n="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,o=n+".deviceKey",i=n+".randomPasswordKey",a=n+".deviceGroupKey";this.storage.getItem(o)&&(this.deviceKey=this.storage.getItem(o),this.randomPassword=this.storage.getItem(i),this.deviceGroupKey=this.storage.getItem(a))},t.clearCachedDeviceKeyAndPassword=function(){var n="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,o=n+".deviceKey",i=n+".randomPasswordKey",a=n+".deviceGroupKey";this.storage.removeItem(o),this.storage.removeItem(i),this.storage.removeItem(a)},t.clearCachedTokens=function(){var n="CognitoIdentityServiceProvider."+this.pool.getClientId(),o=n+"."+this.username+".idToken",i=n+"."+this.username+".accessToken",a=n+"."+this.username+".refreshToken",l=n+".LastAuthUser",f=n+"."+this.username+".clockDrift";this.storage.removeItem(o),this.storage.removeItem(i),this.storage.removeItem(a),this.storage.removeItem(l),this.storage.removeItem(f)},t.getCognitoUserSession=function(n){var o=new ii(n),i=new ni(n),a=new oi(n),l={IdToken:o,AccessToken:i,RefreshToken:a};return new si(l)},t.forgotPassword=function(n,o){var i={ClientId:this.pool.getClientId(),Username:this.username,ClientMetadata:o};this.getUserContextData()&&(i.UserContextData=this.getUserContextData()),this.client.request("ForgotPassword",i,function(a,l){return a?n.onFailure(a):typeof n.inputVerificationCode=="function"?n.inputVerificationCode(l):n.onSuccess(l)})},t.confirmPassword=function(n,o,i,a){var l={ClientId:this.pool.getClientId(),Username:this.username,ConfirmationCode:n,Password:o,ClientMetadata:a};this.getUserContextData()&&(l.UserContextData=this.getUserContextData()),this.client.request("ConfirmForgotPassword",l,function(f){return f?i.onFailure(f):i.onSuccess("SUCCESS")})},t.getAttributeVerificationCode=function(n,o,i){if(this.signInUserSession==null||!this.signInUserSession.isValid())return o.onFailure(new Error("User is not authenticated"));this.client.request("GetUserAttributeVerificationCode",{AttributeName:n,AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),ClientMetadata:i},function(a,l){return a?o.onFailure(a):typeof o.inputVerificationCode=="function"?o.inputVerificationCode(l):o.onSuccess("SUCCESS")})},t.verifyAttribute=function(n,o,i){if(this.signInUserSession==null||!this.signInUserSession.isValid())return i.onFailure(new Error("User is not authenticated"));this.client.request("VerifyUserAttribute",{AttributeName:n,Code:o,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(a){return a?i.onFailure(a):i.onSuccess("SUCCESS")})},t.getDevice=function(n){if(this.signInUserSession==null||!this.signInUserSession.isValid())return n.onFailure(new Error("User is not authenticated"));this.client.request("GetDevice",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey},function(o,i){return o?n.onFailure(o):n.onSuccess(i)})},t.forgetSpecificDevice=function(n,o){if(this.signInUserSession==null||!this.signInUserSession.isValid())return o.onFailure(new Error("User is not authenticated"));this.client.request("ForgetDevice",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:n},function(i){return i?o.onFailure(i):o.onSuccess("SUCCESS")})},t.forgetDevice=function(n){var o=this;this.forgetSpecificDevice(this.deviceKey,{onFailure:n.onFailure,onSuccess:function(a){return o.deviceKey=null,o.deviceGroupKey=null,o.randomPassword=null,o.clearCachedDeviceKeyAndPassword(),n.onSuccess(a)}})},t.setDeviceStatusRemembered=function(n){if(this.signInUserSession==null||!this.signInUserSession.isValid())return n.onFailure(new Error("User is not authenticated"));this.client.request("UpdateDeviceStatus",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey,DeviceRememberedStatus:"remembered"},function(o){return o?n.onFailure(o):n.onSuccess("SUCCESS")})},t.setDeviceStatusNotRemembered=function(n){if(this.signInUserSession==null||!this.signInUserSession.isValid())return n.onFailure(new Error("User is not authenticated"));this.client.request("UpdateDeviceStatus",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey,DeviceRememberedStatus:"not_remembered"},function(o){return o?n.onFailure(o):n.onSuccess("SUCCESS")})},t.listDevices=function(n,o,i){if(this.signInUserSession==null||!this.signInUserSession.isValid())return i.onFailure(new Error("User is not authenticated"));var a={AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),Limit:n};o&&(a.PaginationToken=o),this.client.request("ListDevices",a,function(l,f){return l?i.onFailure(l):i.onSuccess(f)})},t.globalSignOut=function(n){var o=this;if(this.signInUserSession==null||!this.signInUserSession.isValid())return n.onFailure(new Error("User is not authenticated"));this.client.request("GlobalSignOut",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(i){return i?n.onFailure(i):(o.clearCachedUser(),n.onSuccess("SUCCESS"))})},t.signOut=function(n){var o=this;if(!n||typeof n!="function"){this.cleanClientData();return}this.getSession(function(i,a){if(i)return n(i);o.revokeTokens(function(l){o.cleanClientData(),n(l)})})},t.revokeTokens=function(n){if(n===void 0&&(n=function(){}),typeof n!="function")throw new Error("Invalid revokeTokenCallback. It should be a function.");if(!this.signInUserSession){var o=new Error("User is not authenticated");return n(o)}if(!this.signInUserSession.getAccessToken()){var i=new Error("No Access token available");return n(i)}var a=this.signInUserSession.getRefreshToken().getToken(),l=this.signInUserSession.getAccessToken();if(this.isSessionRevocable(l)&&a)return this.revokeToken({token:a,callback:n});n()},t.isSessionRevocable=function(n){if(n&&typeof n.decodePayload=="function")try{var o=n.decodePayload(),i=o.origin_jti;return!!i}catch{}return!1},t.cleanClientData=function(){this.signInUserSession=null,this.clearCachedUser()},t.revokeToken=function(n){var o=n.token,i=n.callback;this.client.requestWithRetry("RevokeToken",{Token:o,ClientId:this.pool.getClientId()},function(a){if(a)return i(a);i()})},t.sendMFASelectionAnswer=function(n,o){var i=this,a={};a.USERNAME=this.username,a.ANSWER=n;var l={ChallengeName:"SELECT_MFA_TYPE",ChallengeResponses:a,ClientId:this.pool.getClientId(),Session:this.Session};this.getUserContextData()&&(l.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",l,function(f,d){if(f)return o.onFailure(f);if(i.Session=d.Session,n==="SMS_MFA")return o.mfaRequired(d.ChallengeName,d.ChallengeParameters);if(n==="SOFTWARE_TOKEN_MFA")return o.totpRequired(d.ChallengeName,d.ChallengeParameters)})},t.getUserContextData=function(){var n=this.pool;return n.getUserContextData(this.username)},t.associateSoftwareToken=function(n){var o=this;this.signInUserSession!=null&&this.signInUserSession.isValid()?this.client.request("AssociateSoftwareToken",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(i,a){return i?n.onFailure(i):n.associateSecretCode(a.SecretCode)}):this.client.request("AssociateSoftwareToken",{Session:this.Session},function(i,a){return i?n.onFailure(i):(o.Session=a.Session,n.associateSecretCode(a.SecretCode))})},t.verifySoftwareToken=function(n,o,i){var a=this;this.signInUserSession!=null&&this.signInUserSession.isValid()?this.client.request("VerifySoftwareToken",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),UserCode:n,FriendlyDeviceName:o},function(l,f){return l?i.onFailure(l):i.onSuccess(f)}):this.client.request("VerifySoftwareToken",{Session:this.Session,UserCode:n,FriendlyDeviceName:o},function(l,f){if(l)return i.onFailure(l);a.Session=f.Session;var d={};d.USERNAME=a.username;var m={ChallengeName:"MFA_SETUP",ClientId:a.pool.getClientId(),ChallengeResponses:d,Session:a.Session};a.getUserContextData()&&(m.UserContextData=a.getUserContextData()),a.client.request("RespondToAuthChallenge",m,function(v,_){return v?i.onFailure(v):(a.signInUserSession=a.getCognitoUserSession(_.AuthenticationResult),a.cacheTokens(),i.onSuccess(a.signInUserSession))})})},e})();function Ya(e,t){return t=t||{},new Promise(function(r,n){var o=new XMLHttpRequest,i=[],a=[],l={},f=function(){return{ok:(o.status/100|0)==2,statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:f,headers:{keys:function(){return i},entries:function(){return a},get:function(m){return l[m.toLowerCase()]},has:function(m){return m.toLowerCase()in l}}}};for(var d in o.open(t.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(m,v,_){i.push(v=v.toLowerCase()),a.push([v,_]),l[v]=l[v]?l[v]+","+_:_}),r(f())},o.onerror=n,o.withCredentials=t.credentials=="include",t.headers)o.setRequestHeader(d,t.headers[d]);o.send(t.body||null)})}const Za=Object.freeze(Object.defineProperty({__proto__:null,default:Ya},Symbol.toStringTag,{value:"Module"})),ci=un(Za);var Ar,ui;function Xa(){return ui||(ui=1,Ar=self.fetch||(self.fetch=ci.default||ci)),Ar}Xa();function Xe(){}Xe.prototype.userAgent=Ha();var Qa=function(t){var r=Xe.category?" "+Xe.category:"",n=Xe.framework?" framework/"+Xe.framework:"",o=""+Xe.prototype.userAgent+r+n;return o};function el(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Rt(e,t)}function Gr(e){var t=typeof Map=="function"?new Map:void 0;return Gr=function(n){if(n===null||!rl(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(n))return t.get(n);t.set(n,o)}function o(){return tl(n,arguments,Jr(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),Rt(o,n)},Gr(e)}function tl(e,t,r){if(eo())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var o=new(e.bind.apply(e,n));return r&&Rt(o,r.prototype),o}function eo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(eo=function(){return!!e})()}function rl(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function Rt(e,t){return Rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},Rt(e,t)}function Jr(e){return Jr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jr(e)}var nl=(function(e){function t(r,n,o,i){var a;return a=e.call(this,r)||this,a.code=n,a.name=o,a.statusCode=i,a}return el(t,e),t})(Gr(Error)),il=(function(){function e(r,n,o){this.endpoint=n||"https://cognito-idp."+r+".amazonaws.com/";var i=o||{},a=i.credentials;this.fetchOptions=a?{credentials:a}:{}}var t=e.prototype;return t.promisifyRequest=function(n,o){var i=this;return new Promise(function(a,l){i.request(n,o,function(f,d){f?l(new nl(f.message,f.code,f.name,f.statusCode)):a(d)})})},t.requestWithRetry=function(n,o,i){var a=this,l=5*1e3;al(function(f){return new Promise(function(d,m){a.request(n,f,function(v,_){v?m(v):d(_)})})},[o],l).then(function(f){return i(null,f)}).catch(function(f){return i(f)})},t.request=function(n,o,i){var a={"Content-Type":"application/x-amz-json-1.1","X-Amz-Target":"AWSCognitoIdentityProviderService."+n,"X-Amz-User-Agent":Qa(),"Cache-Control":"no-store"},l=Object.assign({},this.fetchOptions,{headers:a,method:"POST",mode:"cors",body:JSON.stringify(o)}),f;fetch(this.endpoint,l).then(function(d){return f=d,d},function(d){throw d instanceof TypeError?new Error("Network error"):d}).then(function(d){return d.json().catch(function(){return{}})}).then(function(d){if(f.ok)return i(null,d);var m=(d.__type||d.code).split("#").pop(),v=new Error(d.message||d.Message||null);return v.name=m,v.code=m,i(v)}).catch(function(d){if(f&&f.headers&&f.headers.get("x-amzn-errortype"))try{var m=f.headers.get("x-amzn-errortype").split(":")[0],v=new Error(f.status?f.status.toString():null);return v.code=m,v.name=m,v.statusCode=f.status,i(v)}catch{return i(d)}else d instanceof Error&&d.message==="Network error"&&(d.code="NetworkError");return i(d)})},e})(),Jt={debug:function(){}},ol=function(t){var r="nonRetryable";return t&&t[r]};function to(e,t,r,n){if(n===void 0&&(n=1),typeof e!="function")throw Error("functionToRetry must be a function");return Jt.debug(e.name+" attempt #"+n+" with args: "+JSON.stringify(t)),e.apply(void 0,t).catch(function(o){if(Jt.debug("error on "+e.name,o),ol(o))throw Jt.debug(e.name+" non retryable error",o),o;var i=r(n,t,o);if(Jt.debug(e.name+" retrying in "+i+" ms"),i!==!1)return new Promise(function(a){return setTimeout(a,i)}).then(function(){return to(e,t,r,n+1)});throw o})}function sl(e){var t=100,r=100;return function(n){var o=Math.pow(2,n)*t+r*Math.random();return o>e?!1:o}}function al(e,t,r){return to(e,t,sl(r))}/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var ll=55,cl=(function(){function e(r,n){var o=r||{},i=o.UserPoolId,a=o.ClientId,l=o.endpoint,f=o.fetchOptions,d=o.AdvancedSecurityDataCollectionFlag;if(!i||!a)throw new Error("Both UserPoolId and ClientId are required.");if(i.length>ll||!/^[\w-]+_[0-9a-zA-Z]+$/.test(i))throw new Error("Invalid UserPoolId format.");var m=i.split("_")[0];this.userPoolId=i,this.clientId=a,this.client=new il(m,l,f),this.advancedSecurityDataCollectionFlag=d!==!1,this.storage=r.Storage||new Qi().getStorage(),n&&(this.wrapRefreshSessionCallback=n)}var t=e.prototype;return t.getUserPoolId=function(){return this.userPoolId},t.getUserPoolName=function(){return this.getUserPoolId().split("_")[1]},t.getClientId=function(){return this.clientId},t.signUp=function(n,o,i,a,l,f){var d=this,m={ClientId:this.clientId,Username:n,Password:o,UserAttributes:i,ValidationData:a,ClientMetadata:f};this.getUserContextData(n)&&(m.UserContextData=this.getUserContextData(n)),this.client.request("SignUp",m,function(v,_){if(v)return l(v,null);var g={Username:n,Pool:d,Storage:d.storage},w={user:new Wr(g),userConfirmed:_.UserConfirmed,userSub:_.UserSub,codeDeliveryDetails:_.CodeDeliveryDetails};return l(null,w)})},t.getCurrentUser=function(){var n="CognitoIdentityServiceProvider."+this.clientId+".LastAuthUser",o=this.storage.getItem(n);if(o){var i={Username:o,Pool:this,Storage:this.storage};return new Wr(i)}return null},t.getUserContextData=function(n){if(!(typeof AmazonCognitoAdvancedSecurityData>"u")){var o=AmazonCognitoAdvancedSecurityData;if(this.advancedSecurityDataCollectionFlag){var i=o.getData(n,this.userPoolId,this.clientId);if(i){var a={EncodedData:i};return a}}return{}}},e})(),Er={exports:{}};/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */var di;function ul(){return di||(di=1,(function(e,t){(function(r){var n;if(e.exports=r(),n=!0,!n){var o=window.Cookies,i=window.Cookies=r();i.noConflict=function(){return window.Cookies=o,i}}})(function(){function r(){for(var i=0,a={};i<arguments.length;i++){var l=arguments[i];for(var f in l)a[f]=l[f]}return a}function n(i){return i.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function o(i){function a(){}function l(d,m,v){if(!(typeof document>"u")){v=r({path:"/"},a.defaults,v),typeof v.expires=="number"&&(v.expires=new Date(new Date*1+v.expires*864e5)),v.expires=v.expires?v.expires.toUTCString():"";try{var _=JSON.stringify(m);/^[\{\[]/.test(_)&&(m=_)}catch{}m=i.write?i.write(m,d):encodeURIComponent(String(m)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),d=encodeURIComponent(String(d)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var g="";for(var w in v)v[w]&&(g+="; "+w,v[w]!==!0&&(g+="="+v[w].split(";")[0]));return document.cookie=d+"="+m+g}}function f(d,m){if(!(typeof document>"u")){for(var v={},_=document.cookie?document.cookie.split("; "):[],g=0;g<_.length;g++){var w=_[g].split("="),b=w.slice(1).join("=");!m&&b.charAt(0)==='"'&&(b=b.slice(1,-1));try{var T=n(w[0]);if(b=(i.read||i)(b,T)||n(b),m)try{b=JSON.parse(b)}catch{}if(v[T]=b,d===T)break}catch{}}return d?v[d]:v}}return a.set=l,a.get=function(d){return f(d,!1)},a.getJSON=function(d){return f(d,!0)},a.remove=function(d,m){l(d,"",r(m,{expires:-1}))},a.defaults={},a.withConverter=o,a}return o(function(){})})})(Er)),Er.exports}ul();const dl="us-east-1_2XDZpGyEN,us-east-1_wZQb5HVNv".split(",").map(e=>e.trim()).filter(Boolean),fl="7ttl5fme1llm52l25v2ocd5mla,47l07iv46cpc2r7kmcecc80ags".split(",").map(e=>e.trim()).filter(Boolean),ot=dl.map((e,t)=>({userPoolId:e,clientId:fl[t]||""})).filter(e=>e.userPoolId&&e.clientId);let pn=0;const kr=new Map;function vn(e){const t=e??pn;if(!kr.has(t)){const r=ot[t];kr.set(t,new cl({UserPoolId:r.userPoolId,ClientId:r.clientId}))}return kr.get(t)}function hl(e){const t=e.message||"";return t.includes("does not exist")||t.includes("User pool client")||t.includes("ResourceNotFoundException")}const Ae=E(!1),$e=E(null),Yr=E(!0);function Pt(){return ot.length>0}function ro(){if(!Pt())return Promise.resolve(null);function e(t){return t>=ot.length?Promise.resolve(null):new Promise(r=>{const o=vn(t).getCurrentUser();if(!o){r(e(t+1));return}o.getSession((i,a)=>{if(i||!a||!a.isValid()){r(e(t+1));return}pn=t,r(a.getIdToken().getJwtToken())})})}return e(0)}async function pl(){if(!Pt()){Ae.value=!0,Yr.value=!1;return}try{const e=await ro();Ae.value=e!==null}catch{Ae.value=!1}finally{Yr.value=!1}}function vl(e,t){$e.value=null;function r(n){if(n>=ot.length){const o=new Error("Authentication failed: none of the configured Cognito pools are reachable.");return Ae.value=!1,$e.value=o.message,Promise.reject(o)}return new Promise((o,i)=>{const a=vn(n),l=new Wr({Username:e,Pool:a}),f=new us({Username:e,Password:t});l.authenticateUser(f,{onSuccess:()=>{pn=n,Ae.value=!0,$e.value=null,o()},onFailure:d=>{if(hl(d)&&n+1<ot.length){r(n+1).then(o,i);return}Ae.value=!1,$e.value=d.message||"Authentication failed",i(d)},newPasswordRequired:()=>{Ae.value=!1,$e.value="Password change required. Please use the AWS CLI to set a permanent password.",i(new Error("NEW_PASSWORD_REQUIRED"))}})})}return r(0)}function ml(){if(Pt()){for(let e=0;e<ot.length;e++){const r=vn(e).getCurrentUser();r&&r.signOut()}Ae.value=!1}}const ce=!0,no="";async function H(e,t){const r={"Content-Type":"application/json",...(t==null?void 0:t.headers)||{}},n=await ro();n&&(r.Authorization=`Bearer ${n}`);const o=await fetch(`${no}${e}`,{...t,headers:r});if(!o.ok){const i=await o.text();throw new Error(`${o.status}: ${i}`)}return o.json()}function io(e,t,r){const n=new URLSearchParams({sessionId:e,filename:t,contentType:r});return H(`/api/upload-url?${n}`)}async function oo(e,t,r){return new Promise((n,o)=>{const i=new XMLHttpRequest;i.open("PUT",e,!0),i.setRequestHeader("Content-Type",t.type),r&&i.upload.addEventListener("progress",a=>{a.lengthComputable&&r(a.loaded,a.total)}),i.onload=()=>{i.status>=200&&i.status<300?n():o(new Error(`Upload failed: ${i.status} ${i.statusText}`))},i.onerror=()=>o(new Error("Upload failed: network error")),i.send(t)})}const so=10*1024*1024,gl=10*1024*1024,yl=6;function _l(e){return H("/api/upload-multipart/init",{method:"POST",body:JSON.stringify(e)})}function wl(e){return H("/api/upload-multipart/complete",{method:"POST",body:JSON.stringify(e)})}function Sl(e){return H("/api/upload-multipart/abort",{method:"POST",body:JSON.stringify(e)})}function bl(e,t,r){return new Promise((n,o)=>{const i=new XMLHttpRequest;i.open("PUT",e,!0),r&&i.upload.addEventListener("progress",a=>{a.lengthComputable&&r(a.loaded)}),i.onload=()=>{if(i.status>=200&&i.status<300){const a=i.getResponseHeader("ETag");if(!a){o(new Error("Upload succeeded but ETag header missing (check S3 CORS exposedHeaders)"));return}n(a)}else o(new Error(`Chunk upload failed: ${i.status} ${i.statusText}`))},i.onerror=()=>o(new Error("Chunk upload failed: network error")),i.send(t)})}async function ao(e,t,r){const n=gl,o=t.size,i=await _l({sessionId:e,filename:t.name,contentType:t.type,fileSize:o,chunkSize:n}),{uploadId:a,key:l,partUrls:f}=i,d=[],m=new Array(f.length).fill(0);function v(){if(r){const _=m.reduce((g,w)=>g+w,0);r(_,o)}}try{let _=0;async function g(){for(;_<f.length;){const b=_++,T=f[b];if(!T)continue;const C=b*n,I=Math.min(C+n,o),D=t.slice(C,I),B=await bl(T.url,D,M=>{m[b]=M,v()});m[b]=I-C,v(),d.push({partNumber:T.partNumber,etag:B})}}const w=Array.from({length:Math.min(yl,f.length)},()=>g());return await Promise.all(w),d.sort((b,T)=>b.partNumber-T.partNumber),await wl({sessionId:e,key:l,uploadId:a,parts:d}),l}catch(_){try{await Sl({sessionId:e,key:l,uploadId:a})}catch(g){console.error("Failed to abort multipart upload:",g)}throw _}}function lo(e){return H("/api/triage/start",{method:"POST",body:JSON.stringify(e)})}function xl(e,t){const r=t?`?sessionId=${encodeURIComponent(t)}`:"";return H(`/api/triage/${e}/results${r}`)}function Cl(e,t){return H(`/api/triage/${e}/confirm`,{method:"POST",body:JSON.stringify(t)})}function ye(e){return`${no}/api/media/thumbnail?key=${encodeURIComponent(e)}`}async function co(e){return(await H(`/api/media/full?key=${encodeURIComponent(e)}`)).url}async function fi(e){const t=await co(e);window.open(t,"_blank")}function uo(e){var r;const t=((r=e.split(".").pop())==null?void 0:r.toLowerCase())??"";return["mp4","mov","avi","mkv","webm","m4v","3gp"].includes(t)}function Tl(e){return H("/api/selection/start",{method:"POST",body:JSON.stringify(e)})}function Il(e,t){return H(`/api/selection/${e}/results?sessionId=${encodeURIComponent(t)}`)}function Al(e){return H("/api/enhance/start",{method:"POST",body:JSON.stringify(e)})}function fo(e,t){return H(`/api/enhance/${e}/results?sessionId=${encodeURIComponent(t)}`)}function El(e,t){return H(`/api/enhance/${e}/feedback`,{method:"POST",body:JSON.stringify(t)})}function kl(e){return H("/api/download/start",{method:"POST",body:JSON.stringify(e)})}function Ul(e,t){return H(`/api/download/${e}/results?sessionId=${encodeURIComponent(t)}`)}function Dl(e){return H("/api/description/generate",{method:"POST",body:JSON.stringify(e)})}function Rl(e,t){return H(`/api/description/${e}/results?sessionId=${encodeURIComponent(t)}`)}function Pl(e,t){return H(`/api/description/${e}/feedback`,{method:"POST",body:JSON.stringify(t)})}function Fl(){return H("/api/health")}function Bl(e){return H("/api/publish/start",{method:"POST",body:JSON.stringify(e)})}function Ml(e,t){return H(`/api/publish/${e}/status?sessionId=${encodeURIComponent(t)}`)}function Ol(e){return H("/api/session/invalidate",{method:"POST",body:JSON.stringify(e)})}const Ft=20,F=E([]),_e=E([]),me=E(null),Ce=E(null),V=E(null);let Zr=0;function ho(){F.value=[],_e.value=[],me.value=null,Ce.value=null,V.value=null,Zr=0}const po=Y(()=>{const e=new Set;for(const t of F.value)for(const r of t.keys)e.add(r);return e}),Nl=Y(()=>_e.value.filter(e=>!po.value.has(e.key))),mn=Y(()=>F.value.find(e=>e.id===me.value)??null),zl=Y(()=>{const e=mn.value;return e?e.keys.map(t=>_e.value.find(r=>r.key===t)).filter(t=>t!==void 0):[]});function vo(e){Zr++;const t=`group-${Zr}-${Date.now()}`,r=e?[e]:[];return F.value=[...F.value,{id:t,label:"",keys:r}],me.value=t,t}function Ll(e){F.value=F.value.filter(t=>t.id!==e),me.value===e&&(me.value=F.value.length>0?F.value[0].id:null)}function $l(e,t){F.value=F.value.map(r=>r.id===e?{...r,label:t}:r)}function mo(e,t){const r=F.value.find(n=>n.id===e);r&&(r.keys.length>=Ft||r.keys.includes(t)||(gn(t),F.value=F.value.map(n=>n.id===e?{...n,keys:[...n.keys,t]}:n)))}function Kl(e,t){F.value=F.value.map(r=>r.id===e?{...r,keys:r.keys.filter(n=>n!==t)}:r)}function gn(e){F.value=F.value.map(t=>t.keys.includes(e)?{...t,keys:t.keys.filter(r=>r!==e)}:t)}function jl(e,t){Ce.value={key:e,sourceGroupId:t}}function Hl(){Ce.value=null,V.value=null}function yn(e){e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move")}function Vl(e,t){e.preventDefault();const r=Ce.value;r&&(mo(t,r.key),Ce.value=null,V.value=null)}function ql(e){e.preventDefault();const t=Ce.value;t&&(gn(t.key),vo(t.key),Ce.value=null,V.value=null)}function Wl(e){e.preventDefault();const t=Ce.value;t&&(gn(t.key),Ce.value=null,V.value=null)}function Gl(e,t){if(t){const r=mn.value;r&&Kl(r.id,e)}else me.value&&mo(me.value,e)}function Jl(){const e=F.value.filter(t=>t.keys.length>0);e.length!==0&&(F.value=e,Ue("publish"))}function Yl(){Ge()}function hi({item:e,isInGroup:t,groupId:r,showAssignHint:n}){var i;const o=((i=Ce.value)==null?void 0:i.key)===e.key;return s("div",{draggable:!0,onDragStart:()=>jl(e.key,r),onDragEnd:Hl,onClick:()=>Gl(e.key,t),title:t?`${e.filename}  click to remove from group`:n?`${e.filename}  click to add to selected group`:e.filename,style:{position:"relative",borderRadius:"var(--radius)",overflow:"hidden",cursor:"grab",opacity:o?.4:1,transition:"opacity 0.15s, transform 0.15s",border:"2px solid transparent",background:"var(--color-bg)"},children:[s("div",{style:{width:"100%",aspectRatio:"1",background:"var(--color-surface-hover)"},children:s("img",{src:ye(e.thumbnailKey),alt:e.filename,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"},onError:a=>{a.target.style.display="none"}})}),e.type==="Video"&&s("span",{style:{position:"absolute",top:"0.25rem",left:"0.25rem",fontSize:"0.5rem",padding:"0.0625rem 0.25rem",borderRadius:"3px",background:"rgba(108, 140, 255, 0.85)",color:"#fff",fontWeight:600},children:"Video"}),t&&s("div",{style:{position:"absolute",top:"0.25rem",right:"0.25rem",width:"1rem",height:"1rem",borderRadius:"50%",background:"rgba(255, 107, 107, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.625rem",color:"#fff",fontWeight:700,lineHeight:1},children:""}),s("div",{style:{padding:"0.25rem 0.375rem",fontSize:"0.5625rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"var(--color-text-secondary)"},children:e.filename})]})}function Zl({group:e,isSelected:t,onSelect:r,onDelete:n}){const o=V.value===e.id,i=e.keys.length>=Ft,a=e.keys.slice(0,4).map(l=>_e.value.find(f=>f.key===l)).filter(l=>l!==void 0);return s("div",{onClick:r,onDragOver:yn,onDragEnter:()=>{i||(V.value=e.id)},onDragLeave:()=>{V.value===e.id&&(V.value=null)},onDrop:l=>Vl(l,e.id),style:{minWidth:"8.5rem",maxWidth:"10rem",padding:"0.5rem",background:t?"rgba(108, 140, 255, 0.12)":"var(--color-bg)",border:o?"2px dashed var(--color-primary)":t?"2px solid var(--color-primary)":"2px solid var(--color-border)",borderRadius:"var(--radius)",cursor:"pointer",transition:"border-color 0.15s, background 0.15s",flexShrink:0,position:"relative"},children:[s("button",{onClick:l=>{l.stopPropagation(),n()},style:{position:"absolute",top:"0.25rem",right:"0.25rem",width:"1.125rem",height:"1.125rem",borderRadius:"50%",background:"var(--color-surface-hover)",border:"none",color:"var(--color-text-secondary)",fontSize:"0.625rem",display:"flex",alignItems:"center",justifyContent:"center",padding:0,cursor:"pointer",lineHeight:1},title:"Delete group",children:""}),s("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2px",width:"3rem",height:"3rem",margin:"0 auto 0.375rem",borderRadius:"4px",overflow:"hidden",background:"var(--color-surface-hover)"},children:[0,1,2,3].map(l=>{const f=a[l];return s("div",{style:{background:"var(--color-surface-hover)",overflow:"hidden"},children:f&&s("img",{src:ye(f.thumbnailKey),alt:"",style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:d=>{d.target.style.display="none"}})},l)})}),s("div",{style:{fontSize:"0.6875rem",fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"center",marginBottom:"0.125rem",color:e.label?"var(--color-text)":"var(--color-text-secondary)"},title:e.label||"Untitled group",children:e.label||"Untitled"}),s("div",{style:{fontSize:"0.625rem",textAlign:"center",color:i?"var(--color-danger)":"var(--color-text-secondary)"},children:[e.keys.length,"/",Ft]})]})}function Xl(){const e=V.value==="__new__";return s("div",{onClick:()=>vo(),onDragOver:yn,onDragEnter:()=>{V.value="__new__"},onDragLeave:()=>{V.value==="__new__"&&(V.value=null)},onDrop:ql,style:{minWidth:"8.5rem",maxWidth:"10rem",padding:"0.5rem",background:e?"rgba(108, 140, 255, 0.08)":"var(--color-bg)",border:e?"2px dashed var(--color-primary)":"2px dashed var(--color-border)",borderRadius:"var(--radius)",cursor:"pointer",transition:"border-color 0.15s, background 0.15s",flexShrink:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"6.5rem"},children:[s("div",{style:{fontSize:"1.5rem",color:e?"var(--color-primary)":"var(--color-text-secondary)",lineHeight:1,marginBottom:"0.375rem"},children:"+"}),s("div",{style:{fontSize:"0.6875rem",color:e?"var(--color-primary)":"var(--color-text-secondary)",fontWeight:500},children:"New Group"})]})}function Ql(){const e=F.value,t=Nl.value,r=mn.value,n=zl.value,o=!!me.value,i=_e.value.length,a=po.value.size,l=i-a,f=e.filter(d=>d.keys.length>0);return s("div",{children:[s("div",{class:"card",style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"0.5rem"},children:[s("div",{children:s("span",{style:{fontSize:"0.875rem"},children:[s("strong",{children:i})," media items",a>0&&s($,{children:["  ",s("span",{style:{color:"var(--color-success)"},children:[a," grouped"]})]}),l>0&&s($,{children:["  ",s("span",{style:{color:"var(--color-text-secondary)"},children:[l," remaining"]})]})]})}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:o?"Click thumbnails to add/remove from selected group, or drag to any group.":"Select or create a group below, then click thumbnails to add them."})]}),s("div",{class:"card",style:{marginBottom:"1rem"},onDragOver:yn,onDragEnter:()=>{V.value="__ungrouped__"},onDragLeave:d=>{const m=d.relatedTarget;m&&d.currentTarget.contains(m)||V.value==="__ungrouped__"&&(V.value=null)},onDrop:Wl,children:[s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},children:[s("h2",{style:{marginBottom:0},children:["Ungrouped Media",s("span",{style:{fontSize:"0.8125rem",fontWeight:400,color:"var(--color-text-secondary)",marginLeft:"0.5rem"},children:["(",t.length,")"]})]}),t.length>0&&o&&s("span",{style:{fontSize:"0.6875rem",color:"var(--color-primary)",fontStyle:"italic"},children:["Click to add to ",(r==null?void 0:r.label)||"Untitled",""]})]}),t.length===0?s("div",{style:{textAlign:"center",padding:"2rem",color:"var(--color-text-secondary)",fontSize:"0.875rem",borderRadius:"var(--radius)",background:V.value==="__ungrouped__"?"rgba(108, 140, 255, 0.06)":"transparent",border:V.value==="__ungrouped__"?"2px dashed var(--color-primary)":"2px dashed transparent",transition:"background 0.15s, border-color 0.15s"},children:"All media has been grouped! Drag items here to ungroup them."}):s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"0.5rem",borderRadius:"var(--radius)",padding:V.value==="__ungrouped__"?"0.5rem":"0",background:V.value==="__ungrouped__"?"rgba(108, 140, 255, 0.06)":"transparent",border:V.value==="__ungrouped__"?"2px dashed var(--color-primary)":"2px dashed transparent",transition:"background 0.15s, border-color 0.15s, padding 0.15s"},children:t.map(d=>s(hi,{item:d,isInGroup:!1,groupId:null,showAssignHint:o},d.key))})]}),s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("h2",{style:{marginBottom:"0.75rem"},children:["Post Groups",s("span",{style:{fontSize:"0.8125rem",fontWeight:400,color:"var(--color-text-secondary)",marginLeft:"0.5rem"},children:["(",e.length,")"]})]}),s("div",{style:{display:"flex",gap:"0.75rem",overflowX:"auto",paddingBottom:"0.5rem"},children:[e.map(d=>s(Zl,{group:d,isSelected:d.id===me.value,onSelect:()=>{me.value=me.value===d.id?null:d.id},onDelete:()=>Ll(d.id)},d.id)),s(Xl,{})]})]}),r&&s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.75rem",gap:"1rem"},children:[s("div",{style:{flex:1},children:[s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.25rem"},children:"Group label  describe this post (used for AI caption generation)"}),s("textarea",{value:r.label,onInput:d=>$l(r.id,d.target.value),placeholder:"e.g., First morning in Shibuya  the energy of the crossing, coffee at Blue Bottle, found a great vintage shop on Cat Street...",style:{width:"100%",minHeight:"3rem",resize:"vertical",fontSize:"0.8125rem",background:"var(--color-bg)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",padding:"0.5rem 0.75rem",color:"var(--color-text)",lineHeight:1.5}})]}),s("div",{style:{fontSize:"0.8125rem",color:r.keys.length>=Ft?"var(--color-danger)":"var(--color-text-secondary)",fontWeight:600,whiteSpace:"nowrap",paddingTop:"1.25rem"},children:[r.keys.length,"/",Ft]})]}),n.length===0?s("div",{style:{textAlign:"center",padding:"2rem",color:"var(--color-text-secondary)",fontSize:"0.875rem",borderRadius:"var(--radius)",border:"2px dashed var(--color-border)"},children:"No items in this group yet. Click thumbnails above or drag media here."}):s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"0.5rem"},children:n.map(d=>s(hi,{item:d,isInGroup:!0,groupId:r.id},d.key))}),n.length>0&&s("div",{style:{marginTop:"0.5rem",fontSize:"0.6875rem",color:"var(--color-text-secondary)",fontStyle:"italic"},children:"Click a thumbnail to remove it from this group."})]}),s("div",{style:{position:"sticky",bottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",background:"var(--color-surface)",borderRadius:"var(--radius-lg)",border:"1px solid var(--color-border)"},children:[s("span",{style:{fontSize:"0.875rem"},children:f.length===0?s("span",{style:{color:"var(--color-text-secondary)"},children:"Create a group and add media to proceed"}):s($,{children:[s("strong",{style:{color:"var(--color-success)"},children:[f.length," post",f.length!==1?"s":""]}),s("span",{style:{color:"var(--color-text-secondary)"},children:[" ","ready (",a," items)"]}),l>0&&s("span",{style:{color:"var(--color-text-secondary)",fontSize:"0.75rem",marginLeft:"0.5rem"},children:["(",l," ungrouped  will not be published)"]})]})}),s("div",{style:{display:"flex",gap:"0.75rem"},children:[s("button",{class:"outline",onClick:Yl,children:"Back to Enhancement"}),s("button",{class:"primary",onClick:Jl,disabled:f.length===0,children:["Continue (",f.length," post",f.length!==1?"s":"",")"]})]})]})]})}const Bt=E({}),Xr=E(null);function go(){Bt.value={},Xr.value=null}function pi(e){if(e===0)return"0 B";const t=1024,r=["B","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(t));return`${(e/Math.pow(t,n)).toFixed(1)} ${r[n]}`}function ec(e){return Bt.value[e]??{jobId:null,status:"idle",bundles:[],error:null}}function Yt(e,t){Bt.value={...Bt.value,[e]:t}}async function vi(e){const t=j.value;if(t){Yt(e.id,{jobId:null,status:"processing",bundles:[],error:null});try{const{id:r}=await kl({sessionId:t,keys:e.keys,groupLabel:e.label||"media"});Yt(e.id,{jobId:r,status:"processing",bundles:[],error:null});const n=2e3,o=150;for(let i=0;i<o;i++){await new Promise(l=>setTimeout(l,n));const a=await Ul(r,t);if(Yt(e.id,{jobId:r,status:a.status==="complete"||a.status==="error"?a.status:"processing",bundles:a.bundles??[],error:a.error??null}),a.status==="complete"||a.status==="error")break}}catch(r){Yt(e.id,{jobId:null,status:"error",bundles:[],error:r instanceof Error?r.message:"Download failed"})}}}const Ur=Y(()=>F.value.length),wt=Y(()=>Object.values(Bt.value).filter(e=>e.status==="complete").length);function tc({bundle:e}){const t=e.status==="complete",r=e.status==="error",n=e.status==="processing"||e.status==="pending";return s("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem 1rem",background:"var(--color-bg)",borderRadius:"var(--radius)",border:r?"1px solid var(--color-danger)":"1px solid var(--color-border)"},children:[s("div",{style:{flex:1},children:[s("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[s("span",{style:{fontSize:"0.625rem",padding:"0.125rem 0.375rem",borderRadius:"3px",background:e.type==="images"?"rgba(108, 200, 108, 0.15)":"rgba(108, 140, 255, 0.15)",color:e.type==="images"?"var(--color-success)":"var(--color-primary)",fontWeight:600,textTransform:"uppercase"},children:e.type==="images"?"Photos":"Videos"}),s("span",{style:{fontSize:"0.8125rem",fontWeight:500,fontFamily:"var(--font-mono)"},children:e.name})]}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:[e.fileCount," file",e.fileCount!==1?"s":"","  ",pi(e.totalSize),t&&e.zipSize>0&&s($,{children:[" (ZIP: ",pi(e.zipSize),")"]})]}),r&&e.error&&s("div",{style:{fontSize:"0.75rem",color:"var(--color-danger)",marginTop:"0.25rem"},children:e.error})]}),s("div",{style:{marginLeft:"1rem"},children:[n&&s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",fontStyle:"italic"},children:"Creating ZIP..."}),t&&e.downloadUrl&&s("a",{href:e.downloadUrl,download:e.name,style:{display:"inline-flex",alignItems:"center",gap:"0.375rem",padding:"0.375rem 0.75rem",fontSize:"0.8125rem",fontWeight:500,background:"var(--color-primary)",color:"#fff",borderRadius:"var(--radius)",textDecoration:"none",cursor:"pointer",transition:"opacity 0.15s"},children:"Download"}),r&&s("span",{style:{fontSize:"0.75rem",color:"var(--color-danger)",fontWeight:500},children:"Failed"})]})]})}function rc({group:e}){const t=ec(e.id),r=Xr.value===e.id,n=t.status==="idle",o=t.status==="processing",i=t.status==="complete",a=t.status==="error",l=e.keys.slice(0,6).map(g=>_e.value.find(w=>w.key===g)).filter(g=>g!==void 0),f=e.keys.map(g=>_e.value.find(w=>w.key===g)).filter(g=>g!==void 0),d=f.filter(g=>g.type==="Photo").length,m=f.filter(g=>g.type==="Video").length,v=t.bundles.filter(g=>g.status==="complete").length,_=t.bundles.length;return s("div",{class:"card",style:{marginBottom:"0.75rem",border:i?"1px solid var(--color-success)":a?"1px solid var(--color-danger)":"1px solid var(--color-border)"},children:[s("div",{onClick:()=>{Xr.value=r?null:e.id},style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",gap:"1rem"},children:[s("div",{style:{flex:1},children:[s("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.375rem"},children:[s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",transition:"transform 0.15s",transform:r?"rotate(90deg)":"rotate(0deg)"},children:""}),s("h3",{style:{margin:0,fontSize:"1rem",color:e.label?"var(--color-text)":"var(--color-text-secondary)"},children:e.label||"Untitled group"}),i&&s("span",{style:{fontSize:"0.625rem",padding:"0.125rem 0.375rem",borderRadius:"3px",background:"rgba(108, 200, 108, 0.15)",color:"var(--color-success)",fontWeight:600},children:"Ready"}),o&&s("span",{style:{fontSize:"0.625rem",padding:"0.125rem 0.375rem",borderRadius:"3px",background:"rgba(108, 140, 255, 0.15)",color:"var(--color-primary)",fontWeight:600},children:["Creating ZIPs... ",v,"/",_]})]}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginLeft:"1.5rem"},children:[e.keys.length," item",e.keys.length!==1?"s":"",d>0&&s($,{children:["  ",d," photo",d!==1?"s":""]}),m>0&&s($,{children:["  ",m," video",m!==1?"s":""]})]})]}),s("div",{style:{display:"flex",gap:"2px",flexShrink:0},children:[l.map(g=>s("div",{style:{width:"2rem",height:"2rem",borderRadius:"3px",overflow:"hidden",background:"var(--color-surface-hover)"},children:s("img",{src:ye(g.thumbnailKey),alt:"",style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:w=>{w.target.style.display="none"}})},g.key)),e.keys.length>6&&s("div",{style:{width:"2rem",height:"2rem",borderRadius:"3px",background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.5625rem",color:"var(--color-text-secondary)"},children:["+",e.keys.length-6]})]}),s("div",{style:{flexShrink:0},children:[n&&s("button",{class:"primary",onClick:g=>{g.stopPropagation(),vi(e)},style:{fontSize:"0.8125rem"},children:"Prepare Download"}),a&&s("button",{class:"outline",onClick:g=>{g.stopPropagation(),vi(e)},style:{fontSize:"0.8125rem"},children:"Retry"})]})]}),r&&(i||o||a)&&s("div",{style:{marginTop:"1rem"},children:[t.bundles.length===0&&o&&s("div",{style:{textAlign:"center",padding:"1.5rem",color:"var(--color-text-secondary)",fontSize:"0.875rem"},children:"Calculating bundles..."}),t.bundles.length>0&&s("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:t.bundles.map((g,w)=>s(tc,{bundle:g},`${e.id}-${w}`))}),i&&s("div",{style:{marginTop:"0.75rem",padding:"0.5rem 0.75rem",background:"rgba(108, 200, 108, 0.06)",borderRadius:"var(--radius)",fontSize:"0.75rem",color:"var(--color-success)"},children:"All bundles ready. Download links expire in 1 hour."}),a&&t.error&&s("div",{style:{marginTop:"0.75rem",padding:"0.5rem 0.75rem",background:"rgba(255, 107, 107, 0.06)",borderRadius:"var(--radius)",fontSize:"0.75rem",color:"var(--color-danger)"},children:t.error})]})]})}function nc(){const e=F.value;return s("div",{children:[s("div",{class:"card",style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"0.5rem"},children:[s("div",{children:s("span",{style:{fontSize:"0.875rem"},children:[s("strong",{children:Ur.value})," post group",Ur.value!==1?"s":"",wt.value>0&&s($,{children:["  ",s("span",{style:{color:"var(--color-success)"},children:[wt.value," ready for download"]})]})]})}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Photos are bundled into one ZIP. Videos are split into bundles under 375 MB each for fast downloads."})]}),e.map(t=>s(rc,{group:t},t.id)),s("div",{style:{position:"sticky",bottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",background:"var(--color-surface)",borderRadius:"var(--radius-lg)",border:"1px solid var(--color-border)"},children:[s("span",{style:{fontSize:"0.875rem"},children:wt.value===0?s("span",{style:{color:"var(--color-text-secondary)"},children:'Click "Prepare Download" on a group to create ZIP bundles'}):s($,{children:[s("strong",{style:{color:"var(--color-success)"},children:[wt.value," of ",Ur.value]}),s("span",{style:{color:"var(--color-text-secondary)"},children:[" ","group",wt.value!==1?"s":""," ready"]})]})}),s("div",{style:{display:"flex",gap:"0.5rem"},children:[s("button",{class:"outline",onClick:()=>Ge(),children:"Back to Grouping"}),s("button",{class:"primary",onClick:()=>Ue("description"),style:{fontSize:"0.8125rem"},children:"Generate Captions"})]})]})]})}E([]);E(!1);E(null);const It=E(!1),sr=E(""),yo=E("Photo"),ar=E(""),At=E(null),je=E(!1);function Mt(e,t,r){sr.value=e,yo.value=t,ar.value=r,At.value=null,je.value=!0,It.value=!0,co(e).then(n=>{At.value=n}).catch(()=>{At.value=null}).finally(()=>{je.value=!1})}function Dr(){It.value=!1,sr.value="",ar.value="",At.value=null,je.value=!1}function ic(){const e=Qo(null);if(qe(()=>{function n(o){o.key==="Escape"&&It.value&&Dr()}return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]),qe(()=>(It.value?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""})),!It.value)return null;const t=At.value,r=yo.value==="Video";return s("div",{ref:e,onClick:n=>{n.target===e.current&&Dr()},style:{position:"fixed",inset:0,zIndex:9999,background:"rgba(0, 0, 0, 0.85)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[s("div",{style:{position:"absolute",top:0,left:0,right:0,display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1.5rem",background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(8px)",zIndex:1},children:[s("div",{style:{fontSize:"0.875rem",fontFamily:"var(--font-mono)",color:"#e4e6f0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:"1rem"},children:ar.value}),s("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[s("button",{class:"outline",onClick:n=>{n.stopPropagation(),fi(sr.value)},style:{fontSize:"0.75rem",padding:"0.25rem 0.75rem",color:"#e4e6f0",borderColor:"rgba(255, 255, 255, 0.2)"},children:"Open in New Tab"}),s("button",{class:"outline",onClick:n=>{n.stopPropagation(),Dr()},style:{fontSize:"0.875rem",padding:"0.25rem 0.625rem",color:"#e4e6f0",borderColor:"rgba(255, 255, 255, 0.2)",fontWeight:700,lineHeight:1},children:""})]})]}),s("div",{style:{maxWidth:"90vw",maxHeight:"80vh",display:"flex",alignItems:"center",justifyContent:"center"},children:[je.value&&s("div",{style:{color:"#e4e6f0",fontSize:"1rem"},children:"Loading..."}),!je.value&&!t&&s("div",{style:{color:"var(--color-danger)",fontSize:"0.875rem",textAlign:"center"},children:[s("div",{style:{marginBottom:"0.5rem"},children:"Failed to load media."}),s("button",{class:"outline",onClick:n=>{n.stopPropagation(),fi(sr.value)},style:{fontSize:"0.75rem",color:"#e4e6f0",borderColor:"rgba(255, 255, 255, 0.2)"},children:"Try opening in new tab"})]}),!je.value&&t&&!r&&s("img",{src:t,alt:ar.value,style:{maxWidth:"90vw",maxHeight:"80vh",objectFit:"contain",borderRadius:"var(--radius)"}}),!je.value&&t&&r&&s("video",{src:t,controls:!0,autoPlay:!0,style:{maxWidth:"90vw",maxHeight:"80vh",borderRadius:"var(--radius)"},children:"Your browser does not support the video tag."})]}),s("div",{style:{position:"absolute",bottom:"1rem",fontSize:"0.6875rem",color:"rgba(255, 255, 255, 0.4)"},children:"Press Esc or click outside to close"})]})}const $t=E(null),re=E(null),he=E(null),Te=E(null),ke=E(""),Ve=E(!1),gr=E([]);function _o(){$t.value=null,re.value=null,he.value=null,Te.value=null,ke.value="",Ve.value=!1,gr.value=[]}function oc(){const e=j.value;if(!e){he.value="No upload session found. Please upload media first.";return}const t=gr.value;if(t.length===0){he.value="No photos selected for enhancement.";return}Po("grouping"),he.value=null,Al({sessionId:e,keys:t}).then(r=>{$t.value=r.id,sc(r.id,e)}).catch(r=>{he.value=r instanceof Error?r.message:"Failed to start enhancement"})}function sc(e,t){const r=setInterval(async()=>{try{const n=await fo(e,t);re.value=n,(n.status==="complete"||n.status==="error")&&(clearInterval(r),n.status==="complete"&&(U.value="review-enhanced"))}catch(n){he.value=n instanceof Error?n.message:"Failed to poll results",clearInterval(r)}},3e3)}async function ac(){if(!Te.value||!ke.value.trim())return;const e=j.value,t=$t.value;if(!(!e||!t)){Ve.value=!0;try{await El(t,{sessionId:e,key:Te.value,feedback:ke.value.trim()}),ke.value="",setTimeout(async()=>{try{const r=await fo(t,e);re.value=r}catch{}Ve.value=!1},5e3)}catch(r){he.value=r instanceof Error?r.message:"Feedback submission failed",Ve.value=!1}}}function lc(){var t;const e=((t=re.value)==null?void 0:t.items)??[];_e.value=e.filter(r=>r.phase==="complete"||r.phase==="feedback").map(r=>({key:r.enhancedKey||r.key,filename:r.filename,thumbnailKey:r.enhancedThumbKey||r.originalThumbKey||r.key,type:"Photo"})),Ue("group-posts")}function Rr(){re.value=null,$t.value=null,Te.value=null,ke.value="",he.value=null,Ge()}function lr(e){switch(e){case"initial":return"Queued";case"phase1":return"Global Enhancement";case"phase2":return"Analyzing";case"phase3":return"Surgical Edits";case"feedback":return"Feedback Applied";case"complete":return"Done";case"error":return"Error";default:return e}}function _n(e){switch(e){case"complete":case"feedback":return"var(--color-success)";case"error":return"var(--color-danger)";case"initial":return"var(--color-text-secondary)";default:return"var(--color-primary)"}}function cc({item:e,isSelected:t,onClick:r}){const n=!!e.enhancedThumbKey,o=ye(n?e.enhancedThumbKey:e.originalThumbKey||e.key);return s("div",{onClick:r,style:{background:t?"rgba(108, 140, 255, 0.08)":"var(--color-bg)",borderRadius:"var(--radius)",overflow:"hidden",border:t?"2px solid var(--color-primary)":"2px solid transparent",cursor:"pointer",transition:"border-color 0.15s"},children:[s("div",{style:{width:"100%",aspectRatio:"1",background:"var(--color-surface-hover)",position:"relative"},children:[s("img",{src:o,alt:e.filename,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover"},onError:i=>{i.target.style.display="none"}}),s("span",{style:{position:"absolute",top:"0.375rem",right:"0.375rem",fontSize:"0.5625rem",padding:"0.125rem 0.375rem",borderRadius:"4px",background:_n(e.phase),color:"#fff",fontWeight:600},children:lr(e.phase)}),e.analysis&&s("span",{style:{position:"absolute",top:"0.375rem",left:"0.375rem",fontSize:"0.6875rem",fontWeight:700,padding:"0.125rem 0.375rem",borderRadius:"4px",background:e.analysis.professionalScore>=8.5?"rgba(81, 207, 102, 0.9)":"rgba(255, 193, 7, 0.9)",color:"#fff"},children:e.analysis.professionalScore.toFixed(1)}),e.imagenEdits>0&&s("span",{style:{position:"absolute",bottom:"0.375rem",left:"0.375rem",fontSize:"0.5625rem",padding:"0.125rem 0.375rem",borderRadius:"4px",background:"rgba(108, 140, 255, 0.85)",color:"#fff",fontWeight:600},children:["+",e.imagenEdits," surgical"]})]}),s("div",{style:{padding:"0.5rem"},children:[s("div",{title:e.filename,style:{fontSize:"0.75rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.filename}),e.error&&s("div",{style:{fontSize:"0.625rem",color:"var(--color-danger)",marginTop:"0.25rem"},children:e.error})]})]})}function uc({item:e}){const t=ye(e.originalThumbKey||e.key),r=e.enhancedThumbKey?ye(e.enhancedThumbKey):null;return s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("h3",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s("span",{children:e.filename}),s("span",{style:{fontSize:"0.75rem",color:_n(e.phase),fontWeight:600},children:lr(e.phase)})]}),s("div",{style:{display:"grid",gridTemplateColumns:r?"1fr 1fr":"1fr",gap:"1rem",marginBottom:"1rem"},children:[s("div",{children:[s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.375rem",textAlign:"center"},children:"Original"}),s("div",{style:{background:"var(--color-surface-hover)",borderRadius:"var(--radius)",overflow:"hidden",aspectRatio:"4/3"},children:s("img",{src:t,alt:`Original: ${e.filename}`,onClick:()=>Mt(e.originalKey,"Photo",e.filename),style:{width:"100%",height:"100%",objectFit:"contain",cursor:"zoom-in"},onError:n=>{n.target.style.display="none"}})})]}),r&&s("div",{children:[s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.375rem",textAlign:"center"},children:["Enhanced",e.analysis&&s("span",{style:{marginLeft:"0.375rem",color:e.analysis.professionalScore>=8.5?"var(--color-success)":"var(--color-warning, #ffc107)"},children:["(Score: ",e.analysis.professionalScore.toFixed(1),")"]})]}),s("div",{style:{background:"var(--color-surface-hover)",borderRadius:"var(--radius)",overflow:"hidden",aspectRatio:"4/3"},children:s("img",{src:r,alt:`Enhanced: ${e.filename}`,onClick:()=>Mt(e.enhancedKey,"Photo",`${e.filename} (enhanced)`),style:{width:"100%",height:"100%",objectFit:"contain",cursor:"zoom-in"},onError:n=>{n.target.style.display="none"}})})]})]}),e.phase1Text&&s("div",{style:{marginBottom:"0.75rem"},children:[s("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"var(--color-text-secondary)",marginBottom:"0.25rem"},children:"Changes Applied:"}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",lineHeight:1.5,background:"var(--color-bg)",padding:"0.5rem 0.75rem",borderRadius:"var(--radius)"},children:e.phase1Text})]}),e.analysis&&!e.analysis.noFurtherEditsNeeded&&s("div",{style:{marginBottom:"0.75rem"},children:[s("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"var(--color-text-secondary)",marginBottom:"0.25rem"},children:"Analysis:"}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",lineHeight:1.5,background:"var(--color-bg)",padding:"0.5rem 0.75rem",borderRadius:"var(--radius)"},children:[s("div",{children:e.analysis.overallAssessment}),e.analysis.remainingImprovements.length>0&&s("ul",{style:{margin:"0.375rem 0 0 0",paddingLeft:"1.25rem"},children:e.analysis.remainingImprovements.map((n,o)=>s("li",{style:{marginBottom:"0.25rem"},children:[s("span",{style:{fontWeight:600,color:n.impact==="high"?"var(--color-danger)":"var(--color-text-secondary)"},children:["[",n.impact,"]"]})," ",n.description,n.imagenSuitable&&s("span",{style:{fontSize:"0.625rem",color:"var(--color-primary)",marginLeft:"0.375rem"},children:"(surgical edit)"})]},o))})]})]}),e.feedbackHistory&&e.feedbackHistory.length>0&&s("div",{style:{marginBottom:"0.75rem"},children:[s("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"var(--color-text-secondary)",marginBottom:"0.25rem"},children:"Feedback History:"}),e.feedbackHistory.map((n,o)=>s("div",{style:{fontSize:"0.75rem",background:"var(--color-bg)",padding:"0.375rem 0.75rem",borderRadius:"var(--radius)",marginBottom:"0.375rem",borderLeft:`3px solid ${n.success?"var(--color-success)":"var(--color-danger)"}`},children:[s("div",{style:{fontWeight:600},children:["You: ",n.userFeedback]}),s("div",{style:{color:"var(--color-text-secondary)"},children:["AI (",n.method,"): ",n.modelResponse]})]},o))]}),(e.phase==="complete"||e.phase==="feedback")&&s("div",{style:{display:"flex",gap:"0.5rem",alignItems:"flex-start"},children:[s("textarea",{value:ke.value,onInput:n=>{ke.value=n.target.value},placeholder:'Give feedback, e.g., "make the sky more blue", "remove the trash can on the right"...',style:{flex:1,minHeight:"2.5rem",resize:"vertical",fontSize:"0.8125rem"},disabled:Ve.value}),s("button",{class:"primary",onClick:ac,disabled:!ke.value.trim()||Ve.value,style:{whiteSpace:"nowrap"},children:Ve.value?"Processing...":"Apply Feedback"})]})]})}function dc(){var o,i,a,l,f;if(qe(()=>{U.value==="enhancing"&&!$t.value&&oc()},[]),U.value==="enhancing"&&(!re.value||re.value.status==="pending"||re.value.status==="processing")){const d=((o=re.value)==null?void 0:o.completedCount)??0,m=((i=re.value)==null?void 0:i.totalCount)??gr.value.length,v=m>0?d/m*100:0;return s("div",{class:"card",style:{textAlign:"center",padding:"3rem"},children:[s("div",{style:{fontSize:"1.5rem",marginBottom:"1rem",color:"var(--color-text-secondary)"},children:"Enhancing Photos..."}),s("p",{style:{color:"var(--color-text-secondary)",maxWidth:"32rem",margin:"0 auto"},children:"Each photo goes through a multi-step AI enhancement pipeline: global enhancement, professional quality analysis, and surgical edits."}),m>0&&s("div",{style:{margin:"1.5rem auto",maxWidth:"24rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8125rem",color:"var(--color-text-secondary)",marginBottom:"0.375rem"},children:[s("span",{children:[d," of ",m," photos"]}),s("span",{children:[Math.round(v),"%"]})]}),s("div",{style:{width:"100%",height:"0.5rem",background:"var(--color-surface-hover)",borderRadius:"4px",overflow:"hidden"},children:s("div",{style:{width:`${v}%`,height:"100%",background:"var(--color-primary)",borderRadius:"4px",transition:"width 0.3s"}})})]}),((a=re.value)==null?void 0:a.items)&&re.value.items.length>0&&s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:"0.5rem",maxWidth:"40rem",margin:"1.5rem auto 0"},children:re.value.items.map(_=>s("div",{style:{fontSize:"0.6875rem",padding:"0.25rem 0.5rem",borderRadius:"var(--radius)",background:"var(--color-bg)",color:_n(_.phase),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:`${_.filename}: ${lr(_.phase)}`,children:[_.filename,": ",lr(_.phase)]},_.key))}),he.value&&s("div",{style:{color:"var(--color-danger)",marginTop:"1.5rem",fontSize:"0.875rem"},children:he.value}),s("button",{class:"outline",onClick:Rr,style:{marginTop:"1.5rem"},children:"Cancel"})]})}if(((l=re.value)==null?void 0:l.status)==="error")return s("div",{class:"card",children:[s("p",{style:{color:"var(--color-danger)"},children:["Enhancement failed: ",re.value.error]}),s("button",{class:"outline",onClick:Rr,style:{marginTop:"1rem"},children:"Back to Selection"})]});const e=((f=re.value)==null?void 0:f.items)||[],t=e.filter(d=>d.phase==="complete"||d.phase==="feedback"),r=e.filter(d=>d.phase==="error"),n=e.find(d=>d.key===Te.value);return!n&&e.length>0&&!Te.value&&(Te.value=e[0].key),s("div",{children:[he.value&&s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:he.value}),s("div",{class:"card",style:{marginBottom:"1.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s("div",{children:s("span",{style:{fontSize:"0.875rem"},children:[s("strong",{style:{color:"var(--color-success)"},children:[t.length," enhanced"]}),r.length>0&&s($,{children:[" / ",s("span",{style:{color:"var(--color-danger)"},children:[r.length," failed"]})]})," / ",s("span",{style:{color:"var(--color-text-secondary)"},children:[e.length," total"]})]})}),s("div",{children:s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Click a photo to view comparison. Give feedback to request changes."})})]}),s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("h2",{style:{marginBottom:"1rem"},children:"Enhanced Photos"}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"0.75rem"},children:e.map(d=>s(cc,{item:d,isSelected:d.key===Te.value,onClick:()=>{Te.value=d.key,ke.value=""}},d.key))})]}),n&&s(uc,{item:n}),s("div",{style:{position:"sticky",bottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",background:"var(--color-surface)",borderRadius:"var(--radius-lg)",border:"1px solid var(--color-border)"},children:[s("span",{style:{fontSize:"0.875rem"},children:[t.length," photo(s) ready for grouping"]}),s("div",{style:{display:"flex",gap:"0.75rem"},children:[s("button",{class:"outline",onClick:Rr,children:"Back to Selection"}),s("button",{class:"primary",onClick:lc,disabled:t.length===0,children:["Proceed to Grouping (",t.length,")"]})]})]})]})}const fc=[{id:"triage",title:"Media Triage",description:"Identify and delete unsaveable media",details:["AI detects blurry, dark, and accidental photos/videos","Review flagged items with thumbnail previews","Multi-select deletion with confirmation"],startStep:"triage-upload",accentColor:"var(--color-danger)",accentBg:"rgba(255, 107, 107, 0.1)"},{id:"selection",title:"Media Selection",description:"Full AI pipeline for Instagram posts",details:["AI selects the best photos and videos","Enhance, group into posts, generate captions","Download bundles or publish to Instagram"],startStep:"upload",accentColor:"var(--color-primary)",accentBg:"rgba(108, 140, 255, 0.1)"}];function mi(e){zt.value=e.id,U.value=e.startStep}function hc(){return s("div",{children:[s("p",{style:{color:"var(--color-text-secondary)",fontSize:"0.9375rem",marginBottom:"2rem",lineHeight:"1.6"},children:"Choose a tool to get started. Upload your media files, and AI will handle the rest."}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:"1.5rem"},children:fc.map(e=>s("div",{onClick:()=>mi(e),role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),mi(e))},style:{background:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-lg)",padding:"2rem",cursor:"pointer",transition:"all 0.2s ease",position:"relative",overflow:"hidden"},onMouseEnter:t=>{const r=t.currentTarget;r.style.borderColor=e.accentColor,r.style.transform="translateY(-2px)",r.style.boxShadow=`0 4px 12px ${e.accentBg}`},onMouseLeave:t=>{const r=t.currentTarget;r.style.borderColor="var(--color-border)",r.style.transform="none",r.style.boxShadow="none"},children:[s("div",{style:{position:"absolute",top:0,left:0,right:0,height:"3px",background:e.accentColor,opacity:.6}}),s("h2",{style:{fontSize:"1.25rem",fontWeight:600,marginBottom:"0.5rem",color:e.accentColor},children:e.title}),s("p",{style:{color:"var(--color-text-secondary)",fontSize:"0.9375rem",marginBottom:"1.25rem"},children:e.description}),s("ul",{style:{listStyle:"none",padding:0,margin:0},children:e.details.map((t,r)=>s("li",{style:{fontSize:"0.8125rem",color:"var(--color-text-secondary)",padding:"0.25rem 0",paddingLeft:"1rem",position:"relative"},children:[s("span",{style:{position:"absolute",left:0,color:e.accentColor,opacity:.7},children:"-"}),t]},r))}),s("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"flex-end"},children:s("span",{style:{fontSize:"0.8125rem",fontWeight:500,color:e.accentColor,display:"flex",alignItems:"center",gap:"0.25rem"},children:["Get started",s("span",{"aria-hidden":"true",children:""})]})})]},e.id))})]})}const Qr=E(""),en=E(""),Et=E(!1);async function pc(e){if(e.preventDefault(),!Et.value){Et.value=!0;try{await vl(Qr.value,en.value)}catch{}finally{Et.value=!1}}}function vc(){return s("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:s("div",{class:"card",style:{maxWidth:"400px",width:"100%"},children:[s("h2",{style:{marginBottom:"1.5rem",textAlign:"center"},children:"Sign In"}),s("form",{onSubmit:pc,children:[s("div",{style:{marginBottom:"1rem"},children:[s("label",{htmlFor:"email",style:{display:"block",fontSize:"0.875rem",marginBottom:"0.25rem",color:"var(--color-text-secondary)"},children:"Email"}),s("input",{id:"email",type:"email",value:Qr.value,onInput:e=>{Qr.value=e.target.value},required:!0,autoComplete:"email",style:{width:"100%",padding:"0.5rem 0.75rem",borderRadius:"var(--radius)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)",fontSize:"0.875rem",boxSizing:"border-box"}})]}),s("div",{style:{marginBottom:"1.5rem"},children:[s("label",{htmlFor:"password",style:{display:"block",fontSize:"0.875rem",marginBottom:"0.25rem",color:"var(--color-text-secondary)"},children:"Password"}),s("input",{id:"password",type:"password",value:en.value,onInput:e=>{en.value=e.target.value},required:!0,autoComplete:"current-password",style:{width:"100%",padding:"0.5rem 0.75rem",borderRadius:"var(--radius)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)",fontSize:"0.875rem",boxSizing:"border-box"}})]}),$e.value&&s("div",{style:{color:"var(--color-danger)",fontSize:"0.875rem",marginBottom:"1rem",textAlign:"center"},children:$e.value}),s("button",{type:"submit",class:"primary",disabled:Et.value,style:{width:"100%"},children:Et.value?"Signing in...":"Sign In"})]})]})})}const mc=new Set([".jpg",".jpeg",".png",".gif",".webp",".heic",".heif",".mp4",".mov",".avi",".webm",".mkv"]),gc=[{description:"Media files",accept:{"image/*":[".jpg",".jpeg",".png",".gif",".webp",".heic",".heif"],"video/*":[".mp4",".mov",".avi",".webm",".mkv"]}}],cr=160,G=E([]),we=E(null);function yc(){return crypto.randomUUID()}function wo(e){const t=e.name.lastIndexOf(".");if(t===-1)return!1;const r=e.name.slice(t).toLowerCase();return mc.has(r)}function _c(e){return e.type.startsWith("video/")?"video":"image"}async function wc(e){return new Promise((t,r)=>{const n=URL.createObjectURL(e),o=new Image;o.onload=()=>{const i=Math.min(cr/o.width,cr/o.height,1),a=Math.round(o.width*i),l=Math.round(o.height*i),f=document.createElement("canvas");f.width=a,f.height=l;const d=f.getContext("2d");if(!d){URL.revokeObjectURL(n),r(new Error("Canvas not supported"));return}d.drawImage(o,0,0,a,l),URL.revokeObjectURL(n),t(f.toDataURL("image/jpeg",.7))},o.onerror=()=>{URL.revokeObjectURL(n),r(new Error("Failed to load image"))},o.src=n})}async function Sc(e){return new Promise((t,r)=>{const n=URL.createObjectURL(e),o=document.createElement("video");o.preload="metadata",o.muted=!0,o.playsInline=!0,o.onloadeddata=()=>{o.currentTime=Math.min(1,o.duration/2)},o.onseeked=()=>{const i=Math.min(cr/o.videoWidth,cr/o.videoHeight,1),a=Math.round(o.videoWidth*i),l=Math.round(o.videoHeight*i),f=document.createElement("canvas");f.width=a,f.height=l;const d=f.getContext("2d");if(!d){URL.revokeObjectURL(n),r(new Error("Canvas not supported"));return}d.drawImage(o,0,0,a,l),URL.revokeObjectURL(n),t(f.toDataURL("image/jpeg",.7))},o.onerror=()=>{URL.revokeObjectURL(n),r(new Error("Failed to load video"))},o.src=n})}async function bc(e){try{if(e.type.startsWith("video/"))return await Sc(e);if(e.type.startsWith("image/"))return await wc(e)}catch{}}async function So(e){const t=[];for await(const r of e.values())if(r.kind==="file"){const n=await r.getFile();wo(n)&&t.push(n)}else if(r.kind==="directory"){const n=await So(r);t.push(...n)}return t}async function xc(){try{const e=await window.showOpenFilePicker({multiple:!0,types:gc}),t=[];for(const r of e)t.push(await r.getFile());t.length>0&&wn(t)}catch(e){if(e instanceof DOMException&&e.name==="AbortError")return;we.value=e instanceof Error?e.message:"Failed to open file picker"}}async function Cc(){try{const e=await window.showDirectoryPicker(),t=await So(e);if(t.length===0){we.value="No media files found in the selected folder.";return}we.value=null,wn(t)}catch(e){if(e instanceof DOMException&&e.name==="AbortError")return;we.value=e instanceof Error?e.message:"Failed to open folder picker"}}function wn(e){j.value||(j.value=yc());const t=j.value,r=new Set(G.value.map(i=>i.name)),n=[],o=new Map;for(const i of e)r.has(i.name)||(r.add(i.name),n.push({name:i.name,size:i.size,key:`${t}/${i.name}`,status:"pending",progress:0,mediaType:_c(i)}),o.set(i.name,i));if(n.length!==0){G.value=[...G.value,...n];for(const i of n){const a=o.get(i.name);bc(a).then(l=>{l&&Qe(i.name,{thumbnailDataUrl:l})}),Tc(t,i.name,a)}}}async function Tc(e,t,r){Qe(t,{status:"uploading",progress:0});try{let n;if(r.size>so)n=await ao(e,r,(o,i)=>{Qe(t,{progress:Math.round(o/i*100)})});else{const o=await io(e,t,r.type);n=o.key,await oo(o.uploadUrl,r,(i,a)=>{Qe(t,{progress:Math.round(i/a*100)})})}Qe(t,{status:"done",progress:100,key:n})}catch(n){Qe(t,{status:"error",error:n instanceof Error?n.message:"Upload failed"})}}function Qe(e,t){G.value=G.value.map(r=>r.name===e?{...r,...t}:r)}function Ic(e){G.value=G.value.filter(t=>t.name!==e)}function Ac(){G.value=[],j.value=null}function Ec(e){return new Promise((t,r)=>{const n=[];function o(){e.readEntries(i=>{i.length===0?t(n):(n.push(...i),o())},r)}o()})}function kc(e){return new Promise((t,r)=>e.file(t,r))}async function bo(e){if(e.isFile)try{return[await kc(e)]}catch{return[]}if(e.isDirectory){const t=e.createReader(),r=await Ec(t);return(await Promise.all(r.map(bo))).flat()}return[]}async function Uc(e){const r=Array.from(e.items).map(o=>{var i;return(i=o.webkitGetAsEntry)==null?void 0:i.call(o)}).filter(o=>o!=null);return r.length===0?Array.from(e.files):(await Promise.all(r.map(bo))).flat()}async function Dc(e){if(e.preventDefault(),e.stopPropagation(),!e.dataTransfer)return;const r=(await Uc(e.dataTransfer)).filter(wo);r.length>0&&wn(r)}function Rc(e){e.preventDefault(),e.stopPropagation()}function Pc(){const e=G.value.filter(t=>t.status==="done").map(t=>t.key);if(e.length!==0){if(!st.value.trim()){we.value="Please enter a trip or event description before continuing.";return}we.value=null,dt.value=e,Ue("selecting")}}function Fc(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:`${(e/(1024*1024*1024)).toFixed(1)} GB`}function Bc(){const e=G.value.length>0&&G.value.every(i=>i.status==="done"||i.status==="error"),t=G.value.filter(i=>i.status==="done").length,r=G.value.some(i=>i.status==="uploading"),n=G.value.length,o=n>0?Math.round(G.value.reduce((i,a)=>i+a.progress,0)/n):0;return s("div",{class:"card",children:[s("p",{style:{color:"var(--color-text-secondary)",fontSize:"0.875rem",marginBottom:"1.5rem"},children:"Upload media files for AI selection. Choose individual files, select a folder, or drag and drop."}),s("div",{style:{display:"flex",gap:"0.75rem",marginBottom:"1rem"},children:[s("button",{class:"primary",onClick:xc,children:"Choose Files"}),s("button",{class:"outline",onClick:Cc,children:"Choose Folder"})]}),s("div",{onDrop:Dc,onDragOver:Rc,style:{border:"2px dashed var(--color-border)",borderRadius:"var(--radius)",padding:"1.5rem",textAlign:"center",marginBottom:"1.5rem",transition:"border-color 0.2s"},children:[s("div",{style:{fontSize:"1rem",marginBottom:"0.375rem",color:"var(--color-text-secondary)"},children:"or drop files here"}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"JPEG, PNG, GIF, WebP, HEIC, MP4, MOV, AVI, WebM, MKV"})]}),G.value.length>0&&s("div",{style:{background:"var(--color-bg)",borderRadius:"var(--radius)",padding:"0.5rem",maxHeight:"480px",overflowY:"auto",marginBottom:"1rem"},children:G.value.map(i=>s("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.375rem 0.5rem",borderBottom:"1px solid var(--color-border)"},children:[s("div",{style:{width:"40px",height:"40px",borderRadius:"4px",overflow:"hidden",flexShrink:0,background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center"},children:i.thumbnailDataUrl?s("img",{src:i.thumbnailDataUrl,alt:i.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):s("span",{style:{fontSize:"0.625rem",color:"var(--color-text-secondary)",textTransform:"uppercase"},children:i.mediaType==="video"?"VID":"IMG"})}),s("span",{style:{flex:1,fontSize:"0.8125rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:i.name,children:i.name}),s("span",{style:{fontSize:"0.625rem",padding:"0.125rem 0.375rem",borderRadius:"4px",background:i.mediaType==="video"?"rgba(108, 140, 255, 0.15)":"rgba(81, 207, 102, 0.15)",color:i.mediaType==="video"?"var(--color-primary)":"var(--color-success)",flexShrink:0,textTransform:"uppercase",fontWeight:600},children:i.mediaType==="video"?"Video":"Photo"}),s("span",{style:{fontSize:"0.6875rem",color:"var(--color-text-secondary)",flexShrink:0},children:Fc(i.size)}),s("span",{style:{fontSize:"0.6875rem",color:i.status==="error"?"var(--color-danger)":"var(--color-text-secondary)",flexShrink:0,minWidth:"3.5rem",textAlign:"right",position:"relative",cursor:i.status==="error"?"help":"default"},title:i.status==="error"?i.error||"Upload failed":void 0,children:i.status==="uploading"?`${i.progress}%`:i.status==="done"?"Uploaded":i.status==="error"?s($,{children:["Failed ",s("span",{style:{fontSize:"0.625rem",opacity:.8},children:""})]}):"Pending"}),s("button",{class:"outline",onClick:()=>Ic(i.name),disabled:i.status==="uploading",style:{padding:"0.125rem 0.5rem",fontSize:"0.75rem",flexShrink:0},children:"Remove"})]},i.name))}),r&&s("div",{style:{marginBottom:"1rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.375rem"},children:[s("span",{children:["Uploading ",t," of ",n," files..."]}),s("span",{children:[o,"%"]})]}),s("div",{style:{height:"4px",background:"var(--color-border)",borderRadius:"2px",overflow:"hidden"},children:s("div",{style:{height:"100%",width:`${o}%`,background:"var(--color-primary)",transition:"width 0.3s ease",borderRadius:"2px"}})})]}),we.value&&s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:we.value}),G.value.length===0&&s("p",{style:{color:"var(--color-text-secondary)",padding:"1.5rem 1rem",textAlign:"center",fontSize:"0.875rem"},children:"No files selected yet. Use the buttons above or drag and drop media files."}),s("div",{style:{marginBottom:"1.5rem"},children:[s("label",{style:{display:"block",fontSize:"0.8125rem",fontWeight:500,marginBottom:"0.5rem"},children:"Trip / Event Context"}),s("input",{type:"text",placeholder:'e.g., "3-day trip to Tokyo, Oct 2025"',value:st.value,onInput:i=>{var a;st.value=i.target.value,(a=we.value)!=null&&a.includes("trip or event")&&(we.value=null)},style:{width:"100%",padding:"0.625rem 0.75rem",fontSize:"0.875rem",background:"var(--color-bg)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",outline:"none"}}),s("p",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginTop:"0.375rem"},children:"Describe the trip or event to help the AI understand context for media selection."})]}),G.value.length>0&&s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:[t," of ",n," file(s) uploaded",r&&"  uploading..."]}),s("div",{style:{display:"flex",gap:"0.75rem"},children:[s("button",{class:"outline",onClick:Ac,disabled:r,children:"Clear all"}),s("button",{class:"primary",onClick:Pc,disabled:!e||t===0,children:"Continue to Selection"})]})]})]})}const kt=E(!1),ur=E(null);async function Mc(){kt.value=!0,ur.value=null;try{const e=ce?{sessionId:j.value}:{paths:dt.value},t=await lo(e);Me.value=t.id,U.value="processing"}catch(e){ur.value=e instanceof Error?e.message:"Failed to start triage"}finally{kt.value=!1}}function Oc(){U.value="browse"}function Nc(e){const t=e.split("/");return t[t.length-1]||e}function zc(){const e=dt.value;return s("div",{class:"card",children:[s("h2",{children:"Files to triage"}),s("p",{style:{color:"var(--color-text-secondary)",fontSize:"0.875rem",marginBottom:"1rem"},children:["The following ",e.length," file(s) will be sent for AI triage analysis. Media files will be evaluated and categorized as keep or discard."]}),s("div",{style:{background:"var(--color-bg)",borderRadius:"var(--radius)",padding:"0.75rem",maxHeight:"400px",overflowY:"auto",marginBottom:"1.5rem"},children:e.map(t=>s("div",{style:{padding:"0.375rem 0",fontSize:"0.8125rem",fontFamily:"var(--font-mono)",borderBottom:"1px solid var(--color-border)"},children:Nc(t)},t))}),ur.value&&s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:ur.value}),s("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[s("button",{class:"outline",onClick:Oc,disabled:kt.value,children:"Back"}),s("button",{class:"primary",onClick:Mc,disabled:kt.value,children:kt.value?"Starting...":"Start Triage"})]})]})}const yr=E(null),Q=E(null),Se=E(null),be=E(new Set),xe=E(new Set),et=E(!1),tt=E(!1);function xo(){yr.value=null,Q.value=null,Se.value=null,be.value=new Set,xe.value=new Set,et.value=!1,tt.value=!1}function Lc(){const e=j.value;if(!e){Se.value="No upload session found. Please upload media first.";return}Po("enhancement"),Se.value=null,Tl({sessionId:e,tripContext:st.value}).then(t=>{yr.value=t.id,$c(t.id,e)}).catch(t=>{Se.value=t instanceof Error?t.message:"Failed to start selection"})}function $c(e,t){const r=setInterval(async()=>{try{const n=await Il(e,t);Q.value=n,(n.status==="complete"||n.status==="error")&&(clearInterval(r),n.status==="complete"&&(U.value="review-selection"))}catch(n){Se.value=n instanceof Error?n.message:"Failed to poll results",clearInterval(r)}},3e3)}function gi(e,t){if(t){const r=new Set(xe.value);r.has(e.key)?r.delete(e.key):r.add(e.key),xe.value=r;const n=new Set(be.value);n.delete(e.key),be.value=n}else{const r=new Set(be.value);r.has(e.key)?r.delete(e.key):r.add(e.key),be.value=r;const n=new Set(xe.value);n.delete(e.key),xe.value=n}}function Co(){var n;if(!((n=Q.value)!=null&&n.selected))return[];const e=xe.value,t=be.value,r=(Q.value.selected||[]).filter(o=>!e.has(o.key));if(Q.value.excluded)for(const o of Q.value.excluded)t.has(o.key)&&r.push({rank:r.length+1,media:o.media,filename:o.filename,key:o.key,type:"Photo",scene:"",justification:"Added by user override",thumbnailUrl:o.thumbnailUrl});return r}function Kc(){var n;if(!((n=Q.value)!=null&&n.excluded))return[];const e=be.value,t=xe.value,r=(Q.value.excluded||[]).filter(o=>!e.has(o.key));if(Q.value.selected)for(const o of Q.value.selected)t.has(o.key)&&r.push({media:o.media,filename:o.filename,key:o.key,reason:"Removed by user override",category:"redundant-scene",thumbnailUrl:o.thumbnailUrl});return r}function jc(){const e=Co();gr.value=e.map(t=>t.key),Ue("enhancing")}function Pr(){Q.value=null,yr.value=null,be.value=new Set,xe.value=new Set,et.value=!1,tt.value=!1,Se.value=null,Ge()}function Hc({item:e,onToggle:t}){const r=be.value.has(e.key);return s("div",{style:{background:r?"rgba(108, 140, 255, 0.08)":"var(--color-bg)",borderRadius:"var(--radius)",overflow:"hidden",border:r?"2px solid var(--color-primary)":"2px solid transparent"},children:[s("div",{style:{width:"100%",aspectRatio:"1",background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[s("img",{src:e.thumbnailUrl,alt:e.filename,loading:"lazy",onClick:()=>Mt(e.key,e.type,e.filename),style:{width:"100%",height:"100%",objectFit:"cover",cursor:"zoom-in"},onError:n=>{n.target.style.display="none"}}),s("span",{style:{position:"absolute",top:"0.375rem",left:"0.375rem",background:"var(--color-primary)",color:"#fff",fontSize:"0.6875rem",fontWeight:700,width:"1.5rem",height:"1.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.rank}),s("span",{style:{position:"absolute",top:"0.375rem",right:"0.375rem",fontSize:"0.5625rem",padding:"0.125rem 0.375rem",borderRadius:"4px",background:e.type==="Video"?"rgba(108, 140, 255, 0.85)":"rgba(81, 207, 102, 0.85)",color:"#fff",fontWeight:600,textTransform:"uppercase"},children:e.type})]}),s("div",{style:{padding:"0.5rem"},children:[s("div",{title:e.filename,style:{fontSize:"0.75rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginBottom:"0.25rem"},children:e.filename}),e.scene&&s("div",{style:{fontSize:"0.6875rem",color:"var(--color-primary)",marginBottom:"0.25rem"},children:e.scene}),s("div",{style:{fontSize:"0.625rem",color:"var(--color-text-secondary)",lineHeight:1.4},children:e.justification}),e.comparisonNote&&s("div",{style:{fontSize:"0.625rem",color:"var(--color-text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:e.comparisonNote}),s("button",{class:"outline",onClick:t,style:{marginTop:"0.5rem",padding:"0.125rem 0.5rem",fontSize:"0.6875rem",width:"100%"},children:r?"Undo Add":"Remove"})]})]})}function Vc({item:e,onToggle:t}){const r=xe.value.has(e.key);return s("div",{style:{background:r?"rgba(255, 107, 107, 0.08)":"var(--color-bg)",borderRadius:"var(--radius)",overflow:"hidden",border:r?"2px solid var(--color-danger)":"2px solid transparent"},children:[s("div",{style:{width:"100%",aspectRatio:"1",background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[s("img",{src:e.thumbnailUrl,alt:e.filename,loading:"lazy",onClick:()=>Mt(e.key,uo(e.filename)?"Video":"Photo",e.filename),style:{width:"100%",height:"100%",objectFit:"cover",cursor:"zoom-in",opacity:.7},onError:n=>{n.target.style.display="none"}}),s("span",{style:{position:"absolute",top:"0.375rem",right:"0.375rem",fontSize:"0.5625rem",padding:"0.125rem 0.375rem",borderRadius:"4px",background:"rgba(255, 107, 107, 0.85)",color:"#fff",fontWeight:600},children:e.category.replace("-"," ")})]}),s("div",{style:{padding:"0.5rem"},children:[s("div",{title:e.filename,style:{fontSize:"0.75rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginBottom:"0.25rem"},children:e.filename}),s("div",{style:{fontSize:"0.625rem",color:"var(--color-text-secondary)",lineHeight:1.4},children:e.reason}),e.duplicateOf&&s("div",{style:{fontSize:"0.625rem",color:"var(--color-text-secondary)",fontStyle:"italic",marginTop:"0.125rem"},children:["Duplicate of: ",e.duplicateOf]}),s("button",{class:"outline",onClick:t,style:{marginTop:"0.5rem",padding:"0.125rem 0.5rem",fontSize:"0.6875rem",width:"100%"},children:r?"Undo Remove":"Add to Selection"})]})]})}function qc({group:e}){return s("div",{style:{background:"var(--color-bg)",borderRadius:"var(--radius)",padding:"0.75rem",marginBottom:"0.75rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[s("strong",{style:{fontSize:"0.875rem"},children:e.name}),s("span",{style:{fontSize:"0.6875rem",color:"var(--color-text-secondary)"},children:[e.items.filter(t=>t.selected).length," /"," ",e.items.length," selected"]})]}),(e.gps||e.timeRange)&&s("div",{style:{fontSize:"0.6875rem",color:"var(--color-text-secondary)",marginBottom:"0.5rem"},children:[e.gps&&s("span",{children:e.gps}),e.gps&&e.timeRange&&s("span",{children:"  "}),e.timeRange&&s("span",{children:e.timeRange})]}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(80px, 1fr))",gap:"0.375rem"},children:e.items.map(t=>s("div",{style:{position:"relative",aspectRatio:"1",borderRadius:"4px",overflow:"hidden",border:t.selected?"2px solid var(--color-success)":"2px solid var(--color-border)",opacity:t.selected?1:.5},title:`${t.filename}: ${t.description}`,children:s("img",{src:t.thumbnailUrl,alt:t.filename,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover"},onError:r=>{r.target.style.display="none"}})},t.key))})]})}function Wc(){var o,i;if(qe(()=>{U.value==="selecting"&&!yr.value&&Lc()},[]),U.value==="selecting"||Q.value&&(Q.value.status==="pending"||Q.value.status==="processing"))return s("div",{class:"card",style:{textAlign:"center",padding:"3rem"},children:[s("div",{style:{fontSize:"1.5rem",marginBottom:"1rem",color:"var(--color-text-secondary)"},children:"Analyzing Media..."}),s("p",{style:{color:"var(--color-text-secondary)",maxWidth:"32rem",margin:"0 auto"},children:"The AI is analyzing your media files to select the best items for posting. This includes scene detection, deduplication, and content evaluation."}),s("p",{style:{color:"var(--color-text-secondary)",fontSize:"0.8125rem",marginTop:"1rem"},children:"This may take 1-3 minutes depending on the number of files..."}),Se.value&&s("div",{style:{color:"var(--color-danger)",marginTop:"1.5rem",fontSize:"0.875rem"},children:Se.value}),s("button",{class:"outline",onClick:Pr,style:{marginTop:"1.5rem"},children:"Cancel"})]});if(((o=Q.value)==null?void 0:o.status)==="error")return s("div",{class:"card",children:[s("p",{style:{color:"var(--color-danger)"},children:["Selection failed: ",Q.value.error]}),s("button",{class:"outline",onClick:Pr,style:{marginTop:"1rem"},children:"Back to Upload"})]});const e=Co(),t=Kc(),r=((i=Q.value)==null?void 0:i.sceneGroups)||[],n=be.value.size>0||xe.value.size>0;return s("div",{children:[Se.value&&s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:Se.value}),s("div",{class:"card",style:{marginBottom:"1.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s("div",{children:[s("span",{style:{fontSize:"0.875rem"},children:[s("strong",{style:{color:"var(--color-success)"},children:[e.length," selected"]})," / ",s("span",{style:{color:"var(--color-text-secondary)"},children:[t.length," excluded"]})," / ",s("span",{style:{color:"var(--color-text-secondary)"},children:[r.length," scenes"]})]}),n&&s("span",{style:{fontSize:"0.75rem",color:"var(--color-primary)",marginLeft:"0.75rem"},children:"(modified)"})]}),s("div",{children:s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Click thumbnails to view full-size. Use buttons to override AI selections."})})]}),s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("h2",{style:{color:"var(--color-success)",marginBottom:"1rem"},children:["Selected (",e.length,")"]}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"0.75rem"},children:e.map(a=>s(Hc,{item:a,onToggle:()=>gi(a,!0)},a.key))}),e.length===0&&s("p",{style:{color:"var(--color-text-secondary)",textAlign:"center",padding:"1.5rem"},children:"No items selected. Add items from the excluded section below."})]}),s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("div",{onClick:()=>{et.value=!et.value},style:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[s("h2",{style:{color:"var(--color-text-secondary)",marginBottom:0},children:["Excluded (",t.length,")"]}),s("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:et.value?"Collapse":"Expand"})]}),et.value&&s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"0.75rem",marginTop:"1rem"},children:t.map(a=>s(Vc,{item:a,onToggle:()=>gi(a,!1)},a.key))})]}),r.length>0&&s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("div",{onClick:()=>{tt.value=!tt.value},style:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[s("h2",{style:{color:"var(--color-text-secondary)",marginBottom:0},children:["Scene Groups (",r.length,")"]}),s("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:tt.value?"Collapse":"Expand"})]}),tt.value&&s("div",{style:{marginTop:"1rem"},children:r.map(a=>s(qc,{group:a},a.name))})]}),s("div",{style:{position:"sticky",bottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",background:"var(--color-surface)",borderRadius:"var(--radius-lg)",border:"1px solid var(--color-border)"},children:[s("span",{style:{fontSize:"0.875rem"},children:[e.length," item(s) selected for enhancement",n&&s("span",{style:{color:"var(--color-primary)",marginLeft:"0.5rem"},children:"(includes overrides)"})]}),s("div",{style:{display:"flex",gap:"0.75rem"},children:[s("button",{class:"outline",onClick:Pr,children:"Back to Upload"}),s("button",{class:"primary",onClick:jc,disabled:e.length===0,children:["Confirm Selection (",e.length,")"]})]})]})]})}const tn=[{id:1,label:"Upload",steps:["upload"]},{id:2,label:"Select",steps:["selecting","review-selection"]},{id:3,label:"Enhance",steps:["enhancing","review-enhanced"]},{id:4,label:"Group",steps:["group-posts"]},{id:5,label:"Download",steps:["publish"]},{id:6,label:"Caption",steps:["description"]}];function To(e){return tn.findIndex(t=>t.steps.includes(e))}const Io=Y(()=>To(U.value)),Gc=Y(()=>{const e=[...Oe.value.map(t=>To(t)),Io.value].filter(t=>t>=0);return Math.max(...e,0)}),Jc={display:"flex",alignItems:"center",gap:"0",marginBottom:"1.5rem",padding:"0.75rem 1rem",background:"var(--color-surface)",borderRadius:"var(--radius-lg)",border:"1px solid var(--color-border)",overflowX:"auto",flexWrap:"wrap",justifyContent:"center"};function Yc(e){const t={display:"flex",alignItems:"center",gap:"0.375rem",padding:"0.375rem 0.75rem",borderRadius:"999px",fontSize:"0.75rem",fontWeight:"600",letterSpacing:"0.02em",whiteSpace:"nowrap",transition:"all 0.2s ease",border:"2px solid transparent"};switch(e){case"completed":return{...t,background:"rgba(81, 207, 102, 0.12)",color:"#51cf66",border:"2px solid rgba(81, 207, 102, 0.25)",cursor:"pointer"};case"current":return{...t,background:"rgba(108, 140, 255, 0.15)",color:"#6c8cff",border:"2px solid rgba(108, 140, 255, 0.4)",cursor:"default"};case"future":return{...t,background:"transparent",color:"var(--color-text-secondary)",opacity:"0.5",cursor:"default"}}}function Zc(e){const t={display:"flex",alignItems:"center",justifyContent:"center",width:"1.25rem",height:"1.25rem",borderRadius:"50%",fontSize:"0.625rem",fontWeight:"700",lineHeight:"1",flexShrink:"0"};switch(e){case"completed":return{...t,background:"#51cf66",color:"#0f1117"};case"current":return{...t,background:"#6c8cff",color:"#ffffff"};case"future":return{...t,background:"var(--color-border)",color:"var(--color-text-secondary)"}}}function Xc(e){return{display:"flex",alignItems:"center",padding:"0 0.25rem",color:e?"rgba(81, 207, 102, 0.5)":"var(--color-border)",fontSize:"0.875rem",flexShrink:"0",userSelect:"none"}}function Qc(){const e=Io.value,t=Gc.value;return s("nav",{style:Jc,"aria-label":"Workflow steps",children:tn.map((r,n)=>{const o=n<e?"completed":n===e?"current":n<=t?"completed":"future",i=o==="completed";function a(){if(!i)return;const l=r.steps[0];Ue(l)}return s($,{children:[s("div",{style:Yc(o),onClick:a,role:i?"button":void 0,tabIndex:i?0:void 0,"aria-current":o==="current"?"step":void 0,onKeyDown:i?l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),a())}:void 0,title:i?`Go back to ${r.label}`:o==="current"?`Currently on ${r.label}`:r.label,children:[s("span",{style:Zc(o),children:o==="completed"&&n<e?"":r.id}),s("span",{children:r.label})]},r.id),n<tn.length-1&&s("span",{style:Xc(n<e),"aria-hidden":"true",children:""})]})})})}const We=E({}),Re=E(null);function Ao(){We.value={}}async function eu(){if(Re.value===null)try{const e=await Fl();Re.value=e.instagramConfigured}catch{Re.value=!1}}function tu(e,t,r){const n=rt(e);We.value={...We.value,[e]:{...n,caption:t,hashtags:r}}}function rt(e){return We.value[e]??{jobId:null,status:"idle",phase:"",progress:{completed:0,total:0},instagramPostId:null,error:null,caption:"",hashtags:[]}}function Zt(e,t){We.value={...We.value,[e]:t}}const Fr=Y(()=>F.value.length),St=Y(()=>Object.values(We.value).filter(e=>e.status==="published").length);function ru(e){switch(e){case"creating_containers":return"Uploading media to Instagram...";case"processing_videos":return"Processing videos on Instagram...";case"creating_carousel":return"Creating carousel post...";case"publishing":return"Publishing...";case"published":return"Published!";default:return"Preparing..."}}async function yi(e){const t=j.value;if(!t)return;const r=rt(e.id);Zt(e.id,{...r,jobId:null,status:"publishing",phase:"pending",progress:{completed:0,total:e.keys.length},instagramPostId:null,error:null});try{const{id:n}=await Bl({sessionId:t,groupId:e.id,keys:e.keys,caption:r.caption,hashtags:r.hashtags});Zt(e.id,{...rt(e.id),jobId:n});const o=3e3,i=200;for(let a=0;a<i;a++){await new Promise(d=>setTimeout(d,o));const l=await Ml(n,t),f=rt(e.id);if(Zt(e.id,{...f,jobId:n,status:l.status==="published"?"published":l.status==="error"?"error":"publishing",phase:l.phase,progress:l.progress,instagramPostId:l.instagramPostId??null,error:l.error??null}),l.status==="published"||l.status==="error")break}}catch(n){Zt(e.id,{...rt(e.id),status:"error",error:n instanceof Error?n.message:"Publish failed"})}}function nu({group:e}){const t=rt(e.id),r=t.status==="idle",n=t.status==="publishing",o=t.status==="published",i=t.status==="error",a=e.keys.slice(0,8).map(v=>_e.value.find(_=>_.key===v)).filter(v=>v!==void 0),l=e.keys.map(v=>_e.value.find(_=>_.key===v)).filter(v=>v!==void 0),f=l.filter(v=>v.type==="Photo").length,d=l.filter(v=>v.type==="Video").length,m=t.caption.length>0;return s("div",{class:"card",style:{marginBottom:"0.75rem",border:o?"1px solid var(--color-success)":i?"1px solid var(--color-danger)":"1px solid var(--color-border)"},children:[s("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"1rem",marginBottom:"0.75rem"},children:[s("div",{style:{flex:1},children:[s("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[s("h3",{style:{margin:0,fontSize:"1rem",color:e.label?"var(--color-text)":"var(--color-text-secondary)"},children:e.label||"Untitled group"}),o&&s("span",{style:{fontSize:"0.625rem",padding:"0.125rem 0.375rem",borderRadius:"3px",background:"rgba(108, 200, 108, 0.15)",color:"var(--color-success)",fontWeight:600},children:"Published"})]}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:[e.keys.length," item",e.keys.length!==1?"s":"",f>0&&s($,{children:["  ",f," photo",f!==1?"s":""]}),d>0&&s($,{children:["  ",d," video",d!==1?"s":""]})]})]}),s("div",{style:{display:"flex",gap:"2px",flexShrink:0},children:[a.map(v=>s("div",{style:{width:"2.5rem",height:"2.5rem",borderRadius:"3px",overflow:"hidden",background:"var(--color-surface-hover)",position:"relative"},children:[s("img",{src:ye(v.thumbnailKey),alt:"",style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:_=>{_.target.style.display="none"}}),v.type==="Video"&&s("span",{style:{position:"absolute",bottom:"1px",right:"1px",fontSize:"0.5rem",background:"rgba(0,0,0,0.6)",color:"#fff",padding:"1px 2px",borderRadius:"2px"},children:"VID"})]},v.key)),e.keys.length>8&&s("div",{style:{width:"2.5rem",height:"2.5rem",borderRadius:"3px",background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.5625rem",color:"var(--color-text-secondary)"},children:["+",e.keys.length-8]})]})]}),m&&s("div",{style:{padding:"0.5rem 0.75rem",background:"var(--color-bg)",borderRadius:"var(--radius)",border:"1px solid var(--color-border)",fontSize:"0.8125rem",lineHeight:"1.5",whiteSpace:"pre-wrap",marginBottom:"0.75rem",maxHeight:"4.5rem",overflow:"hidden",position:"relative"},children:[t.caption.slice(0,200),t.caption.length>200&&s("span",{style:{color:"var(--color-text-secondary)"},children:"..."})]}),!m&&r&&s("div",{style:{padding:"0.5rem 0.75rem",background:"rgba(255, 200, 50, 0.06)",borderRadius:"var(--radius)",border:"1px solid rgba(255, 200, 50, 0.2)",fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.75rem"},children:"No caption set. Generate captions in the Description step first, or publish without a caption."}),t.hashtags.length>0&&s("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem",marginBottom:"0.75rem"},children:[t.hashtags.slice(0,10).map((v,_)=>s("span",{style:{fontSize:"0.6875rem",padding:"0.125rem 0.375rem",background:"rgba(108, 140, 255, 0.1)",color:"var(--color-primary)",borderRadius:"3px"},children:["#",v]},`${v}-${_}`)),t.hashtags.length>10&&s("span",{style:{fontSize:"0.6875rem",color:"var(--color-text-secondary)",padding:"0.125rem 0.25rem"},children:["+",t.hashtags.length-10," more"]})]}),n&&s("div",{style:{padding:"0.75rem",background:"rgba(108, 140, 255, 0.06)",borderRadius:"var(--radius)",marginBottom:"0.5rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[s("span",{style:{fontSize:"0.8125rem",fontWeight:500},children:ru(t.phase)}),s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:[t.progress.completed,"/",t.progress.total]})]}),s("div",{style:{height:"4px",background:"var(--color-border)",borderRadius:"2px",overflow:"hidden"},children:s("div",{style:{height:"100%",width:t.progress.total>0?`${t.progress.completed/t.progress.total*100}%`:"0%",background:"var(--color-primary)",borderRadius:"2px",transition:"width 0.3s ease"}})}),s("div",{style:{marginTop:"0.5rem",width:"1.25rem",height:"1.25rem",border:"2px solid var(--color-border)",borderTop:"2px solid var(--color-primary)",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0.5rem auto 0"}}),s("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}),o&&s("div",{style:{padding:"0.75rem",background:"rgba(108, 200, 108, 0.06)",borderRadius:"var(--radius)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s("span",{style:{fontSize:"0.8125rem",color:"var(--color-success)",fontWeight:500},children:"Successfully published to Instagram"}),t.instagramPostId&&s("a",{href:`https://www.instagram.com/p/${t.instagramPostId}/`,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"0.8125rem",color:"var(--color-primary)",textDecoration:"none",fontWeight:500},children:"View on Instagram"})]}),i&&s("div",{style:{padding:"0.75rem",background:"rgba(255, 107, 107, 0.06)",borderRadius:"var(--radius)",marginBottom:"0.5rem"},children:[s("div",{style:{fontSize:"0.8125rem",color:"var(--color-danger)",marginBottom:"0.5rem"},children:t.error}),s("button",{class:"outline",onClick:()=>yi(e),style:{fontSize:"0.75rem"},children:"Retry"})]}),r&&s("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"0.75rem"},children:[Re.value===!1&&s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Instagram not connected"}),s("button",{class:"primary",onClick:()=>yi(e),disabled:!Re.value,style:{fontSize:"0.8125rem",opacity:Re.value?1:.4,cursor:Re.value?"pointer":"not-allowed"},children:"Publish to Instagram"})]})]})}function iu(){const e=F.value;return qe(()=>{eu()},[]),s("div",{children:[Re.value===!1&&s("div",{class:"card",style:{marginBottom:"1rem",padding:"0.75rem 1rem",background:"rgba(255, 200, 50, 0.08)",border:"1px solid rgba(255, 200, 50, 0.25)",display:"flex",alignItems:"center",gap:"0.75rem"},children:[s("span",{style:{fontSize:"1.125rem"},children:""}),s("div",{children:[s("div",{style:{fontSize:"0.875rem",fontWeight:500,marginBottom:"0.125rem"},children:"Instagram not connected"}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Publishing is disabled. Provide a long-lived access token and user ID via SSM Parameter Store to enable Instagram publishing."})]})]}),s("div",{class:"card",style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"0.5rem"},children:[s("div",{children:s("span",{style:{fontSize:"0.875rem"},children:[s("strong",{children:Fr.value})," post group",Fr.value!==1?"s":"",St.value>0&&s($,{children:["  ",s("span",{style:{color:"var(--color-success)"},children:[St.value," published"]})]})]})}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"Each group is published as an Instagram carousel (or single post for 1 item)."})]}),e.map(t=>s(nu,{group:t},t.id)),s("div",{style:{position:"sticky",bottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",background:"var(--color-surface)",borderRadius:"var(--radius-lg)",border:"1px solid var(--color-border)"},children:[s("div",{style:{display:"flex",gap:"0.5rem"},children:[s("button",{class:"outline",onClick:()=>Ge(),children:"Back"}),s("button",{class:"outline",onClick:()=>Ue("description"),style:{fontSize:"0.8125rem"},children:"Generate Captions"})]}),s("span",{style:{fontSize:"0.875rem"},children:St.value===0?s("span",{style:{color:"var(--color-text-secondary)"},children:"Ready to publish your posts"}):s($,{children:[s("strong",{style:{color:"var(--color-success)"},children:[St.value," of ",Fr.value]}),s("span",{style:{color:"var(--color-text-secondary)"},children:[" ","group",St.value!==1?"s":""," published"]})]})})]})]})}const Ee=E(0),L=E({jobId:null,status:"idle",caption:"",hashtags:[],locationTag:"",feedbackRound:0,error:null}),Be=E(""),nt=E(!1),dr=E("idle");function Eo(){Ee.value=0,L.value={jobId:null,status:"idle",caption:"",hashtags:[],locationTag:"",feedbackRound:0,error:null},Be.value="",nt.value=!1,dr.value="idle"}const Sn=Y(()=>{const e=F.value,t=Ee.value;return t<e.length?e[t]:null}),ko=Y(()=>Ee.value<F.value.length-1),ou=Y(()=>F.value.length);async function _i(){const e=Sn.value,t=j.value;if(!(!e||!t)){L.value={jobId:null,status:"generating",caption:"",hashtags:[],locationTag:"",feedbackRound:0,error:null};try{const{id:r}=await Dl({sessionId:t,keys:e.keys,groupLabel:e.label,tripContext:st.value});L.value={...L.value,jobId:r},await Uo(r,t)}catch(r){L.value={...L.value,status:"error",error:r instanceof Error?r.message:"Generation failed"}}}}async function Uo(e,t){for(let o=0;o<30;o++){await new Promise(i=>setTimeout(i,2e3));try{const i=await Rl(e,t);if(i.status==="complete"){L.value={jobId:e,status:"complete",caption:i.caption??"",hashtags:i.hashtags??[],locationTag:i.locationTag??"",feedbackRound:i.feedbackRound,error:null};return}if(i.status==="error"){L.value={jobId:e,status:"error",caption:"",hashtags:[],locationTag:"",feedbackRound:0,error:i.error??"Generation failed"};return}}catch(i){console.warn("Poll error:",i)}}L.value={...L.value,status:"error",error:"Generation timed out"}}async function su(){const e=L.value,t=j.value;if(!e.jobId||!t||!Be.value.trim())return;const r=Be.value.trim();Be.value="",L.value={...L.value,status:"generating"};try{await Pl(e.jobId,{sessionId:t,feedback:r}),await Uo(e.jobId,t)}catch(n){L.value={...L.value,status:"error",error:n instanceof Error?n.message:"Feedback failed"}}}function au(){const e=L.value,t=e.hashtags.map(n=>`#${n}`).join(" "),r=`${e.caption}

${t}`;navigator.clipboard.writeText(r).then(()=>{dr.value="copied",setTimeout(()=>{dr.value="idle"},2e3)})}function lu(){const e=Sn.value,t=L.value;e&&t.status==="complete"&&tu(e.id,t.caption,t.hashtags),ko.value?(Ee.value=Ee.value+1,L.value={jobId:null,status:"idle",caption:"",hashtags:[],locationTag:"",feedbackRound:0,error:null},Be.value="",nt.value=!1):Ue("instagram-publish")}function cu({group:e}){const t=e.keys.slice(0,8).map(r=>_e.value.find(n=>n.key===r)).filter(r=>r!==void 0);return s("div",{style:{display:"flex",gap:"4px",overflowX:"auto",padding:"0.5rem 0"},children:[t.map(r=>s("div",{style:{width:"3.5rem",height:"3.5rem",borderRadius:"var(--radius)",overflow:"hidden",flexShrink:0,background:"var(--color-surface-hover)",position:"relative"},children:[s("img",{src:ye(r.thumbnailKey),alt:r.filename,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:n=>{n.target.style.display="none"}}),r.type==="Video"&&s("span",{style:{position:"absolute",bottom:"2px",right:"2px",fontSize:"0.5rem",background:"rgba(0,0,0,0.6)",color:"#fff",padding:"1px 3px",borderRadius:"2px"},children:"VID"})]},r.key)),e.keys.length>8&&s("div",{style:{width:"3.5rem",height:"3.5rem",borderRadius:"var(--radius)",background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.6875rem",color:"var(--color-text-secondary)",flexShrink:0},children:["+",e.keys.length-8]})]})}function uu({hashtags:e,onRemove:t}){return s("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.375rem"},children:e.map((r,n)=>s("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",fontSize:"0.75rem",background:"rgba(108, 140, 255, 0.1)",color:"var(--color-primary)",borderRadius:"var(--radius)",cursor:"pointer",transition:"background 0.15s"},onClick:()=>t(n),title:"Click to remove",children:["#",r,s("span",{style:{fontSize:"0.625rem",opacity:.6,marginLeft:"0.125rem"},children:"x"})]},`${r}-${n}`))})}function du(){return s("div",{style:{textAlign:"center",padding:"3rem 1rem"},children:[s("div",{style:{fontSize:"1.125rem",fontWeight:500,marginBottom:"0.75rem"},children:"Generating caption..."}),s("div",{style:{fontSize:"0.8125rem",color:"var(--color-text-secondary)"},children:"Analyzing your media and crafting an engaging Instagram caption"}),s("div",{style:{marginTop:"1.5rem",width:"2rem",height:"2rem",border:"3px solid var(--color-border)",borderTop:"3px solid var(--color-primary)",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"1.5rem auto 0"}}),s("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})}function fu(){const e=Sn.value,t=L.value,r=F.value;return qe(()=>{e&&t.status==="idle"&&_i()},[Ee.value]),e?s("div",{children:[r.length>1&&s("div",{class:"card",style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s("span",{style:{fontSize:"0.875rem"},children:["Post"," ",s("strong",{children:[Ee.value+1," of ",ou.value]})]}),s("div",{style:{display:"flex",gap:"4px"},children:r.map((n,o)=>s("div",{style:{width:"1.5rem",height:"4px",borderRadius:"2px",background:o<Ee.value?"var(--color-success)":o===Ee.value?"var(--color-primary)":"var(--color-border)"}},o))})]}),s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("h3",{style:{margin:"0 0 0.5rem",fontSize:"1rem",color:e.label?"var(--color-text)":"var(--color-text-secondary)"},children:e.label||"Untitled group"}),s("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",marginBottom:"0.5rem"},children:[e.keys.length," item",e.keys.length!==1?"s":""," in this post"]}),s(cu,{group:e})]}),t.status==="generating"&&s("div",{class:"card",style:{marginBottom:"1rem"},children:s(du,{})}),t.status==="error"&&s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:t.error}),s("button",{class:"primary",onClick:()=>_i(),children:"Try Again"})]}),t.status==="complete"&&s($,{children:[s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},children:[s("h3",{style:{margin:0,fontSize:"0.9375rem"},children:"Caption"}),s("div",{style:{display:"flex",gap:"0.5rem"},children:[t.feedbackRound>0&&s("span",{style:{fontSize:"0.6875rem",color:"var(--color-text-secondary)",padding:"0.125rem 0.375rem",background:"var(--color-surface-hover)",borderRadius:"3px"},children:["v",t.feedbackRound+1]}),s("button",{class:"outline",style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem"},onClick:()=>{nt.value=!nt.value},children:nt.value?"Done":"Edit"})]})]}),nt.value?s("textarea",{value:t.caption,onInput:n=>{L.value={...L.value,caption:n.target.value}},style:{width:"100%",minHeight:"8rem",padding:"0.75rem",fontSize:"0.875rem",lineHeight:"1.5",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",background:"var(--color-bg)",color:"var(--color-text)",resize:"vertical",fontFamily:"inherit"}}):s("div",{style:{padding:"0.75rem",background:"var(--color-bg)",borderRadius:"var(--radius)",border:"1px solid var(--color-border)",fontSize:"0.875rem",lineHeight:"1.6",whiteSpace:"pre-wrap"},children:t.caption})]}),t.locationTag&&s("div",{class:"card",style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s("span",{style:{fontSize:"0.8125rem",color:"var(--color-text-secondary)"},children:"Location:"}),s("span",{style:{fontSize:"0.8125rem",fontWeight:500,color:"var(--color-primary)"},children:t.locationTag})]}),s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("h3",{style:{margin:"0 0 0.75rem",fontSize:"0.9375rem"},children:["Hashtags",s("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",fontWeight:400,marginLeft:"0.5rem"},children:["(",t.hashtags.length,")"]})]}),s(uu,{hashtags:t.hashtags,onRemove:n=>{L.value={...L.value,hashtags:t.hashtags.filter((o,i)=>i!==n)}}}),s("div",{style:{marginTop:"0.5rem",fontSize:"0.6875rem",color:"var(--color-text-secondary)"},children:"Click a hashtag to remove it"})]}),s("div",{class:"card",style:{marginBottom:"1rem"},children:[s("h3",{style:{margin:"0 0 0.5rem",fontSize:"0.9375rem"},children:"Want changes?"}),s("div",{style:{display:"flex",gap:"0.5rem",alignItems:"flex-end"},children:[s("textarea",{value:Be.value,onInput:n=>{Be.value=n.target.value},placeholder:'e.g., "make it shorter", "more casual", "add more food hashtags"',style:{flex:1,minHeight:"3rem",maxHeight:"6rem",padding:"0.5rem 0.75rem",fontSize:"0.8125rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",background:"var(--color-bg)",color:"var(--color-text)",resize:"vertical",fontFamily:"inherit"}}),s("button",{class:"primary",disabled:!Be.value.trim(),onClick:()=>su(),style:{fontSize:"0.8125rem",flexShrink:0},children:"Regenerate"})]})]})]}),s("div",{style:{position:"sticky",bottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",background:"var(--color-surface)",borderRadius:"var(--radius-lg)",border:"1px solid var(--color-border)"},children:[s("button",{class:"outline",onClick:()=>Ge(),children:"Back"}),s("div",{style:{display:"flex",gap:"0.5rem"},children:t.status==="complete"&&s($,{children:[s("button",{class:"outline",onClick:()=>au(),style:{fontSize:"0.8125rem"},children:dr.value==="copied"?"Copied!":"Copy to Clipboard"}),s("button",{class:"primary",onClick:()=>lu(),style:{fontSize:"0.8125rem"},children:ko.value?"Accept & Next Group":"Done"})]})})]})]}):s("div",{class:"card",style:{textAlign:"center",padding:"2rem"},children:[s("p",{style:{color:"var(--color-text-secondary)"},children:"No post groups to generate descriptions for."}),s("button",{class:"outline",onClick:()=>Ge(),children:"Back"})]})}const ve=E(null),ge=E(new Set),fr=E(!1),Ke=E(null),Ot=E(null);function He(e){return e.key??e.path}function hu(e){return e.key?ye(e.key):ye(e.path)}function pu(e){const t=j.value??void 0,r=setInterval(async()=>{try{const n=await xl(e,t);ve.value=n,(n.status==="complete"||n.status==="error")&&(clearInterval(r),U.value="results",n.discard.length>0&&(ge.value=new Set(n.discard.map(o=>He(o)))))}catch(n){Ot.value=n instanceof Error?n.message:"Failed to poll results",clearInterval(r)}},2e3);return()=>clearInterval(r)}function vu(e){const t=new Set(ge.value);t.has(e)?t.delete(e):t.add(e),ge.value=t}function mu(){ve.value&&(ge.value=new Set(ve.value.discard.map(e=>He(e))))}function gu(){ge.value=new Set}async function yu(){if(Me.value){fr.value=!0;try{const e=Array.from(ge.value),t=ce?{deleteKeys:e,sessionId:j.value}:{deletePaths:e},r=await Cl(Me.value,t);Ke.value=r}catch(e){Ot.value=e instanceof Error?e.message:"Failed to confirm deletion"}finally{fr.value=!1}}}function Br(){ve.value=null,ge.value=new Set,Ke.value=null,Ot.value=null,Me.value=null,dt.value=[],j.value=null,rn()}function wi({item:e,selectable:t,isSelected:r,onToggle:n}){return s("div",{onClick:t?n:void 0,style:{background:r?"rgba(255, 107, 107, 0.1)":"var(--color-bg)",border:r?"2px solid var(--color-danger)":"2px solid transparent",borderRadius:"var(--radius)",overflow:"hidden",cursor:t?"pointer":"default"},children:[s("div",{style:{width:"100%",aspectRatio:"1",background:"var(--color-surface-hover)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[s("img",{src:hu(e),alt:e.filename,title:e.filename,loading:"lazy",onClick:o=>{o.stopPropagation(),Mt(He(e),uo(e.filename)?"Video":"Photo",e.filename)},style:{width:"100%",height:"100%",objectFit:"cover",cursor:"zoom-in"},onError:o=>{o.target.style.display="none"}}),t&&s("input",{type:"checkbox",checked:r,onClick:o=>o.stopPropagation(),onChange:n,style:{position:"absolute",top:"0.5rem",left:"0.5rem",width:"1.25rem",height:"1.25rem"}})]}),s("div",{style:{padding:"0.5rem"},children:[s("div",{title:e.filename,style:{fontSize:"0.75rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.filename}),s("div",{style:{fontSize:"0.6875rem",color:"var(--color-text-secondary)",marginTop:"0.25rem"},children:e.reason})]})]})}function _u(){if(qe(()=>{if(Me.value&&!ve.value)return pu(Me.value)},[]),Ke.value)return s("div",{class:"card",style:{textAlign:"center"},children:[s("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:Ke.value.errors.length===0?"Done":"Completed with errors"}),s("p",{children:["Deleted ",Ke.value.deleted," file(s)",!ce,"."]}),Ke.value.errors.length>0&&s("div",{style:{color:"var(--color-danger)",marginTop:"1rem",fontSize:"0.875rem"},children:Ke.value.errors.map(r=>s("div",{children:r},r))}),s("button",{class:"primary",onClick:Br,style:{marginTop:"1.5rem"},children:"Start Over"})]});if(!ve.value||ve.value.status==="pending"||ve.value.status==="processing")return s("div",{class:"card",style:{textAlign:"center",padding:"3rem"},children:s("p",{style:{color:"var(--color-text-secondary)"},children:"Analyzing media with AI... This may take a minute."})});if(ve.value.status==="error")return s("div",{class:"card",children:[s("p",{style:{color:"var(--color-danger)"},children:["Triage failed: ",ve.value.error]}),s("button",{class:"outline",onClick:Br,style:{marginTop:"1rem"},children:"Start Over"})]});const{keep:e,discard:t}=ve.value;return s("div",{children:[Ot.value&&s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:Ot.value}),s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[s("h2",{style:{color:"var(--color-danger)"},children:["Discard (",t.length,")"]}),s("div",{style:{display:"flex",gap:"0.5rem"},children:[s("button",{class:"outline",onClick:mu,children:"Select all"}),s("button",{class:"outline",onClick:gu,children:"Deselect all"})]})]}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))",gap:"0.75rem"},children:t.map(r=>s(wi,{item:r,selectable:!0,isSelected:ge.value.has(He(r)),onToggle:()=>vu(He(r))},He(r)))})]}),s("div",{class:"card",style:{marginBottom:"1.5rem"},children:[s("h2",{style:{color:"var(--color-success)",marginBottom:"1rem"},children:["Keep (",e.length,")"]}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))",gap:"0.75rem"},children:e.map(r=>s(wi,{item:r,selectable:!1,isSelected:!1},He(r)))})]}),s("div",{style:{position:"sticky",bottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",background:"var(--color-surface)",borderRadius:"var(--radius-lg)",border:"1px solid var(--color-border)"},children:[s("span",{style:{fontSize:"0.875rem"},children:[ge.value.size," of ",t.length," marked for deletion"]}),s("div",{style:{display:"flex",gap:"0.75rem"},children:[s("button",{class:"outline",onClick:Br,children:"Cancel"}),s("button",{class:"danger",onClick:yu,disabled:ge.value.size===0||fr.value,children:fr.value?"Deleting...":`Delete ${ge.value.size} file(s)`})]})]})]})}const wu="image/jpeg,image/png,image/gif,image/webp,image/heic,image/heif,video/mp4,video/quicktime,video/x-msvideo,video/webm,video/x-matroska",J=E([]),Nt=E(null);function Su(){return crypto.randomUUID()}function bu(e){const t=e.target;!t.files||t.files.length===0||(Ro(Array.from(t.files)),t.value="")}function xu(e){return new Promise((t,r)=>{const n=[];function o(){e.readEntries(i=>{i.length===0?t(n):(n.push(...i),o())},r)}o()})}function Cu(e){return new Promise((t,r)=>e.file(t,r))}async function Do(e){if(e.isFile)try{return[await Cu(e)]}catch{return[]}if(e.isDirectory){const t=e.createReader(),r=await xu(t);return(await Promise.all(r.map(Do))).flat()}return[]}async function Tu(e){const r=Array.from(e.items).map(o=>{var i;return(i=o.webkitGetAsEntry)==null?void 0:i.call(o)}).filter(o=>o!=null);return r.length===0?Array.from(e.files):(await Promise.all(r.map(Do))).flat()}async function Iu(e){if(e.preventDefault(),e.stopPropagation(),!e.dataTransfer)return;const t=await Tu(e.dataTransfer);t.length>0&&Ro(t)}function Au(e){e.preventDefault(),e.stopPropagation()}function Ro(e){j.value||(j.value=Su());const t=j.value,r=new Set(J.value.map(i=>i.name)),n=[],o=new Map;for(const i of e)r.has(i.name)||(r.add(i.name),n.push({name:i.name,size:i.size,key:`${t}/${i.name}`,status:"pending",progress:0}),o.set(i.name,i));if(n.length!==0){J.value=[...J.value,...n];for(const i of n)Eu(t,i.name,o.get(i.name))}}async function Eu(e,t,r){bt(t,{status:"uploading",progress:0});try{let n;if(r.size>so)n=await ao(e,r,(o,i)=>{bt(t,{progress:Math.round(o/i*100)})});else{const o=await io(e,t,r.type);n=o.key,await oo(o.uploadUrl,r,(i,a)=>{bt(t,{progress:Math.round(i/a*100)})})}bt(t,{status:"done",progress:100,key:n})}catch(n){bt(t,{status:"error",error:n instanceof Error?n.message:"Upload failed"})}}function bt(e,t){J.value=J.value.map(r=>r.name===e?{...r,...t}:r)}function ku(e){J.value=J.value.filter(t=>t.name!==e)}function Uu(){J.value=[],j.value=null}function Du(){J.value=[],Nt.value=null}async function Ru(){const e=J.value.filter(r=>r.status==="done").map(r=>r.key);if(e.length===0)return;const t=j.value;if(t){Nt.value=null,dt.value=e;try{const r=await lo({sessionId:t});Me.value=r.id,Ue("processing")}catch(r){Nt.value=r instanceof Error?r.message:"Failed to start triage"}}}function Pu(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`}function Fu(){const e=J.value.length>0&&J.value.every(n=>n.status==="done"||n.status==="error"),t=J.value.filter(n=>n.status==="done").length,r=J.value.some(n=>n.status==="uploading");return s("div",{class:"card",children:[s("p",{style:{color:"var(--color-text-secondary)",fontSize:"0.875rem",marginBottom:"1.5rem"},children:"Upload media files for AI triage analysis. Drag and drop or use the button below."}),s("div",{onDrop:Iu,onDragOver:Au,style:{border:"2px dashed var(--color-border)",borderRadius:"var(--radius)",padding:"2rem",textAlign:"center",marginBottom:"1.5rem",cursor:"pointer",transition:"border-color 0.2s"},onClick:()=>{var n;return(n=document.getElementById("file-input"))==null?void 0:n.click()},children:[s("input",{id:"file-input",type:"file",multiple:!0,accept:wu,onChange:bu,style:{display:"none"}}),s("div",{style:{fontSize:"1.25rem",marginBottom:"0.5rem",color:"var(--color-text-secondary)"},children:"Drop files here"}),s("div",{style:{fontSize:"0.8125rem",color:"var(--color-text-secondary)"},children:"or click to browse  JPEG, PNG, GIF, WebP, HEIC, MP4, MOV"})]}),J.value.length>0&&s("div",{style:{background:"var(--color-bg)",borderRadius:"var(--radius)",padding:"0.5rem",maxHeight:"400px",overflowY:"auto",marginBottom:"1.5rem"},children:J.value.map(n=>s("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.375rem 0.5rem",borderBottom:"1px solid var(--color-border)"},children:[s("span",{style:{width:"0.5rem",height:"0.5rem",borderRadius:"50%",flexShrink:0,background:n.status==="done"?"var(--color-success)":n.status==="error"?"var(--color-danger)":n.status==="uploading"?"var(--color-accent)":"var(--color-text-secondary)"}}),s("span",{style:{flex:1,fontSize:"0.8125rem",fontFamily:"var(--font-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:n.name,children:n.name}),s("span",{style:{fontSize:"0.6875rem",color:"var(--color-text-secondary)",flexShrink:0},children:Pu(n.size)}),s("span",{style:{fontSize:"0.6875rem",color:n.status==="error"?"var(--color-danger)":"var(--color-text-secondary)",flexShrink:0,minWidth:"3.5rem",textAlign:"right",position:"relative",cursor:n.status==="error"?"help":"default"},title:n.status==="error"?n.error||"Upload failed":void 0,children:n.status==="uploading"?`${n.progress}%`:n.status==="done"?"Uploaded":n.status==="error"?s($,{children:["Failed ",s("span",{style:{fontSize:"0.625rem",opacity:.8},children:""})]}):"Pending"}),s("button",{class:"outline",onClick:()=>ku(n.name),disabled:n.status==="uploading",style:{padding:"0.125rem 0.5rem",fontSize:"0.75rem",flexShrink:0},children:"Remove"})]},n.name))}),Nt.value&&s("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.875rem"},children:Nt.value}),J.value.length===0&&s("p",{style:{color:"var(--color-text-secondary)",padding:"2rem 1rem",textAlign:"center",fontSize:"0.875rem"},children:"No files selected yet. Drag and drop media files or click the drop zone above."}),J.value.length>0&&s("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:[t," of ",J.value.length," file(s) uploaded",r&&"  uploading..."]}),s("div",{style:{display:"flex",gap:"0.75rem"},children:[s("button",{class:"outline",onClick:Uu,disabled:r,children:"Clear all"}),s("button",{class:"primary",onClick:Ru,disabled:!e||t===0,children:"Continue to Triage"})]})]})]})}const zt=E(null),U=E("landing"),dt=E([]),Me=E(null),j=E(null),st=E(""),Oe=E([]),tr=[{steps:["upload"],invalidationKey:"upload"},{steps:["selecting","review-selection"],invalidationKey:"selection"},{steps:["enhancing","review-enhanced"],invalidationKey:"enhancement"},{steps:["group-posts"],invalidationKey:"grouping"},{steps:["publish"],invalidationKey:"download"},{steps:["description"],invalidationKey:"description"},{steps:["instagram-publish"],invalidationKey:"publish"}];function Bu(e){return tr.findIndex(t=>t.steps.includes(e))}function Ue(e){Oe.value=[...Oe.value,U.value],U.value=e}function Ge(){const e=Oe.value;if(e.length===0)return;const t=e[e.length-1];Oe.value=e.slice(0,-1),U.value=t}async function Po(e){const t=j.value;if(!t)return;Ol({sessionId:t,fromStep:e}).catch(o=>{console.warn("Backend invalidation failed (non-blocking):",o)});const r={selection:xo,enhancement:_o,grouping:ho,download:go,description:Eo,publish:Ao},n=tr.findIndex(o=>o.invalidationKey===e);if(n>=0){for(const i of tr.slice(n)){const a=r[i.invalidationKey];a&&a()}const o=new Set(tr.slice(n).flatMap(i=>i.steps));Oe.value=Oe.value.filter(i=>!o.has(i))}}const Si=Y(()=>zt.value==="triage"?"Media Triage":(zt.value==="selection","Media Tools")),Mu=Y(()=>{switch(U.value){case"landing":return"Choose a Tool";case"browse":return"Select Media";case"confirm-files":return"Confirm Selection";case"triage-upload":return"Upload Media";case"processing":return"Processing...";case"results":return"Triage Results";case"upload":return"Upload Media";case"selecting":return"AI Selection";case"review-selection":return"Review Selection";case"enhancing":return"Enhancement";case"review-enhanced":return"Review Enhanced";case"group-posts":return"Group into Posts";case"publish":return"Publish or Download";case"description":return"Post Description";case"instagram-publish":return"Publish to Instagram"}});function rn(){zt.value=null,U.value="landing",Oe.value=[],dt.value=[],Me.value=null,j.value=null,st.value="",xo(),_o(),ho(),go(),Eo(),Ao(),Du()}const bi=Y(()=>zt.value==="selection"&&Bu(U.value)>=0),Xt=Y(()=>U.value==="landing");function Ou(){return Yr.value?s("div",{style:{textAlign:"center",padding:"4rem 0"},children:s("p",{style:{color:"var(--color-text-secondary)"},children:"Loading..."})}):Pt()&&!Ae.value?s("div",{children:[s("header",{style:{marginBottom:"2rem"},children:s("h1",{children:Si.value})}),s(vc,{})]}):s("div",{children:[s("header",{style:{marginBottom:bi.value?"1rem":"2rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s("div",{children:[s("h1",{onClick:Xt.value?void 0:rn,style:{cursor:Xt.value?"default":"pointer"},title:Xt.value?void 0:"Back to Home",children:Si.value}),s("p",{style:{color:"var(--color-text-secondary)"},children:Mu.value})]}),s("div",{style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[!Xt.value&&s("button",{class:"outline",onClick:rn,style:{fontSize:"0.8125rem"},children:"Home"}),Pt()&&s("button",{class:"outline",onClick:()=>ml(),style:{fontSize:"0.8125rem"},children:"Sign Out"})]})]}),U.value==="landing"&&ce&&s(hc,{}),bi.value&&s(Qc,{}),U.value==="browse"&&!ce,U.value==="confirm-files"&&s(zc,{}),U.value==="triage-upload"&&ce&&s(Fu,{}),(U.value==="processing"||U.value==="results")&&s(_u,{}),U.value==="upload"&&ce&&s(Bc,{}),(U.value==="selecting"||U.value==="review-selection")&&ce&&s(Wc,{}),(U.value==="enhancing"||U.value==="review-enhanced")&&ce&&s(dc,{}),U.value==="group-posts"&&ce&&s(Ql,{}),U.value==="publish"&&ce&&s(nc,{}),U.value==="description"&&ce&&s(fu,{}),U.value==="instagram-publish"&&ce&&s(iu,{}),s(ic,{})]})}pl().then(()=>{Zo(s(Ou,{}),document.getElementById("app"))});
